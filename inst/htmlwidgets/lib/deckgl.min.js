(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === 'object' && typeof module === 'object')
    module.exports = factory();
  else if (typeof define === 'function' && define.amd) define([], factory);
        else if (typeof exports === 'object') exports['deck'] = factory();
  else root['deck'] = factory();})(globalThis, function () {
"use strict";var __exports__=(()=>{var Tle=Object.create;var Od=Object.defineProperty;var Sle=Object.getOwnPropertyDescriptor;var Ple=Object.getOwnPropertyNames;var wle=Object.getPrototypeOf,Ole=Object.prototype.hasOwnProperty;var W2=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(r,e)=>(typeof require<"u"?require:r)[e]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var Te=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports),tn=(t,r)=>{for(var e in r)Od(t,e,{get:r[e],enumerable:!0})},$2=(t,r,e,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of Ple(r))!Ole.call(t,i)&&i!==e&&Od(t,i,{get:()=>r[i],enumerable:!(n=Sle(r,i))||n.enumerable});return t};var h=(t,r,e)=>(e=t!=null?Tle(wle(t)):{},$2(r||!t||!t.__esModule?Od(e,"default",{value:t,enumerable:!0}):e,t)),Ele=t=>$2(Od({},"__esModule",{value:!0}),t);var q2=Te((zBe,X2)=>{function Cle(t){if(Array.isArray(t))return t}X2.exports=Cle});var K2=Te((VBe,Y2)=>{function Mle(t,r){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]"){var e=[],n=!0,i=!1,a=void 0;try{for(var o=t[Symbol.iterator](),s;!(n=(s=o.next()).done)&&(e.push(s.value),!(r&&e.length===r));n=!0);}catch(u){i=!0,a=u}finally{try{!n&&o.return!=null&&o.return()}finally{if(i)throw a}}return e}}Y2.exports=Mle});var Z2=Te((HBe,J2)=>{function Ile(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}J2.exports=Ile});var ye=Te((WBe,Q2)=>{var Rle=q2(),Lle=K2(),kle=Z2();function Ble(t,r){return Rle(t)||Lle(t,r)||kle()}Q2.exports=Ble});var ge=Te(($Be,tI)=>{function eI(t,r,e,n,i,a,o){try{var s=t[a](o),u=s.value}catch(l){e(l);return}s.done?r(u):Promise.resolve(u).then(n,i)}function Fle(t){return function(){var r=this,e=arguments;return new Promise(function(n,i){var a=t.apply(r,e);function o(u){eI(a,n,i,o,s,"next",u)}function s(u){eI(a,n,i,o,s,"throw",u)}o(void 0)})}}tI.exports=Fle});var L=Te((XBe,rI)=>{function Dle(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}rI.exports=Dle});var N=Te((qBe,iI)=>{function nI(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Nle(t,r,e){return r&&nI(t.prototype,r),e&&nI(t,e),t}iI.exports=Nle});var _e=Te((YBe,aI)=>{function jle(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}aI.exports=jle});var q=Te((KBe,bb)=>{function _b(t){return bb.exports=_b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_b(t)}bb.exports=_b});var sI=Te((JBe,oI)=>{var Ule=q();function Gle(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&(t=Ule(t),t!==null););return t}oI.exports=Gle});var Oe=Te((ZBe,Cd)=>{var zle=sI();function Ed(t,r,e){return typeof Reflect<"u"&&Reflect.get?Cd.exports=Ed=Reflect.get:Cd.exports=Ed=function(i,a,o){var s=zle(i,a);if(s){var u=Object.getOwnPropertyDescriptor(s,a);return u.get?u.get.call(o):u.value}},Ed(t,r,e||t)}Cd.exports=Ed});var Tb=Te((QBe,Ab)=>{function xb(t,r){return Ab.exports=xb=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},xb(t,r)}Ab.exports=xb});var Y=Te((e3e,uI)=>{var Vle=Tb();function Hle(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&Vle(t,r)}uI.exports=Hle});var Je=Te((t3e,Id)=>{function Md(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Id.exports=Md=function(e){return typeof e}:Id.exports=Md=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Md(t)}Id.exports=Md});var K=Te((r3e,lI)=>{var Wle=Je(),$le=_e();function Xle(t,r){return r&&(Wle(r)==="object"||typeof r=="function")?r:$le(t)}lI.exports=Xle});var B=Te((n3e,fI)=>{function qle(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}fI.exports=qle});var pI=Te((i3e,Sb)=>{var cI=function(t){"use strict";var r=Object.prototype,e=r.hasOwnProperty,n,i=typeof Symbol=="function"?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(k,U,j,X){var H=U&&U.prototype instanceof m?U:m,Q=Object.create(H.prototype),ne=new R(X||[]);return Q._invoke=w(k,j,ne),Q}t.wrap=u;function l(k,U,j){try{return{type:"normal",arg:k.call(U,j)}}catch(X){return{type:"throw",arg:X}}}var f="suspendedStart",c="suspendedYield",p="executing",d="completed",v={};function m(){}function g(){}function y(){}var _={};_[a]=function(){return this};var b=Object.getPrototypeOf,x=b&&b(b(z([])));x&&x!==r&&e.call(x,a)&&(_=x);var A=y.prototype=m.prototype=Object.create(_);g.prototype=A.constructor=y,y.constructor=g,y[s]=g.displayName="GeneratorFunction";function T(k){["next","throw","return"].forEach(function(U){k[U]=function(j){return this._invoke(U,j)}})}t.isGeneratorFunction=function(k){var U=typeof k=="function"&&k.constructor;return U?U===g||(U.displayName||U.name)==="GeneratorFunction":!1},t.mark=function(k){return Object.setPrototypeOf?Object.setPrototypeOf(k,y):(k.__proto__=y,s in k||(k[s]="GeneratorFunction")),k.prototype=Object.create(A),k},t.awrap=function(k){return{__await:k}};function O(k){function U(H,Q,ne,le){var xe=l(k[H],k,Q);if(xe.type==="throw")le(xe.arg);else{var we=xe.arg,ze=we.value;return ze&&typeof ze=="object"&&e.call(ze,"__await")?Promise.resolve(ze.__await).then(function(me){U("next",me,ne,le)},function(me){U("throw",me,ne,le)}):Promise.resolve(ze).then(function(me){we.value=me,ne(we)},function(me){return U("throw",me,ne,le)})}}var j;function X(H,Q){function ne(){return new Promise(function(le,xe){U(H,Q,le,xe)})}return j=j?j.then(ne,ne):ne()}this._invoke=X}T(O.prototype),O.prototype[o]=function(){return this},t.AsyncIterator=O,t.async=function(k,U,j,X){var H=new O(u(k,U,j,X));return t.isGeneratorFunction(U)?H:H.next().then(function(Q){return Q.done?Q.value:H.next()})};function w(k,U,j){var X=f;return function(Q,ne){if(X===p)throw new Error("Generator is already running");if(X===d){if(Q==="throw")throw ne;return G()}for(j.method=Q,j.arg=ne;;){var le=j.delegate;if(le){var xe=E(le,j);if(xe){if(xe===v)continue;return xe}}if(j.method==="next")j.sent=j._sent=j.arg;else if(j.method==="throw"){if(X===f)throw X=d,j.arg;j.dispatchException(j.arg)}else j.method==="return"&&j.abrupt("return",j.arg);X=p;var we=l(k,U,j);if(we.type==="normal"){if(X=j.done?d:c,we.arg===v)continue;return{value:we.arg,done:j.done}}else we.type==="throw"&&(X=d,j.method="throw",j.arg=we.arg)}}}function E(k,U){var j=k.iterator[U.method];if(j===n){if(U.delegate=null,U.method==="throw"){if(k.iterator.return&&(U.method="return",U.arg=n,E(k,U),U.method==="throw"))return v;U.method="throw",U.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var X=l(j,k.iterator,U.arg);if(X.type==="throw")return U.method="throw",U.arg=X.arg,U.delegate=null,v;var H=X.arg;if(!H)return U.method="throw",U.arg=new TypeError("iterator result is not an object"),U.delegate=null,v;if(H.done)U[k.resultName]=H.value,U.next=k.nextLoc,U.method!=="return"&&(U.method="next",U.arg=n);else return H;return U.delegate=null,v}T(A),A[s]="Generator",A[a]=function(){return this},A.toString=function(){return"[object Generator]"};function S(k){var U={tryLoc:k[0]};1 in k&&(U.catchLoc=k[1]),2 in k&&(U.finallyLoc=k[2],U.afterLoc=k[3]),this.tryEntries.push(U)}function I(k){var U=k.completion||{};U.type="normal",delete U.arg,k.completion=U}function R(k){this.tryEntries=[{tryLoc:"root"}],k.forEach(S,this),this.reset(!0)}t.keys=function(k){var U=[];for(var j in k)U.push(j);return U.reverse(),function X(){for(;U.length;){var H=U.pop();if(H in k)return X.value=H,X.done=!1,X}return X.done=!0,X}};function z(k){if(k){var U=k[a];if(U)return U.call(k);if(typeof k.next=="function")return k;if(!isNaN(k.length)){var j=-1,X=function H(){for(;++j<k.length;)if(e.call(k,j))return H.value=k[j],H.done=!1,H;return H.value=n,H.done=!0,H};return X.next=X}}return{next:G}}t.values=z;function G(){return{value:n,done:!0}}return R.prototype={constructor:R,reset:function(k){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(I),!k)for(var U in this)U.charAt(0)==="t"&&e.call(this,U)&&!isNaN(+U.slice(1))&&(this[U]=n)},stop:function(){this.done=!0;var k=this.tryEntries[0],U=k.completion;if(U.type==="throw")throw U.arg;return this.rval},dispatchException:function(k){if(this.done)throw k;var U=this;function j(xe,we){return Q.type="throw",Q.arg=k,U.next=xe,we&&(U.method="next",U.arg=n),!!we}for(var X=this.tryEntries.length-1;X>=0;--X){var H=this.tryEntries[X],Q=H.completion;if(H.tryLoc==="root")return j("end");if(H.tryLoc<=this.prev){var ne=e.call(H,"catchLoc"),le=e.call(H,"finallyLoc");if(ne&&le){if(this.prev<H.catchLoc)return j(H.catchLoc,!0);if(this.prev<H.finallyLoc)return j(H.finallyLoc)}else if(ne){if(this.prev<H.catchLoc)return j(H.catchLoc,!0)}else if(le){if(this.prev<H.finallyLoc)return j(H.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(k,U){for(var j=this.tryEntries.length-1;j>=0;--j){var X=this.tryEntries[j];if(X.tryLoc<=this.prev&&e.call(X,"finallyLoc")&&this.prev<X.finallyLoc){var H=X;break}}H&&(k==="break"||k==="continue")&&H.tryLoc<=U&&U<=H.finallyLoc&&(H=null);var Q=H?H.completion:{};return Q.type=k,Q.arg=U,H?(this.method="next",this.next=H.finallyLoc,v):this.complete(Q)},complete:function(k,U){if(k.type==="throw")throw k.arg;return k.type==="break"||k.type==="continue"?this.next=k.arg:k.type==="return"?(this.rval=this.arg=k.arg,this.method="return",this.next="end"):k.type==="normal"&&U&&(this.next=U),v},finish:function(k){for(var U=this.tryEntries.length-1;U>=0;--U){var j=this.tryEntries[U];if(j.finallyLoc===k)return this.complete(j.completion,j.afterLoc),I(j),v}},catch:function(k){for(var U=this.tryEntries.length-1;U>=0;--U){var j=this.tryEntries[U];if(j.tryLoc===k){var X=j.completion;if(X.type==="throw"){var H=X.arg;I(j)}return H}}throw new Error("illegal catch attempt")},delegateYield:function(k,U,j){return this.delegate={iterator:z(k),resultName:U,nextLoc:j},this.method==="next"&&(this.arg=n),v}},t}(typeof Sb=="object"?Sb.exports:{});try{regeneratorRuntime=cI}catch{Function("r","regeneratorRuntime = r")(cI)}});var de=Te((a3e,hI)=>{hI.exports=pI()});var Ld=Te((G3e,HI)=>{function afe(t){var r;if(typeof Symbol<"u"&&(Symbol.asyncIterator&&(r=t[Symbol.asyncIterator],r!=null)||Symbol.iterator&&(r=t[Symbol.iterator],r!=null)))return r.call(t);throw new TypeError("Object is not async iterable")}HI.exports=afe});var WI=Te(()=>{});var Wb=Te((pFe,KI)=>{function pfe(t){this.wrapped=t}KI.exports=pfe});var $b=Te((hFe,JI)=>{var hfe=Wb();function dfe(t){return new hfe(t)}JI.exports=dfe});var QI=Te((dFe,ZI)=>{var vfe=Wb();function sc(t){var r,e;function n(o,s){return new Promise(function(u,l){var f={key:o,arg:s,resolve:u,reject:l,next:null};e?e=e.next=f:(r=e=f,i(o,s))})}function i(o,s){try{var u=t[o](s),l=u.value,f=l instanceof vfe;Promise.resolve(f?l.wrapped:l).then(function(c){if(f){i(o==="return"?"return":"next",c);return}a(u.done?"return":"normal",c)},function(c){i("throw",c)})}catch(c){a("throw",c)}}function a(o,s){switch(o){case"return":r.resolve({value:s,done:!0});break;case"throw":r.reject(s);break;default:r.resolve({value:s,done:!1});break}r=r.next,r?i(r.key,r.arg):e=null}this._invoke=n,typeof t.return!="function"&&(this.return=void 0)}typeof Symbol=="function"&&Symbol.asyncIterator&&(sc.prototype[Symbol.asyncIterator]=function(){return this});sc.prototype.next=function(t){return this._invoke("next",t)};sc.prototype.throw=function(t){return this._invoke("throw",t)};sc.prototype.return=function(t){return this._invoke("return",t)};ZI.exports=sc});var Xb=Te((vFe,eR)=>{var mfe=QI();function gfe(t){return function(){return new mfe(t.apply(this,arguments))}}eR.exports=gfe});var hR=Te(()=>{});var TR=Te((fDe,AR)=>{function Dfe(t){if(Array.isArray(t)){for(var r=0,e=new Array(t.length);r<t.length;r++)e[r]=t[r];return e}}AR.exports=Dfe});var PR=Te((cDe,SR)=>{function Nfe(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}SR.exports=Nfe});var OR=Te((pDe,wR)=>{function jfe(){throw new TypeError("Invalid attempt to spread non-iterable instance")}wR.exports=jfe});var dr=Te((hDe,ER)=>{var Ufe=TR(),Gfe=PR(),zfe=OR();function Vfe(t){return Ufe(t)||Gfe(t)||zfe()}ER.exports=Vfe});var Sk=Te((hUe,iv)=>{var Upe=Tb();function Gpe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function nv(t,r,e){return Gpe()?iv.exports=nv=Reflect.construct:iv.exports=nv=function(i,a,o){var s=[null];s.push.apply(s,a);var u=Function.bind.apply(i,s),l=new u;return o&&Upe(l,o.prototype),l},nv.apply(null,arguments)}iv.exports=nv});var TG=Te((Rqe,Jm)=>{(function(t,r,e,n){"use strict";var i=["","webkit","Moz","MS","ms","o"],a=r.createElement("div"),o="function",s=Math.round,u=Math.abs,l=Date.now;function f(P,M,F){return setTimeout(_(P,F),M)}function c(P,M,F){return Array.isArray(P)?(p(P,F[M],F),!0):!1}function p(P,M,F){var $;if(P)if(P.forEach)P.forEach(M,F);else if(P.length!==n)for($=0;$<P.length;)M.call(F,P[$],$,P),$++;else for($ in P)P.hasOwnProperty($)&&M.call(F,P[$],$,P)}function d(P,M,F){var $="DEPRECATED METHOD: "+M+`
`+F+` AT
`;return function(){var ee=new Error("get-stack-trace"),he=ee&&ee.stack?ee.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ue=t.console&&(t.console.warn||t.console.log);return Ue&&Ue.call(t.console,$,he),P.apply(this,arguments)}}var v;typeof Object.assign!="function"?v=function(M){if(M===n||M===null)throw new TypeError("Cannot convert undefined or null to object");for(var F=Object(M),$=1;$<arguments.length;$++){var ee=arguments[$];if(ee!==n&&ee!==null)for(var he in ee)ee.hasOwnProperty(he)&&(F[he]=ee[he])}return F}:v=Object.assign;var m=d(function(M,F,$){for(var ee=Object.keys(F),he=0;he<ee.length;)(!$||$&&M[ee[he]]===n)&&(M[ee[he]]=F[ee[he]]),he++;return M},"extend","Use `assign`."),g=d(function(M,F){return m(M,F,!0)},"merge","Use `assign`.");function y(P,M,F){var $=M.prototype,ee;ee=P.prototype=Object.create($),ee.constructor=P,ee._super=$,F&&v(ee,F)}function _(P,M){return function(){return P.apply(M,arguments)}}function b(P,M){return typeof P==o?P.apply(M&&M[0]||n,M):P}function x(P,M){return P===n?M:P}function A(P,M,F){p(E(M),function($){P.addEventListener($,F,!1)})}function T(P,M,F){p(E(M),function($){P.removeEventListener($,F,!1)})}function O(P,M){for(;P;){if(P==M)return!0;P=P.parentNode}return!1}function w(P,M){return P.indexOf(M)>-1}function E(P){return P.trim().split(/\s+/g)}function S(P,M,F){if(P.indexOf&&!F)return P.indexOf(M);for(var $=0;$<P.length;){if(F&&P[$][F]==M||!F&&P[$]===M)return $;$++}return-1}function I(P){return Array.prototype.slice.call(P,0)}function R(P,M,F){for(var $=[],ee=[],he=0;he<P.length;){var Ue=M?P[he][M]:P[he];S(ee,Ue)<0&&$.push(P[he]),ee[he]=Ue,he++}return F&&(M?$=$.sort(function(hr,Er){return hr[M]>Er[M]}):$=$.sort()),$}function z(P,M){for(var F,$,ee=M[0].toUpperCase()+M.slice(1),he=0;he<i.length;){if(F=i[he],$=F?F+ee:M,$ in P)return $;he++}return n}var G=1;function k(){return G++}function U(P){var M=P.ownerDocument||P;return M.defaultView||M.parentWindow||t}var j=/mobile|tablet|ip(ad|hone|od)|android/i,X="ontouchstart"in t,H=z(t,"PointerEvent")!==n,Q=X&&j.test(navigator.userAgent),ne="touch",le="pen",xe="mouse",we="kinect",ze=25,me=1,$e=2,Le=4,Pt=8,$i=1,wt=2,No=4,jo=8,ar=16,et=wt|No,Bn=jo|ar,Fn=et|Bn,Dn=["x","y"],xu=["clientX","clientY"];function zr(P,M){var F=this;this.manager=P,this.callback=M,this.element=P.element,this.target=P.options.inputTarget,this.domHandler=function($){b(P.options.enable,[P])&&F.handler($)},this.init()}zr.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(U(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(U(this.element),this.evWin,this.domHandler)}};function Kf(P){var M,F=P.options.inputClass;return F?M=F:H?M=fb:Q?M=xd:X?M=cb:M=bd,new M(P,ob)}function ob(P,M,F){var $=F.pointers.length,ee=F.changedPointers.length,he=M&me&&$-ee===0,Ue=M&(Le|Pt)&&$-ee===0;F.isFirst=!!he,F.isFinal=!!Ue,he&&(P.session={}),F.eventType=M,sb(P,F),P.emit("hammer.input",F),P.recognize(F),P.session.prevInput=F}function sb(P,M){var F=P.session,$=M.pointers,ee=$.length;F.firstInput||(F.firstInput=yd(M)),ee>1&&!F.firstMultiple?F.firstMultiple=yd(M):ee===1&&(F.firstMultiple=!1);var he=F.firstInput,Ue=F.firstMultiple,or=Ue?Ue.center:he.center,hr=M.center=_d($);M.timeStamp=l(),M.deltaTime=M.timeStamp-he.timeStamp,M.angle=zo(or,hr),M.distance=Xi(or,hr),ub(F,M),M.offsetDirection=Go(M.deltaX,M.deltaY);var Er=Uo(M.deltaTime,M.deltaX,M.deltaY);M.overallVelocityX=Er.x,M.overallVelocityY=Er.y,M.overallVelocity=u(Er.x)>u(Er.y)?Er.x:Er.y,M.scale=Ue?rle(Ue.pointers,$):1,M.rotation=Ue?tle(Ue.pointers,$):0,M.maxPointers=F.prevInput?M.pointers.length>F.prevInput.maxPointers?M.pointers.length:F.prevInput.maxPointers:M.pointers.length,lb(F,M);var di=P.element;O(M.srcEvent.target,di)&&(di=M.srcEvent.target),M.target=di}function ub(P,M){var F=M.center,$=P.offsetDelta||{},ee=P.prevDelta||{},he=P.prevInput||{};(M.eventType===me||he.eventType===Le)&&(ee=P.prevDelta={x:he.deltaX||0,y:he.deltaY||0},$=P.offsetDelta={x:F.x,y:F.y}),M.deltaX=ee.x+(F.x-$.x),M.deltaY=ee.y+(F.y-$.y)}function lb(P,M){var F=P.lastInterval||M,$=M.timeStamp-F.timeStamp,ee,he,Ue,or;if(M.eventType!=Pt&&($>ze||F.velocity===n)){var hr=M.deltaX-F.deltaX,Er=M.deltaY-F.deltaY,di=Uo($,hr,Er);he=di.x,Ue=di.y,ee=u(di.x)>u(di.y)?di.x:di.y,or=Go(hr,Er),P.lastInterval=M}else ee=F.velocity,he=F.velocityX,Ue=F.velocityY,or=F.direction;M.velocity=ee,M.velocityX=he,M.velocityY=Ue,M.direction=or}function yd(P){for(var M=[],F=0;F<P.pointers.length;)M[F]={clientX:s(P.pointers[F].clientX),clientY:s(P.pointers[F].clientY)},F++;return{timeStamp:l(),pointers:M,center:_d(M),deltaX:P.deltaX,deltaY:P.deltaY}}function _d(P){var M=P.length;if(M===1)return{x:s(P[0].clientX),y:s(P[0].clientY)};for(var F=0,$=0,ee=0;ee<M;)F+=P[ee].clientX,$+=P[ee].clientY,ee++;return{x:s(F/M),y:s($/M)}}function Uo(P,M,F){return{x:M/P||0,y:F/P||0}}function Go(P,M){return P===M?$i:u(P)>=u(M)?P<0?wt:No:M<0?jo:ar}function Xi(P,M,F){F||(F=Dn);var $=M[F[0]]-P[F[0]],ee=M[F[1]]-P[F[1]];return Math.sqrt($*$+ee*ee)}function zo(P,M,F){F||(F=Dn);var $=M[F[0]]-P[F[0]],ee=M[F[1]]-P[F[1]];return Math.atan2(ee,$)*180/Math.PI}function tle(P,M){return zo(M[1],M[0],xu)+zo(P[1],P[0],xu)}function rle(P,M){return Xi(M[0],M[1],xu)/Xi(P[0],P[1],xu)}var nle={mousedown:me,mousemove:$e,mouseup:Le},ile="mousedown",ale="mousemove mouseup";function bd(){this.evEl=ile,this.evWin=ale,this.pressed=!1,zr.apply(this,arguments)}y(bd,zr,{handler:function(M){var F=nle[M.type];F&me&&M.button===0&&(this.pressed=!0),F&$e&&M.which!==1&&(F=Le),this.pressed&&(F&Le&&(this.pressed=!1),this.callback(this.manager,F,{pointers:[M],changedPointers:[M],pointerType:xe,srcEvent:M}))}});var ole={pointerdown:me,pointermove:$e,pointerup:Le,pointercancel:Pt,pointerout:Pt},sle={2:ne,3:le,4:xe,5:we},R2="pointerdown",L2="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(R2="MSPointerDown",L2="MSPointerMove MSPointerUp MSPointerCancel");function fb(){this.evEl=R2,this.evWin=L2,zr.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}y(fb,zr,{handler:function(M){var F=this.store,$=!1,ee=M.type.toLowerCase().replace("ms",""),he=ole[ee],Ue=sle[M.pointerType]||M.pointerType,or=Ue==ne,hr=S(F,M.pointerId,"pointerId");he&me&&(M.button===0||or)?hr<0&&(F.push(M),hr=F.length-1):he&(Le|Pt)&&($=!0),!(hr<0)&&(F[hr]=M,this.callback(this.manager,he,{pointers:F,changedPointers:[M],pointerType:Ue,srcEvent:M}),$&&F.splice(hr,1))}});var ule={touchstart:me,touchmove:$e,touchend:Le,touchcancel:Pt},lle="touchstart",fle="touchstart touchmove touchend touchcancel";function k2(){this.evTarget=lle,this.evWin=fle,this.started=!1,zr.apply(this,arguments)}y(k2,zr,{handler:function(M){var F=ule[M.type];if(F===me&&(this.started=!0),!!this.started){var $=cle.call(this,M,F);F&(Le|Pt)&&$[0].length-$[1].length===0&&(this.started=!1),this.callback(this.manager,F,{pointers:$[0],changedPointers:$[1],pointerType:ne,srcEvent:M})}}});function cle(P,M){var F=I(P.touches),$=I(P.changedTouches);return M&(Le|Pt)&&(F=R(F.concat($),"identifier",!0)),[F,$]}var ple={touchstart:me,touchmove:$e,touchend:Le,touchcancel:Pt},hle="touchstart touchmove touchend touchcancel";function xd(){this.evTarget=hle,this.targetIds={},zr.apply(this,arguments)}y(xd,zr,{handler:function(M){var F=ple[M.type],$=dle.call(this,M,F);$&&this.callback(this.manager,F,{pointers:$[0],changedPointers:$[1],pointerType:ne,srcEvent:M})}});function dle(P,M){var F=I(P.touches),$=this.targetIds;if(M&(me|$e)&&F.length===1)return $[F[0].identifier]=!0,[F,F];var ee,he,Ue=I(P.changedTouches),or=[],hr=this.target;if(he=F.filter(function(Er){return O(Er.target,hr)}),M===me)for(ee=0;ee<he.length;)$[he[ee].identifier]=!0,ee++;for(ee=0;ee<Ue.length;)$[Ue[ee].identifier]&&or.push(Ue[ee]),M&(Le|Pt)&&delete $[Ue[ee].identifier],ee++;if(or.length)return[R(he.concat(or),"identifier",!0),or]}var vle=2500,B2=25;function cb(){zr.apply(this,arguments);var P=_(this.handler,this);this.touch=new xd(this.manager,P),this.mouse=new bd(this.manager,P),this.primaryTouch=null,this.lastTouches=[]}y(cb,zr,{handler:function(M,F,$){var ee=$.pointerType==ne,he=$.pointerType==xe;if(!(he&&$.sourceCapabilities&&$.sourceCapabilities.firesTouchEvents)){if(ee)mle.call(this,F,$);else if(he&&gle.call(this,$))return;this.callback(M,F,$)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function mle(P,M){P&me?(this.primaryTouch=M.changedPointers[0].identifier,F2.call(this,M)):P&(Le|Pt)&&F2.call(this,M)}function F2(P){var M=P.changedPointers[0];if(M.identifier===this.primaryTouch){var F={x:M.clientX,y:M.clientY};this.lastTouches.push(F);var $=this.lastTouches,ee=function(){var he=$.indexOf(F);he>-1&&$.splice(he,1)};setTimeout(ee,vle)}}function gle(P){for(var M=P.srcEvent.clientX,F=P.srcEvent.clientY,$=0;$<this.lastTouches.length;$++){var ee=this.lastTouches[$],he=Math.abs(M-ee.x),Ue=Math.abs(F-ee.y);if(he<=B2&&Ue<=B2)return!0}return!1}var D2=z(a.style,"touchAction"),N2=D2!==n,j2="compute",U2="auto",pb="manipulation",Vo="none",Jf="pan-x",Zf="pan-y",Ad=_le();function hb(P,M){this.manager=P,this.set(M)}hb.prototype={set:function(P){P==j2&&(P=this.compute()),N2&&this.manager.element.style&&Ad[P]&&(this.manager.element.style[D2]=P),this.actions=P.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var P=[];return p(this.manager.recognizers,function(M){b(M.options.enable,[M])&&(P=P.concat(M.getTouchAction()))}),yle(P.join(" "))},preventDefaults:function(P){var M=P.srcEvent,F=P.offsetDirection;if(this.manager.session.prevented){M.preventDefault();return}var $=this.actions,ee=w($,Vo)&&!Ad[Vo],he=w($,Zf)&&!Ad[Zf],Ue=w($,Jf)&&!Ad[Jf];if(ee){var or=P.pointers.length===1,hr=P.distance<2,Er=P.deltaTime<250;if(or&&hr&&Er)return}if(!(Ue&&he)&&(ee||he&&F&et||Ue&&F&Bn))return this.preventSrc(M)},preventSrc:function(P){this.manager.session.prevented=!0,P.preventDefault()}};function yle(P){if(w(P,Vo))return Vo;var M=w(P,Jf),F=w(P,Zf);return M&&F?Vo:M||F?M?Jf:Zf:w(P,pb)?pb:U2}function _le(){if(!N2)return!1;var P={},M=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(F){P[F]=M?t.CSS.supports("touch-action",F):!0}),P}var Td=1,pn=2,Au=4,za=8,qi=za,Qf=16,hi=32;function Yi(P){this.options=v({},this.defaults,P||{}),this.id=k(),this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=Td,this.simultaneous={},this.requireFail=[]}Yi.prototype={defaults:{},set:function(P){return v(this.options,P),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(P){if(c(P,"recognizeWith",this))return this;var M=this.simultaneous;return P=Sd(P,this),M[P.id]||(M[P.id]=P,P.recognizeWith(this)),this},dropRecognizeWith:function(P){return c(P,"dropRecognizeWith",this)?this:(P=Sd(P,this),delete this.simultaneous[P.id],this)},requireFailure:function(P){if(c(P,"requireFailure",this))return this;var M=this.requireFail;return P=Sd(P,this),S(M,P)===-1&&(M.push(P),P.requireFailure(this)),this},dropRequireFailure:function(P){if(c(P,"dropRequireFailure",this))return this;P=Sd(P,this);var M=S(this.requireFail,P);return M>-1&&this.requireFail.splice(M,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(P){return!!this.simultaneous[P.id]},emit:function(P){var M=this,F=this.state;function $(ee){M.manager.emit(ee,P)}F<za&&$(M.options.event+G2(F)),$(M.options.event),P.additionalEvent&&$(P.additionalEvent),F>=za&&$(M.options.event+G2(F))},tryEmit:function(P){if(this.canEmit())return this.emit(P);this.state=hi},canEmit:function(){for(var P=0;P<this.requireFail.length;){if(!(this.requireFail[P].state&(hi|Td)))return!1;P++}return!0},recognize:function(P){var M=v({},P);if(!b(this.options.enable,[this,M])){this.reset(),this.state=hi;return}this.state&(qi|Qf|hi)&&(this.state=Td),this.state=this.process(M),this.state&(pn|Au|za|Qf)&&this.tryEmit(M)},process:function(P){},getTouchAction:function(){},reset:function(){}};function G2(P){return P&Qf?"cancel":P&za?"end":P&Au?"move":P&pn?"start":""}function z2(P){return P==ar?"down":P==jo?"up":P==wt?"left":P==No?"right":""}function Sd(P,M){var F=M.manager;return F?F.get(P):P}function Nn(){Yi.apply(this,arguments)}y(Nn,Yi,{defaults:{pointers:1},attrTest:function(P){var M=this.options.pointers;return M===0||P.pointers.length===M},process:function(P){var M=this.state,F=P.eventType,$=M&(pn|Au),ee=this.attrTest(P);return $&&(F&Pt||!ee)?M|Qf:$||ee?F&Le?M|za:M&pn?M|Au:pn:hi}});function Pd(){Nn.apply(this,arguments),this.pX=null,this.pY=null}y(Pd,Nn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Fn},getTouchAction:function(){var P=this.options.direction,M=[];return P&et&&M.push(Zf),P&Bn&&M.push(Jf),M},directionTest:function(P){var M=this.options,F=!0,$=P.distance,ee=P.direction,he=P.deltaX,Ue=P.deltaY;return ee&M.direction||(M.direction&et?(ee=he===0?$i:he<0?wt:No,F=he!=this.pX,$=Math.abs(P.deltaX)):(ee=Ue===0?$i:Ue<0?jo:ar,F=Ue!=this.pY,$=Math.abs(P.deltaY))),P.direction=ee,F&&$>M.threshold&&ee&M.direction},attrTest:function(P){return Nn.prototype.attrTest.call(this,P)&&(this.state&pn||!(this.state&pn)&&this.directionTest(P))},emit:function(P){this.pX=P.deltaX,this.pY=P.deltaY;var M=z2(P.direction);M&&(P.additionalEvent=this.options.event+M),this._super.emit.call(this,P)}});function db(){Nn.apply(this,arguments)}y(db,Nn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Vo]},attrTest:function(P){return this._super.attrTest.call(this,P)&&(Math.abs(P.scale-1)>this.options.threshold||this.state&pn)},emit:function(P){if(P.scale!==1){var M=P.scale<1?"in":"out";P.additionalEvent=this.options.event+M}this._super.emit.call(this,P)}});function vb(){Yi.apply(this,arguments),this._timer=null,this._input=null}y(vb,Yi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[U2]},process:function(P){var M=this.options,F=P.pointers.length===M.pointers,$=P.distance<M.threshold,ee=P.deltaTime>M.time;if(this._input=P,!$||!F||P.eventType&(Le|Pt)&&!ee)this.reset();else if(P.eventType&me)this.reset(),this._timer=f(function(){this.state=qi,this.tryEmit()},M.time,this);else if(P.eventType&Le)return qi;return hi},reset:function(){clearTimeout(this._timer)},emit:function(P){this.state===qi&&(P&&P.eventType&Le?this.manager.emit(this.options.event+"up",P):(this._input.timeStamp=l(),this.manager.emit(this.options.event,this._input)))}});function mb(){Nn.apply(this,arguments)}y(mb,Nn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Vo]},attrTest:function(P){return this._super.attrTest.call(this,P)&&(Math.abs(P.rotation)>this.options.threshold||this.state&pn)}});function gb(){Nn.apply(this,arguments)}y(gb,Nn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:et|Bn,pointers:1},getTouchAction:function(){return Pd.prototype.getTouchAction.call(this)},attrTest:function(P){var M=this.options.direction,F;return M&(et|Bn)?F=P.overallVelocity:M&et?F=P.overallVelocityX:M&Bn&&(F=P.overallVelocityY),this._super.attrTest.call(this,P)&&M&P.offsetDirection&&P.distance>this.options.threshold&&P.maxPointers==this.options.pointers&&u(F)>this.options.velocity&&P.eventType&Le},emit:function(P){var M=z2(P.offsetDirection);M&&this.manager.emit(this.options.event+M,P),this.manager.emit(this.options.event,P)}});function wd(){Yi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}y(wd,Yi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[pb]},process:function(P){var M=this.options,F=P.pointers.length===M.pointers,$=P.distance<M.threshold,ee=P.deltaTime<M.time;if(this.reset(),P.eventType&me&&this.count===0)return this.failTimeout();if($&&ee&&F){if(P.eventType!=Le)return this.failTimeout();var he=this.pTime?P.timeStamp-this.pTime<M.interval:!0,Ue=!this.pCenter||Xi(this.pCenter,P.center)<M.posThreshold;this.pTime=P.timeStamp,this.pCenter=P.center,!Ue||!he?this.count=1:this.count+=1,this._input=P;var or=this.count%M.taps;if(or===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=qi,this.tryEmit()},M.interval,this),pn):qi}return hi},failTimeout:function(){return this._timer=f(function(){this.state=hi},this.options.interval,this),hi},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==qi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ki(P,M){return M=M||{},M.recognizers=x(M.recognizers,Ki.defaults.preset),new yb(P,M)}Ki.VERSION="2.0.7",Ki.defaults={domEvents:!1,touchAction:j2,enable:!0,inputTarget:null,inputClass:null,preset:[[mb,{enable:!1}],[db,{enable:!1},["rotate"]],[gb,{direction:et}],[Pd,{direction:et},["swipe"]],[wd],[wd,{event:"doubletap",taps:2},["tap"]],[vb]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ble=1,V2=2;function yb(P,M){this.options=v({},Ki.defaults,M||{}),this.options.inputTarget=this.options.inputTarget||P,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=P,this.input=Kf(this),this.touchAction=new hb(this,this.options.touchAction),H2(this,!0),p(this.options.recognizers,function(F){var $=this.add(new F[0](F[1]));F[2]&&$.recognizeWith(F[2]),F[3]&&$.requireFailure(F[3])},this)}yb.prototype={set:function(P){return v(this.options,P),P.touchAction&&this.touchAction.update(),P.inputTarget&&(this.input.destroy(),this.input.target=P.inputTarget,this.input.init()),this},stop:function(P){this.session.stopped=P?V2:ble},recognize:function(P){var M=this.session;if(!M.stopped){this.touchAction.preventDefaults(P);var F,$=this.recognizers,ee=M.curRecognizer;(!ee||ee&&ee.state&qi)&&(ee=M.curRecognizer=null);for(var he=0;he<$.length;)F=$[he],M.stopped!==V2&&(!ee||F==ee||F.canRecognizeWith(ee))?F.recognize(P):F.reset(),!ee&&F.state&(pn|Au|za)&&(ee=M.curRecognizer=F),he++}},get:function(P){if(P instanceof Yi)return P;for(var M=this.recognizers,F=0;F<M.length;F++)if(M[F].options.event==P)return M[F];return null},add:function(P){if(c(P,"add",this))return this;var M=this.get(P.options.event);return M&&this.remove(M),this.recognizers.push(P),P.manager=this,this.touchAction.update(),P},remove:function(P){if(c(P,"remove",this))return this;if(P=this.get(P),P){var M=this.recognizers,F=S(M,P);F!==-1&&(M.splice(F,1),this.touchAction.update())}return this},on:function(P,M){if(P!==n&&M!==n){var F=this.handlers;return p(E(P),function($){F[$]=F[$]||[],F[$].push(M)}),this}},off:function(P,M){if(P!==n){var F=this.handlers;return p(E(P),function($){M?F[$]&&F[$].splice(S(F[$],M),1):delete F[$]}),this}},emit:function(P,M){this.options.domEvents&&xle(P,M);var F=this.handlers[P]&&this.handlers[P].slice();if(!(!F||!F.length)){M.type=P,M.preventDefault=function(){M.srcEvent.preventDefault()};for(var $=0;$<F.length;)F[$](M),$++}},destroy:function(){this.element&&H2(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function H2(P,M){var F=P.element;if(F.style){var $;p(P.options.cssProps,function(ee,he){$=z(F.style,he),M?(P.oldCssProps[$]=F.style[$],F.style[$]=ee):F.style[$]=P.oldCssProps[$]||""}),M||(P.oldCssProps={})}}function xle(P,M){var F=r.createEvent("Event");F.initEvent(P,!0,!0),F.gesture=M,M.target.dispatchEvent(F)}v(Ki,{INPUT_START:me,INPUT_MOVE:$e,INPUT_END:Le,INPUT_CANCEL:Pt,STATE_POSSIBLE:Td,STATE_BEGAN:pn,STATE_CHANGED:Au,STATE_ENDED:za,STATE_RECOGNIZED:qi,STATE_CANCELLED:Qf,STATE_FAILED:hi,DIRECTION_NONE:$i,DIRECTION_LEFT:wt,DIRECTION_RIGHT:No,DIRECTION_UP:jo,DIRECTION_DOWN:ar,DIRECTION_HORIZONTAL:et,DIRECTION_VERTICAL:Bn,DIRECTION_ALL:Fn,Manager:yb,Input:zr,TouchAction:hb,TouchInput:xd,MouseInput:bd,PointerEventInput:fb,TouchMouseInput:cb,SingleTouchInput:k2,Recognizer:Yi,AttrRecognizer:Nn,Tap:wd,Pan:Pd,Swipe:gb,Pinch:db,Rotate:mb,Press:vb,on:A,off:T,each:p,merge:g,extend:m,assign:v,inherit:y,bindFn:_,prefixed:z});var Ale=typeof t<"u"?t:typeof self<"u"?self:{};Ale.Hammer=Ki,n==="function"&&define.amd?define(function(){return Ki}):typeof Jm<"u"&&Jm.exports?Jm.exports=Ki:t[e]=Ki})(window,document,"Hammer")});var T9=Te((Rtt,bP)=>{"use strict";bP.exports=Yg;bP.exports.default=Yg;function Yg(t,r,e){e=e||2;var n=r&&r.length,i=n?r[0]*e:t.length,a=b9(t,0,i,e,!0),o=[];if(!a||a.next===a.prev)return o;var s,u,l,f,c,p,d;if(n&&(a=tAe(t,r,a,e)),t.length>80*e){s=l=t[0],u=f=t[1];for(var v=e;v<i;v+=e)c=t[v],p=t[v+1],c<s&&(s=c),p<u&&(u=p),c>l&&(l=c),p>f&&(f=p);d=Math.max(l-s,f-u),d=d!==0?32767/d:0}return Jp(a,o,e,s,u,d,0),o}function b9(t,r,e,n,i){var a,o;if(i===_P(t,r,e,n)>0)for(a=r;a<e;a+=n)o=_9(a,t[a],t[a+1],o);else for(a=e-n;a>=r;a-=n)o=_9(a,t[a],t[a+1],o);return o&&Kg(o,o.next)&&(Qp(o),o=o.next),o}function Ms(t,r){if(!t)return t;r||(r=t);var e=t,n;do if(n=!1,!e.steiner&&(Kg(e,e.next)||Bt(e.prev,e,e.next)===0)){if(Qp(e),e=r=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==r);return r}function Jp(t,r,e,n,i,a,o){if(t){!o&&a&&oAe(t,n,i,a);for(var s=t,u,l;t.prev!==t.next;){if(u=t.prev,l=t.next,a?Zxe(t,n,i,a):Jxe(t)){r.push(u.i/e|0),r.push(t.i/e|0),r.push(l.i/e|0),Qp(t),t=l.next,s=l.next;continue}if(t=l,t===s){o?o===1?(t=Qxe(Ms(t),r,e),Jp(t,r,e,n,i,a,2)):o===2&&eAe(t,r,e,n,i,a):Jp(Ms(t),r,e,n,i,a,1);break}}}}function Jxe(t){var r=t.prev,e=t,n=t.next;if(Bt(r,e,n)>=0)return!1;for(var i=r.x,a=e.x,o=n.x,s=r.y,u=e.y,l=n.y,f=i<a?i<o?i:o:a<o?a:o,c=s<u?s<l?s:l:u<l?u:l,p=i>a?i>o?i:o:a>o?a:o,d=s>u?s>l?s:l:u>l?u:l,v=n.next;v!==r;){if(v.x>=f&&v.x<=p&&v.y>=c&&v.y<=d&&Dl(i,s,a,u,o,l,v.x,v.y)&&Bt(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function Zxe(t,r,e,n){var i=t.prev,a=t,o=t.next;if(Bt(i,a,o)>=0)return!1;for(var s=i.x,u=a.x,l=o.x,f=i.y,c=a.y,p=o.y,d=s<u?s<l?s:l:u<l?u:l,v=f<c?f<p?f:p:c<p?c:p,m=s>u?s>l?s:l:u>l?u:l,g=f>c?f>p?f:p:c>p?c:p,y=gP(d,v,r,e,n),_=gP(m,g,r,e,n),b=t.prevZ,x=t.nextZ;b&&b.z>=y&&x&&x.z<=_;){if(b.x>=d&&b.x<=m&&b.y>=v&&b.y<=g&&b!==i&&b!==o&&Dl(s,f,u,c,l,p,b.x,b.y)&&Bt(b.prev,b,b.next)>=0||(b=b.prevZ,x.x>=d&&x.x<=m&&x.y>=v&&x.y<=g&&x!==i&&x!==o&&Dl(s,f,u,c,l,p,x.x,x.y)&&Bt(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;b&&b.z>=y;){if(b.x>=d&&b.x<=m&&b.y>=v&&b.y<=g&&b!==i&&b!==o&&Dl(s,f,u,c,l,p,b.x,b.y)&&Bt(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=_;){if(x.x>=d&&x.x<=m&&x.y>=v&&x.y<=g&&x!==i&&x!==o&&Dl(s,f,u,c,l,p,x.x,x.y)&&Bt(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Qxe(t,r,e){var n=t;do{var i=n.prev,a=n.next.next;!Kg(i,a)&&x9(i,n,n.next,a)&&Zp(i,a)&&Zp(a,i)&&(r.push(i.i/e|0),r.push(n.i/e|0),r.push(a.i/e|0),Qp(n),Qp(n.next),n=t=a),n=n.next}while(n!==t);return Ms(n)}function eAe(t,r,e,n,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&lAe(o,s)){var u=A9(o,s);o=Ms(o,o.next),u=Ms(u,u.next),Jp(o,r,e,n,i,a,0),Jp(u,r,e,n,i,a,0);return}s=s.next}o=o.next}while(o!==t)}function tAe(t,r,e,n){var i=[],a,o,s,u,l;for(a=0,o=r.length;a<o;a++)s=r[a]*n,u=a<o-1?r[a+1]*n:t.length,l=b9(t,s,u,n,!1),l===l.next&&(l.steiner=!0),i.push(uAe(l));for(i.sort(rAe),a=0;a<i.length;a++)e=nAe(i[a],e);return e}function rAe(t,r){return t.x-r.x}function nAe(t,r){var e=iAe(t,r);if(!e)return r;var n=A9(e,t);return Ms(n,n.next),Ms(e,e.next)}function iAe(t,r){var e=r,n=t.x,i=t.y,a=-1/0,o;do{if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){var s=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(s<=n&&s>a&&(a=s,o=e.x<e.next.x?e:e.next,s===n))return o}e=e.next}while(e!==r);if(!o)return null;var u=o,l=o.x,f=o.y,c=1/0,p;e=o;do n>=e.x&&e.x>=l&&n!==e.x&&Dl(i<f?n:a,i,l,f,i<f?a:n,i,e.x,e.y)&&(p=Math.abs(i-e.y)/(n-e.x),Zp(e,t)&&(p<c||p===c&&(e.x>o.x||e.x===o.x&&aAe(o,e)))&&(o=e,c=p)),e=e.next;while(e!==u);return o}function aAe(t,r){return Bt(t.prev,t,r.prev)<0&&Bt(r.next,t,t.next)<0}function oAe(t,r,e,n){var i=t;do i.z===0&&(i.z=gP(i.x,i.y,r,e,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,sAe(i)}function sAe(t){var r,e,n,i,a,o,s,u,l=1;do{for(e=t,t=null,a=null,o=0;e;){for(o++,n=e,s=0,r=0;r<l&&(s++,n=n.nextZ,!!n);r++);for(u=l;s>0||u>0&&n;)s!==0&&(u===0||!n||e.z<=n.z)?(i=e,e=e.nextZ,s--):(i=n,n=n.nextZ,u--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;e=n}a.nextZ=null,l*=2}while(o>1);return t}function gP(t,r,e,n,i){return t=(t-e)*i|0,r=(r-n)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t|r<<1}function uAe(t){var r=t,e=t;do(r.x<e.x||r.x===e.x&&r.y<e.y)&&(e=r),r=r.next;while(r!==t);return e}function Dl(t,r,e,n,i,a,o,s){return(i-o)*(r-s)>=(t-o)*(a-s)&&(t-o)*(n-s)>=(e-o)*(r-s)&&(e-o)*(a-s)>=(i-o)*(n-s)}function lAe(t,r){return t.next.i!==r.i&&t.prev.i!==r.i&&!fAe(t,r)&&(Zp(t,r)&&Zp(r,t)&&cAe(t,r)&&(Bt(t.prev,t,r.prev)||Bt(t,r.prev,r))||Kg(t,r)&&Bt(t.prev,t,t.next)>0&&Bt(r.prev,r,r.next)>0)}function Bt(t,r,e){return(r.y-t.y)*(e.x-r.x)-(r.x-t.x)*(e.y-r.y)}function Kg(t,r){return t.x===r.x&&t.y===r.y}function x9(t,r,e,n){var i=qg(Bt(t,r,e)),a=qg(Bt(t,r,n)),o=qg(Bt(e,n,t)),s=qg(Bt(e,n,r));return!!(i!==a&&o!==s||i===0&&Xg(t,e,r)||a===0&&Xg(t,n,r)||o===0&&Xg(e,t,n)||s===0&&Xg(e,r,n))}function Xg(t,r,e){return r.x<=Math.max(t.x,e.x)&&r.x>=Math.min(t.x,e.x)&&r.y<=Math.max(t.y,e.y)&&r.y>=Math.min(t.y,e.y)}function qg(t){return t>0?1:t<0?-1:0}function fAe(t,r){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==r.i&&e.next.i!==r.i&&x9(e,e.next,t,r))return!0;e=e.next}while(e!==t);return!1}function Zp(t,r){return Bt(t.prev,t,t.next)<0?Bt(t,r,t.next)>=0&&Bt(t,t.prev,r)>=0:Bt(t,r,t.prev)<0||Bt(t,t.next,r)<0}function cAe(t,r){var e=t,n=!1,i=(t.x+r.x)/2,a=(t.y+r.y)/2;do e.y>a!=e.next.y>a&&e.next.y!==e.y&&i<(e.next.x-e.x)*(a-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==t);return n}function A9(t,r){var e=new yP(t.i,t.x,t.y),n=new yP(r.i,r.x,r.y),i=t.next,a=r.prev;return t.next=r,r.prev=t,e.next=i,i.prev=e,n.next=e,e.prev=n,a.next=n,n.prev=a,n}function _9(t,r,e,n){var i=new yP(t,r,e);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Qp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function yP(t,r,e){this.i=t,this.x=r,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Yg.deviation=function(t,r,e,n){var i=r&&r.length,a=i?r[0]*e:t.length,o=Math.abs(_P(t,0,a,e));if(i)for(var s=0,u=r.length;s<u;s++){var l=r[s]*e,f=s<u-1?r[s+1]*e:t.length;o-=Math.abs(_P(t,l,f,e))}var c=0;for(s=0;s<n.length;s+=3){var p=n[s]*e,d=n[s+1]*e,v=n[s+2]*e;c+=Math.abs((t[p]-t[v])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[v+1]-t[p+1]))}return o===0&&c===0?0:Math.abs((c-o)/o)};function _P(t,r,e,n){for(var i=0,a=r,o=e-n;a<e;a+=n)i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return i}Yg.flatten=function(t){for(var r=t[0][0].length,e={vertices:[],holes:[],dimensions:r},n=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++)for(var o=0;o<r;o++)e.vertices.push(t[i][a][o]);i>0&&(n+=t[i-1].length,e.holes.push(n))}return e}});var oW=Te((rrt,aW)=>{function IAe(t,r){if(t==null)return{};var e={},n=Object.keys(t),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(e[i]=t[i]);return e}aW.exports=IAe});var ny=Te((nrt,sW)=>{var RAe=oW();function LAe(t,r){if(t==null)return{};var e=RAe(t,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(e[n]=t[n])}return e}sW.exports=LAe});var kP=Te(_a=>{"use strict";var x7=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",hTe=x7+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",A7="["+x7+"]["+hTe+"]*",dTe=new RegExp("^"+A7+"$"),vTe=function(r,e){for(var n=[],i=e.exec(r);i;){var a=[];a.startIndex=e.lastIndex-i[0].length;for(var o=i.length,s=0;s<o;s++)a.push(i[s]);n.push(a),i=e.exec(r)}return n},mTe=function(r){var e=dTe.exec(r);return!(e===null||typeof e>"u")};_a.isExist=function(t){return typeof t<"u"};_a.isEmptyObject=function(t){return Object.keys(t).length===0};_a.merge=function(t,r,e){if(r)for(var n=Object.keys(r),i=n.length,a=0;a<i;a++)e==="strict"?t[n[a]]=[r[n[a]]]:t[n[a]]=r[n[a]]};_a.getValue=function(t){return _a.isExist(t)?t:""};_a.isName=mTe;_a.getAllMatches=vTe;_a.nameRegexp=A7});var FP=Te(O7=>{"use strict";var BP=kP(),gTe={allowBooleanAttributes:!1,unpairedTags:[]};O7.validate=function(t,r){r=Object.assign({},gTe,r);var e=[],n=!1,i=!1;t[0]==="\uFEFF"&&(t=t.substr(1));for(var a=0;a<t.length;a++)if(t[a]==="<"&&t[a+1]==="?"){if(a+=2,a=S7(t,a),a.err)return a}else if(t[a]==="<"){var o=a;if(a++,t[a]==="!"){a=P7(t,a);continue}else{var s=!1;t[a]==="/"&&(s=!0,a++);for(var u="";a<t.length&&t[a]!==">"&&t[a]!==" "&&t[a]!=="	"&&t[a]!==`
`&&t[a]!=="\r";a++)u+=t[a];if(u=u.trim(),u[u.length-1]==="/"&&(u=u.substring(0,u.length-1),a--),!PTe(u)){var l=void 0;return u.trim().length===0?l="Invalid space after '<'.":l="Tag '"+u+"' is an invalid name.",Jt("InvalidTag",l,Yr(t,a))}var f=bTe(t,a);if(f===!1)return Jt("InvalidAttr","Attributes for '"+u+"' have open quote.",Yr(t,a));var c=f.value;if(a=f.index,c[c.length-1]==="/"){var p=a-c.length;c=c.substring(0,c.length-1);var d=w7(c,r);if(d===!0)n=!0;else return Jt(d.err.code,d.err.msg,Yr(t,p+d.err.line))}else if(s)if(f.tagClosed){if(c.trim().length>0)return Jt("InvalidTag","Closing tag '"+u+"' can't have attributes or invalid starting.",Yr(t,o));var v=e.pop();if(u!==v.tagName){var m=Yr(t,v.tagStartPos);return Jt("InvalidTag","Expected closing tag '"+v.tagName+"' (opened in line "+m.line+", col "+m.col+") instead of closing tag '"+u+"'.",Yr(t,o))}e.length==0&&(i=!0)}else return Jt("InvalidTag","Closing tag '"+u+"' doesn't have proper closing.",Yr(t,a));else{var g=w7(c,r);if(g!==!0)return Jt(g.err.code,g.err.msg,Yr(t,a-c.length+g.err.line));if(i===!0)return Jt("InvalidXml","Multiple possible root nodes found.",Yr(t,a));r.unpairedTags.indexOf(u)!==-1||e.push({tagName:u,tagStartPos:o}),n=!0}for(a++;a<t.length;a++)if(t[a]==="<")if(t[a+1]==="!"){a++,a=P7(t,a);continue}else if(t[a+1]==="?"){if(a=S7(t,++a),a.err)return a}else break;else if(t[a]==="&"){var y=TTe(t,a);if(y==-1)return Jt("InvalidChar","char '&' is not expected.",Yr(t,a));a=y}else if(i===!0&&!T7(t[a]))return Jt("InvalidXml","Extra text at the end",Yr(t,a));t[a]==="<"&&a--}}else{if(T7(t[a]))continue;return Jt("InvalidChar","char '"+t[a]+"' is not expected.",Yr(t,a))}if(n){if(e.length==1)return Jt("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",Yr(t,e[0].tagStartPos));if(e.length>0)return Jt("InvalidXml","Invalid '"+JSON.stringify(e.map(function(_){return _.tagName}),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Jt("InvalidXml","Start tag expected.",1);return!0};function T7(t){return t===" "||t==="	"||t===`
`||t==="\r"}function S7(t,r){for(var e=r;r<t.length;r++)if(t[r]=="?"||t[r]==" "){var n=t.substr(e,r-e);if(r>5&&n==="xml")return Jt("InvalidXml","XML declaration allowed only at the start of the document.",Yr(t,r));if(t[r]=="?"&&t[r+1]==">"){r++;break}else continue}return r}function P7(t,r){if(t.length>r+5&&t[r+1]==="-"&&t[r+2]==="-"){for(r+=3;r<t.length;r++)if(t[r]==="-"&&t[r+1]==="-"&&t[r+2]===">"){r+=2;break}}else if(t.length>r+8&&t[r+1]==="D"&&t[r+2]==="O"&&t[r+3]==="C"&&t[r+4]==="T"&&t[r+5]==="Y"&&t[r+6]==="P"&&t[r+7]==="E"){var e=1;for(r+=8;r<t.length;r++)if(t[r]==="<")e++;else if(t[r]===">"&&(e--,e===0))break}else if(t.length>r+9&&t[r+1]==="["&&t[r+2]==="C"&&t[r+3]==="D"&&t[r+4]==="A"&&t[r+5]==="T"&&t[r+6]==="A"&&t[r+7]==="["){for(r+=8;r<t.length;r++)if(t[r]==="]"&&t[r+1]==="]"&&t[r+2]===">"){r+=2;break}}return r}var yTe='"',_Te="'";function bTe(t,r){for(var e="",n="",i=!1;r<t.length;r++){if(t[r]===yTe||t[r]===_Te)n===""?n=t[r]:n!==t[r]||(n="");else if(t[r]===">"&&n===""){i=!0;break}e+=t[r]}return n!==""?!1:{value:e,index:r,tagClosed:i}}var xTe=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function w7(t,r){for(var e=BP.getAllMatches(t,xTe),n={},i=0;i<e.length;i++){if(e[i][1].length===0)return Jt("InvalidAttr","Attribute '"+e[i][2]+"' has no space in starting.",ph(e[i]));if(e[i][3]!==void 0&&e[i][4]===void 0)return Jt("InvalidAttr","Attribute '"+e[i][2]+"' is without value.",ph(e[i]));if(e[i][3]===void 0&&!r.allowBooleanAttributes)return Jt("InvalidAttr","boolean attribute '"+e[i][2]+"' is not allowed.",ph(e[i]));var a=e[i][2];if(!STe(a))return Jt("InvalidAttr","Attribute '"+a+"' is an invalid name.",ph(e[i]));if(!n.hasOwnProperty(a))n[a]=1;else return Jt("InvalidAttr","Attribute '"+a+"' is repeated.",ph(e[i]))}return!0}function ATe(t,r){var e=/\d/;for(t[r]==="x"&&(r++,e=/[\da-fA-F]/);r<t.length;r++){if(t[r]===";")return r;if(!t[r].match(e))break}return-1}function TTe(t,r){if(r++,t[r]===";")return-1;if(t[r]==="#")return r++,ATe(t,r);for(var e=0;r<t.length;r++,e++)if(!(t[r].match(/\w/)&&e<20)){if(t[r]===";")break;return-1}return r}function Jt(t,r,e){return{err:{code:t,msg:r,line:e.line||e,col:e.col}}}function STe(t){return BP.isName(t)}function PTe(t){return BP.isName(t)}function Yr(t,r){var e=t.substring(0,r).split(/\r?\n/);return{line:e.length,col:e[e.length-1].length+1}}function ph(t){return t.startIndex+t[1].length}});var C7=Te(DP=>{var E7={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:function(){return!1},commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1},wTe=function(r){return Object.assign({},E7,r)};DP.buildOptions=wTe;DP.defaultOptions=E7});var L7=Te((dnt,R7)=>{"use strict";var hh=h(B()),M7=h(L()),I7=h(N()),OTe=function(){function t(r){(0,M7.default)(this,t),this.tagname=r,this.child=[],this[":@"]={}}return(0,I7.default)(t,[{key:"add",value:function(e,n){e==="__proto__"&&(e="#__proto__"),this.child.push((0,hh.default)({},e,n))}},{key:"addChild",value:function(e){if(e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0){var n;this.child.push((n={},(0,hh.default)(n,e.tagname,e.child),(0,hh.default)(n,":@",e[":@"]),n))}else this.child.push((0,hh.default)({},e.tagname,e.child))}}]),t}();R7.exports=OTe});var B7=Te((vnt,k7)=>{function ETe(t,r){var e={};if(t[r+3]==="O"&&t[r+4]==="C"&&t[r+5]==="T"&&t[r+6]==="Y"&&t[r+7]==="P"&&t[r+8]==="E"){r=r+9;for(var n=1,i=!1,a=!1,o=!1,s="";r<t.length;r++)if(t[r]==="<"&&!o){if(i&&t[r+1]==="!"&&t[r+2]==="E"&&t[r+3]==="N"&&t[r+4]==="T"&&t[r+5]==="I"&&t[r+6]==="T"&&t[r+7]==="Y")r+=7,a=!0;else if(i&&t[r+1]==="!"&&t[r+2]==="E"&&t[r+3]==="L"&&t[r+4]==="E"&&t[r+5]==="M"&&t[r+6]==="E"&&t[r+7]==="N"&&t[r+8]==="T")r+=8;else if(i&&t[r+1]==="!"&&t[r+2]==="A"&&t[r+3]==="T"&&t[r+4]==="T"&&t[r+5]==="L"&&t[r+6]==="I"&&t[r+7]==="S"&&t[r+8]==="T")r+=8;else if(i&&t[r+1]==="!"&&t[r+2]==="N"&&t[r+3]==="O"&&t[r+4]==="T"&&t[r+5]==="A"&&t[r+6]==="T"&&t[r+7]==="I"&&t[r+8]==="O"&&t[r+9]==="N")r+=9;else if(t[r+1]==="!"&&t[r+2]==="-"&&t[r+3]==="-")o=!0;else throw new Error("Invalid DOCTYPE");n++,s=""}else if(t[r]===">"){if(o?t[r-1]==="-"&&t[r-2]==="-"&&(o=!1,n--):(a&&(MTe(s,e),a=!1),n--),n===0)break}else t[r]==="["?i=!0:s+=t[r];if(n!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:e,i:r}}var CTe=RegExp(`^\\s([a-zA-z0-0]+)[ 	](['"])([^&]+)\\2`);function MTe(t,r){var e=CTe.exec(t);e&&(r[e[1]]={regx:RegExp("&".concat(e[1],";"),"g"),val:e[3]})}k7.exports=ETe});var D7=Te((mnt,F7)=>{var ITe=/^[-+]?0x[a-fA-F0-9]+$/,RTe=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);var LTe={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function kTe(t,r={}){if(r=Object.assign({},LTe,r),!t||typeof t!="string")return t;let e=t.trim();if(r.skipLike!==void 0&&r.skipLike.test(e))return t;if(r.hex&&ITe.test(e))return Number.parseInt(e,16);{let n=RTe.exec(e);if(n){let i=n[1],a=n[2],o=BTe(n[3]),s=n[4]||n[6];if(!r.leadingZeros&&a.length>0&&i&&e[2]!==".")return t;if(!r.leadingZeros&&a.length>0&&!i&&e[1]!==".")return t;{let u=Number(e),l=""+u;return l.search(/[eE]/)!==-1||s?r.eNotation?u:t:e.indexOf(".")!==-1?l==="0"&&o===""||l===o||i&&l==="-"+o?u:t:a?o===l||i+o===l?u:t:e===l||e===i+l?u:t}}else return t}}function BTe(t){return t&&t.indexOf(".")!==-1&&(t=t.replace(/0+$/,""),t==="."?t="0":t[0]==="."?t="0"+t:t[t.length-1]==="."&&(t=t.substr(0,t.length-1))),t}F7.exports=kTe});var U7=Te((ynt,j7)=>{"use strict";var NP=h(B()),vh=h(Je()),N7=h(L()),GP=kP(),dh=L7(),FTe=B7(),DTe=D7(),gnt="<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,GP.nameRegexp),NTe=function t(r){(0,N7.default)(this,t),this.options=r,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"}},this.addExternalEntities=jTe,this.parseXml=HTe,this.parseTextData=UTe,this.resolveNameSpace=GTe,this.buildAttributesMap=VTe,this.isItStopNode=XTe,this.replaceEntitiesValue=WTe,this.readStopNodeData=YTe,this.saveTextToParentTag=$Te};function jTe(t){for(var r=Object.keys(t),e=0;e<r.length;e++){var n=r[e];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:t[n]}}}function UTe(t,r,e,n,i,a,o){if(t!==void 0&&(this.options.trimValues&&!n&&(t=t.trim()),t.length>0)){o||(t=this.replaceEntitiesValue(t));var s=this.options.tagValueProcessor(r,t,e,i,a);if(s==null)return t;if((0,vh.default)(s)!==(0,vh.default)(t)||s!==t)return s;if(this.options.trimValues)return UP(t,this.options.parseTagValue,this.options.numberParseOptions);var u=t.trim();return u===t?UP(t,this.options.parseTagValue,this.options.numberParseOptions):t}}function GTe(t){if(this.options.removeNSPrefix){var r=t.split(":"),e=t.charAt(0)==="/"?"/":"";if(r[0]==="xmlns")return"";r.length===2&&(t=e+r[1])}return t}var zTe=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function VTe(t,r){if(!this.options.ignoreAttributes&&typeof t=="string"){for(var e=GP.getAllMatches(t,zTe),n=e.length,i={},a=0;a<n;a++){var o=this.resolveNameSpace(e[a][1]),s=e[a][4],u=this.options.attributeNamePrefix+o;if(o.length)if(this.options.transformAttributeName&&(u=this.options.transformAttributeName(u)),u==="__proto__"&&(u="#__proto__"),s!==void 0){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);var l=this.options.attributeValueProcessor(o,s,r);l==null?i[u]=s:(0,vh.default)(l)!==(0,vh.default)(s)||l!==s?i[u]=l:i[u]=UP(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[u]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){var f={};return f[this.options.attributesGroupName]=i,f}return i}}var HTe=function(r){r=r.replace(/\r\n?/g,`
`);for(var e=new dh("!xml"),n=e,i="",a="",o=0;o<r.length;o++){var s=r[o];if(s==="<")if(r[o+1]==="/"){var u=Bs(r,">",o,"Closing Tag is not closed."),l=r.substring(o+2,u).trim();if(this.options.removeNSPrefix){var f=l.indexOf(":");f!==-1&&(l=l.substr(f+1))}this.options.transformTagName&&(l=this.options.transformTagName(l)),n&&(i=this.saveTextToParentTag(i,n,a)),a=a.substr(0,a.lastIndexOf(".")),n=this.tagsNodeStack.pop(),i="",o=u}else if(r[o+1]==="?"){var c=jP(r,o,!1,"?>");if(!c)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,n,a),!(this.options.ignoreDeclaration&&c.tagName==="?xml"||this.options.ignorePiTags)){var p=new dh(c.tagName);p.add(this.options.textNodeName,""),c.tagName!==c.tagExp&&c.attrExpPresent&&(p[":@"]=this.buildAttributesMap(c.tagExp,a)),n.addChild(p)}o=c.closeIndex+1}else if(r.substr(o+1,3)==="!--"){var d=Bs(r,"-->",o+4,"Comment is not closed.");if(this.options.commentPropName){var v=r.substring(o+4,d-2);i=this.saveTextToParentTag(i,n,a),n.add(this.options.commentPropName,[(0,NP.default)({},this.options.textNodeName,v)])}o=d}else if(r.substr(o+1,2)==="!D"){var m=FTe(r,o);this.docTypeEntities=m.entities,o=m.i}else if(r.substr(o+1,2)==="!["){var g=Bs(r,"]]>",o,"CDATA is not closed.")-2,y=r.substring(o+9,g);if(i=this.saveTextToParentTag(i,n,a),this.options.cdataPropName)n.add(this.options.cdataPropName,[(0,NP.default)({},this.options.textNodeName,y)]);else{var _=this.parseTextData(y,n.tagname,a,!0,!1,!0);_==null&&(_=""),n.add(this.options.textNodeName,_)}o=g+2}else{var b=jP(r,o,this.options.removeNSPrefix),x=b.tagName,A=b.tagExp,T=b.attrExpPresent,O=b.closeIndex;this.options.transformTagName&&(x=this.options.transformTagName(x)),n&&i&&n.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,n,a,!1)),x!==e.tagname&&(a+=a?"."+x:x);var w=n;if(w&&this.options.unpairedTags.indexOf(w.tagname)!==-1&&(n=this.tagsNodeStack.pop()),this.isItStopNode(this.options.stopNodes,a,x)){var E="";if(A.length>0&&A.lastIndexOf("/")===A.length-1)o=b.closeIndex;else if(this.options.unpairedTags.indexOf(x)!==-1)o=b.closeIndex;else{var S=this.readStopNodeData(r,x,O+1);if(!S)throw new Error("Unexpected end of ".concat(x));o=S.i,E=S.tagContent}var I=new dh(x);x!==A&&T&&(I[":@"]=this.buildAttributesMap(A,a)),E&&(E=this.parseTextData(E,x,a,!0,T,!0,!0)),a=a.substr(0,a.lastIndexOf(".")),I.add(this.options.textNodeName,E),n.addChild(I)}else{if(A.length>0&&A.lastIndexOf("/")===A.length-1){x[x.length-1]==="/"?(x=x.substr(0,x.length-1),A=x):A=A.substr(0,A.length-1),this.options.transformTagName&&(x=this.options.transformTagName(x));var R=new dh(x);x!==A&&T&&(R[":@"]=this.buildAttributesMap(A,a)),a=a.substr(0,a.lastIndexOf(".")),n.addChild(R)}else{var z=new dh(x);this.tagsNodeStack.push(n),x!==A&&T&&(z[":@"]=this.buildAttributesMap(A,a)),n.addChild(z),n=z}i="",o=O}}else i+=r[o]}return e.child},WTe=function(r){if(this.options.processEntities){for(var e in this.docTypeEntities){var n=this.docTypeEntities[e];r=r.replace(n.regx,n.val)}for(var i in this.lastEntities){var a=this.lastEntities[i];r=r.replace(a.regex,a.val)}if(this.options.htmlEntities)for(var o in this.htmlEntities){var s=this.htmlEntities[o];r=r.replace(s.regex,s.val)}r=r.replace(this.ampEntity.regex,this.ampEntity.val)}return r};function $Te(t,r,e,n){return t&&(n===void 0&&(n=Object.keys(r.child).length===0),t=this.parseTextData(t,r.tagname,e,!1,r[":@"]?Object.keys(r[":@"]).length!==0:!1,n),t!==void 0&&t!==""&&r.add(this.options.textNodeName,t),t=""),t}function XTe(t,r,e){var n="*."+e;for(var i in t){var a=t[i];if(n===a||r===a)return!0}return!1}function qTe(t,r){for(var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:">",n,i="",a=r;a<t.length;a++){var o=t[a];if(n)o===n&&(n="");else if(o==='"'||o==="'")n=o;else if(o===e[0])if(e[1]){if(t[a+1]===e[1])return{data:i,index:a}}else return{data:i,index:a};else o==="	"&&(o=" ");i+=o}}function Bs(t,r,e,n){var i=t.indexOf(r,e);if(i===-1)throw new Error(n);return i+r.length-1}function jP(t,r,e){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:">",i=qTe(t,r+1,n);if(i){var a=i.data,o=i.index,s=a.search(/\s/),u=a,l=!0;if(s!==-1&&(u=a.substr(0,s).replace(/\s\s*$/,""),a=a.substr(s+1)),e){var f=u.indexOf(":");f!==-1&&(u=u.substr(f+1),l=u!==i.data.substr(f+1))}return{tagName:u,tagExp:a,closeIndex:o,attrExpPresent:l}}}function YTe(t,r,e){for(var n=e,i=1;e<t.length;e++)if(t[e]==="<")if(t[e+1]==="/"){var a=Bs(t,">",e,"".concat(r," is not closed")),o=t.substring(e+2,a).trim();if(o===r&&(i--,i===0))return{tagContent:t.substring(n,e),i:a};e=a}else if(t[e+1]==="?"){var s=Bs(t,"?>",e+1,"StopNode is not closed.");e=s}else if(t.substr(e+1,3)==="!--"){var u=Bs(t,"-->",e+3,"StopNode is not closed.");e=u}else if(t.substr(e+1,2)==="!["){var l=Bs(t,"]]>",e,"StopNode is not closed.")-2;e=l}else{var f=jP(t,e,">");if(f){var c=f&&f.tagName;c===r&&f.tagExp[f.tagExp.length-1]!=="/"&&i++,e=f.closeIndex}}}function UP(t,r,e){if(r&&typeof t=="string"){var n=t.trim();return n==="true"?!0:n==="false"?!1:DTe(t,e)}else return GP.isExist(t)?t:""}j7.exports=NTe});var V7=Te(z7=>{"use strict";function KTe(t,r){return G7(t,r)}function G7(t,r,e){for(var n,i={},a=0;a<t.length;a++){var o=t[a],s=JTe(o),u="";if(e===void 0?u=s:u=e+"."+s,s===r.textNodeName)n===void 0?n=o[s]:n+=""+o[s];else{if(s===void 0)continue;if(o[s]){var l=G7(o[s],r,u),f=QTe(l,r);o[":@"]?ZTe(l,o[":@"],u,r):Object.keys(l).length===1&&l[r.textNodeName]!==void 0&&!r.alwaysCreateTextNode?l=l[r.textNodeName]:Object.keys(l).length===0&&(r.alwaysCreateTextNode?l[r.textNodeName]="":l=""),i[s]!==void 0&&i.hasOwnProperty(s)?(Array.isArray(i[s])||(i[s]=[i[s]]),i[s].push(l)):r.isArray(s,u,f)?i[s]=[l]:i[s]=l}}}return typeof n=="string"?n.length>0&&(i[r.textNodeName]=n):n!==void 0&&(i[r.textNodeName]=n),i}function JTe(t){for(var r=Object.keys(t),e=0;e<r.length;e++){var n=r[e];if(n!==":@")return n}}function ZTe(t,r,e,n){if(r)for(var i=Object.keys(r),a=i.length,o=0;o<a;o++){var s=i[o];n.isArray(s,e+"."+s,!0,!0)?t[s]=[r[s]]:t[s]=r[s]}}function QTe(t,r){var e=Object.keys(t).length;return!!(e===0||e===1&&t[r.textNodeName])}z7.prettify=KTe});var X7=Te((bnt,$7)=>{var H7=h(L()),W7=h(N()),eSe=C7(),tSe=eSe.buildOptions,rSe=U7(),nSe=V7(),iSe=nSe.prettify,aSe=FP(),oSe=function(){function t(r){(0,H7.default)(this,t),this.externalEntities={},this.options=tSe(r)}return(0,W7.default)(t,[{key:"parse",value:function(e,n){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(n){n===!0&&(n={});var i=aSe.validate(e,n);if(i!==!0)throw Error("".concat(i.err.msg,":").concat(i.err.line,":").concat(i.err.col))}var a=new rSe(this.options);a.addExternalEntities(this.externalEntities);var o=a.parseXml(e);return this.options.preserveOrder||o===void 0?o:iSe(o,this.options)}},{key:"addEntity",value:function(e,n){if(n.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(n==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=n}}]),t}();$7.exports=oSe});var Z7=Te((xnt,J7)=>{var sSe=`
`;function uSe(t,r){var e="";return r.format&&r.indentBy.length>0&&(e=sSe),Y7(t,r,"",e)}function Y7(t,r,e,n){for(var i="",a=!1,o=0;o<t.length;o++){var s=t[o],u=lSe(s),l="";if(e.length===0?l=u:l="".concat(e,".").concat(u),u===r.textNodeName){var f=s[u];fSe(l,r)||(f=r.tagValueProcessor(u,f),f=K7(f,r)),a&&(i+=n),i+=f,a=!1;continue}else if(u===r.cdataPropName){a&&(i+=n),i+="<![CDATA[".concat(s[u][0][r.textNodeName],"]]>"),a=!1;continue}else if(u===r.commentPropName){i+=n+"<!--".concat(s[u][0][r.textNodeName],"-->"),a=!0;continue}else if(u[0]==="?"){var c=q7(s[":@"],r),p=u==="?xml"?"":n,d=s[u][0][r.textNodeName];d=d.length!==0?" "+d:"",i+=p+"<".concat(u).concat(d).concat(c,"?>"),a=!0;continue}var v=n;v!==""&&(v+=r.indentBy);var m=q7(s[":@"],r),g=n+"<".concat(u).concat(m),y=Y7(s[u],r,l,v);r.unpairedTags.indexOf(u)!==-1?r.suppressUnpairedNode?i+=g+">":i+=g+"/>":(!y||y.length===0)&&r.suppressEmptyNode?i+=g+"/>":y&&y.endsWith(">")?i+=g+">".concat(y).concat(n,"</").concat(u,">"):(i+=g+">",y&&n!==""&&(y.includes("/>")||y.includes("</"))?i+=n+r.indentBy+y+n:i+=y,i+="</".concat(u,">")),a=!0}return i}function lSe(t){for(var r=Object.keys(t),e=0;e<r.length;e++){var n=r[e];if(n!==":@")return n}}function q7(t,r){var e="";if(t&&!r.ignoreAttributes)for(var n in t){var i=r.attributeValueProcessor(n,t[n]);i=K7(i,r),i===!0&&r.suppressBooleanAttributes?e+=" ".concat(n.substr(r.attributeNamePrefix.length)):e+=" ".concat(n.substr(r.attributeNamePrefix.length),'="').concat(i,'"')}return e}function fSe(t,r){t=t.substr(0,t.length-r.textNodeName.length-1);var e=t.substr(t.lastIndexOf(".")+1);for(var n in r.stopNodes)if(r.stopNodes[n]===t||r.stopNodes[n]==="*."+e)return!0;return!1}function K7(t,r){if(t&&t.length>0&&r.processEntities)for(var e=0;e<r.entities.length;e++){var n=r.entities[e];t=t.replace(n.regex,n.val)}return t}J7.exports=uSe});var t$=Te((Ant,e$)=>{"use strict";var zP=h(Je()),Q7=h(B()),cSe=Z7(),pSe={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[]};function _o(t){this.options=Object.assign({},pSe,t),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=vSe),this.processTextOrObjNode=hSe,this.options.format?(this.indentate=dSe,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}_o.prototype.build=function(t){return this.options.preserveOrder?cSe(t,this.options):(Array.isArray(t)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(t=(0,Q7.default)({},this.options.arrayNodeName,t)),this.j2x(t,0).val)};_o.prototype.j2x=function(t,r){var e="",n="";for(var i in t)if(!(typeof t[i]>"u"))if(t[i]===null)i[0]==="?"?n+=this.indentate(r)+"<"+i+"?"+this.tagEndChar:n+=this.indentate(r)+"<"+i+"/"+this.tagEndChar;else if(t[i]instanceof Date)n+=this.buildTextValNode(t[i],i,"",r);else if((0,zP.default)(t[i])!=="object"){var a=this.isAttribute(i);if(a)e+=this.buildAttrPairStr(a,""+t[i]);else if(i===this.options.textNodeName){var o=this.options.tagValueProcessor(i,""+t[i]);n+=this.replaceEntitiesValue(o)}else n+=this.buildTextValNode(t[i],i,"",r)}else if(Array.isArray(t[i]))for(var s=t[i].length,u=0;u<s;u++){var l=t[i][u];typeof l>"u"||(l===null?i[0]==="?"?n+=this.indentate(r)+"<"+i+"?"+this.tagEndChar:n+=this.indentate(r)+"<"+i+"/"+this.tagEndChar:(0,zP.default)(l)==="object"?n+=this.processTextOrObjNode(l,i,r):n+=this.buildTextValNode(l,i,"",r))}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName)for(var f=Object.keys(t[i]),c=f.length,p=0;p<c;p++)e+=this.buildAttrPairStr(f[p],""+t[i][f[p]]);else n+=this.processTextOrObjNode(t[i],i,r);return{attrStr:e,val:n}};_o.prototype.buildAttrPairStr=function(t,r){return r=this.options.attributeValueProcessor(t,""+r),r=this.replaceEntitiesValue(r),this.options.suppressBooleanAttributes&&r==="true"?" "+t:" "+t+'="'+r+'"'};function hSe(t,r,e){var n=this.j2x(t,e+1);return t[this.options.textNodeName]!==void 0&&Object.keys(t).length===1?this.buildTextValNode(t[this.options.textNodeName],r,n.attrStr,e):this.buildObjectNode(n.val,r,n.attrStr,e)}_o.prototype.buildObjectNode=function(t,r,e,n){if(t==="")return r[0]==="?"?this.indentate(n)+"<"+r+e+"?"+this.tagEndChar:this.indentate(n)+"<"+r+e+this.closeTag(r)+this.tagEndChar;var i="</"+r+this.tagEndChar,a="";return r[0]==="?"&&(a="?",i=""),e&&t.indexOf("<")===-1?this.indentate(n)+"<"+r+e+a+">"+t+i:this.options.commentPropName!==!1&&r===this.options.commentPropName&&a.length===0?this.indentate(n)+"<!--".concat(t,"-->")+this.newLine:this.indentate(n)+"<"+r+e+a+this.tagEndChar+t+this.indentate(n)+i};_o.prototype.closeTag=function(t){var r="";return this.options.unpairedTags.indexOf(t)!==-1?this.options.suppressUnpairedNode||(r="/"):this.options.suppressEmptyNode?r="/":r="></".concat(t),r};_o.prototype.buildTextValNode=function(t,r,e,n){if(this.options.cdataPropName!==!1&&r===this.options.cdataPropName)return this.indentate(n)+"<![CDATA[".concat(t,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&r===this.options.commentPropName)return this.indentate(n)+"<!--".concat(t,"-->")+this.newLine;if(r[0]==="?")return this.indentate(n)+"<"+r+e+"?"+this.tagEndChar;var i=this.options.tagValueProcessor(r,t);return i=this.replaceEntitiesValue(i),i===""?this.indentate(n)+"<"+r+e+this.closeTag(r)+this.tagEndChar:this.indentate(n)+"<"+r+e+">"+i+"</"+r+this.tagEndChar};_o.prototype.replaceEntitiesValue=function(t){if(t&&t.length>0&&this.options.processEntities)for(var r=0;r<this.options.entities.length;r++){var e=this.options.entities[r];t=t.replace(e.regex,e.val)}return t};function dSe(t){return this.options.indentBy.repeat(t)}function vSe(t){return t.startsWith(this.options.attributeNamePrefix)?t.substr(this.attrPrefixLen):!1}e$.exports=_o});var n$=Te((Tnt,r$)=>{"use strict";var mSe=FP(),gSe=X7(),ySe=t$();r$.exports={XMLParser:gSe,XMLValidator:mSe,XMLBuilder:ySe}});var dw=Te((uX,Th)=>{(function(t,r){typeof define=="function"&&define.amd?define([],r):typeof W2=="function"&&typeof Th=="object"&&Th&&Th.exports?Th.exports=r():(t.dcodeIO=t.dcodeIO||{}).Long=r()})(uX,function(){"use strict";function t(E,S,I){this.low=E|0,this.high=S|0,this.unsigned=!!I}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function r(E){return(E&&E.__isLong__)===!0}t.isLong=r;var e={},n={};function i(E,S){var I,R,z;return S?(E>>>=0,(z=0<=E&&E<256)&&(R=n[E],R)?R:(I=o(E,(E|0)<0?-1:0,!0),z&&(n[E]=I),I)):(E|=0,(z=-128<=E&&E<128)&&(R=e[E],R)?R:(I=o(E,E<0?-1:0,!1),z&&(e[E]=I),I))}t.fromInt=i;function a(E,S){if(isNaN(E)||!isFinite(E))return S?y:g;if(S){if(E<0)return y;if(E>=d)return T}else{if(E<=-v)return O;if(E+1>=v)return A}return E<0?a(-E,S).neg():o(E%p|0,E/p|0,S)}t.fromNumber=a;function o(E,S,I){return new t(E,S,I)}t.fromBits=o;var s=Math.pow;function u(E,S,I){if(E.length===0)throw Error("empty string");if(E==="NaN"||E==="Infinity"||E==="+Infinity"||E==="-Infinity")return g;if(typeof S=="number"?(I=S,S=!1):S=!!S,I=I||10,I<2||36<I)throw RangeError("radix");var R;if((R=E.indexOf("-"))>0)throw Error("interior hyphen");if(R===0)return u(E.substring(1),S,I).neg();for(var z=a(s(I,8)),G=g,k=0;k<E.length;k+=8){var U=Math.min(8,E.length-k),j=parseInt(E.substring(k,k+U),I);if(U<8){var X=a(s(I,U));G=G.mul(X).add(a(j))}else G=G.mul(z),G=G.add(a(j))}return G.unsigned=S,G}t.fromString=u;function l(E){return E instanceof t?E:typeof E=="number"?a(E):typeof E=="string"?u(E):o(E.low,E.high,E.unsigned)}t.fromValue=l;var f=1<<16,c=1<<24,p=f*f,d=p*p,v=d/2,m=i(c),g=i(0);t.ZERO=g;var y=i(0,!0);t.UZERO=y;var _=i(1);t.ONE=_;var b=i(1,!0);t.UONE=b;var x=i(-1);t.NEG_ONE=x;var A=o(-1,2147483647,!1);t.MAX_VALUE=A;var T=o(-1,-1,!0);t.MAX_UNSIGNED_VALUE=T;var O=o(0,-2147483648,!1);t.MIN_VALUE=O;var w=t.prototype;return w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},w.toString=function(S){if(S=S||10,S<2||36<S)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(O)){var I=a(S),R=this.div(I),z=R.mul(I).sub(this);return R.toString(S)+z.toInt().toString(S)}else return"-"+this.neg().toString(S);for(var G=a(s(S,6),this.unsigned),k=this,U="";;){var j=k.div(G),X=k.sub(j.mul(G)).toInt()>>>0,H=X.toString(S);if(k=j,k.isZero())return H+U;for(;H.length<6;)H="0"+H;U=""+H+U}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(O)?64:this.neg().getNumBitsAbs();for(var S=this.high!=0?this.high:this.low,I=31;I>0&&!(S&1<<I);I--);return this.high!=0?I+33:I+1},w.isZero=function(){return this.high===0&&this.low===0},w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return(this.low&1)===1},w.isEven=function(){return(this.low&1)===0},w.equals=function(S){return r(S)||(S=l(S)),this.unsigned!==S.unsigned&&this.high>>>31===1&&S.high>>>31===1?!1:this.high===S.high&&this.low===S.low},w.eq=w.equals,w.notEquals=function(S){return!this.eq(S)},w.neq=w.notEquals,w.lessThan=function(S){return this.comp(S)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(S){return this.comp(S)<=0},w.lte=w.lessThanOrEqual,w.greaterThan=function(S){return this.comp(S)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(S){return this.comp(S)>=0},w.gte=w.greaterThanOrEqual,w.compare=function(S){if(r(S)||(S=l(S)),this.eq(S))return 0;var I=this.isNegative(),R=S.isNegative();return I&&!R?-1:!I&&R?1:this.unsigned?S.high>>>0>this.high>>>0||S.high===this.high&&S.low>>>0>this.low>>>0?-1:1:this.sub(S).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(O)?O:this.not().add(_)},w.neg=w.negate,w.add=function(S){r(S)||(S=l(S));var I=this.high>>>16,R=this.high&65535,z=this.low>>>16,G=this.low&65535,k=S.high>>>16,U=S.high&65535,j=S.low>>>16,X=S.low&65535,H=0,Q=0,ne=0,le=0;return le+=G+X,ne+=le>>>16,le&=65535,ne+=z+j,Q+=ne>>>16,ne&=65535,Q+=R+U,H+=Q>>>16,Q&=65535,H+=I+k,H&=65535,o(ne<<16|le,H<<16|Q,this.unsigned)},w.subtract=function(S){return r(S)||(S=l(S)),this.add(S.neg())},w.sub=w.subtract,w.multiply=function(S){if(this.isZero()||(r(S)||(S=l(S)),S.isZero()))return g;if(this.eq(O))return S.isOdd()?O:g;if(S.eq(O))return this.isOdd()?O:g;if(this.isNegative())return S.isNegative()?this.neg().mul(S.neg()):this.neg().mul(S).neg();if(S.isNegative())return this.mul(S.neg()).neg();if(this.lt(m)&&S.lt(m))return a(this.toNumber()*S.toNumber(),this.unsigned);var I=this.high>>>16,R=this.high&65535,z=this.low>>>16,G=this.low&65535,k=S.high>>>16,U=S.high&65535,j=S.low>>>16,X=S.low&65535,H=0,Q=0,ne=0,le=0;return le+=G*X,ne+=le>>>16,le&=65535,ne+=z*X,Q+=ne>>>16,ne&=65535,ne+=G*j,Q+=ne>>>16,ne&=65535,Q+=R*X,H+=Q>>>16,Q&=65535,Q+=z*j,H+=Q>>>16,Q&=65535,Q+=G*U,H+=Q>>>16,Q&=65535,H+=I*X+R*j+z*U+G*k,H&=65535,o(ne<<16|le,H<<16|Q,this.unsigned)},w.mul=w.multiply,w.divide=function(S){if(r(S)||(S=l(S)),S.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?y:g;var I,R,z;if(this.unsigned){if(S.unsigned||(S=S.toUnsigned()),S.gt(this))return y;if(S.gt(this.shru(1)))return b;z=y}else{if(this.eq(O)){if(S.eq(_)||S.eq(x))return O;if(S.eq(O))return _;var G=this.shr(1);return I=G.div(S).shl(1),I.eq(g)?S.isNegative()?_:x:(R=this.sub(S.mul(I)),z=I.add(R.div(S)),z)}else if(S.eq(O))return this.unsigned?y:g;if(this.isNegative())return S.isNegative()?this.neg().div(S.neg()):this.neg().div(S).neg();if(S.isNegative())return this.div(S.neg()).neg();z=g}for(R=this;R.gte(S);){I=Math.max(1,Math.floor(R.toNumber()/S.toNumber()));for(var k=Math.ceil(Math.log(I)/Math.LN2),U=k<=48?1:s(2,k-48),j=a(I),X=j.mul(S);X.isNegative()||X.gt(R);)I-=U,j=a(I,this.unsigned),X=j.mul(S);j.isZero()&&(j=_),z=z.add(j),R=R.sub(X)}return z},w.div=w.divide,w.modulo=function(S){return r(S)||(S=l(S)),this.sub(this.div(S).mul(S))},w.mod=w.modulo,w.not=function(){return o(~this.low,~this.high,this.unsigned)},w.and=function(S){return r(S)||(S=l(S)),o(this.low&S.low,this.high&S.high,this.unsigned)},w.or=function(S){return r(S)||(S=l(S)),o(this.low|S.low,this.high|S.high,this.unsigned)},w.xor=function(S){return r(S)||(S=l(S)),o(this.low^S.low,this.high^S.high,this.unsigned)},w.shiftLeft=function(S){return r(S)&&(S=S.toInt()),(S&=63)===0?this:S<32?o(this.low<<S,this.high<<S|this.low>>>32-S,this.unsigned):o(0,this.low<<S-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(S){return r(S)&&(S=S.toInt()),(S&=63)===0?this:S<32?o(this.low>>>S|this.high<<32-S,this.high>>S,this.unsigned):o(this.high>>S-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(S){if(r(S)&&(S=S.toInt()),S&=63,S===0)return this;var I=this.high;if(S<32){var R=this.low;return o(R>>>S|I<<32-S,I>>>S,this.unsigned)}else return S===32?o(I,0,this.unsigned):o(I>>>S-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},w.toBytes=function(E){return E?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var E=this.high,S=this.low;return[S&255,S>>>8&255,S>>>16&255,S>>>24&255,E&255,E>>>8&255,E>>>16&255,E>>>24&255]},w.toBytesBE=function(){var E=this.high,S=this.low;return[E>>>24&255,E>>>16&255,E>>>8&255,E&255,S>>>24&255,S>>>16&255,S>>>8&255,S&255]},t})});var Fy=Te((Qot,yq)=>{yq.exports=globalThis.h3||{}});var Bne=Te(MM=>{MM.read=function(t,r,e,n,i){var a,o,s=i*8-n-1,u=(1<<s)-1,l=u>>1,f=-7,c=e?i-1:0,p=e?-1:1,d=t[r+c];for(c+=p,a=d&(1<<-f)-1,d>>=-f,f+=s;f>0;a=a*256+t[r+c],c+=p,f-=8);for(o=a&(1<<-f)-1,a>>=-f,f+=n;f>0;o=o*256+t[r+c],c+=p,f-=8);if(a===0)a=1-l;else{if(a===u)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,n),a=a-l}return(d?-1:1)*o*Math.pow(2,a-n)};MM.write=function(t,r,e,n,i,a){var o,s,u,l=a*8-i-1,f=(1<<l)-1,c=f>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:a-1,v=n?1:-1,m=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(s=isNaN(r)?1:0,o=f):(o=Math.floor(Math.log(r)/Math.LN2),r*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+c>=1?r+=p/u:r+=p*Math.pow(2,1-c),r*u>=2&&(o++,u/=2),o+c>=f?(s=0,o=f):o+c>=1?(s=(r*u-1)*Math.pow(2,i),o=o+c):(s=r*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;t[e+d]=s&255,d+=v,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;t[e+d]=o&255,d+=v,o/=256,l-=8);t[e+d-v]|=m*128}});var Gne=Te((uyt,Une)=>{"use strict";Une.exports=at;var y_=Bne();function at(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}at.Varint=0;at.Fixed64=1;at.Bytes=2;at.Fixed32=5;var IM=(1<<16)*(1<<16),Fne=1/IM,mRe=12,jne=typeof TextDecoder>"u"?null:new TextDecoder("utf8");at.prototype={destroy:function(){this.buf=null},readFields:function(t,r,e){for(e=e||this.length;this.pos<e;){var n=this.readVarint(),i=n>>3,a=this.pos;this.type=n&7,t(i,r,this),this.pos===a&&this.skip(n)}return r},readMessage:function(t,r){return this.readFields(t,r,this.readVarint()+this.pos)},readFixed32:function(){var t=__(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Nne(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=__(this.buf,this.pos)+__(this.buf,this.pos+4)*IM;return this.pos+=8,t},readSFixed64:function(){var t=__(this.buf,this.pos)+Nne(this.buf,this.pos+4)*IM;return this.pos+=8,t},readFloat:function(){var t=y_.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=y_.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var r=this.buf,e,n;return n=r[this.pos++],e=n&127,n<128||(n=r[this.pos++],e|=(n&127)<<7,n<128)||(n=r[this.pos++],e|=(n&127)<<14,n<128)||(n=r[this.pos++],e|=(n&127)<<21,n<128)?e:(n=r[this.pos],e|=(n&15)<<28,gRe(e,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,r=this.pos;return this.pos=t,t-r>=mRe&&jne?IRe(this.buf,r,t):MRe(this.buf,r,t)},readBytes:function(){var t=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,t);return this.pos=t,r},readPackedVarint:function(t,r){if(this.type!==at.Bytes)return t.push(this.readVarint(r));var e=Ga(this);for(t=t||[];this.pos<e;)t.push(this.readVarint(r));return t},readPackedSVarint:function(t){if(this.type!==at.Bytes)return t.push(this.readSVarint());var r=Ga(this);for(t=t||[];this.pos<r;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==at.Bytes)return t.push(this.readBoolean());var r=Ga(this);for(t=t||[];this.pos<r;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==at.Bytes)return t.push(this.readFloat());var r=Ga(this);for(t=t||[];this.pos<r;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==at.Bytes)return t.push(this.readDouble());var r=Ga(this);for(t=t||[];this.pos<r;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==at.Bytes)return t.push(this.readFixed32());var r=Ga(this);for(t=t||[];this.pos<r;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==at.Bytes)return t.push(this.readSFixed32());var r=Ga(this);for(t=t||[];this.pos<r;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==at.Bytes)return t.push(this.readFixed64());var r=Ga(this);for(t=t||[];this.pos<r;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==at.Bytes)return t.push(this.readSFixed64());var r=Ga(this);for(t=t||[];this.pos<r;)t.push(this.readSFixed64());return t},skip:function(t){var r=t&7;if(r===at.Varint)for(;this.buf[this.pos++]>127;);else if(r===at.Bytes)this.pos=this.readVarint()+this.pos;else if(r===at.Fixed32)this.pos+=4;else if(r===at.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+r)},writeTag:function(t,r){this.writeVarint(t<<3|r)},realloc:function(t){for(var r=this.length||16;r<this.pos+t;)r*=2;if(r!==this.length){var e=new Uint8Array(r);e.set(this.buf),this.buf=e,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),xf(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),xf(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),xf(this.buf,t&-1,this.pos),xf(this.buf,Math.floor(t*Fne),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),xf(this.buf,t&-1,this.pos),xf(this.buf,Math.floor(t*Fne),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){yRe(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var r=this.pos;this.pos=RRe(this.buf,t,this.pos);var e=this.pos-r;e>=128&&Dne(r,e,this),this.pos=r-1,this.writeVarint(e),this.pos+=e},writeFloat:function(t){this.realloc(4),y_.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),y_.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var r=t.length;this.writeVarint(r),this.realloc(r);for(var e=0;e<r;e++)this.buf[this.pos++]=t[e]},writeRawMessage:function(t,r){this.pos++;var e=this.pos;t(r,this);var n=this.pos-e;n>=128&&Dne(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,r,e){this.writeTag(t,at.Bytes),this.writeRawMessage(r,e)},writePackedVarint:function(t,r){r.length&&this.writeMessage(t,xRe,r)},writePackedSVarint:function(t,r){r.length&&this.writeMessage(t,ARe,r)},writePackedBoolean:function(t,r){r.length&&this.writeMessage(t,PRe,r)},writePackedFloat:function(t,r){r.length&&this.writeMessage(t,TRe,r)},writePackedDouble:function(t,r){r.length&&this.writeMessage(t,SRe,r)},writePackedFixed32:function(t,r){r.length&&this.writeMessage(t,wRe,r)},writePackedSFixed32:function(t,r){r.length&&this.writeMessage(t,ORe,r)},writePackedFixed64:function(t,r){r.length&&this.writeMessage(t,ERe,r)},writePackedSFixed64:function(t,r){r.length&&this.writeMessage(t,CRe,r)},writeBytesField:function(t,r){this.writeTag(t,at.Bytes),this.writeBytes(r)},writeFixed32Field:function(t,r){this.writeTag(t,at.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(t,r){this.writeTag(t,at.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(t,r){this.writeTag(t,at.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(t,r){this.writeTag(t,at.Fixed64),this.writeSFixed64(r)},writeVarintField:function(t,r){this.writeTag(t,at.Varint),this.writeVarint(r)},writeSVarintField:function(t,r){this.writeTag(t,at.Varint),this.writeSVarint(r)},writeStringField:function(t,r){this.writeTag(t,at.Bytes),this.writeString(r)},writeFloatField:function(t,r){this.writeTag(t,at.Fixed32),this.writeFloat(r)},writeDoubleField:function(t,r){this.writeTag(t,at.Fixed64),this.writeDouble(r)},writeBooleanField:function(t,r){this.writeVarintField(t,Boolean(r))}};function gRe(t,r,e){var n=e.buf,i,a;if(a=n[e.pos++],i=(a&112)>>4,a<128||(a=n[e.pos++],i|=(a&127)<<3,a<128)||(a=n[e.pos++],i|=(a&127)<<10,a<128)||(a=n[e.pos++],i|=(a&127)<<17,a<128)||(a=n[e.pos++],i|=(a&127)<<24,a<128)||(a=n[e.pos++],i|=(a&1)<<31,a<128))return bf(t,i,r);throw new Error("Expected varint not more than 10 bytes")}function Ga(t){return t.type===at.Bytes?t.readVarint()+t.pos:t.pos+1}function bf(t,r,e){return e?r*4294967296+(t>>>0):(r>>>0)*4294967296+(t>>>0)}function yRe(t,r){var e,n;if(t>=0?(e=t%4294967296|0,n=t/4294967296|0):(e=~(-t%4294967296),n=~(-t/4294967296),e^4294967295?e=e+1|0:(e=0,n=n+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),_Re(e,n,r),bRe(n,r)}function _Re(t,r,e){e.buf[e.pos++]=t&127|128,t>>>=7,e.buf[e.pos++]=t&127|128,t>>>=7,e.buf[e.pos++]=t&127|128,t>>>=7,e.buf[e.pos++]=t&127|128,t>>>=7,e.buf[e.pos]=t&127}function bRe(t,r){var e=(t&7)<<4;r.buf[r.pos++]|=e|((t>>>=3)?128:0),t&&(r.buf[r.pos++]=t&127|((t>>>=7)?128:0),t&&(r.buf[r.pos++]=t&127|((t>>>=7)?128:0),t&&(r.buf[r.pos++]=t&127|((t>>>=7)?128:0),t&&(r.buf[r.pos++]=t&127|((t>>>=7)?128:0),t&&(r.buf[r.pos++]=t&127)))))}function Dne(t,r,e){var n=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(Math.LN2*7));e.realloc(n);for(var i=e.pos-1;i>=t;i--)e.buf[i+n]=e.buf[i]}function xRe(t,r){for(var e=0;e<t.length;e++)r.writeVarint(t[e])}function ARe(t,r){for(var e=0;e<t.length;e++)r.writeSVarint(t[e])}function TRe(t,r){for(var e=0;e<t.length;e++)r.writeFloat(t[e])}function SRe(t,r){for(var e=0;e<t.length;e++)r.writeDouble(t[e])}function PRe(t,r){for(var e=0;e<t.length;e++)r.writeBoolean(t[e])}function wRe(t,r){for(var e=0;e<t.length;e++)r.writeFixed32(t[e])}function ORe(t,r){for(var e=0;e<t.length;e++)r.writeSFixed32(t[e])}function ERe(t,r){for(var e=0;e<t.length;e++)r.writeFixed64(t[e])}function CRe(t,r){for(var e=0;e<t.length;e++)r.writeSFixed64(t[e])}function __(t,r){return(t[r]|t[r+1]<<8|t[r+2]<<16)+t[r+3]*16777216}function xf(t,r,e){t[e]=r,t[e+1]=r>>>8,t[e+2]=r>>>16,t[e+3]=r>>>24}function Nne(t,r){return(t[r]|t[r+1]<<8|t[r+2]<<16)+(t[r+3]<<24)}function MRe(t,r,e){for(var n="",i=r;i<e;){var a=t[i],o=null,s=a>239?4:a>223?3:a>191?2:1;if(i+s>e)break;var u,l,f;s===1?a<128&&(o=a):s===2?(u=t[i+1],(u&192)===128&&(o=(a&31)<<6|u&63,o<=127&&(o=null))):s===3?(u=t[i+1],l=t[i+2],(u&192)===128&&(l&192)===128&&(o=(a&15)<<12|(u&63)<<6|l&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):s===4&&(u=t[i+1],l=t[i+2],f=t[i+3],(u&192)===128&&(l&192)===128&&(f&192)===128&&(o=(a&15)<<18|(u&63)<<12|(l&63)<<6|f&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,s=1):o>65535&&(o-=65536,n+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),n+=String.fromCharCode(o),i+=s}return n}function IRe(t,r,e){return jne.decode(t.subarray(r,e))}function RRe(t,r,e){for(var n=0,i,a;n<r.length;n++){if(i=r.charCodeAt(n),i>55295&&i<57344)if(a)if(i<56320){t[e++]=239,t[e++]=191,t[e++]=189,a=i;continue}else i=a-55296<<10|i-56320|65536,a=null;else{i>56319||n+1===r.length?(t[e++]=239,t[e++]=191,t[e++]=189):a=i;continue}else a&&(t[e++]=239,t[e++]=191,t[e++]=189,a=null);i<128?t[e++]=i:(i<2048?t[e++]=i>>6|192:(i<65536?t[e++]=i>>12|224:(t[e++]=i>>18|240,t[e++]=i>>12&63|128),t[e++]=i>>6&63|128),t[e++]=i&63|128)}return e}});var Kie=Te((T0t,Yie)=>{"use strict";var ALe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";Yie.exports=ALe});var eae=Te((S0t,Qie)=>{"use strict";var TLe=Kie();function Jie(){}function Zie(){}Zie.resetWarningCache=Jie;Qie.exports=function(){function t(n,i,a,o,s,u){if(u!==TLe){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}t.isRequired=t;function r(){return t}var e={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:r,element:t,elementType:t,instanceOf:r,node:t,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:Zie,resetWarningCache:Jie};return e.PropTypes=e,e}});var rae=Te((O0t,tae)=>{tae.exports=eae()();var P0t,w0t});var UBe={};tn(UBe,{AGGREGATION_OPERATION:()=>vt,AmbientLight:()=>gm,ArcLayer:()=>El,AttributeManager:()=>co,BitmapLayer:()=>Cl,BrushingExtension:()=>Z0,COORDINATE_SYSTEM:()=>se,CPUGridLayer:()=>hu,ClipExtension:()=>vf,CollisionFilterExtension:()=>u_,ColumnLayer:()=>Li,CompositeLayer:()=>St,ContourLayer:()=>q_,Controller:()=>wn,DataFilterExtension:()=>t_,Deck:()=>un,DeckGL:()=>pae,DeckRenderer:()=>qm,DirectionalLight:()=>fs,FillStyleExtension:()=>a_,FirstPersonController:()=>Pg,FirstPersonView:()=>RS,FirstPersonViewport:()=>Ag,FlyToInterpolator:()=>Z8,Fp64Extension:()=>sM,GPUGridLayer:()=>mu,GeoJsonLayer:()=>ya,GeohashLayer:()=>P_,GoogleMapsOverlay:()=>Nue,GreatCircleLayer:()=>yy,GridCellLayer:()=>Fl,GridLayer:()=>Q_,H3ClusterLayer:()=>Ny,H3HexagonLayer:()=>Pa,HeatmapLayer:()=>tb,HexagonLayer:()=>V_,IconLayer:()=>po,Layer:()=>Ve,LayerExtension:()=>jt,LayerManager:()=>Um,LightingEffect:()=>ip,LineLayer:()=>Il,LinearInterpolator:()=>Xr,MVTLayer:()=>S_,MapController:()=>$m,MapView:()=>As,MapboxLayer:()=>ib,MapboxOverlay:()=>ele,MaskExtension:()=>l_,OPERATION:()=>KL,OrbitController:()=>Og,OrbitView:()=>NS,OrbitViewport:()=>bg,OrthographicController:()=>Eg,OrthographicView:()=>HS,OrthographicViewport:()=>wl,PathLayer:()=>ki,PathStyleExtension:()=>n_,PointCloudLayer:()=>Rl,PointLight:()=>km,PolygonLayer:()=>Fi,PostProcessEffect:()=>F4,QuadkeyLayer:()=>Ty,S2Layer:()=>xy,ScatterplotLayer:()=>Ll,ScenegraphLayer:()=>nf,ScreenGridLayer:()=>U_,SimpleMeshLayer:()=>Oa,SolidPolygonLayer:()=>Bi,TRANSITION_EVENTS:()=>cp,TerrainLayer:()=>J0,Tesselator:()=>Ol,TextLayer:()=>zl,Tile3DLayer:()=>V0,TileLayer:()=>Sa,TransitionInterpolator:()=>pl,TripsLayer:()=>By,UNIT:()=>bt,VERSION:()=>Yd,View:()=>Pn,Viewport:()=>yr,WebMercatorViewport:()=>$r,_AggregationLayer:()=>fi,_BinSorter:()=>Ef,_CPUAggregator:()=>Rf,_CameraLight:()=>m4,_GPUGridAggregator:()=>Or,_GeoCellLayer:()=>Cn,_GlobeController:()=>Rg,_GlobeView:()=>YS,_GlobeViewport:()=>Pl,_LayersPass:()=>Vr,_MultiIconLayer:()=>Ul,_PickLayersPass:()=>oo,_SunLight:()=>P4,_TerrainExtension:()=>d_,_TextBackgroundLayer:()=>Gl,_Tile2DHeader:()=>Sh,_Tileset2D:()=>Ch,_WMSLayer:()=>gy,_compareProps:()=>bl,_count:()=>hg,_deepEqual:()=>It,_fillArray:()=>jm,_flatten:()=>Br,_getURLFromTemplate:()=>ji,_memoize:()=>Hr,_mergeShaders:()=>da,_registerLoggers:()=>qd,assert:()=>rt,createIterable:()=>Nt,fp64LowPart:()=>Jn,gouraudLighting:()=>on,log:()=>Z,phongLighting:()=>ia,picking:()=>it,project:()=>Yt,project32:()=>Ze,project64:()=>r_,shadow:()=>gs});var fw=h(ye()),vy=h(ge()),q$=h(L()),Y$=h(N()),K$=h(_e()),J$=h(Oe()),Z$=h(Y()),Q$=h(K()),my=h(q()),Ah=h(B()),js=h(de());var YL=h(B());var xR=h(ge()),u1=h(de());function Fe(t,r){if(!t)throw new Error(r||"loader assertion failed.")}var vI=h(Je()),vi={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},Yle=vi.self||vi.window||vi.global||{},Kle=vi.window||vi.self||vi.global||{},Jle=vi.global||vi.self||vi.window||{},Zle=vi.document||{};var jn=Boolean((typeof process>"u"?"undefined":(0,vI.default)(process))!=="object"||String(process)!=="[object process]"||process.browser);var dI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),Qle=dI&&parseFloat(dI[1])||0;var mI="3.3.3";function sr(t,r){if(!t)throw new Error(r||"loaders.gl assertion failed.")}var yI=h(Je()),mi={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},f3e=mi.self||mi.window||mi.global||{},c3e=mi.window||mi.self||mi.global||{},_I=mi.global||mi.self||mi.window||{},p3e=mi.document||{};var Cr=(typeof process>"u"?"undefined":(0,yI.default)(process))!=="object"||String(process)!=="[object process]"||process.browser,ec=typeof importScripts=="function",bI=typeof window<"u"&&typeof window.orientation<"u",gI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),h3e=gI&&parseFloat(gI[1])||0;var xI=h(L()),AI=h(N());function C(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var TI=function(){function t(r,e){var n=this;(0,xI.default)(this,t),C(this,"name",void 0),C(this,"workerThread",void 0),C(this,"isRunning",!0),C(this,"result",void 0),C(this,"_resolve",function(){}),C(this,"_reject",function(){}),this.name=r,this.workerThread=e,this.result=new Promise(function(i,a){n._resolve=i,n._reject=a})}return(0,AI.default)(t,[{key:"postMessage",value:function(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}},{key:"done",value:function(e){sr(this.isRunning),this.isRunning=!1,this._resolve(e)}},{key:"error",value:function(e){sr(this.isRunning),this.isRunning=!1,this._reject(e)}}]),t}();var MI=h(L()),II=h(N());var SI=h(L()),PI=h(N()),Rd=function(){function t(){(0,SI.default)(this,t)}return(0,PI.default)(t,[{key:"terminate",value:function(){}}]),t}();var Pb=new Map;function wI(t){sr(t.source&&!t.url||!t.source&&t.url);var r=Pb.get(t.source||t.url);return r||(t.url&&(r=efe(t.url),Pb.set(t.url,r)),t.source&&(r=OI(t.source),Pb.set(t.source,r))),sr(r),r}function efe(t){if(!t.startsWith("http"))return t;var r=tfe(t);return OI(r)}function OI(t){var r=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(r)}function tfe(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}var CI=h(Je());function wb(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=arguments.length>2?arguments[2]:void 0,n=e||new Set;if(t){if(EI(t))n.add(t);else if(EI(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(r&&(0,CI.default)(t)==="object")for(var i in t)wb(t[i],r,n)}}return e===void 0?Array.from(n):[]}function EI(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}var Ob=function(){},tc=function(){function t(r){(0,MI.default)(this,t),C(this,"name",void 0),C(this,"source",void 0),C(this,"url",void 0),C(this,"terminated",!1),C(this,"worker",void 0),C(this,"onMessage",void 0),C(this,"onError",void 0),C(this,"_loadableURL","");var e=r.name,n=r.source,i=r.url;sr(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=Ob,this.onError=function(a){return console.log(a)},this.worker=Cr?this._createBrowserWorker():this._createNodeWorker()}return(0,II.default)(t,[{key:"destroy",value:function(){this.onMessage=Ob,this.onError=Ob,this.worker.terminate(),this.terminated=!0}},{key:"isRunning",get:function(){return Boolean(this.onMessage)}},{key:"postMessage",value:function(e,n){n=n||wb(e),this.worker.postMessage(e,n)}},{key:"_getErrorFromErrorEvent",value:function(e){var n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}},{key:"_createBrowserWorker",value:function(){var e=this;this._loadableURL=wI({source:this.source,url:this.url});var n=new Worker(this._loadableURL,{name:this.name});return n.onmessage=function(i){i.data?e.onMessage(i.data):e.onError(new Error("No data received"))},n.onerror=function(i){e.onError(e._getErrorFromErrorEvent(i)),e.terminated=!0},n.onmessageerror=function(i){return console.error(i)},n}},{key:"_createNodeWorker",value:function(){var e=this,n;if(this.url){var i=this.url.includes(":/")||this.url.startsWith("/"),a=i?this.url:"./".concat(this.url);n=new Rd(a,{eval:!1})}else if(this.source)n=new Rd(this.source,{eval:!0});else throw new Error("no worker");return n.on("message",function(o){e.onMessage(o)}),n.on("error",function(o){e.onError(o)}),n.on("exit",function(o){}),n}}],[{key:"isSupported",value:function(){return typeof Worker<"u"&&Cr||typeof Rd<"u"&&!Cr}}]),t}();var GI=h(B()),zI=h(L()),VI=h(N());var Eb=h(ge()),kI=h(B()),BI=h(L()),FI=h(N()),rc=h(de());function RI(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function LI(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?RI(Object(e),!0).forEach(function(n){(0,kI.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):RI(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var DI=function(){function t(r){(0,BI.default)(this,t),C(this,"name","unnamed"),C(this,"source",void 0),C(this,"url",void 0),C(this,"maxConcurrency",1),C(this,"maxMobileConcurrency",1),C(this,"onDebug",function(){}),C(this,"reuseWorkers",!0),C(this,"props",{}),C(this,"jobQueue",[]),C(this,"idleQueue",[]),C(this,"count",0),C(this,"isDestroyed",!1),this.source=r.source,this.url=r.url,this.setProps(r)}return(0,FI.default)(t,[{key:"destroy",value:function(){this.idleQueue.forEach(function(e){return e.destroy()}),this.isDestroyed=!0}},{key:"setProps",value:function(e){this.props=LI(LI({},this.props),e),e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}},{key:"startJob",value:function(){var r=(0,Eb.default)(rc.default.mark(function n(i){var a=this,o,s,u,l=arguments;return rc.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=l.length>1&&l[1]!==void 0?l[1]:function(p,d,v){return p.done(v)},s=l.length>2&&l[2]!==void 0?l[2]:function(p,d){return p.error(d)},u=new Promise(function(p){return a.jobQueue.push({name:i,onMessage:o,onError:s,onStart:p}),a}),this._startQueuedJob(),c.next=6,u;case 6:return c.abrupt("return",c.sent);case 7:case"end":return c.stop()}},n,this)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"_startQueuedJob",value:function(){var r=(0,Eb.default)(rc.default.mark(function n(){var i,a,o;return rc.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.jobQueue.length){u.next=2;break}return u.abrupt("return");case 2:if(i=this._getAvailableWorker(),i){u.next=5;break}return u.abrupt("return");case 5:if(a=this.jobQueue.shift(),!a){u.next=18;break}return this.onDebug({message:"Starting job",name:a.name,workerThread:i,backlog:this.jobQueue.length}),o=new TI(a.name,i),i.onMessage=function(l){return a.onMessage(o,l.type,l.payload)},i.onError=function(l){return a.onError(o,l)},a.onStart(o),u.prev=12,u.next=15,o.result;case 15:return u.prev=15,this.returnWorkerToQueue(i),u.finish(15);case 18:case"end":return u.stop()}},n,this,[[12,,15,18]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"returnWorkerToQueue",value:function(e){var n=this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency();n?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new tc({name:e,source:this.source,url:this.url})}return null}},{key:"_getMaxConcurrency",value:function(){return bI?this.maxMobileConcurrency:this.maxConcurrency}}],[{key:"isSupported",value:function(){return tc.isSupported()}}]),t}();function NI(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=rfe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function rfe(t,r){if(t){if(typeof t=="string")return jI(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return jI(t,r)}}function jI(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function UI(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Cb(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?UI(Object(e),!0).forEach(function(n){(0,GI.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):UI(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var nfe={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:function(){}},nc=function(){function t(r){(0,zI.default)(this,t),C(this,"props",void 0),C(this,"workerPools",new Map),this.props=Cb({},nfe),this.setProps(r),this.workerPools=new Map}return(0,VI.default)(t,[{key:"destroy",value:function(){var e=NI(this.workerPools.values()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.destroy()}}catch(a){e.e(a)}finally{e.f()}this.workerPools=new Map}},{key:"setProps",value:function(e){this.props=Cb(Cb({},this.props),e);var n=NI(this.workerPools.values()),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.setProps(this._getWorkerPoolProps())}}catch(o){n.e(o)}finally{n.f()}}},{key:"getWorkerPool",value:function(e){var n=e.name,i=e.source,a=e.url,o=this.workerPools.get(n);return o||(o=new DI({name:n,source:i,url:a}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,o)),o}},{key:"_getWorkerPoolProps",value:function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}],[{key:"isSupported",value:function(){return tc.isSupported()}},{key:"getWorkerFarm",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t._workerFarm=t._workerFarm||new t({}),t._workerFarm.setProps(e),t._workerFarm}}]),t}();C(nc,"_workerFarm",void 0);var ife="latest";function Mb(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r[t.id]||{},n="".concat(t.id,"-worker.js"),i=e.workerUrl;if(!i&&t.id==="compression"&&(i=r.workerUrl),r._workerType==="test"&&(i="modules/".concat(t.module,"/dist/").concat(n)),!i){var a=t.version;a==="latest"&&(a=ife);var o=a?"@".concat(a):"";i="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(n)}return sr(i),i}function Ib(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:mI;sr(t,"no worker provided");var e=t.version;return!(!r||!e)}var Bb=h(ge()),ic=h(de());var Ho=h(WI());var ofe="3.3.3",Rb={};function gi(t){return Lb.apply(this,arguments)}function Lb(){return Lb=(0,Bb.default)(ic.default.mark(function t(r){var e,n,i=arguments;return ic.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return e=i.length>1&&i[1]!==void 0?i[1]:null,n=i.length>2&&i[2]!==void 0?i[2]:{},e&&(r=$I(r,e,n)),Rb[r]=Rb[r]||sfe(r),o.next=6,Rb[r];case 6:return o.abrupt("return",o.sent);case 7:case"end":return o.stop()}},t)})),Lb.apply(this,arguments)}function $I(t,r,e){if(t.startsWith("http"))return t;var n=e.modules||{};return n[t]?n[t]:Cr?e.CDN?(sr(e.CDN.startsWith("http")),"".concat(e.CDN,"/").concat(r,"@").concat(ofe,"/dist/libs/").concat(t)):ec?"../src/libs/".concat(t):"modules/".concat(r,"/src/libs/").concat(t):"modules/".concat(r,"/dist/libs/").concat(t)}function sfe(t){return kb.apply(this,arguments)}function kb(){return kb=(0,Bb.default)(ic.default.mark(function t(r){var e,n,i;return ic.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!r.endsWith("wasm")){o.next=7;break}return o.next=3,fetch(r);case 3:return e=o.sent,o.next=6,e.arrayBuffer();case 6:return o.abrupt("return",o.sent);case 7:if(Cr){o.next=20;break}if(o.prev=8,o.t0=Ho&&Ho.requireFromFile,!o.t0){o.next=14;break}return o.next=13,Ho.requireFromFile(r);case 13:o.t0=o.sent;case 14:return o.abrupt("return",o.t0);case 17:return o.prev=17,o.t1=o.catch(8),o.abrupt("return",null);case 20:if(!ec){o.next=22;break}return o.abrupt("return",importScripts(r));case 22:return o.next=24,fetch(r);case 24:return n=o.sent,o.next=27,n.text();case 27:return i=o.sent,o.abrupt("return",ufe(i,r));case 29:case"end":return o.stop()}},t,null,[[8,17]])})),kb.apply(this,arguments)}function ufe(t,r){if(!Cr)return Ho.requireFromString&&Ho.requireFromString(t,r);if(ec)return eval.call(_I,t),null;var e=document.createElement("script");e.id=r;try{e.appendChild(document.createTextNode(t))}catch{e.text=t}return document.body.appendChild(e),null}var Nb=h(ge()),ac=h(de());function jb(t,r){return!nc.isSupported()||!Cr&&!(r!=null&&r._nodeWorkers)?!1:t.worker&&r?.worker}function Ub(t,r,e,n,i){return Fb.apply(this,arguments)}function Fb(){return Fb=(0,Nb.default)(ac.default.mark(function t(r,e,n,i,a){var o,s,u,l,f,c;return ac.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return o=r.id,s=Mb(r,n),u=nc.getWorkerFarm(n),l=u.getWorkerPool({name:o,url:s}),n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{})),d.next=8,l.startJob("process-on-worker",lfe.bind(null,a));case 8:return f=d.sent,f.postMessage("process",{input:e,options:n,context:i}),d.next=12,f.result;case 12:return c=d.sent,d.next=15,c.result;case 15:return d.abrupt("return",d.sent);case 16:case"end":return d.stop()}},t)})),Fb.apply(this,arguments)}function lfe(t,r,e,n){return Db.apply(this,arguments)}function Db(){return Db=(0,Nb.default)(ac.default.mark(function t(r,e,n,i){var a,o,s,u,l;return ac.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:c.t0=n,c.next=c.t0==="done"?3:c.t0==="error"?5:c.t0==="process"?7:20;break;case 3:return e.done(i),c.abrupt("break",21);case 5:return e.error(new Error(i.error)),c.abrupt("break",21);case 7:return a=i.id,o=i.input,s=i.options,c.prev=8,c.next=11,r(o,s);case 11:u=c.sent,e.postMessage("done",{id:a,result:u}),c.next=19;break;case 15:c.prev=15,c.t1=c.catch(8),l=c.t1 instanceof Error?c.t1.message:"unknown error",e.postMessage("error",{id:a,error:l});case 19:return c.abrupt("break",21);case 20:console.warn("parse-with-worker unknown message ".concat(n));case 21:case"end":return c.stop()}},t,null,[[8,15]])})),Db.apply(this,arguments)}function qI(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;if(typeof t=="string")return t.slice(0,r);if(ArrayBuffer.isView(t))return XI(t.buffer,t.byteOffset,r);if(t instanceof ArrayBuffer){var e=0;return XI(t,e,r)}return""}function XI(t,r,e){if(t.byteLength<=r+e)return"";for(var n=new DataView(t),i="",a=0;a<e;a++)i+=String.fromCharCode(n.getUint8(r+a));return i}function Gb(t){try{return JSON.parse(t)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(qI(t),'"'))}}function ffe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=cfe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function cfe(t,r){if(t){if(typeof t=="string")return YI(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return YI(t,r)}}function YI(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function zb(t,r,e){if(e=e||t.byteLength,t.byteLength<e||r.byteLength<e)return!1;for(var n=new Uint8Array(t),i=new Uint8Array(r),a=0;a<n.length;++a)if(n[a]!==i[a])return!1;return!0}function Vb(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];var n=r.map(function(f){return f instanceof ArrayBuffer?new Uint8Array(f):f}),i=n.reduce(function(f,c){return f+c.byteLength},0),a=new Uint8Array(i),o=0,s=ffe(n),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;a.set(l,o),o+=l.byteLength}}catch(f){s.e(f)}finally{s.f()}return a.buffer}function oc(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];var n=r,i=n&&n.length>1&&n[0].constructor||null;if(!i)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');for(var a=n.reduce(function(c,p){return c+p.length},0),o=new i(a),s=0,u=0,l=n;u<l.length;u++){var f=l[u];o.set(f,s),s+=f.length}return o}function Wo(t,r,e){var n=e!==void 0?new Uint8Array(t).subarray(r,r+e):new Uint8Array(t).subarray(r),i=new Uint8Array(n);return i.buffer}function Va(t,r){return Fe(t>=0),Fe(r>0),t+(r-1)&~(r-1)}function Hb(t,r,e){var n;if(t instanceof ArrayBuffer)n=new Uint8Array(t);else{var i=t.byteOffset,a=t.byteLength;n=new Uint8Array(t.buffer||t.arrayBuffer,i,a)}return r.set(n,e),e+Va(n.byteLength,4)}var tR=h(ge()),rR=h(Ld()),qb=h(de());function Kb(t){return Yb.apply(this,arguments)}function Yb(){return Yb=(0,tR.default)(qb.default.mark(function t(r){var e,n,i,a,o,s,u;return qb.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:e=[],n=!1,i=!1,f.prev=3,o=(0,rR.default)(r);case 5:return f.next=7,o.next();case 7:if(!(n=!(s=f.sent).done)){f.next=13;break}u=s.value,e.push(u);case 10:n=!1,f.next=5;break;case 13:f.next=19;break;case 15:f.prev=15,f.t0=f.catch(3),i=!0,a=f.t0;case 19:if(f.prev=19,f.prev=20,!(n&&o.return!=null)){f.next=24;break}return f.next=24,o.return();case 24:if(f.prev=24,!i){f.next=27;break}throw a;case 27:return f.finish(24);case 28:return f.finish(19);case 29:return f.abrupt("return",Vb.apply(void 0,e));case 30:case"end":return f.stop()}},t,null,[[3,15,19,29],[20,,24,28]])})),Yb.apply(this,arguments)}var lR=h(B()),fR=h(L()),cR=h(N());var aR=h(L()),oR=h(N());var nR=h(L()),iR=h(N());function uc(){var t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){var r=process.hrtime();t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}var kd=function(){function t(r,e){(0,nR.default)(this,t),C(this,"name",void 0),C(this,"type",void 0),C(this,"sampleSize",1),C(this,"time",void 0),C(this,"count",void 0),C(this,"samples",void 0),C(this,"lastTiming",void 0),C(this,"lastSampleTime",void 0),C(this,"lastSampleCount",void 0),C(this,"_count",0),C(this,"_time",0),C(this,"_samples",0),C(this,"_startTime",0),C(this,"_timerPending",!1),this.name=r,this.type=e,this.reset()}return(0,iR.default)(t,[{key:"setSampleSize",value:function(e){return this.sampleSize=e,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(e){return this._count+=e,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(e){return this._count-=e,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=uc(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(uc()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}();var Un=function(){function t(r){(0,aR.default)(this,t),C(this,"id",void 0),C(this,"stats",{}),this.id=r.id,this.stats={},this._initializeStats(r.stats),Object.seal(this)}return(0,oR.default)(t,[{key:"get",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}},{key:"size",get:function(){return Object.keys(this.stats).length}},{key:"reset",value:function(){for(var e in this.stats)this.stats[e].reset();return this}},{key:"forEach",value:function(e){for(var n in this.stats)e(this.stats[n])}},{key:"getTable",value:function(){var e={};return this.forEach(function(n){e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}},{key:"_initializeStats",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];n.forEach(function(i){return e._getOrCreate(i)})}},{key:"_getOrCreate",value:function(e){if(!e||!e.name)return null;var n=e.name,i=e.type;return this.stats[n]||(e instanceof kd?this.stats[n]=e:this.stats[n]=new kd(n,i)),this.stats[n]}}]),t}();function sR(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function uR(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?sR(Object(e),!0).forEach(function(n){(0,lR.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):sR(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var yfe="Queued Requests",_fe="Active Requests",bfe="Cancelled Requests",xfe="Queued Requests Ever",Afe="Active Requests Ever",Tfe={id:"request-scheduler",throttleRequests:!0,maxRequests:6},lc=function(){function t(){(0,fR.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};C(this,"props",void 0),C(this,"stats",void 0),C(this,"activeRequestCount",0),C(this,"requestQueue",[]),C(this,"requestMap",new Map),C(this,"deferredUpdate",null),this.props=uR(uR({},Tfe),r),this.stats=new Un({id:this.props.id}),this.stats.get(yfe),this.stats.get(_fe),this.stats.get(bfe),this.stats.get(xfe),this.stats.get(Afe)}return(0,cR.default)(t,[{key:"scheduleRequest",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return 0};if(!this.props.throttleRequests)return Promise.resolve({done:function(){}});if(this.requestMap.has(e))return this.requestMap.get(e);var i={handle:e,priority:0,getPriority:n},a=new Promise(function(o){return i.resolve=o,i});return this.requestQueue.push(i),this.requestMap.set(e,a),this._issueNewRequests(),a}},{key:"_issueRequest",value:function(e){var n=this,i=e.handle,a=e.resolve,o=!1,s=function(){o||(o=!0,n.requestMap.delete(i),n.activeRequestCount--,n._issueNewRequests())};return this.activeRequestCount++,a?a({done:s}):Promise.resolve({done:s})}},{key:"_issueNewRequests",value:function(){var e=this;this.deferredUpdate||(this.deferredUpdate=setTimeout(function(){return e._issueNewRequestsAsync()},0))}},{key:"_issueNewRequestsAsync",value:function(){this.deferredUpdate=null;var e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(var n=0;n<e;++n){var i=this.requestQueue.shift();i&&this._issueRequest(i)}}}},{key:"_updateAllRequests",value:function(){for(var e=this.requestQueue,n=0;n<e.length;++n){var i=e[n];this._updateRequest(i)||(e.splice(n,1),this.requestMap.delete(i.handle),n--)}e.sort(function(a,o){return a.priority-o.priority})}},{key:"_updateRequest",value:function(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}]),t}();var Sfe="",pR={};function Jb(t){for(var r in pR)if(t.startsWith(r)){var e=pR[r];t=t.replace(r,e)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(Sfe).concat(t)),t}var Zb=h(Je()),Qb=h(hR());function dR(t){return t&&(0,Zb.default)(t)==="object"&&t.isBuffer}function Bd(t){if(dR(t))return Qb.toArrayBuffer(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){var r=t,e=new TextEncoder().encode(r);return e.buffer}if(t&&(0,Zb.default)(t)==="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}var Ha={};tn(Ha,{dirname:()=>wfe,filename:()=>Pfe,join:()=>Ofe});function Pfe(t){var r=t&&t.lastIndexOf("/");return r>=0?t.substr(r+1):""}function wfe(t){var r=t&&t.lastIndexOf("/");return r>=0?t.substr(0,r):""}function Ofe(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];var n="/";return r=r.map(function(i,a){return a&&(i=i.replace(new RegExp("^".concat(n)),"")),a!==r.length-1&&(i=i.replace(new RegExp("".concat(n,"$")),"")),i}),r.join(n)}var cc=h(ge()),Ji=h(de());var e1=h(Je()),Efe=function(r){return typeof r=="boolean"},fc=function(r){return typeof r=="function"},Tu=function(r){return r!==null&&(0,e1.default)(r)==="object"},t1=function(r){return Tu(r)&&r.constructor==={}.constructor};var vR=function(r){return r&&typeof r[Symbol.iterator]=="function"},mR=function(r){return r&&typeof r[Symbol.asyncIterator]=="function"};var Gn=function(r){return typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json};var zn=function(r){return typeof Blob<"u"&&r instanceof Blob},gR=function(r){return r&&(0,e1.default)(r)==="object"&&r.isBuffer};var Cfe=function(r){return typeof ReadableStream<"u"&&r instanceof ReadableStream||Tu(r)&&fc(r.tee)&&fc(r.cancel)&&fc(r.getReader)};var Mfe=function(r){return Tu(r)&&fc(r.read)&&fc(r.pipe)&&Efe(r.readable)},Fd=function(r){return Cfe(r)||Mfe(r)};var Ife=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Rfe=/^([-\w.]+\/[-\w.+]+)/;function yR(t){var r=Rfe.exec(t);return r?r[1]:t}function r1(t){var r=Ife.exec(t);return r?r[1]:""}var Lfe=/\?.*/;function $o(t){if(Gn(t)){var r=n1(t.url||""),e=t.headers.get("content-type")||"";return{url:r,type:yR(e)||r1(r)}}return zn(t)?{url:n1(t.name||""),type:t.type||""}:typeof t=="string"?{url:n1(t),type:r1(t)}:{url:"",type:""}}function _R(t){return Gn(t)?t.headers["content-length"]||-1:zn(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function n1(t){return t.replace(Lfe,"")}function Dd(t){return i1.apply(this,arguments)}function i1(){return i1=(0,cc.default)(Ji.default.mark(function t(r){var e,n,i,a,o,s,u;return Ji.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!Gn(r)){f.next=2;break}return f.abrupt("return",r);case 2:return e={},n=_R(r),n>=0&&(e["content-length"]=String(n)),i=$o(r),a=i.url,o=i.type,o&&(e["content-type"]=o),f.next=9,Bfe(r);case 9:return s=f.sent,s&&(e["x-first-bytes"]=s),typeof r=="string"&&(r=new TextEncoder().encode(r)),u=new Response(r,{headers:e}),Object.defineProperty(u,"url",{value:a}),f.abrupt("return",u);case 15:case"end":return f.stop()}},t)})),i1.apply(this,arguments)}function bR(t){return a1.apply(this,arguments)}function a1(){return a1=(0,cc.default)(Ji.default.mark(function t(r){var e;return Ji.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(r.ok){i.next=5;break}return i.next=3,kfe(r);case 3:throw e=i.sent,new Error(e);case 5:case"end":return i.stop()}},t)})),a1.apply(this,arguments)}function kfe(t){return o1.apply(this,arguments)}function o1(){return o1=(0,cc.default)(Ji.default.mark(function t(r){var e,n,i;return Ji.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(e="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): "),o.prev=1,n=r.headers.get("Content-Type"),i=r.statusText,!n.includes("application/json")){o.next=11;break}return o.t0=i,o.t1=" ",o.next=9,r.text();case 9:o.t2=o.sent,i=o.t0+=o.t1.concat.call(o.t1,o.t2);case 11:e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e,o.next=17;break;case 15:o.prev=15,o.t3=o.catch(1);case 17:return o.abrupt("return",e);case 18:case"end":return o.stop()}},t,null,[[1,15]])})),o1.apply(this,arguments)}function Bfe(t){return s1.apply(this,arguments)}function s1(){return s1=(0,cc.default)(Ji.default.mark(function t(r){var e,n,i,a;return Ji.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(e=5,typeof r!="string"){s.next=3;break}return s.abrupt("return","data:,".concat(r.slice(0,e)));case 3:if(!(r instanceof Blob)){s.next=8;break}return n=r.slice(0,5),s.next=7,new Promise(function(u){var l=new FileReader;l.onload=function(f){var c;return u(f==null||(c=f.target)===null||c===void 0?void 0:c.result)},l.readAsDataURL(n)});case 7:return s.abrupt("return",s.sent);case 8:if(!(r instanceof ArrayBuffer)){s.next=12;break}return i=r.slice(0,e),a=Ffe(i),s.abrupt("return","data:base64,".concat(a));case 12:return s.abrupt("return",null);case 13:case"end":return s.stop()}},t)})),s1.apply(this,arguments)}function Ffe(t){for(var r="",e=new Uint8Array(t),n=0;n<e.byteLength;n++)r+=String.fromCharCode(e[n]);return btoa(r)}function Su(t,r){return l1.apply(this,arguments)}function l1(){return l1=(0,xR.default)(u1.default.mark(function t(r,e){var n;return u1.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(typeof r!="string"){a.next=7;break}return r=Jb(r),n=e,e!=null&&e.fetch&&typeof e?.fetch!="function"&&(n=e.fetch),a.next=6,fetch(r,n);case 6:return a.abrupt("return",a.sent);case 7:return a.next=9,Dd(r);case 9:return a.abrupt("return",a.sent);case 10:case"end":return a.stop()}},t)})),l1.apply(this,arguments)}var eL=h(B());var c1=h(L()),p1=h(N());var zd=h(Je()),hc=h(dr()),VR=h(B()),HR=h(L()),WR=h(N());var CR=h(Je());var Nd=h(Je());function pc(t){if(typeof window<"u"&&(0,Nd.default)(window.process)==="object"&&window.process.type==="renderer"||typeof process<"u"&&(0,Nd.default)(process.versions)==="object"&&Boolean(process.versions.electron))return!0;var r=(typeof navigator>"u"?"undefined":(0,Nd.default)(navigator))==="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=t||r;return!!(e&&e.indexOf("Electron")>=0)}function Qt(){var t=(typeof process>"u"?"undefined":(0,CR.default)(process))==="object"&&String(process)==="[object process]"&&!process.browser;return!t||pc()}var MR=h(Je()),Wa={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:(typeof process>"u"?"undefined":(0,MR.default)(process))==="object"&&process};var Hfe=Wa.self||Wa.window||Wa.global,Pu=Wa.window||Wa.self||Wa.global,Wfe=Wa.document||{},Xo=Wa.process||{};var jd="8.9.11",_De=Qt();var f1=globalThis;function wu(t){if(!t&&!Qt())return"Node";if(pc(t))return"Electron";var r=typeof navigator<"u"?navigator:{},e=t||r.userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";var n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i?"IE":f1.chrome?"Chrome":f1.safari?"Safari":f1.mozInnerScreenX?"Firefox":"Unknown"}var IR=h(L()),RR=h(N());function $fe(t){try{var r=window[t],e="__storage_test__";return r.setItem(e,e),r.removeItem(e),r}catch{return null}}var LR=function(){function t(r){(0,IR.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";C(this,"storage",void 0),C(this,"id",void 0),C(this,"config",{}),this.storage=$fe(n),this.id=r,this.config={},Object.assign(this.config,e),this._loadConfiguration()}return(0,RR.default)(t,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){return this.config={},this.updateConfiguration(e)}},{key:"updateConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}]),t}();function kR(t){var r;return t<10?r="".concat(t.toFixed(2),"ms"):t<100?r="".concat(t.toFixed(1),"ms"):t<1e3?r="".concat(t.toFixed(0),"ms"):r="".concat((t/1e3).toFixed(2),"s"),r}function BR(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,e=Math.max(r-t.length,0);return"".concat(" ".repeat(e)).concat(t)}function Ud(t,r,e){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600,i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>n&&(e=Math.min(e,n/t.width));var a=t.width*e,o=t.height*e,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(r," %c+"),s]}var Gd;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Gd||(Gd={}));function FR(t){return typeof t=="string"?Gd[t.toUpperCase()]||Gd.WHITE:t}function DR(t,r,e){return!Qt&&typeof t=="string"&&(r&&(r=FR(r),t="\x1B[".concat(r,"m").concat(t,"\x1B[39m")),e&&(r=FR(e),t="\x1B[".concat(e+10,"m").concat(t,"\x1B[49m"))),t}function Xfe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=qfe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function qfe(t,r){if(t){if(typeof t=="string")return NR(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return NR(t,r)}}function NR(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function jR(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"],e=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(e),i=Xfe(n),a;try{var o=function(){var u=a.value;typeof t[u]=="function"&&(r.find(function(l){return u===l})||(t[u]=t[u].bind(t)))};for(i.s();!(a=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}}function Ou(t,r){if(!t)throw new Error(r||"Assertion failed")}function qo(){var t;if(Qt&&"performance"in Pu){var r,e;t=Pu===null||Pu===void 0||(r=Pu.performance)===null||r===void 0||(e=r.now)===null||e===void 0?void 0:e.call(r)}else if("hrtime"in Xo){var n,i=Xo===null||Xo===void 0||(n=Xo.hrtime)===null||n===void 0?void 0:n.call(Xo);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}var Eu={debug:Qt&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Yfe={enabled:!0,level:0};function hn(){}var UR={},GR={once:!0},dn=function(){function t(){(0,HR.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""},e=r.id;C(this,"id",void 0),C(this,"VERSION",jd),C(this,"_startTs",qo()),C(this,"_deltaTs",qo()),C(this,"_storage",void 0),C(this,"userData",{}),C(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new LR("__probe-".concat(this.id,"__"),Yfe),this.userData={},this.timeStamp("".concat(this.id," started")),jR(this),Object.seal(this)}return(0,WR.default)(t,[{key:"level",get:function(){return this.getLevel()},set:function(e){this.setLevel(e)}},{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((qo()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((qo()-this._deltaTs).toPrecision(10))}},{key:"priority",get:function(){return this.level},set:function(e){this.level=e}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.updateConfiguration({level:e}),this}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,n){this._storage.updateConfiguration((0,VR.default)({},e,n))}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"assert",value:function(e,n){Ou(e,n)}},{key:"warn",value:function(e){return this._getLogFunction(0,e,Eu.warn,arguments,GR)}},{key:"error",value:function(e){return this._getLogFunction(0,e,Eu.error,arguments)}},{key:"deprecated",value:function(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}},{key:"removed",value:function(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}},{key:"probe",value:function(e,n){return this._getLogFunction(e,n,Eu.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(e,n){return this._getLogFunction(e,n,Eu.debug,arguments)}},{key:"info",value:function(e,n){return this._getLogFunction(e,n,console.info,arguments)}},{key:"once",value:function(e,n){for(var i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];return this._getLogFunction(e,n,Eu.debug||Eu.info,arguments,GR)}},{key:"table",value:function(e,n,i){return n?this._getLogFunction(e,n,console.table||hn,i&&[i],{tag:Qfe(n)}):hn}},{key:"image",value:function(e){var n=e.logLevel,i=e.priority,a=e.image,o=e.message,s=o===void 0?"":o,u=e.scale,l=u===void 0?1:u;return this._shouldLog(n||i)?Qt?Zfe({image:a,message:s,scale:l}):Jfe({image:a,message:s,scale:l}):hn}},{key:"time",value:function(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}},{key:"timeEnd",value:function(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(e,n){return this._getLogFunction(e,n,console.timeStamp||hn)}},{key:"group",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1},a=zR({logLevel:e,message:n,opts:i}),o=i.collapsed;return a.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(a)}},{key:"groupCollapsed",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction(e,"",console.groupEnd||hn)}},{key:"withGroup",value:function(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return this.isEnabled()&&this.getLevel()>=$R(e)}},{key:"_getLogFunction",value:function(e,n,i,a,o){if(this._shouldLog(e)){var s;o=zR({logLevel:e,message:n,args:a,opts:o}),i=i||o.method,Ou(i),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=qo();var u=o.tag||o.message;if(o.once)if(!UR[u])UR[u]=qo();else return hn;return n=Kfe(this.id,o.message,o),(s=i).bind.apply(s,[console,n].concat((0,hc.default)(o.args)))}return hn}}]),t}();C(dn,"VERSION",jd);function $R(t){if(!t)return 0;var r;switch((0,zd.default)(t)){case"number":r=t;break;case"object":r=t.logLevel||t.priority||0;break;default:return 0}return Ou(Number.isFinite(r)&&r>=0),r}function zR(t){var r=t.logLevel,e=t.message;t.logLevel=$R(r);for(var n=t.args?Array.from(t.args):[];n.length&&n.shift()!==e;);switch((0,zd.default)(r)){case"string":case"function":e!==void 0&&n.unshift(e),t.message=r;break;case"object":Object.assign(t,r);break;default:}typeof t.message=="function"&&(t.message=t.message());var i=(0,zd.default)(t.message);return Ou(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function Kfe(t,r,e){if(typeof r=="string"){var n=e.time?BR(kR(e.total)):"";r=e.time?"".concat(t,": ").concat(n,"  ").concat(r):"".concat(t,": ").concat(r),r=DR(r,e.color,e.background)}return r}function Jfe(t){var r=t.image,e=t.message,n=e===void 0?"":e,i=t.scale,a=i===void 0?1:i,o=null;try{o=module.require("asciify-image")}catch{}return o?function(){return o(r,{fit:"box",width:"".concat(Math.round(80*a),"%")}).then(function(s){return console.log(s)})}:hn}function Zfe(t){var r=t.image,e=t.message,n=e===void 0?"":e,i=t.scale,a=i===void 0?1:i;if(typeof r=="string"){var o=new Image;return o.onload=function(){var f,c=Ud(o,n,a);(f=console).log.apply(f,(0,hc.default)(c))},o.src=r,hn}var s=r.nodeName||"";if(s.toLowerCase()==="img"){var u;return(u=console).log.apply(u,(0,hc.default)(Ud(r,n,a))),hn}if(s.toLowerCase()==="canvas"){var l=new Image;return l.onload=function(){var f;return(f=console).log.apply(f,(0,hc.default)(Ud(l,n,a)))},l.src=r.toDataURL(),hn}return hn}function Qfe(t){for(var r in t)for(var e in t[r])return e||"untitled";return"empty"}var ZDe=new dn({id:"@probe.gl/log"});var h1=new dn({id:"loaders.gl"}),XR=function(){function t(){(0,c1.default)(this,t)}return(0,p1.default)(t,[{key:"log",value:function(){return function(){}}},{key:"info",value:function(){return function(){}}},{key:"warn",value:function(){return function(){}}},{key:"error",value:function(){return function(){}}}]),t}(),qR=function(){function t(){(0,c1.default)(this,t),C(this,"console",void 0),this.console=console}return(0,p1.default)(t,[{key:"log",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.log).bind.apply(e,[this.console].concat(i))}},{key:"info",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.info).bind.apply(e,[this.console].concat(i))}},{key:"warn",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.warn).bind.apply(e,[this.console].concat(i))}},{key:"error",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.error).bind.apply(e,[this.console].concat(i))}}]),t}();var d1={fetch:null,mimeType:void 0,nothrow:!1,log:new qR,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:jn,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},YR={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function tL(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=ece(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function ece(t,r){if(t){if(typeof t=="string")return KR(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return KR(t,r)}}function KR(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function JR(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Vd(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?JR(Object(e),!0).forEach(function(n){(0,eL.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):JR(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function v1(){globalThis.loaders=globalThis.loaders||{};var t=globalThis.loaders;return t._state=t._state||{},t._state}var rL=function(){var r=v1();return r.globalOptions=r.globalOptions||Vd({},d1),r.globalOptions};function nL(t,r,e,n){return e=e||[],e=Array.isArray(e)?e:[e],tce(t,e),nce(r,t,n)}function Hd(t,r){var e=rL(),n=t||e;return typeof n.fetch=="function"?n.fetch:Tu(n.fetch)?function(i){return Su(i,n)}:r!=null&&r.fetch?r?.fetch:Su}function tce(t,r){ZR(t,null,d1,YR,r);var e=tL(r),n;try{for(e.s();!(n=e.n()).done;){var i=n.value,a=t&&t[i.id]||{},o=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};ZR(a,i.id,o,s,r)}}catch(u){e.e(u)}finally{e.f()}}function ZR(t,r,e,n,i){var a=r||"Top level",o=r?"".concat(r,"."):"";for(var s in t){var u=!r&&Tu(t[s]),l=s==="baseUri"&&!r,f=s==="workerUrl"&&r;if(!(s in e)&&!l&&!f){if(s in n)h1.warn("".concat(a," loader option '").concat(o).concat(s,"' no longer supported, use '").concat(n[s],"'"))();else if(!u){var c=rce(s,i);h1.warn("".concat(a," loader option '").concat(o).concat(s,"' not recognized. ").concat(c))()}}}}function rce(t,r){var e=t.toLowerCase(),n="",i=tL(r),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;for(var s in o.options){if(t===s)return"Did you mean '".concat(o.id,".").concat(s,"'?");var u=s.toLowerCase(),l=e.startsWith(u)||u.startsWith(e);l&&(n=n||"Did you mean '".concat(o.id,".").concat(s,"'?"))}}}catch(f){i.e(f)}finally{i.f()}return n}function nce(t,r,e){var n=t.options||{},i=Vd({},n);return ice(i,e),i.log===null&&(i.log=new XR),QR(i,rL()),QR(i,r),i}function QR(t,r){for(var e in r)if(e in r){var n=r[e];t1(n)&&t1(t[e])?t[e]=Vd(Vd({},t[e]),r[e]):t[e]=r[e]}}function ice(t,r){r&&!("baseUri"in t)&&(t.baseUri=r)}var aL=h(B());function iL(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Wd(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?iL(Object(e),!0).forEach(function(n){(0,aL.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):iL(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function dc(t){var r;if(!t)return!1;Array.isArray(t)&&(t=t[0]);var e=Array.isArray((r=t)===null||r===void 0?void 0:r.extensions);return e}function vc(t){var r,e;Fe(t,"null loader"),Fe(dc(t),"invalid loader");var n;return Array.isArray(t)&&(n=t[1],t=t[0],t=Wd(Wd({},t),{},{options:Wd(Wd({},t.options),n)})),((r=t)!==null&&r!==void 0&&r.parseTextSync||(e=t)!==null&&e!==void 0&&e.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}function ace(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=oce(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function oce(t,r){if(t){if(typeof t=="string")return oL(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return oL(t,r)}}function oL(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var sL=function(){var r=v1();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function mc(t){var r=sL();t=Array.isArray(t)?t:[t];var e=ace(t),n;try{var i=function(){var o=n.value,s=vc(o);r.find(function(u){return s===u})||r.unshift(s)};for(e.s();!(n=e.n()).done;)i()}catch(a){e.e(a)}finally{e.f()}}function uL(){return sL()}var vL=h(B()),mL=h(Je()),gL=h(dr()),yL=h(ge()),g1=h(de());var lL=new dn({id:"loaders.gl"});function fL(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function cL(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?fL(Object(e),!0).forEach(function(n){(0,vL.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):fL(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function gc(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=sce(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function sce(t,r){if(t){if(typeof t=="string")return pL(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return pL(t,r)}}function pL(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var uce=/\.([^.]+)$/;function _L(t){return y1.apply(this,arguments)}function y1(){return y1=(0,yL.default)(g1.default.mark(function t(r){var e,n,i,a,o=arguments;return g1.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(e=o.length>1&&o[1]!==void 0?o[1]:[],n=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,bL(r)){u.next=5;break}return u.abrupt("return",null);case 5:if(a=hL(r,e,cL(cL({},n),{},{nothrow:!0}),i),!a){u.next=8;break}return u.abrupt("return",a);case 8:if(!zn(r)){u.next=13;break}return u.next=11,r.slice(0,10).arrayBuffer();case 11:r=u.sent,a=hL(r,e,n,i);case 13:if(!(!a&&!(n!=null&&n.nothrow))){u.next=15;break}throw new Error(xL(r));case 15:return u.abrupt("return",a);case 16:case"end":return u.stop()}},t)})),y1.apply(this,arguments)}function hL(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!bL(t))return null;if(r&&!Array.isArray(r))return vc(r);var i=[];if(r&&(i=i.concat(r)),!(e!=null&&e.ignoreRegisteredLoaders)){var a;(a=i).push.apply(a,(0,gL.default)(uL()))}fce(i);var o=lce(t,i,e,n);if(!o&&!(e!=null&&e.nothrow))throw new Error(xL(t));return o}function lce(t,r,e,n){var i=$o(t),a=i.url,o=i.type,s=a||n?.url,u=null,l="";if(e!=null&&e.mimeType&&(u=m1(r,e?.mimeType),l="match forced by supplied MIME type ".concat(e?.mimeType)),u=u||cce(r,s),l=l||(u?"matched url ".concat(s):""),u=u||m1(r,o),l=l||(u?"matched MIME type ".concat(o):""),u=u||hce(r,t),l=l||(u?"matched initial data ".concat(AL(t)):""),u=u||m1(r,e?.fallbackMimeType),l=l||(u?"matched fallback MIME type ".concat(o):""),l){var f;lL.log(1,"selectLoader selected ".concat((f=u)===null||f===void 0?void 0:f.name,": ").concat(l,"."))}return u}function bL(t){return!(t instanceof Response&&t.status===204)}function xL(t){var r=$o(t),e=r.url,n=r.type,i="No valid loader found (";i+=e?"".concat(Ha.filename(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");var a=t?AL(t):"";return i+=a?' first bytes: "'.concat(a,'"'):"first bytes: not available",i+=")",i}function fce(t){var r=gc(t),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;vc(n)}}catch(i){r.e(i)}finally{r.f()}}function cce(t,r){var e=r&&uce.exec(r),n=e&&e[1];return n?pce(t,n):null}function pce(t,r){r=r.toLowerCase();var e=gc(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value,a=gc(i.extensions),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;if(s.toLowerCase()===r)return i}}catch(u){a.e(u)}finally{a.f()}}}catch(u){e.e(u)}finally{e.f()}return null}function m1(t,r){var e=gc(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(i.mimeTypes&&i.mimeTypes.includes(r)||r==="application/x.".concat(i.id))return i}}catch(a){e.e(a)}finally{e.f()}return null}function hce(t,r){if(!r)return null;var e=gc(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(typeof r=="string"){if(dce(r,i))return i}else if(ArrayBuffer.isView(r)){if(dL(r.buffer,r.byteOffset,i))return i}else if(r instanceof ArrayBuffer){var a=0;if(dL(r,a,i))return i}}}catch(o){e.e(o)}finally{e.f()}return null}function dce(t,r){if(r.testText)return r.testText(t);var e=Array.isArray(r.tests)?r.tests:[r.tests];return e.some(function(n){return t.startsWith(n)})}function dL(t,r,e){var n=Array.isArray(e.tests)?e.tests:[e.tests];return n.some(function(i){return vce(t,r,e,i)})}function vce(t,r,e,n){if(n instanceof ArrayBuffer)return zb(n,t,n.byteLength);switch((0,mL.default)(n)){case"function":return n(t,e);case"string":var i=_1(t,r,n.length);return n===i;default:return!1}}function AL(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;if(typeof t=="string")return t.slice(0,r);if(ArrayBuffer.isView(t))return _1(t.buffer,t.byteOffset,r);if(t instanceof ArrayBuffer){var e=0;return _1(t,e,r)}return""}function _1(t,r,e){if(t.byteLength<r+e)return"";for(var n=new DataView(t),i="",a=0;a<e;a++)i+=String.fromCharCode(n.getUint8(r+a));return i}var BL=h(Je()),B1=h(ge()),_c=h(de());var EL=h(ge()),M1=h(de());var b1=h(de()),mce=b1.default.mark(x1),gce=256*1024;function x1(t,r){var e,n,i,a,o;return b1.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:e=r?.chunkSize||gce,n=0,i=new TextEncoder;case 3:if(!(n<t.length)){u.next=11;break}return a=Math.min(t.length-n,e),o=t.slice(n,n+a),n+=a,u.next=9,i.encode(o);case 9:u.next=3;break;case 11:case"end":return u.stop()}},mce)}var A1=h(de()),yce=A1.default.mark(T1),_ce=256*1024;function T1(t){var r,e,n,i,a,o,s,u,l=arguments;return A1.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:r=l.length>1&&l[1]!==void 0?l[1]:{},e=r.chunkSize,n=e===void 0?_ce:e,i=0;case 3:if(!(i<t.byteLength)){c.next=14;break}return a=Math.min(t.byteLength-i,n),o=new ArrayBuffer(a),s=new Uint8Array(t,i,a),u=new Uint8Array(o),u.set(s),i+=a,c.next=12,o;case 12:c.next=3;break;case 14:case"end":return c.stop()}},yce)}var TL=h($b()),SL=h(Xb()),S1=h(de()),bce=1024*1024;function PL(t,r){return P1.apply(this,arguments)}function P1(){return P1=(0,SL.default)(S1.default.mark(function t(r,e){var n,i,a,o;return S1.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:n=e?.chunkSize||bce,i=0;case 2:if(!(i<r.size)){u.next=12;break}return a=i+n,u.next=6,(0,TL.default)(r.slice(i,a).arrayBuffer());case 6:return o=u.sent,i=a,u.next=10,o;case 10:u.next=2;break;case 12:case"end":return u.stop()}},t)})),P1.apply(this,arguments)}var wL=h(Ld()),$d=h($b()),E1=h(Xb()),yc=h(de());function C1(t,r){return jn?xce(t,r):Ace(t,r)}function xce(t,r){return w1.apply(this,arguments)}function w1(){return w1=(0,E1.default)(yc.default.mark(function t(r,e){var n,i,a,o,s,u;return yc.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:n=r.getReader(),f.prev=1;case 2:return a=i||n.read(),e!=null&&e._streamReadAhead&&(i=n.read()),f.next=7,(0,$d.default)(a);case 7:if(o=f.sent,s=o.done,u=o.value,!s){f.next=12;break}return f.abrupt("return");case 12:return f.next=14,Bd(u);case 14:f.next=2;break;case 16:f.next=21;break;case 18:f.prev=18,f.t0=f.catch(1),n.releaseLock();case 21:case"end":return f.stop()}},t,null,[[1,18]])})),w1.apply(this,arguments)}function Ace(t,r){return O1.apply(this,arguments)}function O1(){return O1=(0,E1.default)(yc.default.mark(function t(r,e){var n,i,a,o,s,u;return yc.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:n=!1,i=!1,f.prev=2,o=(0,wL.default)(r);case 4:return f.next=6,(0,$d.default)(o.next());case 6:if(!(n=!(s=f.sent).done)){f.next=13;break}return u=s.value,f.next=10,Bd(u);case 10:n=!1,f.next=4;break;case 13:f.next=19;break;case 15:f.prev=15,f.t0=f.catch(2),i=!0,a=f.t0;case 19:if(f.prev=19,f.prev=20,!(n&&o.return!=null)){f.next=24;break}return f.next=24,(0,$d.default)(o.return());case 24:if(f.prev=24,!i){f.next=27;break}throw a;case 27:return f.finish(24);case 28:return f.finish(19);case 29:case"end":return f.stop()}},t,null,[[2,15,19,29],[20,,24,28]])})),O1.apply(this,arguments)}function OL(t,r){if(typeof t=="string")return x1(t,r);if(t instanceof ArrayBuffer)return T1(t,r);if(zn(t))return PL(t,r);if(Fd(t))return C1(t,r);if(Gn(t)){var e=t;return C1(e.body,r)}throw new Error("makeIterator")}var CL="Cannot convert supplied data type";function Tce(t,r,e){if(r.text&&typeof t=="string")return t;if(gR(t)&&(t=t.buffer),t instanceof ArrayBuffer){var n=t;if(r.text&&!r.binary){var i=new TextDecoder("utf8");return i.decode(n)}return n}if(ArrayBuffer.isView(t)){if(r.text&&!r.binary){var a=new TextDecoder("utf8");return a.decode(t)}var o=t.buffer,s=t.byteLength||t.length;return(t.byteOffset!==0||s!==o.byteLength)&&(o=o.slice(t.byteOffset,t.byteOffset+s)),o}throw new Error(CL)}function ML(t,r,e){return I1.apply(this,arguments)}function I1(){return I1=(0,EL.default)(M1.default.mark(function t(r,e,n){var i,a;return M1.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(i=r instanceof ArrayBuffer||ArrayBuffer.isView(r),!(typeof r=="string"||i)){s.next=3;break}return s.abrupt("return",Tce(r,e,n));case 3:if(!zn(r)){s.next=7;break}return s.next=6,Dd(r);case 6:r=s.sent;case 7:if(!Gn(r)){s.next=21;break}return a=r,s.next=11,bR(a);case 11:if(!e.binary){s.next=17;break}return s.next=14,a.arrayBuffer();case 14:s.t0=s.sent,s.next=20;break;case 17:return s.next=19,a.text();case 19:s.t0=s.sent;case 20:return s.abrupt("return",s.t0);case 21:if(Fd(r)&&(r=OL(r,n)),!(vR(r)||mR(r))){s.next=24;break}return s.abrupt("return",Kb(r));case 24:throw new Error(CL);case 25:case"end":return s.stop()}},t)})),I1.apply(this,arguments)}var R1=h(dr()),RL=h(B());function IL(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Sce(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?IL(Object(e),!0).forEach(function(n){(0,RL.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):IL(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function LL(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(e)return e;var n=Sce({fetch:Hd(r,t)},t);return Array.isArray(n.loaders)||(n.loaders=null),n}function kL(t,r){if(!r&&t&&!Array.isArray(t))return t;var e;if(t&&(e=Array.isArray(t)?t:[t]),r&&r.loaders){var n=Array.isArray(r.loaders)?r.loaders:[r.loaders];e=e?[].concat((0,R1.default)(e),(0,R1.default)(n)):n}return e&&e.length?e:null}function Yo(t,r,e,n){return L1.apply(this,arguments)}function L1(){return L1=(0,B1.default)(_c.default.mark(function t(r,e,n,i){var a,o,s,u,l;return _c.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return sr(!i||(0,BL.default)(i)==="object"),e&&!Array.isArray(e)&&!dc(e)&&(i=void 0,n=e,e=void 0),c.next=4,r;case 4:return r=c.sent,n=n||{},a=$o(r),o=a.url,s=e,u=kL(s,i),c.next=11,_L(r,u,n);case 11:if(l=c.sent,l){c.next=14;break}return c.abrupt("return",null);case 14:return n=nL(n,l,u,o),i=LL({url:o,parse:Yo,loaders:u},n,i),c.next=18,Pce(l,r,n,i);case 18:return c.abrupt("return",c.sent);case 19:case"end":return c.stop()}},t)})),L1.apply(this,arguments)}function Pce(t,r,e,n){return k1.apply(this,arguments)}function k1(){return k1=(0,B1.default)(_c.default.mark(function t(r,e,n,i){var a,o,s,u,l,f,c,p;return _c.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return Ib(r),Gn(e)&&(a=e,o=a.ok,s=a.redirected,u=a.status,l=a.statusText,f=a.type,c=a.url,p=Object.fromEntries(a.headers.entries()),i.response={headers:p,ok:o,redirected:s,status:u,statusText:l,type:f,url:c}),v.next=4,ML(e,r,n);case 4:if(e=v.sent,!(r.parseTextSync&&typeof e=="string")){v.next=8;break}return n.dataType="text",v.abrupt("return",r.parseTextSync(e,n,i,r));case 8:if(!jb(r,n)){v.next=12;break}return v.next=11,Ub(r,e,n,i,Yo);case 11:return v.abrupt("return",v.sent);case 12:if(!(r.parseText&&typeof e=="string")){v.next=16;break}return v.next=15,r.parseText(e,n,i,r);case 15:return v.abrupt("return",v.sent);case 16:if(!r.parse){v.next=20;break}return v.next=19,r.parse(e,n,i,r);case 19:return v.abrupt("return",v.sent);case 20:throw sr(!r.parseSync),new Error("".concat(r.id," loader - no parser found and worker is disabled"));case 22:case"end":return v.stop()}},t)})),k1.apply(this,arguments)}var FL=h(ge()),F1=h(de());function qt(t,r,e,n){return D1.apply(this,arguments)}function D1(){return D1=(0,FL.default)(F1.default.mark(function t(r,e,n,i){var a,o;return F1.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!Array.isArray(e)&&!dc(e)&&(i=void 0,n=e,e=void 0),a=Hd(n),o=r,typeof r!="string"){u.next=7;break}return u.next=6,a(r);case 6:o=u.sent;case 7:if(!zn(r)){u.next=11;break}return u.next=10,a(r);case 10:o=u.sent;case 11:return u.next=13,Yo(o,e,n);case 13:return u.abrupt("return",u.sent);case 14:case"end":return u.stop()}},t)})),D1.apply(this,arguments)}var DL="3.3.3";var WL=h(ge()),Z1=h(de());var wce=globalThis._parseImageNode,N1=typeof Image<"u",j1=typeof ImageBitmap<"u",Oce=Boolean(wce),U1=jn?!0:Oce;function NL(t){switch(t){case"auto":return j1||N1||U1;case"imagebitmap":return j1;case"image":return N1;case"data":return U1;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function jL(){if(j1)return"imagebitmap";if(N1)return"image";if(U1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}var UL=h(Je());function Ece(t){var r=Cce(t);if(!r)throw new Error("Not an image");return r}function GL(t){switch(Ece(t)){case"data":return t;case"image":case"imagebitmap":var r=document.createElement("canvas"),e=r.getContext("2d");if(!e)throw new Error("getImageData");return r.width=t.width,r.height=t.height,e.drawImage(t,0,0),e.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Cce(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&(0,UL.default)(t)==="object"&&t.data&&t.width&&t.height?"data":null}var H1=h(ge()),bc=h(de());var Mce=/^data:image\/svg\+xml/,Ice=/\.svg((\?|#).*)?$/;function Xd(t){return t&&(Mce.test(t)||Ice.test(t))}function zL(t,r){if(Xd(r)){var e=new TextDecoder,n=e.decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(a){throw new Error(a.message)}var i="data:image/svg+xml;base64,".concat(btoa(n));return i}return G1(t,r)}function G1(t,r){if(Xd(r))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}function xc(t,r,e){return z1.apply(this,arguments)}function z1(){return z1=(0,H1.default)(bc.default.mark(function t(r,e,n){var i,a,o;return bc.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i=zL(r,n),a=self.URL||self.webkitURL,o=typeof i!="string"&&a.createObjectURL(i),u.prev=3,u.next=6,Rce(o||i,e);case 6:return u.abrupt("return",u.sent);case 7:return u.prev=7,o&&a.revokeObjectURL(o),u.finish(7);case 10:case"end":return u.stop()}},t,null,[[3,,7,10]])})),z1.apply(this,arguments)}function Rce(t,r){return V1.apply(this,arguments)}function V1(){return V1=(0,H1.default)(bc.default.mark(function t(r,e){var n;return bc.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(n=new Image,n.src=r,!(e.image&&e.image.decode&&n.decode)){a.next=6;break}return a.next=5,n.decode();case 5:return a.abrupt("return",n);case 6:return a.next=8,new Promise(function(o,s){try{n.onload=function(){return o(n)},n.onerror=function(u){return s(new Error("Could not load image ".concat(r,": ").concat(u)))}}catch(u){s(u)}});case 8:return a.abrupt("return",a.sent);case 9:case"end":return a.stop()}},t)})),V1.apply(this,arguments)}var X1=h(ge()),Ac=h(de());var Lce={},VL=!0;function q1(t,r,e){return W1.apply(this,arguments)}function W1(){return W1=(0,X1.default)(Ac.default.mark(function t(r,e,n){var i,a,o;return Ac.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!Xd(n)){u.next=7;break}return u.next=3,xc(r,e,n);case 3:a=u.sent,i=a,u.next=8;break;case 7:i=G1(r,n);case 8:return o=e&&e.imagebitmap,u.next=11,kce(i,o);case 11:return u.abrupt("return",u.sent);case 12:case"end":return u.stop()}},t)})),W1.apply(this,arguments)}function kce(t){return $1.apply(this,arguments)}function $1(){return $1=(0,X1.default)(Ac.default.mark(function t(r){var e,n=arguments;return Ac.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e=n.length>1&&n[1]!==void 0?n[1]:null,(Bce(e)||!VL)&&(e=null),!e){a.next=13;break}return a.prev=3,a.next=6,createImageBitmap(r,e);case 6:return a.abrupt("return",a.sent);case 9:a.prev=9,a.t0=a.catch(3),console.warn(a.t0),VL=!1;case 13:return a.next=15,createImageBitmap(r);case 15:return a.abrupt("return",a.sent);case 16:case"end":return a.stop()}},t,null,[[3,9]])})),$1.apply(this,arguments)}function Bce(t){for(var r in t||Lce)return!1;return!0}var HL=h(ge()),Y1=h(de());var yi=!1,Tc=!0;function Ko(t){var r=Sc(t);return Fce(r)||jce(r)||Dce(r)||Nce(r)}function Fce(t){var r=Sc(t),e=r.byteLength>=24&&r.getUint32(0,yi)===2303741511;return e?{mimeType:"image/png",width:r.getUint32(16,yi),height:r.getUint32(20,yi)}:null}function Dce(t){var r=Sc(t),e=r.byteLength>=10&&r.getUint32(0,yi)===1195984440;return e?{mimeType:"image/gif",width:r.getUint16(6,Tc),height:r.getUint16(8,Tc)}:null}function Nce(t){var r=Sc(t),e=r.byteLength>=14&&r.getUint16(0,yi)===16973&&r.getUint32(2,Tc)===r.byteLength;return e?{mimeType:"image/bmp",width:r.getUint32(18,Tc),height:r.getUint32(22,Tc)}:null}function jce(t){var r=Sc(t),e=r.byteLength>=3&&r.getUint16(0,yi)===65496&&r.getUint8(2)===255;if(!e)return null;for(var n=Uce(),i=n.tableMarkers,a=n.sofMarkers,o=2;o+9<r.byteLength;){var s=r.getUint16(o,yi);if(a.has(s))return{mimeType:"image/jpeg",height:r.getUint16(o+5,yi),width:r.getUint16(o+7,yi)};if(!i.has(s))return null;o+=2,o+=r.getUint16(o,yi)}return null}function Uce(){for(var t=new Set([65499,65476,65484,65501,65534]),r=65504;r<65520;++r)t.add(r);var e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}function Sc(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}function J1(t,r){return K1.apply(this,arguments)}function K1(){return K1=(0,HL.default)(Y1.default.mark(function t(r,e){var n,i,a;return Y1.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=Ko(r)||{},i=n.mimeType,a=globalThis._parseImageNode,Fe(a),s.next=5,a(r,i);case 5:return s.abrupt("return",s.sent);case 6:case"end":return s.stop()}},t)})),K1.apply(this,arguments)}function ex(t,r,e){return Q1.apply(this,arguments)}function Q1(){return Q1=(0,WL.default)(Z1.default.mark(function t(r,e,n){var i,a,o,s,u,l;return Z1.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=e||{},i=e.image||{},a=i.type||"auto",o=n||{},s=o.url,u=Gce(a),c.t0=u,c.next=c.t0==="imagebitmap"?8:c.t0==="image"?12:c.t0==="data"?16:20;break;case 8:return c.next=10,q1(r,e,s);case 10:return l=c.sent,c.abrupt("break",21);case 12:return c.next=14,xc(r,e,s);case 14:return l=c.sent,c.abrupt("break",21);case 16:return c.next=18,J1(r,e);case 18:return l=c.sent,c.abrupt("break",21);case 20:Fe(!1);case 21:return a==="data"&&(l=GL(l)),c.abrupt("return",l);case 23:case"end":return c.stop()}},t)})),Q1.apply(this,arguments)}function Gce(t){switch(t){case"auto":case"data":return jL();default:return NL(t),t}}var zce=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],Vce=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Hce={image:{type:"auto",decode:!0}},Vn={id:"image",module:"images",name:"Images",version:DL,mimeTypes:Vce,extensions:zce,parse:ex,tests:[function(t){return Boolean(Ko(new DataView(t)))}],options:Hce};var Wce=["image/png","image/jpeg","image/gif"],tx={};function rx(t){return tx[t]===void 0&&(tx[t]=$ce(t)),tx[t]}function $ce(t){switch(t){case"image/webp":return Xce();case"image/svg":return jn;default:if(!jn){var r=globalThis._parseImageNode;return Boolean(r)&&Wce.includes(t)}return!0}}function Xce(){if(!jn)return!1;try{var t=document.createElement("canvas");return t.toDataURL("image/webp").indexOf("data:image/webp")===0}catch{return!1}}var Z=new dn({id:"deck"});var nx={};function qd(t){nx=t}function Ft(t,r,e,n){Z.level>0&&nx[t]&&nx[t].call(null,r,e,n)}function qce(t){var r=t[0],e=t[t.length-1];return r==="{"&&e==="}"||r==="["&&e==="]"}var $L={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:qce,parseTextSync:JSON.parse};function XL(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function qL(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?XL(Object(e),!0).forEach(function(n){(0,YL.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):XL(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Yce(){var t="8.9.11",r=globalThis.deck&&globalThis.deck.VERSION;if(r&&r!==t)throw new Error("deck.gl - multiple versions detected: ".concat(r," vs ").concat(t));return r||(Z.log(1,"deck.gl ".concat(t))(),globalThis.deck=qL(qL({},globalThis.deck),{},{VERSION:t,version:t,log:Z,_registerLoggers:qd}),mc([$L,[Vn,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}var Yd=Yce();var se={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(se,"IDENTITY",{get:function(){return Z.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0}});var _r={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},bt={common:0,meters:1,pixels:2},ix={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},KL={DRAW:"draw",MASK:"mask",TERRAIN:"terrain"};var Gj=h(L()),zj=h(N()),sn=h(B());var re=new dn({id:"luma.gl"});function Ut(t,r){if(!t)throw new Error(r||"luma.gl: assertion failed.")}var Kce="Invalid WebGLRenderingContext";var Jce="Requires WebGL2";function Zi(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function fe(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function ax(t){return fe(t)?t:null}function Qi(t){return Ut(Zi(t),Kce),t}function mt(t){return Ut(fe(t),Jce),t}var Pc={};function Zce(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function Qce(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function epe(t,r){Pc[t]=!0,r!==void 0&&Zce(r)}function tpe(t){var r=t.getError;t.getError=function(){var n;do n=r.apply(t),n!==0&&(Pc[n]=!0);while(n!==0);for(n in Pc)if(Pc[n])return delete Pc[n],parseInt(n,10);return 0}}var wc=function t(r){var e=r.gl;this.ext=r,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(r.maxVertexAttribs);for(var n=0;n<this.attribs.length;n++){var i=new t.VertexAttrib(e);this.attribs[n]=i}this.maxAttrib=0};wc.VertexAttrib=function(r){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};wc.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var Jo=function(r){var e=this;this.gl=r,tpe(r);var n=this.original={getParameter:r.getParameter,enableVertexAttribArray:r.enableVertexAttribArray,disableVertexAttribArray:r.disableVertexAttribArray,bindBuffer:r.bindBuffer,getVertexAttrib:r.getVertexAttrib,vertexAttribPointer:r.vertexAttribPointer};r.getParameter=function(a){return a===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:n.getParameter.apply(this,arguments)},r.enableVertexAttribArray=function(a){var o=e.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,a);var s=o.attribs[a];return s.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},r.disableVertexAttribArray=function(a){var o=e.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,a);var s=o.attribs[a];return s.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},r.bindBuffer=function(a,o){switch(a){case 34962:e.currentArrayBuffer=o;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=o;break;default:}return n.bindBuffer.apply(this,arguments)},r.getVertexAttrib=function(a,o){var s=e.currentVertexArrayObject,u=s.attribs[a];switch(o){case 34975:return u.buffer;case 34338:return u.enabled;case 34339:return u.size;case 34340:return u.stride;case 34341:return u.type;case 34922:return u.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},r.vertexAttribPointer=function(a,o,s,u,l,f){var c=e.currentVertexArrayObject;c.maxAttrib=Math.max(c.maxAttrib,a);var p=c.attribs[a];return p.buffer=e.currentArrayBuffer,p.size=o,p.type=s,p.normalized=u,p.stride=l,p.offset=f,p.recache(),n.vertexAttribPointer.apply(this,arguments)},r.instrumentExtension&&r.instrumentExtension(this,"OES_vertex_array_object"),r.canvas&&r.canvas.addEventListener("webglcontextrestored",function(){Qce("OESVertexArrayObject emulation library context restored"),e.reset_()},!0),this.reset_()};Jo.prototype.VERTEX_ARRAY_BINDING_OES=34229;Jo.prototype.reset_=function(){var r=this.vertexArrayObjects!==void 0;if(r)for(var e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;var n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new wc(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Jo.prototype.createVertexArrayOES=function(){var r=new wc(this);return this.vertexArrayObjects.push(r),r};Jo.prototype.deleteVertexArrayOES=function(r){r.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(r),1),this.currentVertexArrayObject===r&&this.bindVertexArrayOES(null)};Jo.prototype.isVertexArrayOES=function(r){return!!(r&&r instanceof wc&&r.hasBeenBound&&r.ext===this)};Jo.prototype.bindVertexArrayOES=function(r){var e=this.gl;if(r&&!r.isAlive){epe(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}var n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=r||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var a=this.currentVertexArrayObject;if(i!==a){(!i||a.elementArrayBuffer!==i.elementArrayBuffer)&&n.bindBuffer.call(e,34963,a.elementArrayBuffer);for(var o=this.currentArrayBuffer,s=Math.max(i?i.maxAttrib:0,a.maxAttrib),u=0;u<=s;u++){var l=a.attribs[u],f=i?i.attribs[u]:null;if((!i||l.enabled!==f.enabled)&&(l.enabled?n.enableVertexAttribArray.call(e,u):n.disableVertexAttribArray.call(e,u)),l.enabled){var c=!1;(!i||l.buffer!==f.buffer)&&(o!==l.buffer&&(n.bindBuffer.call(e,34962,l.buffer),o=l.buffer),c=!0),(c||l.cached!==f.cached)&&n.vertexAttribPointer.call(e,u,l.size,l.type,l.normalized,l.stride,l.offset)}}this.currentArrayBuffer!==o&&n.bindBuffer.call(e,34962,this.currentArrayBuffer)}};function JL(t){if(typeof t.createVertexArray!="function"){var r=t.getSupportedExtensions;t.getSupportedExtensions=function(){var i=r.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};var e=t.getExtension;t.getExtension=function(i){var a=e.call(this,i);return a||(i!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Jo(this)),this.__OESVertexArrayObject))}}}var Oc=h(B());var je=h(B());var Ne,ZL="OES_element_index",QL="WEBGL_draw_buffers",rpe="EXT_disjoint_timer_query",npe="EXT_disjoint_timer_query_webgl2",ipe="EXT_texture_filter_anisotropic",ek="WEBGL_debug_renderer_info",ape=35723,ope=4352,spe=36795,upe=34047,lpe=37445,fpe=37446,gt=function(r){return fe(r)?void 0:0},cpe=(Ne={},(0,je.default)(Ne,3074,function(r){return fe(r)?void 0:36064}),(0,je.default)(Ne,ape,function(t){return fe(t)?void 0:ope}),(0,je.default)(Ne,35977,gt),(0,je.default)(Ne,32937,gt),(0,je.default)(Ne,spe,function(t,r){var e=fe(t)?t.getExtension(npe):t.getExtension(rpe);return e&&e.GPU_DISJOINT_EXT?r(e.GPU_DISJOINT_EXT):0}),(0,je.default)(Ne,lpe,function(t,r){var e=t.getExtension(ek);return r(e&&e.UNMASKED_VENDOR_WEBGL||7936)}),(0,je.default)(Ne,fpe,function(t,r){var e=t.getExtension(ek);return r(e&&e.UNMASKED_RENDERER_WEBGL||7937)}),(0,je.default)(Ne,upe,function(t,r){var e=t.luma.extensions[ipe];return e?r(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}),(0,je.default)(Ne,32883,gt),(0,je.default)(Ne,35071,gt),(0,je.default)(Ne,37447,gt),(0,je.default)(Ne,36063,function(r,e){if(!fe(r)){var n=r.getExtension(QL);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}}),(0,je.default)(Ne,35379,gt),(0,je.default)(Ne,35374,gt),(0,je.default)(Ne,35377,gt),(0,je.default)(Ne,34852,function(r){if(!fe(r)){var e=r.getExtension(QL);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}}),(0,je.default)(Ne,36203,function(r){return r.getExtension(ZL)?2147483647:65535}),(0,je.default)(Ne,33001,function(r){return r.getExtension(ZL)?16777216:65535}),(0,je.default)(Ne,33e3,function(r){return 16777216}),(0,je.default)(Ne,37157,gt),(0,je.default)(Ne,35373,gt),(0,je.default)(Ne,35657,gt),(0,je.default)(Ne,36183,gt),(0,je.default)(Ne,37137,gt),(0,je.default)(Ne,34045,gt),(0,je.default)(Ne,35978,gt),(0,je.default)(Ne,35979,gt),(0,je.default)(Ne,35968,gt),(0,je.default)(Ne,35376,gt),(0,je.default)(Ne,35375,gt),(0,je.default)(Ne,35659,gt),(0,je.default)(Ne,37154,gt),(0,je.default)(Ne,35371,gt),(0,je.default)(Ne,35658,gt),(0,je.default)(Ne,35076,gt),(0,je.default)(Ne,35077,gt),(0,je.default)(Ne,35380,gt),Ne);function tk(t,r,e){var n=cpe[e],i=typeof n=="function"?n(t,r,e):n,a=i!==void 0?i:r(e);return a}var Cu,ppe="OES_vertex_array_object",rk="ANGLE_instanced_arrays",hpe="WEBGL_draw_buffers",dpe="EXT_disjoint_timer_query",vpe="EXT_texture_filter_anisotropic",mpe="VertexArray requires WebGL2 or OES_vertex_array_object extension";function gpe(t,r){return{webgl2:fe(t),ext:t.getExtension(r)}}var ox=(Cu={},(0,Oc.default)(Cu,ppe,{meta:{suffix:"OES"},createVertexArray:function(){Ut(!1,mpe)},deleteVertexArray:function(){},bindVertexArray:function(){},isVertexArray:function(){return!1}}),(0,Oc.default)(Cu,rk,{meta:{suffix:"ANGLE"},vertexAttribDivisor:function(r,e){Ut(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:function(){},drawArraysInstanced:function(){}}),(0,Oc.default)(Cu,hpe,{meta:{suffix:"WEBGL"},drawBuffers:function(){Ut(!1)}}),(0,Oc.default)(Cu,dpe,{meta:{suffix:"EXT"},createQuery:function(){Ut(!1)},deleteQuery:function(){Ut(!1)},beginQuery:function(){Ut(!1)},endQuery:function(){},getQuery:function(r,e){return this.getQueryObject(r,e)},getQueryParameter:function(r,e){return this.getQueryObject(r,e)},getQueryObject:function(){}}),Cu),Kd={readBuffer:function(r,e,n){fe(r)&&e(n)},getVertexAttrib:function(r,e,n,i){var a=gpe(r,rk),o=a.webgl2,s=a.ext,u;switch(i){case 35069:u=o?void 0:!1;break;case 35070:u=!o&&!s?0:void 0;break;default:}return u!==void 0?u:e(n,i)},getProgramParameter:function(r,e,n,i){if(!fe(r))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0;default:}return e(n,i)},getInternalformatParameter:function(r,e,n,i,a){if(!fe(r))switch(a){case 32937:return new Int32Array([0]);default:}return r.getInternalformatParameter(n,i,a)},getTexParameter:function(r,e,n,i){switch(i){case 34046:var a=r.luma.extensions,o=a[vpe];i=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break;default:}return e(n,i)},getParameter:tk,hint:function(r,e,n,i){return e(n,i)}};function ik(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=ype(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function ype(t,r){if(t){if(typeof t=="string")return nk(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return nk(t,r)}}function nk(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function ak(t){t.luma=t.luma||{};var r=t.luma;return r.polyfilled||(JL(t),_pe(t),xpe(t,ox),bpe(t,{target:r,target2:t}),r.polyfilled=!0),t}globalThis.polyfillContext=ak;function _pe(t){t.luma.extensions={};var r=t.getSupportedExtensions()||[],e=ik(r),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;t.luma[i]=t.getExtension(i)}}catch(a){e.e(a)}finally{e.f()}}function bpe(t,r){var e=r.target,n=r.target2;Object.keys(Kd).forEach(function(i){if(typeof Kd[i]=="function"){var a=t[i]?t[i].bind(t):function(){},o=Kd[i].bind(null,t,a);e[i]=o,n[i]=o}})}function xpe(t,r){var e=ik(Object.getOwnPropertyNames(r)),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i!=="overrides"&&Ape(t,{extension:i,target:t.luma,target2:t})}}catch(a){e.e(a)}finally{e.f()}}function Ape(t,r){var e=r.extension,n=r.target,i=r.target2,a=ox[e];Ut(a);for(var o=a.meta,s=o===void 0?{}:o,u=s.suffix,l=u===void 0?"":u,f=t.getExtension(e),c=function(){var m=d[p],g="".concat(m).concat(l),y=null;m==="meta"||typeof t[m]=="function"||(f&&typeof f[g]=="function"?y=function(){return f[g].apply(f,arguments)}:typeof a[m]=="function"&&(y=a[m].bind(n))),y&&(n[m]=y,i[m]=y)},p=0,d=Object.keys(a);p<d.length;p++)c()}var Jd=h(ye()),Mt=h(dr()),D=h(B());var ve,te,vn,Cc=(ve={},(0,D.default)(ve,3042,!1),(0,D.default)(ve,32773,new Float32Array([0,0,0,0])),(0,D.default)(ve,32777,32774),(0,D.default)(ve,34877,32774),(0,D.default)(ve,32969,1),(0,D.default)(ve,32968,0),(0,D.default)(ve,32971,1),(0,D.default)(ve,32970,0),(0,D.default)(ve,3106,new Float32Array([0,0,0,0])),(0,D.default)(ve,3107,[!0,!0,!0,!0]),(0,D.default)(ve,2884,!1),(0,D.default)(ve,2885,1029),(0,D.default)(ve,2929,!1),(0,D.default)(ve,2931,1),(0,D.default)(ve,2932,513),(0,D.default)(ve,2928,new Float32Array([0,1])),(0,D.default)(ve,2930,!0),(0,D.default)(ve,3024,!0),(0,D.default)(ve,36006,null),(0,D.default)(ve,2886,2305),(0,D.default)(ve,33170,4352),(0,D.default)(ve,2849,1),(0,D.default)(ve,32823,!1),(0,D.default)(ve,32824,0),(0,D.default)(ve,10752,0),(0,D.default)(ve,32938,1),(0,D.default)(ve,32939,!1),(0,D.default)(ve,3089,!1),(0,D.default)(ve,3088,new Int32Array([0,0,1024,1024])),(0,D.default)(ve,2960,!1),(0,D.default)(ve,2961,0),(0,D.default)(ve,2968,4294967295),(0,D.default)(ve,36005,4294967295),(0,D.default)(ve,2962,519),(0,D.default)(ve,2967,0),(0,D.default)(ve,2963,4294967295),(0,D.default)(ve,34816,519),(0,D.default)(ve,36003,0),(0,D.default)(ve,36004,4294967295),(0,D.default)(ve,2964,7680),(0,D.default)(ve,2965,7680),(0,D.default)(ve,2966,7680),(0,D.default)(ve,34817,7680),(0,D.default)(ve,34818,7680),(0,D.default)(ve,34819,7680),(0,D.default)(ve,2978,[0,0,1024,1024]),(0,D.default)(ve,3333,4),(0,D.default)(ve,3317,4),(0,D.default)(ve,37440,!1),(0,D.default)(ve,37441,!1),(0,D.default)(ve,37443,37444),(0,D.default)(ve,35723,4352),(0,D.default)(ve,36010,null),(0,D.default)(ve,35977,!1),(0,D.default)(ve,3330,0),(0,D.default)(ve,3332,0),(0,D.default)(ve,3331,0),(0,D.default)(ve,3314,0),(0,D.default)(ve,32878,0),(0,D.default)(ve,3316,0),(0,D.default)(ve,3315,0),(0,D.default)(ve,32877,0),ve),$a=function(r,e,n){return e?r.enable(n):r.disable(n)},ok=function(r,e,n){return r.hint(n,e)},rn=function(r,e,n){return r.pixelStorei(n,e)},Tpe=function(r,e){var n=fe(r)?36009:36160;return r.bindFramebuffer(n,e)},Spe=function(r,e){return r.bindFramebuffer(36008,e)};function Ec(t){return Array.isArray(t)||ArrayBuffer.isView(t)}var sk=(te={},(0,D.default)(te,3042,$a),(0,D.default)(te,32773,function(r,e){return r.blendColor.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,32777,"blendEquation"),(0,D.default)(te,34877,"blendEquation"),(0,D.default)(te,32969,"blendFunc"),(0,D.default)(te,32968,"blendFunc"),(0,D.default)(te,32971,"blendFunc"),(0,D.default)(te,32970,"blendFunc"),(0,D.default)(te,3106,function(r,e){return r.clearColor.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,3107,function(r,e){return r.colorMask.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,2884,$a),(0,D.default)(te,2885,function(r,e){return r.cullFace(e)}),(0,D.default)(te,2929,$a),(0,D.default)(te,2931,function(r,e){return r.clearDepth(e)}),(0,D.default)(te,2932,function(r,e){return r.depthFunc(e)}),(0,D.default)(te,2928,function(r,e){return r.depthRange.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,2930,function(r,e){return r.depthMask(e)}),(0,D.default)(te,3024,$a),(0,D.default)(te,35723,ok),(0,D.default)(te,36006,Tpe),(0,D.default)(te,2886,function(r,e){return r.frontFace(e)}),(0,D.default)(te,33170,ok),(0,D.default)(te,2849,function(r,e){return r.lineWidth(e)}),(0,D.default)(te,32823,$a),(0,D.default)(te,32824,"polygonOffset"),(0,D.default)(te,10752,"polygonOffset"),(0,D.default)(te,35977,$a),(0,D.default)(te,32938,"sampleCoverage"),(0,D.default)(te,32939,"sampleCoverage"),(0,D.default)(te,3089,$a),(0,D.default)(te,3088,function(r,e){return r.scissor.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,2960,$a),(0,D.default)(te,2961,function(r,e){return r.clearStencil(e)}),(0,D.default)(te,2968,function(r,e){return r.stencilMaskSeparate(1028,e)}),(0,D.default)(te,36005,function(r,e){return r.stencilMaskSeparate(1029,e)}),(0,D.default)(te,2962,"stencilFuncFront"),(0,D.default)(te,2967,"stencilFuncFront"),(0,D.default)(te,2963,"stencilFuncFront"),(0,D.default)(te,34816,"stencilFuncBack"),(0,D.default)(te,36003,"stencilFuncBack"),(0,D.default)(te,36004,"stencilFuncBack"),(0,D.default)(te,2964,"stencilOpFront"),(0,D.default)(te,2965,"stencilOpFront"),(0,D.default)(te,2966,"stencilOpFront"),(0,D.default)(te,34817,"stencilOpBack"),(0,D.default)(te,34818,"stencilOpBack"),(0,D.default)(te,34819,"stencilOpBack"),(0,D.default)(te,2978,function(r,e){return r.viewport.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,3333,rn),(0,D.default)(te,3317,rn),(0,D.default)(te,37440,rn),(0,D.default)(te,37441,rn),(0,D.default)(te,37443,rn),(0,D.default)(te,3330,rn),(0,D.default)(te,3332,rn),(0,D.default)(te,3331,rn),(0,D.default)(te,36010,Spe),(0,D.default)(te,3314,rn),(0,D.default)(te,32878,rn),(0,D.default)(te,3316,rn),(0,D.default)(te,3315,rn),(0,D.default)(te,32877,rn),(0,D.default)(te,"framebuffer",function(r,e){var n=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,n)}),(0,D.default)(te,"blend",function(r,e){return e?r.enable(3042):r.disable(3042)}),(0,D.default)(te,"blendColor",function(r,e){return r.blendColor.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,"blendEquation",function(r,e){e=Ec(e)?e:[e,e],r.blendEquationSeparate.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,"blendFunc",function(r,e){e=Ec(e)&&e.length===2?[].concat((0,Mt.default)(e),(0,Mt.default)(e)):e,r.blendFuncSeparate.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,"clearColor",function(r,e){return r.clearColor.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,"clearDepth",function(r,e){return r.clearDepth(e)}),(0,D.default)(te,"clearStencil",function(r,e){return r.clearStencil(e)}),(0,D.default)(te,"colorMask",function(r,e){return r.colorMask.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,"cull",function(r,e){return e?r.enable(2884):r.disable(2884)}),(0,D.default)(te,"cullFace",function(r,e){return r.cullFace(e)}),(0,D.default)(te,"depthTest",function(r,e){return e?r.enable(2929):r.disable(2929)}),(0,D.default)(te,"depthFunc",function(r,e){return r.depthFunc(e)}),(0,D.default)(te,"depthMask",function(r,e){return r.depthMask(e)}),(0,D.default)(te,"depthRange",function(r,e){return r.depthRange.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,"dither",function(r,e){return e?r.enable(3024):r.disable(3024)}),(0,D.default)(te,"derivativeHint",function(r,e){r.hint(35723,e)}),(0,D.default)(te,"frontFace",function(r,e){return r.frontFace(e)}),(0,D.default)(te,"mipmapHint",function(r,e){return r.hint(33170,e)}),(0,D.default)(te,"lineWidth",function(r,e){return r.lineWidth(e)}),(0,D.default)(te,"polygonOffsetFill",function(r,e){return e?r.enable(32823):r.disable(32823)}),(0,D.default)(te,"polygonOffset",function(r,e){return r.polygonOffset.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,"sampleCoverage",function(r,e){return r.sampleCoverage.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,"scissorTest",function(r,e){return e?r.enable(3089):r.disable(3089)}),(0,D.default)(te,"scissor",function(r,e){return r.scissor.apply(r,(0,Mt.default)(e))}),(0,D.default)(te,"stencilTest",function(r,e){return e?r.enable(2960):r.disable(2960)}),(0,D.default)(te,"stencilMask",function(r,e){e=Ec(e)?e:[e,e];var n=e,i=(0,Jd.default)(n,2),a=i[0],o=i[1];r.stencilMaskSeparate(1028,a),r.stencilMaskSeparate(1029,o)}),(0,D.default)(te,"stencilFunc",function(r,e){e=Ec(e)&&e.length===3?[].concat((0,Mt.default)(e),(0,Mt.default)(e)):e;var n=e,i=(0,Jd.default)(n,6),a=i[0],o=i[1],s=i[2],u=i[3],l=i[4],f=i[5];r.stencilFuncSeparate(1028,a,o,s),r.stencilFuncSeparate(1029,u,l,f)}),(0,D.default)(te,"stencilOp",function(r,e){e=Ec(e)&&e.length===3?[].concat((0,Mt.default)(e),(0,Mt.default)(e)):e;var n=e,i=(0,Jd.default)(n,6),a=i[0],o=i[1],s=i[2],u=i[3],l=i[4],f=i[5];r.stencilOpSeparate(1028,a,o,s),r.stencilOpSeparate(1029,u,l,f)}),(0,D.default)(te,"viewport",function(r,e){return r.viewport.apply(r,(0,Mt.default)(e))}),te);function Dt(t,r,e){return r[t]!==void 0?r[t]:e[t]}var uk={blendEquation:function(r,e,n){return r.blendEquationSeparate(Dt(32777,e,n),Dt(34877,e,n))},blendFunc:function(r,e,n){return r.blendFuncSeparate(Dt(32969,e,n),Dt(32968,e,n),Dt(32971,e,n),Dt(32970,e,n))},polygonOffset:function(r,e,n){return r.polygonOffset(Dt(32824,e,n),Dt(10752,e,n))},sampleCoverage:function(r,e,n){return r.sampleCoverage(Dt(32938,e,n),Dt(32939,e,n))},stencilFuncFront:function(r,e,n){return r.stencilFuncSeparate(1028,Dt(2962,e,n),Dt(2967,e,n),Dt(2963,e,n))},stencilFuncBack:function(r,e,n){return r.stencilFuncSeparate(1029,Dt(34816,e,n),Dt(36003,e,n),Dt(36004,e,n))},stencilOpFront:function(r,e,n){return r.stencilOpSeparate(1028,Dt(2964,e,n),Dt(2965,e,n),Dt(2966,e,n))},stencilOpBack:function(r,e,n){return r.stencilOpSeparate(1029,Dt(34817,e,n),Dt(34818,e,n),Dt(34819,e,n))}},sx={enable:function(r,e){return r((0,D.default)({},e,!0))},disable:function(r,e){return r((0,D.default)({},e,!1))},pixelStorei:function(r,e,n){return r((0,D.default)({},e,n))},hint:function(r,e,n){return r((0,D.default)({},e,n))},bindFramebuffer:function(r,e,n){var i;switch(e){case 36160:return r((i={},(0,D.default)(i,36006,n),(0,D.default)(i,36010,n),i));case 36009:return r((0,D.default)({},36006,n));case 36008:return r((0,D.default)({},36010,n));default:return null}},blendColor:function(r,e,n,i,a){return r((0,D.default)({},32773,new Float32Array([e,n,i,a])))},blendEquation:function(r,e){var n;return r((n={},(0,D.default)(n,32777,e),(0,D.default)(n,34877,e),n))},blendEquationSeparate:function(r,e,n){var i;return r((i={},(0,D.default)(i,32777,e),(0,D.default)(i,34877,n),i))},blendFunc:function(r,e,n){var i;return r((i={},(0,D.default)(i,32969,e),(0,D.default)(i,32968,n),(0,D.default)(i,32971,e),(0,D.default)(i,32970,n),i))},blendFuncSeparate:function(r,e,n,i,a){var o;return r((o={},(0,D.default)(o,32969,e),(0,D.default)(o,32968,n),(0,D.default)(o,32971,i),(0,D.default)(o,32970,a),o))},clearColor:function(r,e,n,i,a){return r((0,D.default)({},3106,new Float32Array([e,n,i,a])))},clearDepth:function(r,e){return r((0,D.default)({},2931,e))},clearStencil:function(r,e){return r((0,D.default)({},2961,e))},colorMask:function(r,e,n,i,a){return r((0,D.default)({},3107,[e,n,i,a]))},cullFace:function(r,e){return r((0,D.default)({},2885,e))},depthFunc:function(r,e){return r((0,D.default)({},2932,e))},depthRange:function(r,e,n){return r((0,D.default)({},2928,new Float32Array([e,n])))},depthMask:function(r,e){return r((0,D.default)({},2930,e))},frontFace:function(r,e){return r((0,D.default)({},2886,e))},lineWidth:function(r,e){return r((0,D.default)({},2849,e))},polygonOffset:function(r,e,n){var i;return r((i={},(0,D.default)(i,32824,e),(0,D.default)(i,10752,n),i))},sampleCoverage:function(r,e,n){var i;return r((i={},(0,D.default)(i,32938,e),(0,D.default)(i,32939,n),i))},scissor:function(r,e,n,i,a){return r((0,D.default)({},3088,new Int32Array([e,n,i,a])))},stencilMask:function(r,e){var n;return r((n={},(0,D.default)(n,2968,e),(0,D.default)(n,36005,e),n))},stencilMaskSeparate:function(r,e,n){return r((0,D.default)({},e===1028?2968:36005,n))},stencilFunc:function(r,e,n,i){var a;return r((a={},(0,D.default)(a,2962,e),(0,D.default)(a,2967,n),(0,D.default)(a,2963,i),(0,D.default)(a,34816,e),(0,D.default)(a,36003,n),(0,D.default)(a,36004,i),a))},stencilFuncSeparate:function(r,e,n,i,a){var o;return r((o={},(0,D.default)(o,e===1028?2962:34816,n),(0,D.default)(o,e===1028?2967:36003,i),(0,D.default)(o,e===1028?2963:36004,a),o))},stencilOp:function(r,e,n,i){var a;return r((a={},(0,D.default)(a,2964,e),(0,D.default)(a,2965,n),(0,D.default)(a,2966,i),(0,D.default)(a,34817,e),(0,D.default)(a,34818,n),(0,D.default)(a,34819,i),a))},stencilOpSeparate:function(r,e,n,i,a){var o;return r((o={},(0,D.default)(o,e===1028?2964:34817,n),(0,D.default)(o,e===1028?2965:34818,i),(0,D.default)(o,e===1028?2966:34819,a),o))},viewport:function(r,e,n,i,a){return r((0,D.default)({},2978,[e,n,i,a]))}},_i=function(r,e){return r.isEnabled(e)},ux=(vn={},(0,D.default)(vn,3042,_i),(0,D.default)(vn,2884,_i),(0,D.default)(vn,2929,_i),(0,D.default)(vn,3024,_i),(0,D.default)(vn,32823,_i),(0,D.default)(vn,32926,_i),(0,D.default)(vn,32928,_i),(0,D.default)(vn,3089,_i),(0,D.default)(vn,2960,_i),(0,D.default)(vn,35977,_i),vn);var ck=h(L()),pk=h(N());function lx(t){for(var r in t)return!1;return!0}function lk(t,r){if(t===r)return!0;var e=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(r)||ArrayBuffer.isView(r);if(e&&n&&t.length===r.length){for(var i=0;i<t.length;++i)if(t[i]!==r[i])return!1;return!0}return!1}function fk(t,r){var e=t[r].bind(t);t[r]=function(){var i=arguments.length<=0?void 0:arguments[0];return i in t.state.cache&&t.state.enable?t.state.cache[i]:e.apply(void 0,arguments)},Object.defineProperty(t[r],"name",{value:"".concat(r,"-from-cache"),configurable:!1})}function Ppe(t,r,e){var n=t[r].bind(t);t[r]=function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];var u=e.apply(void 0,[t.state._updateCache].concat(o)),l=u.valueChanged,f=u.oldValue;return l&&n.apply(void 0,o),f},Object.defineProperty(t[r],"name",{value:"".concat(r,"-to-cache"),configurable:!1})}function wpe(t){var r=t.useProgram.bind(t);t.useProgram=function(n){t.state.program!==n&&(r(n),t.state.program=n)}}var Ope=function(){function t(r){(0,ck.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.copyState,i=n===void 0?!1:n,a=e.log,o=a===void 0?function(){}:a;this.gl=r,this.program=null,this.stateStack=[],this.enable=!0,this.cache=i?bi(r):Object.assign({},Cc),this.log=o,this._updateCache=this._updateCache.bind(this),Object.seal(this)}return(0,pk.default)(t,[{key:"push",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.stateStack.push({})}},{key:"pop",value:function(){Ut(this.stateStack.length>0);var e=this.stateStack[this.stateStack.length-1];Gt(this.gl,e),this.stateStack.pop()}},{key:"_updateCache",value:function(e){var n=!1,i,a=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(var o in e){Ut(o!==void 0);var s=e[o],u=this.cache[o];lk(s,u)||(n=!0,i=u,a&&!(o in a)&&(a[o]=u),this.cache[o]=s)}return{valueChanged:n,oldValue:i}}}]),t}();function Zd(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.enable,n=e===void 0?!0:e,i=r.copyState;if(Ut(i!==void 0),!t.state){var a=globalThis.polyfillContext;a&&a(t),t.state=new Ope(t,{copyState:i}),wpe(t);for(var o in sx){var s=sx[o];Ppe(t,o,s)}fk(t,"getParameter"),fk(t,"isEnabled")}return t.state.enable=n,t}function fx(t){t.state||Zd(t,{copyState:!1}),t.state.push()}function Qd(t){Ut(t.state),t.state.pop()}function Epe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Cpe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Cpe(t,r){if(t){if(typeof t=="string")return hk(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return hk(t,r)}}function hk(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Gt(t,r){if(Ut(Zi(t),"setParameters requires a WebGL context"),!lx(r)){var e={};for(var n in r){var i=Number(n),a=sk[n];a&&(typeof a=="string"?e[a]=!0:a(t,r[n],i))}var o=t.state&&t.state.cache;if(o)for(var s in e){var u=uk[s];u(t,r,o)}}}function bi(t,r){if(r=r||Cc,typeof r=="number"){var e=r,n=ux[e];return n?n(t,e):t.getParameter(e)}var i=Array.isArray(r)?r:Object.keys(r),a={},o=Epe(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=ux[u];a[u]=l?l(t,Number(u)):t.getParameter(Number(u))}}catch(f){o.e(f)}finally{o.f()}return a}function ev(t){Gt(t,Cc)}function Ie(t,r,e){if(lx(r))return e(t);var n=r.nocatch,i=n===void 0?!0:n;fx(t),Gt(t,r);var a;if(i)a=e(t),Qd(t);else try{a=e(t)}finally{Qd(t)}return a}function vr(t){var r=t.luma;if(t.canvas&&r){var e=r.canvasSizeInfo.clientWidth;return e?t.drawingBufferWidth/e:1}return 1}function Mu(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=vr(t),i=t.drawingBufferWidth,a=t.drawingBufferHeight;return Mpe(r,n,i,a,e)}function mk(t){var r=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?r:1}function Mpe(t,r,e,n,i){var a=dk(t[0],r,e),o=vk(t[1],r,n,i),s=dk(t[0]+1,r,e),u=s===e-1?s:s-1;s=vk(t[1]+1,r,n,i);var l;return i?(s=s===0?s:s+1,l=o,o=s):l=s===n-1?s:s-1,{x:a,y:o,width:Math.max(u-a+1,1),height:Math.max(l-o+1,1)}}function dk(t,r,e){var n=Math.min(Math.round(t*r),e-1);return n}function vk(t,r,e,n){return n?Math.max(0,e-1-Math.round(t*r)):Math.min(Math.round(t*r),e-1)}var cx=Qt(),Ipe=cx&&typeof document<"u",gk={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function Iu(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ut(cx,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},gk,t);var r=t,e=r.width,n=r.height;function i(l){if(t.throwOnError)throw new Error(l);return console.error(l),null}t.onError=i;var a,o=t,s=o.canvas,u=Lpe({canvas:s,width:e,height:n,onError:i});return a=Rpe(u,t),a?(a=ea(a,t),kpe(a),a):null}function ea(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||Bpe(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},r=Object.assign({},gk,r);var e=r,n=e.manageState,i=e.debug;return n&&Zd(t,{copyState:!1,log:function(){for(var o=arguments.length,s=new Array(o),u=0;u<o;u++)s[u]=arguments[u];return re.log.apply(re,[1].concat(s))()}}),cx&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,r),re.level=Math.max(re.level,1)):re.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function yk(t){var r=t.getParameter(7936),e=t.getParameter(7937),n=t.getExtension("WEBGL_debug_renderer_info"),i=n&&t.getParameter(n.UNMASKED_VENDOR_WEBGL||7936),a=n&&t.getParameter(n.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||r,renderer:a||e,vendorMasked:r,rendererMasked:e,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function px(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){var e=mk(r.useDevicePixels);Fpe(t,e,r);return}var n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in r&&"height"in r&&n.resize(r.width,r.height)}function Rpe(t,r){var e=r.onError,n=null,i=function(c){return n=c.statusMessage||n};t.addEventListener("webglcontextcreationerror",i,!1);var a=r.webgl1,o=a===void 0?!0:a,s=r.webgl2,u=s===void 0?!0:s,l=null;return u&&(l=l||t.getContext("webgl2",r),l=l||t.getContext("experimental-webgl2",r)),o&&(l=l||t.getContext("webgl",r),l=l||t.getContext("experimental-webgl",r)),t.removeEventListener("webglcontextcreationerror",i,!1),l?(r.onContextLost&&t.addEventListener("webglcontextlost",r.onContextLost,!1),r.onContextRestored&&t.addEventListener("webglcontextrestored",r.onContextRestored,!1),l):e("Failed to create ".concat(u&&!o?"WebGL2":"WebGL"," context: ").concat(n||"Unknown error"))}function Lpe(t){var r=t.canvas,e=t.width,n=e===void 0?800:e,i=t.height,a=i===void 0?600:i,o=t.onError,s;if(typeof r=="string"){var u=Ipe&&document.readyState==="complete";u||o("createGLContext called on canvas '".concat(r,"' before page was loaded")),s=document.getElementById(r)}else r?s=r:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(a)?"".concat(a,"px"):"100%",document.body.insertBefore(s,document.body.firstChild));return s}function kpe(t){var r=fe(t)?"WebGL2":"WebGL1",e=yk(t),n=e?"(".concat(e.vendor,",").concat(e.renderer,")"):"",i=t.debug?" debug":"";re.info(1,"".concat(r).concat(i," context ").concat(n))()}function Bpe(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function Fpe(t,r,e){var n="width"in e?e.width:t.canvas.clientWidth,i="height"in e?e.height:t.canvas.clientHeight;(!n||!i)&&(re.log(1,"Canvas clientWidth/clientHeight is 0")(),r=1,n=t.canvas.width||1,i=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};var a=t.luma.canvasSizeInfo;if(a.clientWidth!==n||a.clientHeight!==i||a.devicePixelRatio!==r){var o=r,s=Math.floor(n*o),u=Math.floor(i*o);t.canvas.width=s,t.canvas.height=u,(t.drawingBufferWidth!==s||t.drawingBufferHeight!==u)&&(re.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/n,t.drawingBufferHeight/i),t.canvas.width=Math.floor(n*o),t.canvas.height=Math.floor(i*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:n,clientHeight:i,devicePixelRatio:r})}}var _k=h(L()),bk=h(N());var Mc="8.5.16",Dpe="set luma.log.level=1 (or higher) to trace rendering",hx=function(){function t(){(0,_k.default)(this,t),this.stats=new Map}return(0,bk.default)(t,[{key:"get",value:function(e){return this.stats.has(e)||this.stats.set(e,new Un({id:e})),this.stats.get(e)}}]),t}(),mn=new hx;if(globalThis.luma&&globalThis.luma.VERSION!==Mc)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Mc));globalThis.luma||(Qt()&&re.log(1,"luma.gl ".concat(Mc," - ").concat(Dpe))(),globalThis.luma=globalThis.luma||{VERSION:Mc,version:Mc,log:re,stats:mn,globals:{modules:{},nodeIO:{}}});var K4e=globalThis.luma;function dx(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function vx(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}var kB=h(B());var Xk=h(L()),qk=h(N()),Yk=h(_e()),Kk=h(Y()),Jk=h(K()),bx=h(q());var Gk=h(ye()),zk=h(L()),Vk=h(N()),Hk=h(Y()),Wk=h(K()),_x=h(q());var Ak=h(L()),Tk=h(N());function J(t,r){if(!t)throw new Error(r||"luma.gl: assertion failed.")}function tv(t,r){if(typeof r!="string")return r;var e=Number(r);if(!isNaN(e))return e;r=r.replace(/^.*\./,"");var n=t[r];return J(n!==void 0,"Accessing undefined constant GL.".concat(r)),n}function gn(t,r){r=Number(r);for(var e in t)if(t[e]===r)return"GL.".concat(e);return String(r)}var mx={};function Xe(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";mx[t]=mx[t]||1;var r=mx[t]++;return"".concat(t,"-").concat(r)}function gx(t){return J(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function xi(t){var r=!0;for(var e in t){r=!1;break}return r}function rv(t,r,e,n){var i="See luma.gl ".concat(e," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),a=Object.getPrototypeOf(t);n.forEach(function(o){a.methodName||(a[o]=function(){throw re.removed("Calling removed method ".concat(r,".").concat(o,": "),i)(),new Error(o)})})}function Npe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=jpe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function jpe(t,r){if(t){if(typeof t=="string")return xk(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return xk(t,r)}}function xk(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Ru="Resource subclass must define virtual methods",ur=function(t){function r(e){(0,Ak.default)(this,r);var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Qi(e);var i=n.id,a=n.userData,o=a===void 0?{}:a;this.gl=e,this.gl2=e,this.id=i||Xe(this[Symbol.toStringTag]),this.userData=o,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._initStats(),this._addStats()}return(0,Tk.default)(r,[{key:t,get:function(){return"Resource"}},{key:"toString",value:function(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}},{key:"handle",get:function(){return this._handle}},{key:"delete",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.deleteChildren,a=i===void 0?!1:i,o=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,o&&a&&o.filter(Boolean).forEach(function(s){return s.delete()}),this}},{key:"bind",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof n!="function")return this._bindHandle(n),this;var i;return this._bound?i=n():(this._bindHandle(this.handle),this._bound=!0,i=n(),this._bound=!1,this._bindHandle(null)),i}},{key:"unbind",value:function(){this.bind(null)}},{key:"getParameter",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};n=tv(this.gl,n),J(n);var a=this.constructor.PARAMETERS||{},o=a[n];if(o){var s=fe(this.gl),u=(!("webgl2"in o)||s)&&(!("extension"in o)||this.gl.getExtension(o.extension));if(!u){var l=o.webgl1,f="webgl2"in o?o.webgl2:o.webgl1,c=s?f:l;return c}}return this._getParameter(n,i)}},{key:"getParameters",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.parameters,a=n.keys,o=this.constructor.PARAMETERS||{},s=fe(this.gl),u={},l=i||Object.keys(o),f=Npe(l),c;try{for(f.s();!(c=f.n()).done;){var p=c.value,d=o[p],v=d&&(!("webgl2"in d)||s)&&(!("extension"in d)||this.gl.getExtension(d.extension));if(v){var m=a?gn(this.gl,p):p;u[m]=this.getParameter(p,n),a&&d.type==="GLenum"&&(u[m]=gn(this.gl,u[m]))}}}catch(g){f.e(g)}finally{f.f()}return u}},{key:"setParameter",value:function(n,i){n=tv(this.gl,n),J(n);var a=this.constructor.PARAMETERS||{},o=a[n];if(o){var s=fe(this.gl),u=(!("webgl2"in o)||s)&&(!("extension"in o)||this.gl.getExtension(o.extension));if(!u)throw new Error("Parameter not available on this platform");o.type==="GLenum"&&(i=tv(i))}return this._setParameter(n,i),this}},{key:"setParameters",value:function(n){for(var i in n)this.setParameter(i,n[i]);return this}},{key:"stubRemovedMethods",value:function(n,i,a){return rv(this,n,i,a)}},{key:"initialize",value:function(n){}},{key:"_createHandle",value:function(){throw new Error(Ru)}},{key:"_deleteHandle",value:function(){throw new Error(Ru)}},{key:"_bindHandle",value:function(n){throw new Error(Ru)}},{key:"_getOptsFromHandle",value:function(){throw new Error(Ru)}},{key:"_getParameter",value:function(n,i){throw new Error(Ru)}},{key:"_setParameter",value:function(n,i){throw new Error(Ru)}},{key:"_context",value:function(){return this.gl.luma=this.gl.luma||{},this.gl.luma}},{key:"_initStats",value:function(){this.gl.stats=this.gl.stats||new hx}},{key:"_addStats",value:function(){var n=this[Symbol.toStringTag],i=mn.get("Resource Counts");i.get("Resources Created").incrementCount(),i.get("".concat(n,"s Created")).incrementCount(),i.get("".concat(n,"s Active")).incrementCount()}},{key:"_removeStats",value:function(){var n=this[Symbol.toStringTag],i=mn.get("Resource Counts");i.get("".concat(n,"s Active")).decrementCount()}},{key:"_trackAllocatedMemory",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._doTrackAllocatedMemory(n,i),this._doTrackAllocatedMemory(n,i,this.gl.stats.get("Memory Usage"))}},{key:"_doTrackAllocatedMemory",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:mn.get("Memory Usage");a.get("GPU Memory").addCount(n),a.get("".concat(i," Memory")).addCount(n),this.byteLength=n}},{key:"_trackDeallocatedMemory",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._doTrackDeallocatedMemory(n),this._doTrackDeallocatedMemory(n,this.gl.stats.get("Memory Usage"))}},{key:"_doTrackDeallocatedMemory",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:mn.get("Memory Usage");i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(n," Memory")).subtractCount(this.byteLength),this.byteLength=0}}]),r}(Symbol.toStringTag);var Ik=h(L()),Rk=h(N()),Lk=h(_e()),kk=h(Y()),Bk=h(K()),yx=h(q());var Ok=h(Sk()),Ek=h(L()),Ck=h(N());var zpe="Failed to deduce GL constant from typed array";function Ic(t){var r=ArrayBuffer.isView(t)?t.constructor:t;switch(r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(zpe)}}function Xa(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.clamped,n=e===void 0?!0:e;switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Pk(t){var r=t.data,e=t.width,n=t.height,i=t.bytesPerPixel,a=i===void 0?4:i,o=t.temp,s=e*a;o=o||new Uint8Array(s);for(var u=0;u<n/2;++u){var l=u*s,f=(n-u-1)*s;o.set(r.subarray(l,l+s)),r.copyWithin(l,f,f+s),r.set(o,f)}}function wk(t){for(var r=t.data,e=t.width,n=t.height,i=Math.round(e/2),a=Math.round(n/2),o=new Uint8Array(i*a*4),s=0;s<a;s++)for(var u=0;u<i;u++)for(var l=0;l<4;l++)o[(s*i+u)*4+l]=r[(s*2*e+u*2)*4+l];return{data:o,width:i,height:a}}function Rc(t,r,e){var n=e.removedProps,i=n===void 0?{}:n,a=e.deprecatedProps,o=a===void 0?{}:a,s=e.replacedProps,u=s===void 0?{}:s;for(var l in i)if(l in r){var f=i[l],c=f?"".concat(t,".").concat(i[l]):"N/A";re.removed("".concat(t,".").concat(l),c)()}for(var p in o)if(p in r){var d=o[p];re.deprecated("".concat(t,".").concat(p),"".concat(t,".").concat(d))()}var v=null;for(var m in u)if(m in r){var g=u[m];re.deprecated("".concat(t,".").concat(m),"".concat(t,".").concat(g))(),v=v||Object.assign({},r),v[g]=r[m],delete v[m]}return v||r}var Vpe={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},Hpe={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},Mr=function(){function t(){var r=this;(0,Ek.default)(this,t);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(function(a){return r._assign(a)}),Object.freeze(this)}return(0,Ck.default)(t,[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"BYTES_PER_ELEMENT",get:function(){return t.getBytesPerElement(this)}},{key:"BYTES_PER_VERTEX",get:function(){return t.getBytesPerVertex(this)}},{key:"_assign",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Rc("Accessor",e,Hpe),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}],[{key:"getBytesPerElement",value:function(e){var n=Xa(e.type||5126);return n.BYTES_PER_ELEMENT}},{key:"getBytesPerVertex",value:function(e){J(e.size);var n=Xa(e.type||5126);return n.BYTES_PER_ELEMENT*e.size}},{key:"resolve",value:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return(0,Ok.default)(t,[Vpe].concat(n))}}]),t}();function Wpe(t){var r=$pe();return function(){var n=(0,yx.default)(t),i;if(r){var a=(0,yx.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Bk.default)(this,i)}}function $pe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Mk=10,Fk={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Xpe={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Fk},qpe={removedProps:Fk},be=function(t,r){(0,kk.default)(n,t);var e=Wpe(n);function n(i){var a;(0,Ik.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),a.target=o.target||(a.gl.webgl2?36662:34962),a.initialize(o),Object.seal((0,Lk.default)(a)),a}return(0,Rk.default)(n,[{key:r,get:function(){return"Buffer"}},{key:"getElementCount",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Mr.getBytesPerElement(a))}},{key:"getVertexCount",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Mr.getBytesPerVertex(a))}},{key:"initialize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(a)&&(a={data:a}),Number.isFinite(a)&&(a={byteLength:a}),a=Rc("Buffer",a,Xpe),this.usage=a.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},a,a.accessor)),a.data?this._setData(a.data,a.offset,a.byteLength):this._setByteLength(a.byteLength||0),this}},{key:"setProps",value:function(a){return a=Rc("Buffer",a,qpe),"accessor"in a&&this.setAccessor(a.accessor),this}},{key:"setAccessor",value:function(a){return a=Object.assign({},a),delete a.buffer,this.accessor=new Mr(a),this}},{key:"reallocate",value:function(a){return a>this.byteLength?(this._setByteLength(a),!0):(this.bytesUsed=a,!1)}},{key:"setData",value:function(a){return this.initialize(a)}},{key:"subData",value:function(a){ArrayBuffer.isView(a)&&(a={data:a});var o=a,s=o.data,u=o.offset,l=u===void 0?0:u,f=o.srcOffset,c=f===void 0?0:f,p=a.byteLength||a.length;J(s);var d=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(d,this.handle),c!==0||p!==void 0?(mt(this.gl),this.gl.bufferSubData(this.target,l,s,c,p)):this.gl.bufferSubData(d,l,s),this.gl.bindBuffer(d,null),this.debugData=null,this._inferType(s),this}},{key:"copyData",value:function(a){var o=a.sourceBuffer,s=a.readOffset,u=s===void 0?0:s,l=a.writeOffset,f=l===void 0?0:l,c=a.size,p=this.gl;return mt(p),p.bindBuffer(36662,o.handle),p.bindBuffer(36663,this.handle),p.copyBufferSubData(36662,36663,u,f,c),p.bindBuffer(36662,null),p.bindBuffer(36663,null),this.debugData=null,this}},{key:"getData",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.dstData,s=o===void 0?null:o,u=a.srcByteOffset,l=u===void 0?0:u,f=a.dstOffset,c=f===void 0?0:f,p=a.length,d=p===void 0?0:p;mt(this.gl);var v=Xa(this.accessor.type||5126,{clamped:!1}),m=this._getAvailableElementCount(l),g=c,y,_;s?(_=s.length,y=_-g):(y=Math.min(m,d||m),_=g+y);var b=Math.min(m,y);return d=d||b,J(d<=b),s=s||new v(_),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,l,s,c,d),this.gl.bindBuffer(36662,null),s}},{key:"bind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?this.target:o,u=a.index,l=u===void 0?this.accessor&&this.accessor.index:u,f=a.offset,c=f===void 0?0:f,p=a.size;return s===35345||s===35982?p!==void 0?this.gl.bindBufferRange(s,l,this.handle,c,p):(J(c===0),this.gl.bindBufferBase(s,l,this.handle)):this.gl.bindBuffer(s,this.handle),this}},{key:"unbind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?this.target:o,u=a.index,l=u===void 0?this.accessor&&this.accessor.index:u,f=s===35345||s===35982;return f?this.gl.bindBufferBase(s,l,null):this.gl.bindBuffer(s,null),this}},{key:"getDebugData",value:function(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Mk,this.byteLength)}),{data:this.debugData,changed:!0})}},{key:"invalidateDebugData",value:function(){this.debugData=null}},{key:"_setData",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:a.byteLength+o;J(ArrayBuffer.isView(a)),this._trackDeallocatedMemory();var u=this._getTarget();this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,s,this.usage),this.gl.bufferSubData(u,o,a),this.gl.bindBuffer(u,null),this.debugData=a.slice(0,Mk),this.bytesUsed=s,this._trackAllocatedMemory(s);var l=Ic(a);return J(l),this.setAccessor(new Mr(this.accessor,{type:l})),this}},{key:"_setByteLength",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;J(a>=0),this._trackDeallocatedMemory();var s=a;a===0&&(s=new Float32Array(0));var u=this._getTarget();return this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,s,o),this.gl.bindBuffer(u,null),this.usage=o,this.debugData=null,this.bytesUsed=a,this._trackAllocatedMemory(a),this}},{key:"_getTarget",value:function(){return this.gl.webgl2?36663:this.target}},{key:"_getAvailableElementCount",value:function(a){var o=Xa(this.accessor.type||5126,{clamped:!1}),s=a/o.BYTES_PER_ELEMENT;return this.getElementCount()-s}},{key:"_inferType",value:function(a){this.accessor.type||this.setAccessor(new Mr(this.accessor,{type:Ic(a)}))}},{key:"_createHandle",value:function(){return this.gl.createBuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_getParameter",value:function(a){this.gl.bindBuffer(this.target,this.handle);var o=this.gl.getBufferParameter(this.target,a);return this.gl.bindBuffer(this.target,null),o}},{key:"type",get:function(){return re.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}},{key:"bytes",get:function(){return re.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}},{key:"setByteLength",value:function(a){return re.deprecated("setByteLength","reallocate")(),this.reallocate(a)}},{key:"updateAccessor",value:function(a){return re.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Mr(this.accessor,a),this}}]),n}(ur,Symbol.toStringTag);var nt=h(B());var Hn,Ir,Ai,av=(Hn={},(0,nt.default)(Hn,6407,{dataFormat:6407,types:[5121,33635]}),(0,nt.default)(Hn,6408,{dataFormat:6408,types:[5121,32819,32820]}),(0,nt.default)(Hn,6406,{dataFormat:6406,types:[5121]}),(0,nt.default)(Hn,6409,{dataFormat:6409,types:[5121]}),(0,nt.default)(Hn,6410,{dataFormat:6410,types:[5121]}),(0,nt.default)(Hn,33326,{dataFormat:6403,types:[5126],gl2:!0}),(0,nt.default)(Hn,33328,{dataFormat:33319,types:[5126],gl2:!0}),(0,nt.default)(Hn,34837,{dataFormat:6407,types:[5126],gl2:!0}),(0,nt.default)(Hn,34836,{dataFormat:6408,types:[5126],gl2:!0}),Hn),ov=(Ir={},(0,nt.default)(Ir,6403,1),(0,nt.default)(Ir,36244,1),(0,nt.default)(Ir,33319,2),(0,nt.default)(Ir,33320,2),(0,nt.default)(Ir,6407,3),(0,nt.default)(Ir,36248,3),(0,nt.default)(Ir,6408,4),(0,nt.default)(Ir,36249,4),(0,nt.default)(Ir,6402,1),(0,nt.default)(Ir,34041,1),(0,nt.default)(Ir,6406,1),(0,nt.default)(Ir,6409,1),(0,nt.default)(Ir,6410,2),Ir),sv=(Ai={},(0,nt.default)(Ai,5126,4),(0,nt.default)(Ai,5125,4),(0,nt.default)(Ai,5124,4),(0,nt.default)(Ai,5123,2),(0,nt.default)(Ai,5122,2),(0,nt.default)(Ai,5131,2),(0,nt.default)(Ai,5120,1),(0,nt.default)(Ai,5121,1),Ai);function Dk(t,r){var e=av[r];if(!e)return!1;if(e.gl1===void 0&&e.gl2===void 0)return!0;var n=fe(t)&&e.gl2||e.gl1;return typeof n=="string"?t.getExtension(n):n}function Nk(t,r){var e=av[r];switch(e&&e.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}function Ype(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Kpe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Kpe(t,r){if(t){if(typeof t=="string")return jk(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return jk(t,r)}}function jk(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Jpe(t){var r=Zpe();return function(){var n=(0,_x.default)(t),i;if(r){var a=(0,_x.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Wk.default)(this,i)}}function Zpe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Qpe=[9729,9728],Uk=globalThis.WebGLBuffer||function(){},nn=function(t,r){(0,Hk.default)(n,t);var e=Jpe(n);function n(i,a){var o;(0,zk.default)(this,n);var s=a.id,u=s===void 0?Xe("texture"):s,l=a.handle,f=a.target;return o=e.call(this,i,{id:u,handle:l}),o.target=f,o.textureUnit=void 0,o.loaded=!1,o.width=void 0,o.height=void 0,o.depth=void 0,o.format=void 0,o.type=void 0,o.dataFormat=void 0,o.border=void 0,o.textureUnit=void 0,o.mipmaps=void 0,o}return(0,Vk.default)(n,[{key:r,get:function(){return"Texture"}},{key:"toString",value:function(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}},{key:"initialize",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=o.data;if(s instanceof Promise)return s.then(function(X){return a.initialize(Object.assign({},o,{pixels:X,data:X}))}),this;var u=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement;if(u&&s.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,s.addEventListener("loadeddata",function(){return a.initialize(o)}),this;var l=o.pixels,f=l===void 0?null:l,c=o.format,p=c===void 0?6408:c,d=o.border,v=d===void 0?0:d,m=o.recreate,g=m===void 0?!1:m,y=o.parameters,_=y===void 0?{}:y,b=o.pixelStore,x=b===void 0?{}:b,A=o.textureUnit,T=A===void 0?void 0:A;s||(s=f);var O=o.width,w=o.height,E=o.dataFormat,S=o.type,I=o.compressed,R=I===void 0?!1:I,z=o.mipmaps,G=z===void 0?!0:z,k=o.depth,U=k===void 0?0:k,j=this._deduceParameters({format:p,type:S,dataFormat:E,compressed:R,data:s,width:O,height:w});return O=j.width,w=j.height,R=j.compressed,E=j.dataFormat,S=j.type,this.width=O,this.height=w,this.depth=U,this.format=p,this.type=S,this.dataFormat=E,this.border=v,this.textureUnit=T,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),G&&this._isNPOT()&&(re.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),G=!1,this._updateForNPOT(_)),this.mipmaps=G,this.setImageData({data:s,width:O,height:w,depth:U,format:p,type:S,dataFormat:E,border:v,mipmaps:G,parameters:x,compressed:R}),G&&this.generateMipmap(),this.setParameters(_),g&&(this.data=s),u&&(this._video={video:s,parameters:_,lastTime:s.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?s.currentTime:-1}),this}},{key:"update",value:function(){if(this._video){var a=this._video,o=a.video,s=a.parameters,u=a.lastTime;if(u===o.currentTime||o.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:o,parameters:s}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=o.currentTime}}},{key:"resize",value:function(a){var o=a.height,s=a.width,u=a.mipmaps,l=u===void 0?!1:u;return s!==this.width||o!==this.height?this.initialize({width:s,height:o,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:l}):this}},{key:"generateMipmap",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(re.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Ie(this.gl,o,function(){a.gl.generateMipmap(a.target)}),this.gl.bindTexture(this.target,null),this)}},{key:"setImageData",value:function(a){this._trackDeallocatedMemory("Texture");var o=a.target,s=o===void 0?this.target:o,u=a.pixels,l=u===void 0?null:u,f=a.level,c=f===void 0?0:f,p=a.format,d=p===void 0?this.format:p,v=a.border,m=v===void 0?this.border:v,g=a.offset,y=g===void 0?0:g,_=a.parameters,b=_===void 0?{}:_,x=a.data,A=x===void 0?null:x,T=a.type,O=T===void 0?this.type:T,w=a.width,E=w===void 0?this.width:w,S=a.height,I=S===void 0?this.height:S,R=a.dataFormat,z=R===void 0?this.dataFormat:R,G=a.compressed,k=G===void 0?!1:G;A||(A=l);var U=this._deduceParameters({format:d,type:O,dataFormat:z,compressed:k,data:A,width:E,height:I});O=U.type,z=U.dataFormat,k=U.compressed,E=U.width,I=U.height;var j=this.gl;j.bindTexture(this.target,this.handle);var X=null,H=this._getDataType({data:A,compressed:k});A=H.data,X=H.dataType;var Q,ne=0;if(Ie(this.gl,b,function(){switch(X){case"null":j.texImage2D(s,c,d,E,I,m,z,O,A);break;case"typed-array":j.texImage2D(s,c,d,E,I,m,z,O,A,y);break;case"buffer":Q=mt(j),Q.bindBuffer(35052,A.handle||A),Q.texImage2D(s,c,d,E,I,m,z,O,y),Q.bindBuffer(35052,null);break;case"browser-object":fe(j)?j.texImage2D(s,c,d,E,I,m,z,O,A):j.texImage2D(s,c,d,z,O,A);break;case"compressed":var we=Ype(A.entries()),ze;try{for(we.s();!(ze=we.n()).done;){var me=(0,Gk.default)(ze.value,2),$e=me[0],Le=me[1];j.compressedTexImage2D(s,$e,Le.format,Le.width,Le.height,m,Le.data),ne+=Le.levelSize}}catch(Pt){we.e(Pt)}finally{we.f()}break;default:J(!1,"Unknown image data type")}}),X==="compressed")this._trackAllocatedMemory(ne,"Texture");else if(A&&A.byteLength)this._trackAllocatedMemory(A.byteLength,"Texture");else{var le=ov[this.dataFormat]||4,xe=sv[this.type]||1;this._trackAllocatedMemory(this.width*this.height*le*xe,"Texture")}return this.loaded=!0,this}},{key:"setSubImageData",value:function(a){var o=this,s=a.target,u=s===void 0?this.target:s,l=a.pixels,f=l===void 0?null:l,c=a.data,p=c===void 0?null:c,d=a.x,v=d===void 0?0:d,m=a.y,g=m===void 0?0:m,y=a.width,_=y===void 0?this.width:y,b=a.height,x=b===void 0?this.height:b,A=a.level,T=A===void 0?0:A,O=a.format,w=O===void 0?this.format:O,E=a.type,S=E===void 0?this.type:E,I=a.dataFormat,R=I===void 0?this.dataFormat:I,z=a.compressed,G=z===void 0?!1:z,k=a.offset,U=k===void 0?0:k,j=a.border,X=j===void 0?this.border:j,H=a.parameters,Q=H===void 0?{}:H,ne=this._deduceParameters({format:w,type:S,dataFormat:R,compressed:G,data:p,width:_,height:x});if(S=ne.type,R=ne.dataFormat,G=ne.compressed,_=ne.width,x=ne.height,J(this.depth===0,"texSubImage not supported for 3D textures"),p||(p=f),p&&p.data){var le=p;p=le.data,_=le.shape[0],x=le.shape[1]}p instanceof be&&(p=p.handle),this.gl.bindTexture(this.target,this.handle),Ie(this.gl,Q,function(){if(G)o.gl.compressedTexSubImage2D(u,T,v,g,_,x,w,p);else if(p===null)o.gl.texSubImage2D(u,T,v,g,_,x,R,S,null);else if(ArrayBuffer.isView(p))o.gl.texSubImage2D(u,T,v,g,_,x,R,S,p,U);else if(p instanceof Uk){var xe=mt(o.gl);xe.bindBuffer(35052,p),xe.texSubImage2D(u,T,v,g,_,x,R,S,U),xe.bindBuffer(35052,null)}else if(fe(o.gl)){var we=mt(o.gl);we.texSubImage2D(u,T,v,g,_,x,R,S,p)}else o.gl.texSubImage2D(u,T,v,g,R,S,p)}),this.gl.bindTexture(this.target,null)}},{key:"copyFramebuffer",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return re.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(34016)-33984}},{key:"bind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit,o=this.gl;return a!==void 0&&(this.textureUnit=a,o.activeTexture(33984+a)),o.bindTexture(this.target,this.handle),a}},{key:"unbind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit,o=this.gl;return a!==void 0&&(this.textureUnit=a,o.activeTexture(33984+a)),o.bindTexture(this.target,null),a}},{key:"_getDataType",value:function(a){var o=a.data,s=a.compressed,u=s===void 0?!1:s;return u?{data:o,dataType:"compressed"}:o===null?{data:o,dataType:"null"}:ArrayBuffer.isView(o)?{data:o,dataType:"typed-array"}:o instanceof be?{data:o.handle,dataType:"buffer"}:o instanceof Uk?{data:o,dataType:"buffer"}:{data:o,dataType:"browser-object"}}},{key:"_deduceParameters",value:function(a){var o=a.format,s=a.data,u=a.width,l=a.height,f=a.dataFormat,c=a.type,p=a.compressed,d=av[o];f=f||d&&d.dataFormat,c=c||d&&d.types[0],p=p||d&&d.compressed;var v=this._deduceImageSize(s,u,l);return u=v.width,l=v.height,{dataFormat:f,type:c,compressed:p,width:u,height:l,format:o,data:s}}},{key:"_deduceImageSize",value:function(a,o,s){var u;return typeof ImageData<"u"&&a instanceof ImageData?u={width:a.width,height:a.height}:typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement?u={width:a.naturalWidth,height:a.naturalHeight}:typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement?u={width:a.width,height:a.height}:typeof ImageBitmap<"u"&&a instanceof ImageBitmap?u={width:a.width,height:a.height}:typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement?u={width:a.videoWidth,height:a.videoHeight}:a?u={width:o,height:s}:u={width:o>=0?o:1,height:s>=0?s:1},J(u,"Could not deduced texture size"),J(o===void 0||u.width===o,"Deduced texture width does not match supplied width"),J(s===void 0||u.height===s,"Deduced texture height does not match supplied height"),u}},{key:"_createHandle",value:function(){return this.gl.createTexture()}},{key:"_deleteHandle",value:function(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}},{key:"_getParameter",value:function(a){switch(a){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);var o=this.gl.getTexParameter(this.target,a);return this.gl.bindTexture(this.target,null),o}}},{key:"_setParameter",value:function(a,o){switch(this.gl.bindTexture(this.target,this.handle),o=this._getNPOTParam(a,o),a){case 33082:case 33083:this.gl.texParameterf(this.handle,a,o);break;case 4096:case 4097:J(!1);break;default:this.gl.texParameteri(this.target,a,o);break}return this.gl.bindTexture(this.target,null),this}},{key:"_isNPOT",value:function(){return fe(this.gl)||!this.width||!this.height?!1:!gx(this.width)||!gx(this.height)}},{key:"_updateForNPOT",value:function(a){a[this.gl.TEXTURE_MIN_FILTER]===void 0&&(a[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),a[this.gl.TEXTURE_WRAP_S]===void 0&&(a[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),a[this.gl.TEXTURE_WRAP_T]===void 0&&(a[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}},{key:"_getNPOTParam",value:function(a,o){if(this._isNPOT())switch(a){case 10241:Qpe.indexOf(o)===-1&&(o=9729);break;case 10242:case 10243:o!==33071&&(o=33071);break;default:break}return o}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.format,u=o.linearFiltering,l=!0;return s&&(l=l&&Dk(a,s),l=l&&(!u||Nk(a,s))),l}}]),n}(ur,Symbol.toStringTag);var ehe="";function $k(t,r){return J(typeof t=="string"),t=ehe+t,new Promise(function(e,n){try{var i=new Image;i.onload=function(){return e(i)},i.onerror=function(){return n(new Error("Could not load image ".concat(t,".")))},i.crossOrigin=r&&r.crossOrigin||"anonymous",i.src=t}catch(a){n(a)}})}function the(t){var r=rhe();return function(){var n=(0,bx.default)(t),i;if(r){var a=(0,bx.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Jk.default)(this,i)}}function rhe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Se=function(t,r){(0,Kk.default)(n,t);var e=the(n);function n(i){var a;(0,Xk.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Qi(i),(o instanceof Promise||typeof o=="string")&&(o={data:o}),typeof o.data=="string"&&(o=Object.assign({},o,{data:$k(o.data)})),a=e.call(this,i,Object.assign({},o,{target:3553})),a.initialize(o),Object.seal((0,Yk.default)(a)),a}return(0,qk.default)(n,[{key:r,get:function(){return"Texture2D"}}],[{key:"isSupported",value:function(a,o){return nn.isSupported(a,o)}}]),n}(nn,Symbol.toStringTag);var Zk=h(ge()),Qk=h(L()),eB=h(N()),tB=h(_e()),rB=h(Y()),nB=h(K()),xx=h(q()),Ax=h(de());function nhe(t){var r=ihe();return function(){var n=(0,xx.default)(t),i;if(r){var a=(0,xx.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,nB.default)(this,i)}}function ihe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Tx=[34069,34070,34071,34072,34073,34074],Zo=function(t,r){(0,rB.default)(n,t);var e=nhe(n);function n(i){var a;(0,Qk.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Qi(i),a=e.call(this,i,Object.assign({},o,{target:34067})),a.initialize(o),Object.seal((0,tB.default)(a)),a}return(0,eB.default)(n,[{key:r,get:function(){return"TextureCube"}},{key:"initialize",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=o.mipmaps,u=s===void 0?!0:s,l=o.parameters,f=l===void 0?{}:l;return this.opts=o,this.setCubeMapImageData(o).then(function(){a.loaded=!0,u&&a.generateMipmap(o),a.setParameters(f)}),this}},{key:"subImage",value:function(a){var o=a.face,s=a.data,u=a.x,l=u===void 0?0:u,f=a.y,c=f===void 0?0:f,p=a.mipmapLevel,d=p===void 0?0:p;return this._subImage({target:o,data:s,x:l,y:c,mipmapLevel:d})}},{key:"setCubeMapImageData",value:function(){var i=(0,Zk.default)(Ax.default.mark(function o(s){var u=this,l,f,c,p,d,v,m,g,y,_,b,x,A;return Ax.default.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return l=s.width,f=s.height,c=s.pixels,p=s.data,d=s.border,v=d===void 0?0:d,m=s.format,g=m===void 0?6408:m,y=s.type,_=y===void 0?5121:y,b=this.gl,x=c||p,O.next=5,Promise.all(Tx.map(function(w){var E=x[w];return Promise.all(Array.isArray(E)?E:[E])}));case 5:A=O.sent,this.bind(),Tx.forEach(function(w,E){A[E].length>1&&u.opts.mipmaps!==!1&&re.warn("".concat(u.id," has mipmap and multiple LODs."))(),A[E].forEach(function(S,I){l&&f?b.texImage2D(w,I,g,l,f,v,g,_,S):b.texImage2D(w,I,g,g,_,S)})}),this.unbind();case 9:case"end":return O.stop()}},o,this)}));function a(o){return i.apply(this,arguments)}return a}()},{key:"setImageDataForFace",value:function(a){var o=this,s=a.face,u=a.width,l=a.height,f=a.pixels,c=a.data,p=a.border,d=p===void 0?0:p,v=a.format,m=v===void 0?6408:v,g=a.type,y=g===void 0?5121:g,_=this.gl,b=f||c;return this.bind(),b instanceof Promise?b.then(function(x){return o.setImageDataForFace(Object.assign({},a,{face:s,data:x,pixels:x}))}):this.width||this.height?_.texImage2D(s,0,m,u,l,d,m,y,b):_.texImage2D(s,0,m,m,y,b),this}}]),n}(nn,Symbol.toStringTag);Zo.FACES=Tx;var iB=h(L()),aB=h(N()),oB=h(_e()),sB=h(Y()),uB=h(K()),Sx=h(q());function ahe(t){var r=ohe();return function(){var n=(0,Sx.default)(t),i;if(r){var a=(0,Sx.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,uB.default)(this,i)}}function ohe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Lu=function(t,r){(0,sB.default)(n,t);var e=ahe(n);function n(i){var a;(0,iB.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mt(i),o=Object.assign({depth:1},o,{target:32879,unpackFlipY:!1}),a=e.call(this,i,o),a.initialize(o),Object.seal((0,oB.default)(a)),a}return(0,aB.default)(n,[{key:r,get:function(){return"Texture3D"}},{key:"setImageData",value:function(a){var o=this,s=a.level,u=s===void 0?0:s,l=a.dataFormat,f=l===void 0?6408:l,c=a.width,p=a.height,d=a.depth,v=d===void 0?1:d,m=a.border,g=m===void 0?0:m,y=a.format,_=a.type,b=_===void 0?5121:_,x=a.offset,A=x===void 0?0:x,T=a.data,O=a.parameters,w=O===void 0?{}:O;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Ie(this.gl,w,function(){ArrayBuffer.isView(T)&&o.gl.texImage3D(o.target,u,f,c,p,v,g,y,b,T),T instanceof be&&(o.gl.bindBuffer(35052,T.handle),o.gl.texImage3D(o.target,u,f,c,p,v,g,y,b,A))}),T&&T.byteLength)this._trackAllocatedMemory(T.byteLength,"Texture");else{var E=ov[this.dataFormat]||4,S=sv[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*E*S,"Texture")}return this.loaded=!0,this}}],[{key:"isSupported",value:function(a){return fe(a)}}]),n}(nn,Symbol.toStringTag);var Lc=h(B()),OB=h(ye()),EB=h(L()),CB=h(N()),MB=h(_e()),IB=h(Oe()),RB=h(Y()),LB=h(K()),fv=h(q());var lB=h(L()),fB=h(N()),cB=h(_e()),pB=h(Y()),hB=h(K()),wx=h(q());var De=h(B()),ke,Qo="EXT_color_buffer_float",Px=(ke={},(0,De.default)(ke,33189,{bpp:2}),(0,De.default)(ke,33190,{gl2:!0,bpp:3}),(0,De.default)(ke,36012,{gl2:!0,bpp:4}),(0,De.default)(ke,36168,{bpp:1}),(0,De.default)(ke,34041,{bpp:4}),(0,De.default)(ke,35056,{gl2:!0,bpp:4}),(0,De.default)(ke,36013,{gl2:!0,bpp:5}),(0,De.default)(ke,32854,{bpp:2}),(0,De.default)(ke,36194,{bpp:2}),(0,De.default)(ke,32855,{bpp:2}),(0,De.default)(ke,33321,{gl2:!0,bpp:1}),(0,De.default)(ke,33330,{gl2:!0,bpp:1}),(0,De.default)(ke,33329,{gl2:!0,bpp:1}),(0,De.default)(ke,33332,{gl2:!0,bpp:2}),(0,De.default)(ke,33331,{gl2:!0,bpp:2}),(0,De.default)(ke,33334,{gl2:!0,bpp:4}),(0,De.default)(ke,33333,{gl2:!0,bpp:4}),(0,De.default)(ke,33323,{gl2:!0,bpp:2}),(0,De.default)(ke,33336,{gl2:!0,bpp:2}),(0,De.default)(ke,33335,{gl2:!0,bpp:2}),(0,De.default)(ke,33338,{gl2:!0,bpp:4}),(0,De.default)(ke,33337,{gl2:!0,bpp:4}),(0,De.default)(ke,33340,{gl2:!0,bpp:8}),(0,De.default)(ke,33339,{gl2:!0,bpp:8}),(0,De.default)(ke,32849,{gl2:!0,bpp:3}),(0,De.default)(ke,32856,{gl2:!0,bpp:4}),(0,De.default)(ke,32857,{gl2:!0,bpp:4}),(0,De.default)(ke,36220,{gl2:!0,bpp:4}),(0,De.default)(ke,36238,{gl2:!0,bpp:4}),(0,De.default)(ke,36975,{gl2:!0,bpp:4}),(0,De.default)(ke,36214,{gl2:!0,bpp:8}),(0,De.default)(ke,36232,{gl2:!0,bpp:8}),(0,De.default)(ke,36226,{gl2:!0,bpp:16}),(0,De.default)(ke,36208,{gl2:!0,bpp:16}),(0,De.default)(ke,33325,{gl2:Qo,bpp:2}),(0,De.default)(ke,33327,{gl2:Qo,bpp:4}),(0,De.default)(ke,34842,{gl2:Qo,bpp:8}),(0,De.default)(ke,33326,{gl2:Qo,bpp:4}),(0,De.default)(ke,33328,{gl2:Qo,bpp:8}),(0,De.default)(ke,34836,{gl2:Qo,bpp:16}),(0,De.default)(ke,35898,{gl2:Qo,bpp:4}),ke);function she(t){var r=uhe();return function(){var n=(0,wx.default)(t),i;if(r){var a=(0,wx.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,hB.default)(this,i)}}function uhe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function lhe(t,r,e){var n=e[r];if(!n)return!1;var i=fe(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}var Rr=function(t,r){(0,pB.default)(n,t);var e=she(n);function n(i){var a;(0,lB.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.initialize(o),Object.seal((0,cB.default)(a)),a}return(0,fB.default)(n,[{key:r,get:function(){return"Renderbuffer"}},{key:"initialize",value:function(a){var o=a.format,s=a.width,u=s===void 0?1:s,l=a.height,f=l===void 0?1:l,c=a.samples,p=c===void 0?0:c;return J(o,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),p!==0&&fe(this.gl)?this.gl.renderbufferStorageMultisample(36161,p,o,u,f):this.gl.renderbufferStorage(36161,o,u,f),this.format=o,this.width=u,this.height=f,this.samples=p,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Px[this.format].bpp),this}},{key:"resize",value:function(a){var o=a.width,s=a.height;return o!==this.width||s!==this.height?this.initialize({width:o,height:s,format:this.format,samples:this.samples}):this}},{key:"_createHandle",value:function(){return this.gl.createRenderbuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_bindHandle",value:function(a){this.gl.bindRenderbuffer(36161,a)}},{key:"_syncHandle",value:function(a){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}},{key:"_getParameter",value:function(a){this.gl.bindRenderbuffer(36161,this.handle);var o=this.gl.getRenderbufferParameter(36161,a);return o}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null},s=o.format;return!s||lhe(a,s,Px)}},{key:"getSamplesForFormat",value:function(a,o){var s=o.format;return a.getInternalformatParameter(36161,s,32937)}}]),n}(ur,Symbol.toStringTag);var yB=h(ye());var fhe=256,che=1024,phe=16384,dB=6144,vB=6145,mB=6146,gB=34041,_B="clear: bad arguments";function yn(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.framebuffer,n=e===void 0?null:e,i=r.color,a=i===void 0?null:i,o=r.depth,s=o===void 0?null:o,u=r.stencil,l=u===void 0?null:u,f={};n&&(f.framebuffer=n);var c=0;a&&(c|=phe,a!==!0&&(f.clearColor=a)),s&&(c|=fhe,s!==!0&&(f.clearDepth=s)),l&&(c|=che,s!==!0&&(f.clearStencil=s)),J(c!==0,_B),Ie(t,f,function(){t.clear(c)})}function Ox(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.framebuffer,n=e===void 0?null:e,i=r.buffer,a=i===void 0?dB:i,o=r.drawBuffer,s=o===void 0?0:o,u=r.value,l=u===void 0?[0,0,0,0]:u;mt(t),Ie(t,{framebuffer:n},function(){switch(a){case dB:switch(l.constructor){case Int32Array:t.clearBufferiv(a,s,l);break;case Uint32Array:t.clearBufferuiv(a,s,l);break;case Float32Array:default:t.clearBufferfv(a,s,l)}break;case vB:t.clearBufferfv(vB,0,[l]);break;case mB:t.clearBufferiv(mB,0,[l]);break;case gB:var f=(0,yB.default)(l,2),c=f[0],p=f[1];t.clearBufferfi(gB,0,c,p);break;default:J(!1,_B)}})}function Ex(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return J(!1),0}}function bB(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return J(!1),0}}function Wn(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.sourceX,n=e===void 0?0:e,i=r.sourceY,a=i===void 0?0:i,o=r.sourceFormat,s=o===void 0?6408:o,u=r.sourceAttachment,l=u===void 0?36064:u,f=r.target,c=f===void 0?null:f,p=r.sourceWidth,d=r.sourceHeight,v=r.sourceType,m=Cx(t),g=m.framebuffer,y=m.deleteFramebuffer;J(g);var _=g.gl,b=g.handle,x=g.attachments;p=p||g.width,d=d||g.height,l===36064&&b===null&&(l=1028),J(x[l]),v=v||x[l].type,c=hhe(c,v,s,p,d),v=v||Ic(c);var A=_.bindFramebuffer(36160,b);return _.readPixels(n,a,p,d,s,v,c),_.bindFramebuffer(36160,A||null),y&&g.delete(),c}function ta(t,r){var e=r.sourceX,n=e===void 0?0:e,i=r.sourceY,a=i===void 0?0:i,o=r.sourceFormat,s=o===void 0?6408:o,u=r.target,l=u===void 0?null:u,f=r.targetByteOffset,c=f===void 0?0:f,p=r.sourceWidth,d=r.sourceHeight,v=r.sourceType,m=Cx(t),g=m.framebuffer,y=m.deleteFramebuffer;J(g),p=p||g.width,d=d||g.height;var _=mt(g.gl);if(v=v||(l?l.type:5121),!l){var b=Ex(s),x=bB(v),A=c+p*d*b*x;l=new be(_,{byteLength:A,accessor:{type:v,size:b}})}return l.bind({target:35051}),Ie(_,{framebuffer:g},function(){_.readPixels(n,a,p,d,s,v,c)}),l.unbind({target:35051}),y&&g.delete(),l}function uv(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.sourceAttachment,n=e===void 0?36064:e,i=r.targetMaxHeight,a=i===void 0?Number.MAX_SAFE_INTEGER:i,o=Wn(t,{sourceAttachment:n}),s=t.width,u=t.height;u>a;){var l=wk({data:o,width:s,height:u});o=l.data,s=l.width,u=l.height}Pk({data:o,width:s,height:u});var f=document.createElement("canvas");f.width=s,f.height=u;var c=f.getContext("2d"),p=c.createImageData(s,u);return p.data.set(o),c.putImageData(p,0,0),f.toDataURL()}function ku(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=e.sourceX,i=n===void 0?0:n,a=e.sourceY,o=a===void 0?0:a,s=e.targetMipmaplevel,u=s===void 0?0:s,l=e.targetInternalFormat,f=l===void 0?6408:l,c=e.targetX,p=e.targetY,d=e.targetZ,v=e.width,m=e.height,g=Cx(t),y=g.framebuffer,_=g.deleteFramebuffer;J(y);var b=y.gl,x=y.handle,A=typeof c<"u"||typeof p<"u"||typeof d<"u";c=c||0,p=p||0,d=d||0;var T=b.bindFramebuffer(36160,x);J(r);var O=null;if(r instanceof nn&&(O=r,v=Number.isFinite(v)?v:O.width,m=Number.isFinite(m)?m:O.height,O.bind(0),r=O.target),!A)b.copyTexImage2D(r,u,f,i,o,v,m,0);else switch(r){case 3553:case 34067:b.copyTexSubImage2D(r,u,c,p,i,o,v,m);break;case 35866:case 32879:var w=mt(b);w.copyTexSubImage3D(r,u,c,p,d,i,o,v,m);break;default:}return O&&O.unbind(),b.bindFramebuffer(36160,T||null),_&&y.delete(),O}function Cx(t){return t instanceof Me?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:xB(t),deleteFramebuffer:!0}}function hhe(t,r,e,n,i){if(t)return t;r=r||5121;var a=Xa(r,{clamped:!1}),o=Ex(e);return new a(n*i*o)}var Et=h(B());var Ot,Ae={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function dhe(t){var r=new Se(t,{format:6408,type:5126,dataFormat:6408}),e=new Me(t,{id:"test-framebuffer",check:!1,attachments:(0,Et.default)({},36064,r)}),n=e.getStatus();return r.delete(),e.delete(),n===36053}var Mx=(Ot={},(0,Et.default)(Ot,Ae.WEBGL2,[!1,!0]),(0,Et.default)(Ot,Ae.VERTEX_ARRAY_OBJECT,["OES_vertex_array_object",!0]),(0,Et.default)(Ot,Ae.TIMER_QUERY,["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"]),(0,Et.default)(Ot,Ae.INSTANCED_RENDERING,["ANGLE_instanced_arrays",!0]),(0,Et.default)(Ot,Ae.MULTIPLE_RENDER_TARGETS,["WEBGL_draw_buffers",!0]),(0,Et.default)(Ot,Ae.ELEMENT_INDEX_UINT32,["OES_element_index_uint",!0]),(0,Et.default)(Ot,Ae.BLEND_EQUATION_MINMAX,["EXT_blend_minmax",!0]),(0,Et.default)(Ot,Ae.FLOAT_BLEND,["EXT_float_blend"]),(0,Et.default)(Ot,Ae.COLOR_ENCODING_SRGB,["EXT_sRGB",!0]),(0,Et.default)(Ot,Ae.TEXTURE_DEPTH,["WEBGL_depth_texture",!0]),(0,Et.default)(Ot,Ae.TEXTURE_FLOAT,["OES_texture_float",!0]),(0,Et.default)(Ot,Ae.TEXTURE_HALF_FLOAT,["OES_texture_half_float",!0]),(0,Et.default)(Ot,Ae.TEXTURE_FILTER_LINEAR_FLOAT,["OES_texture_float_linear"]),(0,Et.default)(Ot,Ae.TEXTURE_FILTER_LINEAR_HALF_FLOAT,["OES_texture_half_float_linear"]),(0,Et.default)(Ot,Ae.TEXTURE_FILTER_ANISOTROPIC,["EXT_texture_filter_anisotropic"]),(0,Et.default)(Ot,Ae.COLOR_ATTACHMENT_RGBA32F,[dhe,"EXT_color_buffer_float"]),(0,Et.default)(Ot,Ae.COLOR_ATTACHMENT_FLOAT,[!1,"EXT_color_buffer_float"]),(0,Et.default)(Ot,Ae.COLOR_ATTACHMENT_HALF_FLOAT,["EXT_color_buffer_half_float"]),(0,Et.default)(Ot,Ae.GLSL_FRAG_DATA,["WEBGL_draw_buffers",!0]),(0,Et.default)(Ot,Ae.GLSL_FRAG_DEPTH,["EXT_frag_depth",!0]),(0,Et.default)(Ot,Ae.GLSL_DERIVATIVES,["OES_standard_derivatives",!0]),(0,Et.default)(Ot,Ae.GLSL_TEXTURE_LOD,["EXT_shader_texture_lod",!0]),Ot);function vhe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=mhe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function mhe(t,r){if(t){if(typeof t=="string")return AB(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return AB(t,r)}}function AB(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var ghe=2;function $n(t,r){return lr(t,r)}function lr(t,r){return r=Array.isArray(r)?r:[r],r.every(function(e){return TB(t,e)})}function lv(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(var r in Mx)t.luma.caps[r]===void 0&&(t.luma.caps[r]=TB(t,r));return t.luma.caps}function TB(t,r){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[r]===void 0&&(t.luma.caps[r]=yhe(t,r)),t.luma.caps[r]||re.log(ghe,"Feature: ".concat(r," not supported"))(),t.luma.caps[r]}function yhe(t,r){var e=Mx[r];J(e,r);var n,i=fe(t)&&e[1]||e[0];if(typeof i=="function")n=i(t);else if(Array.isArray(i)){n=!0;var a=vhe(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n=n&&Boolean(t.getExtension(s))}}catch(u){a.e(u)}finally{a.f()}}else typeof i=="string"?n=Boolean(t.getExtension(i)):typeof i=="boolean"?n=i:J(!1);return n}function SB(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=_he(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function _he(t,r){if(t){if(typeof t=="string")return PB(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return PB(t,r)}}function PB(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function bhe(t){var r=xhe();return function(){var n=(0,fv.default)(t),i;if(r){var a=(0,fv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,LB.default)(this,i)}}function xhe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var wB="Multiple render targets not supported",Me=function(t,r){(0,RB.default)(n,t);var e=bhe(n);function n(i){var a;(0,EB.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.width=null,a.height=null,a.attachments={},a.readBuffer=36064,a.drawBuffers=[36064],a.ownResources=[],a.initialize(o),Object.seal((0,MB.default)(a)),a}return(0,CB.default)(n,[{key:r,get:function(){return"Framebuffer"}},{key:"MAX_COLOR_ATTACHMENTS",get:function(){var a=mt(this.gl);return a.getParameter(a.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){var a=mt(this.gl);return a.getParameter(a.MAX_DRAW_BUFFERS)}},{key:"color",get:function(){return this.attachments[36064]||null}},{key:"texture",get:function(){return this.attachments[36064]||null}},{key:"depth",get:function(){return this.attachments[36096]||this.attachments[33306]||null}},{key:"stencil",get:function(){return this.attachments[36128]||this.attachments[33306]||null}},{key:"initialize",value:function(a){var o=a.width,s=o===void 0?1:o,u=a.height,l=u===void 0?1:u,f=a.attachments,c=f===void 0?null:f,p=a.color,d=p===void 0?!0:p,v=a.depth,m=v===void 0?!0:v,g=a.stencil,y=g===void 0?!1:g,_=a.check,b=_===void 0?!0:_,x=a.readBuffer,A=x===void 0?void 0:x,T=a.drawBuffers,O=T===void 0?void 0:T;if(J(s>=0&&l>=0,"Width and height need to be integers"),this.width=s,this.height=l,c)for(var w in c){var E=c[w],S=Array.isArray(E)?E[0]:E;S.resize({width:s,height:l})}else c=this._createDefaultAttachments(d,m,y,s,l);this.update({clearAttachments:!0,attachments:c,readBuffer:A,drawBuffers:O}),c&&b&&this.checkStatus()}},{key:"delete",value:function(){var a=SB(this.ownResources),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.delete()}}catch(u){a.e(u)}finally{a.f()}return(0,IB.default)((0,fv.default)(n.prototype),"delete",this).call(this),this}},{key:"update",value:function(a){var o=a.attachments,s=o===void 0?{}:o,u=a.readBuffer,l=a.drawBuffers,f=a.clearAttachments,c=f===void 0?!1:f,p=a.resizeAttachments,d=p===void 0?!0:p;this.attach(s,{clearAttachments:c,resizeAttachments:d});var v=this.gl,m=v.bindFramebuffer(36160,this.handle);return u&&this._setReadBuffer(u),l&&this._setDrawBuffers(l),v.bindFramebuffer(36160,m||null),this}},{key:"resize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.width,s=a.height;if(this.handle===null)return J(o===void 0&&s===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;o===void 0&&(o=this.gl.drawingBufferWidth),s===void 0&&(s=this.gl.drawingBufferHeight),o!==this.width&&s!==this.height&&re.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(o,"x").concat(s))();for(var u in this.attachments)this.attachments[u].resize({width:o,height:s});return this.width=o,this.height=s,this}},{key:"attach",value:function(a){var o=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=s.clearAttachments,l=u===void 0?!1:u,f=s.resizeAttachments,c=f===void 0?!0:f,p={};l&&Object.keys(this.attachments).forEach(function(w){p[w]=null}),Object.assign(p,a);var d=this.gl.bindFramebuffer(36160,this.handle);for(var v in p){J(v!==void 0,"Misspelled framebuffer binding point?");var m=Number(v),g=p[m],y=g;if(!y)this._unattach(m);else if(y instanceof Rr)this._attachRenderbuffer({attachment:m,renderbuffer:y});else if(Array.isArray(g)){var _=(0,OB.default)(g,3),b=_[0],x=_[1],A=x===void 0?0:x,T=_[2],O=T===void 0?0:T;y=b,this._attachTexture({attachment:m,texture:b,layer:A,level:O})}else this._attachTexture({attachment:m,texture:y,layer:0,level:0});c&&y&&y.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,d||null),Object.assign(this.attachments,a),Object.keys(this.attachments).filter(function(w){return!o.attachments[w]}).forEach(function(w){delete o.attachments[w]})}},{key:"checkStatus",value:function(){var a=this.gl,o=this.getStatus();if(o!==36053)throw new Error(The(o));return this}},{key:"getStatus",value:function(){var a=this.gl,o=a.bindFramebuffer(36160,this.handle),s=a.checkFramebufferStatus(36160);return a.bindFramebuffer(36160,o||null),s}},{key:"clear",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=o.color,u=o.depth,l=o.stencil,f=o.drawBuffers,c=f===void 0?[]:f,p=this.gl.bindFramebuffer(36160,this.handle);return(s||u||l)&&yn(this.gl,{color:s,depth:u,stencil:l}),c.forEach(function(d,v){Ox(a.gl,{drawBuffer:v,value:d})}),this.gl.bindFramebuffer(36160,p||null),this}},{key:"readPixels",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return re.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}},{key:"readPixelsToBuffer",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return re.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}},{key:"copyToDataUrl",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return re.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}},{key:"copyToImage",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return re.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}},{key:"copyToTexture",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return re.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"blit",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return re.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}},{key:"invalidate",value:function(a){var o=a.attachments,s=o===void 0?[]:o,u=a.x,l=u===void 0?0:u,f=a.y,c=f===void 0?0:f,p=a.width,d=a.height,v=mt(this.gl),m=v.bindFramebuffer(36008,this.handle),g=l===0&&c===0&&p===void 0&&d===void 0;return g?v.invalidateFramebuffer(36008,s):v.invalidateFramebuffer(36008,s,l,c,p,d),v.bindFramebuffer(36008,m),this}},{key:"getAttachmentParameter",value:function(a,o,s){var u=this._getAttachmentParameterFallback(o);return u===null&&(this.gl.bindFramebuffer(36160,this.handle),u=this.gl.getFramebufferAttachmentParameter(36160,a,o),this.gl.bindFramebuffer(36160,null)),s&&u>1e3&&(u=gn(this.gl,u)),u}},{key:"getAttachmentParameters",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,o=arguments.length>1?arguments[1]:void 0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[],u={},l=SB(s),f;try{for(l.s();!(f=l.n()).done;){var c=f.value,p=o?gn(this.gl,c):c;u[p]=this.getAttachmentParameter(a,c,o)}}catch(d){l.e(d)}finally{l.f()}return u}},{key:"getParameters",value:function(){for(var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,o=Object.keys(this.attachments),s={},u=0,l=o;u<l.length;u++){var f=l[u],c=Number(f),p=a?gn(this.gl,c):c;s[p]=this.getAttachmentParameters(c,a)}return s}},{key:"show",value:function(){return typeof window<"u"&&window.open(uv(this),"luma-debug-texture"),this}},{key:"log",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(a>re.level||typeof window>"u")return this;o=o||"Framebuffer ".concat(this.id);var s=uv(this,{targetMaxHeight:100});return re.image({logLevel:a,message:o,image:s},o)(),this}},{key:"bind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?36160:o;return this.gl.bindFramebuffer(s,this.handle),this}},{key:"unbind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?36160:o;return this.gl.bindFramebuffer(s,null),this}},{key:"_createDefaultAttachments",value:function(a,o,s,u,l){var f=null;if(a){var c;f=f||{},f[36064]=new Se(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:u,height:l,mipmaps:!1,parameters:(c={},(0,Lc.default)(c,10241,9729),(0,Lc.default)(c,10240,9729),(0,Lc.default)(c,10242,33071),(0,Lc.default)(c,10243,33071),c)}),this.ownResources.push(f[36064])}return o&&s?(f=f||{},f[33306]=new Rr(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:u,height:111}),this.ownResources.push(f[33306])):o?(f=f||{},f[36096]=new Rr(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:u,height:l}),this.ownResources.push(f[36096])):s&&J(!1),f}},{key:"_unattach",value:function(a){var o=this.attachments[a];o&&(o instanceof Rr?this.gl.framebufferRenderbuffer(36160,a,36161,null):this.gl.framebufferTexture2D(36160,a,3553,null,0),delete this.attachments[a])}},{key:"_attachRenderbuffer",value:function(a){var o=a.attachment,s=o===void 0?36064:o,u=a.renderbuffer,l=this.gl;l.framebufferRenderbuffer(36160,s,36161,u.handle),this.attachments[s]=u}},{key:"_attachTexture",value:function(a){var o=a.attachment,s=o===void 0?36064:o,u=a.texture,l=a.layer,f=a.level,c=this.gl;switch(c.bindTexture(u.target,u.handle),u.target){case 35866:case 32879:var p=mt(c);p.framebufferTextureLayer(36160,s,u.target,f,l);break;case 34067:var d=Ahe(l);c.framebufferTexture2D(36160,s,d,u.handle,f);break;case 3553:c.framebufferTexture2D(36160,s,3553,u.handle,f);break;default:J(!1,"Illegal texture type")}c.bindTexture(u.target,null),this.attachments[s]=u}},{key:"_setReadBuffer",value:function(a){var o=ax(this.gl);o?o.readBuffer(a):J(a===36064||a===1029,wB),this.readBuffer=a}},{key:"_setDrawBuffers",value:function(a){var o=this.gl,s=mt(o);if(s)s.drawBuffers(a);else{var u=o.getExtension("WEBGL_draw_buffers");u?u.drawBuffersWEBGL(a):J(a.length===1&&(a[0]===36064||a[0]===1029),wB)}this.drawBuffers=a}},{key:"_getAttachmentParameterFallback",value:function(a){var o=lv(this.gl);switch(a){case 36052:return o.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return o.WEBGL2?null:8;case 33297:return o.WEBGL2?null:5125;case 33296:return!o.WEBGL2&&!o.EXT_sRGB?9729:null;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"_bindHandle",value:function(a){return this.gl.bindFramebuffer(36160,a)}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.colorBufferFloat,u=o.colorBufferHalfFloat,l=!0;return s&&(l=Boolean(a.getExtension("EXT_color_buffer_float")||a.getExtension("WEBGL_color_buffer_float")||a.getExtension("OES_texture_float"))),u&&(l=l&&Boolean(a.getExtension("EXT_color_buffer_float")||a.getExtension("EXT_color_buffer_half_float"))),l}},{key:"getDefaultFramebuffer",value:function(a){return a.luma=a.luma||{},a.luma.defaultFramebuffer=a.luma.defaultFramebuffer||new n(a,{id:"default-framebuffer",handle:null,attachments:{}}),a.luma.defaultFramebuffer}}]),n}(ur,Symbol.toStringTag);function Ahe(t){return t<34069?t+34069:t}function The(t){var r=Me.STATUS||{};return r[t]||"Framebuffer error ".concat(t)}var She=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Me.ATTACHMENT_PARAMETERS=She;function Bu(t,r){J(t instanceof Se||t instanceof Zo||t instanceof Lu);var e=t.constructor,n=t.gl,i=t.width,a=t.height,o=t.format,s=t.type,u=t.dataFormat,l=t.border,f=t.mipmaps,c=Object.assign({width:i,height:a,format:o,type:s,dataFormat:u,border:l,mipmaps:f},r);return new e(n,c)}function xB(t,r){var e=t.gl,n=t.width,i=t.height,a=t.id,o=new Me(e,Object.assign({},r,{id:"framebuffer-for-".concat(a),width:n,height:i,attachments:(0,kB.default)({},36064,t)}));return o}var cv=h(L()),pv=h(N()),hv=h(Y()),DB=h(K()),Lx=h(q());function qa(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed",e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,n=t.match(e);return n?n[1]:r}var Phe=35632,whe=35633;function Ix(t){switch(t){case Phe:return"fragment";case whe:return"vertex";default:return"unknown type"}}function Rx(t,r,e,n){for(var i=t.split(/\r?\n/),a={},o={},s=n||qa(r)||"(unnamed)",u="".concat(Ix(e)," shader ").concat(s),l=0;l<i.length;l++){var f=i[l];if(!(f.length<=1)){var c=f.split(":"),p=c[0],d=parseInt(c[2],10);if(isNaN(d))throw new Error("GLSL compilation error in ".concat(u,": ").concat(t));p!=="WARNING"?a[d]=f:o[d]=f}}var v=Ohe(r);return{shaderName:u,errors:BB(a,v),warnings:BB(o,v)}}function BB(t,r){for(var e="",n=0;n<r.length;n++){var i=r[n];if(!(!t[n+3]&&!t[n+2]&&!t[n+1])&&(e+="".concat(i,`
`),t[n+1])){var a=t[n+1],o=a.split(":",3),s=o[0],u=parseInt(o[1],10)||0,l=a.substring(o.join(":").length+1).trim();e+=FB("^^^ ".concat(s,": ").concat(l,`

`),u)}}return e}function Ohe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ",n=t.split(/\r?\n/),i=String(n.length+r-1).length;return n.map(function(a,o){var s=String(o+r),u=s.length,l=FB(s,i-u);return l+e+a})}function FB(t,r){for(var e="",n=0;n<r;++n)e+=" ";return"".concat(e).concat(t)}function Fu(t){var r=100,e=t.match(/[^\s]+/g);if(e.length>=2&&e[0]==="#version"){var n=parseInt(e[1],10);Number.isFinite(n)&&(r=n)}return r}function kx(t){var r=Ehe();return function(){var n=(0,Lx.default)(t),i;if(r){var a=(0,Lx.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,DB.default)(this,i)}}function Ehe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Che="Shader: GLSL source code must be a JavaScript string",NB=function(t,r){(0,hv.default)(n,t);var e=kx(n);function n(i,a){var o;(0,cv.default)(this,n),Qi(i),J(typeof a.source=="string",Che);var s=qa(a.source,null)||a.id||Xe("unnamed ".concat(n.getTypeName(a.shaderType)));return o=e.call(this,i,{id:s}),o.shaderType=a.shaderType,o.source=a.source,o.initialize(a),o}return(0,pv.default)(n,[{key:r,get:function(){return"Shader"}},{key:"initialize",value:function(a){var o=a.source,s=qa(o,null);s&&(this.id=Xe(s)),this._compile(o)}},{key:"getParameter",value:function(a){return this.gl.getShaderParameter(this.handle,a)}},{key:"toString",value:function(){return"".concat(n.getTypeName(this.shaderType),":").concat(this.id)}},{key:"getName",value:function(){return qa(this.source)||"unnamed-shader"}},{key:"getSource",value:function(){return this.gl.getShaderSource(this.handle)}},{key:"getTranslatedSource",value:function(){var a=this.gl.getExtension("WEBGL_debug_shaders");return a?a.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}},{key:"_compile",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;a.startsWith("#version ")||(a=`#version 100
`.concat(a)),this.source=a,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle);var o=this.getParameter(35713);if(!o){var s=this.gl.getShaderInfoLog(this.handle),u=Rx(s,this.source,this.shaderType,this.id),l=u.shaderName,f=u.errors,c=u.warnings;throw re.error("GLSL compilation errors in ".concat(l,`
`).concat(f))(),re.warn("GLSL compilation warnings in ".concat(l,`
`).concat(c))(),new Error("GLSL compilation errors in ".concat(l))}}},{key:"_deleteHandle",value:function(){this.gl.deleteShader(this.handle)}},{key:"_getOptsFromHandle",value:function(){return{type:this.getParameter(35663),source:this.getSource()}}}],[{key:"getTypeName",value:function(a){switch(a){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return J(!1),"unknown"}}}]),n}(ur,Symbol.toStringTag),kc=function(t,r){(0,hv.default)(n,t);var e=kx(n);function n(i,a){return(0,cv.default)(this,n),typeof a=="string"&&(a={source:a}),e.call(this,i,Object.assign({},a,{shaderType:35633}))}return(0,pv.default)(n,[{key:r,get:function(){return"VertexShader"}},{key:"_createHandle",value:function(){return this.gl.createShader(35633)}}]),n}(NB,Symbol.toStringTag),Bc=function(t,r){(0,hv.default)(n,t);var e=kx(n);function n(i,a){return(0,cv.default)(this,n),typeof a=="string"&&(a={source:a}),e.call(this,i,Object.assign({},a,{shaderType:35632}))}return(0,pv.default)(n,[{key:r,get:function(){return"FragmentShader"}},{key:"_createHandle",value:function(){return this.gl.createShader(35632)}}]),n}(NB,Symbol.toStringTag);var KB=h(L()),JB=h(N()),ZB=h(_e()),QB=h(Oe()),e3=h(Y()),t3=h(K()),yv=h(q());var Be=h(B());var Re,Mhe=(Re={},(0,Be.default)(Re,5126,xt.bind(null,"uniform1fv",an,1,br)),(0,Be.default)(Re,35664,xt.bind(null,"uniform2fv",an,2,br)),(0,Be.default)(Re,35665,xt.bind(null,"uniform3fv",an,3,br)),(0,Be.default)(Re,35666,xt.bind(null,"uniform4fv",an,4,br)),(0,Be.default)(Re,5124,xt.bind(null,"uniform1iv",Ya,1,br)),(0,Be.default)(Re,35667,xt.bind(null,"uniform2iv",Ya,2,br)),(0,Be.default)(Re,35668,xt.bind(null,"uniform3iv",Ya,3,br)),(0,Be.default)(Re,35669,xt.bind(null,"uniform4iv",Ya,4,br)),(0,Be.default)(Re,35670,xt.bind(null,"uniform1iv",Ya,1,br)),(0,Be.default)(Re,35671,xt.bind(null,"uniform2iv",Ya,2,br)),(0,Be.default)(Re,35672,xt.bind(null,"uniform3iv",Ya,3,br)),(0,Be.default)(Re,35673,xt.bind(null,"uniform4iv",Ya,4,br)),(0,Be.default)(Re,35674,xt.bind(null,"uniformMatrix2fv",an,4,ra)),(0,Be.default)(Re,35675,xt.bind(null,"uniformMatrix3fv",an,9,ra)),(0,Be.default)(Re,35676,xt.bind(null,"uniformMatrix4fv",an,16,ra)),(0,Be.default)(Re,35678,mr),(0,Be.default)(Re,35680,mr),(0,Be.default)(Re,5125,xt.bind(null,"uniform1uiv",dv,1,br)),(0,Be.default)(Re,36294,xt.bind(null,"uniform2uiv",dv,2,br)),(0,Be.default)(Re,36295,xt.bind(null,"uniform3uiv",dv,3,br)),(0,Be.default)(Re,36296,xt.bind(null,"uniform4uiv",dv,4,br)),(0,Be.default)(Re,35685,xt.bind(null,"uniformMatrix2x3fv",an,6,ra)),(0,Be.default)(Re,35686,xt.bind(null,"uniformMatrix2x4fv",an,8,ra)),(0,Be.default)(Re,35687,xt.bind(null,"uniformMatrix3x2fv",an,6,ra)),(0,Be.default)(Re,35688,xt.bind(null,"uniformMatrix3x4fv",an,12,ra)),(0,Be.default)(Re,35689,xt.bind(null,"uniformMatrix4x2fv",an,8,ra)),(0,Be.default)(Re,35690,xt.bind(null,"uniformMatrix4x3fv",an,12,ra)),(0,Be.default)(Re,35678,mr),(0,Be.default)(Re,35680,mr),(0,Be.default)(Re,35679,mr),(0,Be.default)(Re,35682,mr),(0,Be.default)(Re,36289,mr),(0,Be.default)(Re,36292,mr),(0,Be.default)(Re,36293,mr),(0,Be.default)(Re,36298,mr),(0,Be.default)(Re,36299,mr),(0,Be.default)(Re,36300,mr),(0,Be.default)(Re,36303,mr),(0,Be.default)(Re,36306,mr),(0,Be.default)(Re,36307,mr),(0,Be.default)(Re,36308,mr),(0,Be.default)(Re,36311,mr),Re),Ihe={},Rhe={},Lhe={},jB=[0];function Bx(t,r,e,n){r===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(jB[0]=t,t=jB);var i=t.length;if(i%r&&re.warn("Uniform size should be multiples of ".concat(r),t)(),t instanceof e)return t;var a=n[i];a||(a=new e(i),n[i]=a);for(var o=0;o<i;o++)a[o]=t[o];return a}function an(t,r){return Bx(t,r,Float32Array,Ihe)}function Ya(t,r){return Bx(t,r,Int32Array,Rhe)}function dv(t,r){return Bx(t,r,Uint32Array,Lhe)}function Fx(t,r,e){var n=Mhe[e.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(e.type));return n().bind(null,t,r)}function UB(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};var r=/([^[]*)(\[[0-9]+\])?/,e=t.match(r);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function GB(t,r,e){for(var n in t){var i=t[n],a=!e||Boolean(e[n]);if(a&&!khe(i))throw r=r?"".concat(r," "):"",console.error("".concat(r," Bad uniform ").concat(n),i),new Error("".concat(r," Bad uniform ").concat(n))}return!0}function khe(t){return Array.isArray(t)||ArrayBuffer.isView(t)?Bhe(t):isFinite(t)||t===!0||t===!1||t instanceof nn||t instanceof Rr?!0:t instanceof Me?Boolean(t.texture):!1}function zB(t,r,e){if(Array.isArray(e)||ArrayBuffer.isView(e))if(t[r])for(var n=t[r],i=0,a=e.length;i<a;++i)n[i]=e[i];else t[r]=e.slice();else t[r]=e}function Bhe(t){if(t.length===0)return!1;for(var r=Math.min(t.length,16),e=0;e<r;++e)if(!Number.isFinite(t[e]))return!1;return!0}function mr(){var t=null;return function(r,e,n){var i=t!==n;return i&&(r.uniform1i(e,n),t=n),i}}function xt(t,r,e,n){var i=null,a=null;return function(o,s,u){var l=r(u,e),f=l.length,c=!1;if(i===null)i=new Float32Array(f),a=f,c=!0;else{J(a===f,"Uniform length cannot change.");for(var p=0;p<f;++p)if(l[p]!==i[p]){c=!0;break}}return c&&(n(o,t,s,l),i.set(l)),c}}function br(t,r,e,n){t[r](e,n)}function ra(t,r,e,n){t[r](e,!1,n)}var WB=h(L()),$B=h(N());var Nx=h(ye()),yt=h(B());var ct,Fhe=5120,Dhe=5121,Nhe=5122,jhe=5123,VB=0,vv=1,Uhe=2,Ghe=3,mv=4,zhe=5,Vhe=6,er=5126,Hhe=35664,Whe=35665,$he=35666,Fc=5124,Xhe=35667,qhe=35668,Yhe=35669,Dc=5125,Khe=36294,Jhe=36295,Zhe=36296,Qhe=35670,ede=35671,tde=35672,rde=35673,nde=35674,ide=35675,ade=35676,ode=35685,sde=35686,ude=35687,lde=35688,fde=35689,cde=35690,Dx=(ct={},(0,yt.default)(ct,er,[er,1,"float"]),(0,yt.default)(ct,Hhe,[er,2,"vec2"]),(0,yt.default)(ct,Whe,[er,3,"vec3"]),(0,yt.default)(ct,$he,[er,4,"vec4"]),(0,yt.default)(ct,Fc,[Fc,1,"int"]),(0,yt.default)(ct,Xhe,[Fc,2,"ivec2"]),(0,yt.default)(ct,qhe,[Fc,3,"ivec3"]),(0,yt.default)(ct,Yhe,[Fc,4,"ivec4"]),(0,yt.default)(ct,Dc,[Dc,1,"uint"]),(0,yt.default)(ct,Khe,[Dc,2,"uvec2"]),(0,yt.default)(ct,Jhe,[Dc,3,"uvec3"]),(0,yt.default)(ct,Zhe,[Dc,4,"uvec4"]),(0,yt.default)(ct,Qhe,[er,1,"bool"]),(0,yt.default)(ct,ede,[er,2,"bvec2"]),(0,yt.default)(ct,tde,[er,3,"bvec3"]),(0,yt.default)(ct,rde,[er,4,"bvec4"]),(0,yt.default)(ct,nde,[er,8,"mat2"]),(0,yt.default)(ct,ode,[er,8,"mat2x3"]),(0,yt.default)(ct,sde,[er,8,"mat2x4"]),(0,yt.default)(ct,ide,[er,12,"mat3"]),(0,yt.default)(ct,ude,[er,12,"mat3x2"]),(0,yt.default)(ct,lde,[er,12,"mat3x4"]),(0,yt.default)(ct,ade,[er,16,"mat4"]),(0,yt.default)(ct,fde,[er,16,"mat4x2"]),(0,yt.default)(ct,cde,[er,16,"mat4x3"]),ct);function HB(t){switch(t){case VB:return VB;case vv:return vv;case Ghe:return vv;case Uhe:return vv;case mv:return mv;case zhe:return mv;case Vhe:return mv;default:return J(!1),0}}function jx(t){var r=Dx[t];if(!r)return null;var e=(0,Nx.default)(r,2),n=e[0],i=e[1];return{type:n,components:i}}function gv(t,r){switch(t){case Fhe:case Dhe:case Nhe:case jhe:t=er;break;default:}for(var e in Dx){var n=(0,Nx.default)(Dx[e],3),i=n[0],a=n[1],o=n[2];if(i===t&&a===r)return{glType:e,name:o}}return null}var XB=function(){function t(r){(0,WB.default)(this,t),this.id=r.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(r),this._readVaryingsFromProgram(r)}return(0,$B.default)(t,[{key:"getAttributeInfo",value:function(e){var n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}},{key:"getAttributeLocation",value:function(e){var n=this.getAttributeInfo(e);return n?n.location:-1}},{key:"getAttributeAccessor",value:function(e){var n=this.getAttributeInfo(e);return n?n.accessor:null}},{key:"getVaryingInfo",value:function(e){var n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}},{key:"getVaryingIndex",value:function(e){var n=this.getVaryingInfo();return n?n.location:-1}},{key:"getVaryingAccessor",value:function(e){var n=this.getVaryingInfo();return n?n.accessor:null}},{key:"_readAttributesFromProgram",value:function(e){for(var n=e.gl,i=n.getProgramParameter(e.handle,35721),a=0;a<i;a++){var o=n.getActiveAttrib(e.handle,a),s=o.name,u=o.type,l=o.size,f=n.getAttribLocation(e.handle,s);f>=0&&this._addAttribute(f,s,u,l)}this.attributeInfos.sort(function(c,p){return c.location-p.location})}},{key:"_readVaryingsFromProgram",value:function(e){var n=e.gl;if(fe(n)){for(var i=n.getProgramParameter(e.handle,35971),a=0;a<i;a++){var o=n.getTransformFeedbackVarying(e.handle,a),s=o.name,u=o.type,l=o.size;this._addVarying(a,s,u,l)}this.varyingInfos.sort(function(f,c){return f.location-c.location})}}},{key:"_addAttribute",value:function(e,n,i,a){var o=jx(i),s=o.type,u=o.components,l={type:s,size:a*u};this._inferProperties(e,n,l);var f={location:e,name:n,accessor:new Mr(l)};this.attributeInfos.push(f),this.attributeInfosByLocation[e]=f,this.attributeInfosByName[f.name]=f}},{key:"_inferProperties",value:function(e,n,i){/instance/i.test(n)&&(i.divisor=1)}},{key:"_addVarying",value:function(e,n,i,a){var o=jx(i),s=o.type,u=o.components,l=new Mr({type:s,size:a*u}),f={location:e,name:n,accessor:l};this.varyingInfos.push(f),this.varyingInfosByName[f.name]=f}}]),t}();function pde(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=hde(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function hde(t,r){if(t){if(typeof t=="string")return qB(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return qB(t,r)}}function qB(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function dde(t){var r=vde();return function(){var n=(0,yv.default)(t),i;if(r){var a=(0,yv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,t3.default)(this,i)}}function vde(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var YB=4,mde=35981,gde=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"],Ka=function(t,r){(0,e3.default)(n,t);var e=dde(n);function n(i){var a;(0,KB.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.stubRemovedMethods("Program","v6.0",gde),a._isCached=!1,a.initialize(o),Object.seal((0,ZB.default)(a)),a._setId(o.id),a}return(0,JB.default)(n,[{key:r,get:function(){return"Program"}},{key:"initialize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.hash,s=a.vs,u=a.fs,l=a.varyings,f=a.bufferMode,c=f===void 0?mde:f;return this.hash=o||"",this.vs=typeof s=="string"?new kc(this.gl,{id:"".concat(a.id,"-vs"),source:s}):s,this.fs=typeof u=="string"?new Bc(this.gl,{id:"".concat(a.id,"-fs"),source:u}):u,J(this.vs instanceof kc),J(this.fs instanceof Bc),this.uniforms={},this._textureUniforms={},l&&l.length>0&&(mt(this.gl),this.varyings=l,this.gl2.transformFeedbackVaryings(this.handle,l,c)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new XB(this),this.setProps(a)}},{key:"delete",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:(0,QB.default)((0,yv.default)(n.prototype),"delete",this).call(this,a)}},{key:"setProps",value:function(a){return"uniforms"in a&&this.setUniforms(a.uniforms),this}},{key:"draw",value:function(a){var o=this,s=a.logPriority,u=a.drawMode,l=u===void 0?4:u,f=a.vertexCount,c=a.offset,p=c===void 0?0:c,d=a.start,v=a.end,m=a.isIndexed,g=m===void 0?!1:m,y=a.indexType,_=y===void 0?5123:y,b=a.instanceCount,x=b===void 0?0:b,A=a.isInstanced,T=A===void 0?x>0:A,O=a.vertexArray,w=O===void 0?null:O,E=a.transformFeedback,S=a.framebuffer,I=a.parameters,R=I===void 0?{}:I,z=a.uniforms,G=a.samplers;if((z||G)&&(re.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(z||{})),re.priority>=s){var k=S?S.id:"default",U="mode=".concat(gn(this.gl,l)," verts=").concat(f," ")+"instances=".concat(x," indexType=").concat(gn(this.gl,_)," ")+"isInstanced=".concat(T," isIndexed=").concat(g," ")+"Framebuffer=".concat(k);re.log(s,U)()}return J(w),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||f===0||T&&x===0?!1:(w.bindForDraw(f,x,function(){if(S!==void 0&&(R=Object.assign({},R,{framebuffer:S})),E){var j=HB(l);E.begin(j)}o._bindTextures(),Ie(o.gl,R,function(){g&&T?o.gl2.drawElementsInstanced(l,f,_,p,x):g&&fe(o.gl)&&!isNaN(d)&&!isNaN(v)?o.gl2.drawRangeElements(l,d,v,f,_,p):g?o.gl.drawElements(l,f,_,p):T?o.gl2.drawArraysInstanced(l,p,f,x):o.gl.drawArrays(l,p,f)}),E&&E.end()}),!0)}},{key:"setUniforms",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};re.priority>=2&&GB(a,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(var o in a){var s=a[o],u=this._uniformSetters[o];if(u){var l=s,f=!1;if(l instanceof Me&&(l=l.texture),l instanceof nn)if(f=this.uniforms[o]!==s,f){u.textureIndex===void 0&&(u.textureIndex=this._textureIndexCounter++);var c=l,p=u.textureIndex;c.bind(p),l=p,this._textureUniforms[o]=c}else l=u.textureIndex;else this._textureUniforms[o]&&delete this._textureUniforms[o];(u(l)||f)&&zB(this.uniforms,o,s)}}return this}},{key:"_areTexturesRenderable",value:function(){var a=!0;for(var o in this._textureUniforms){var s=this._textureUniforms[o];s.update(),a=a&&s.loaded}return a}},{key:"_bindTextures",value:function(){for(var a in this._textureUniforms){var o=this._uniformSetters[a].textureIndex;this._textureUniforms[a].bind(o)}}},{key:"_createHandle",value:function(){return this.gl.createProgram()}},{key:"_deleteHandle",value:function(){this.gl.deleteProgram(this.handle)}},{key:"_getOptionsFromHandle",value:function(a){var o=this.gl.getAttachedShaders(a),s={},u=pde(o),l;try{for(u.s();!(l=u.n()).done;){var f=l.value,c=this.gl.getShaderParameter(this.handle,35663);switch(c){case 35633:s.vs=new kc({handle:f});break;case 35632:s.fs=new Bc({handle:f});break;default:}}}catch(p){u.e(p)}finally{u.f()}return s}},{key:"_getParameter",value:function(a){return this.gl.getProgramParameter(this.handle,a)}},{key:"_setId",value:function(a){if(!a){var o=this._getName();this.id=Xe(o)}}},{key:"_getName",value:function(){var a=this.vs.getName()||this.fs.getName();return a=a.replace(/shader/i,""),a=a?"".concat(a,"-program"):"program",a}},{key:"_compileAndLink",value:function(){var a=this.gl;if(a.attachShader(this.handle,this.vs.handle),a.attachShader(this.handle,this.fs.handle),re.time(YB,"linkProgram for ".concat(this._getName()))(),a.linkProgram(this.handle),re.timeEnd(YB,"linkProgram for ".concat(this._getName()))(),a.debug||re.level>0){var o=a.getProgramParameter(this.handle,35714);if(!o)throw new Error("Error linking: ".concat(a.getProgramInfoLog(this.handle)));a.validateProgram(this.handle);var s=a.getProgramParameter(this.handle,35715);if(!s)throw new Error("Error validating: ".concat(a.getProgramInfoLog(this.handle)))}}},{key:"_readUniformLocationsFromLinkedProgram",value:function(){var a=this.gl;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(var o=0;o<this._uniformCount;o++){var s=this.gl.getActiveUniform(this.handle,o),u=UB(s.name),l=u.name,f=a.getUniformLocation(this.handle,l);if(this._uniformSetters[l]=Fx(a,f,s),s.size>1)for(var c=0;c<s.size;c++)f=a.getUniformLocation(this.handle,"".concat(l,"[").concat(c,"]")),this._uniformSetters["".concat(l,"[").concat(c,"]")]=Fx(a,f,s)}this._textureIndexCounter=0}},{key:"getActiveUniforms",value:function(a,o){return this.gl2.getActiveUniforms(this.handle,a,o)}},{key:"getUniformBlockIndex",value:function(a){return this.gl2.getUniformBlockIndex(this.handle,a)}},{key:"getActiveUniformBlockParameter",value:function(a,o){return this.gl2.getActiveUniformBlockParameter(this.handle,a,o)}},{key:"uniformBlockBinding",value:function(a,o){this.gl2.uniformBlockBinding(this.handle,a,o)}}]),n}(ur,Symbol.toStringTag);var n3=h(L()),i3=h(N()),a3=h(_e()),o3=h(Y()),s3=h(K()),Ux=h(q());function yde(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=_de(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function _de(t,r){if(t){if(typeof t=="string")return r3(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return r3(t,r)}}function r3(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function bde(t){var r=xde();return function(){var n=(0,Ux.default)(t),i;if(r){var a=(0,Ux.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,s3.default)(this,i)}}function xde(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ade=34918,Tde=34919,Sde=35007,Pde=36795,wde=35976,Ode=35887,Ede=36202,_v=function(t,r){(0,o3.default)(n,t);var e=bde(n);function n(i){var a;(0,n3.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.target=null,a._queryPending=!1,a._pollingPromise=null,Object.seal((0,a3.default)(a)),a}return(0,i3.default)(n,[{key:r,get:function(){return"Query"}},{key:"beginTimeElapsedQuery",value:function(){return this.begin(Sde)}},{key:"beginOcclusionQuery",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.conservative,s=o===void 0?!1:o;return this.begin(s?Ede:Ode)}},{key:"beginTransformFeedbackQuery",value:function(){return this.begin(wde)}},{key:"begin",value:function(a){return this._queryPending?this:(this.target=a,this.gl2.beginQuery(this.target,this.handle),this)}},{key:"end",value:function(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}},{key:"isResultAvailable",value:function(){if(!this._queryPending)return!1;var a=this.gl2.getQueryParameter(this.handle,Tde);return a&&(this._queryPending=!1),a}},{key:"isTimerDisjoint",value:function(){return this.gl2.getParameter(Pde)}},{key:"getResult",value:function(){return this.gl2.getQueryParameter(this.handle,Ade)}},{key:"getTimerMilliseconds",value:function(){return this.getResult()/1e6}},{key:"createPoll",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;var s=0;return this._pollingPromise=new Promise(function(u,l){var f=function c(){a.isResultAvailable()?(u(a.getResult()),a._pollingPromise=null):s++>o?(l("Timed out"),a._pollingPromise=null):requestAnimationFrame(c)};requestAnimationFrame(f)}),this._pollingPromise}},{key:"_createHandle",value:function(){return n.isSupported(this.gl)?this.gl2.createQuery():null}},{key:"_deleteHandle",value:function(){this.gl2.deleteQuery(this.handle)}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=fe(a),u=lr(a,Ae.TIMER_QUERY),l=s||u,f=yde(o),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;switch(p){case"queries":l=l&&s;break;case"timers":l=l&&u;break;default:J(!1)}}}catch(d){f.e(d)}finally{f.f()}return l}}]),n}(ur,Symbol.toStringTag);var u3=h(L()),l3=h(N()),f3=h(_e()),c3=h(Y()),p3=h(K()),Gx=h(q());function Cde(t){var r=Mde();return function(){var n=(0,Gx.default)(t),i;if(r){var a=(0,Gx.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,p3.default)(this,i)}}function Mde(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ja=function(t,r){(0,c3.default)(n,t);var e=Cde(n);function n(i){var a;(0,u3.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mt(i),a=e.call(this,i,o),a.initialize(o),a.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal((0,f3.default)(a)),a}return(0,l3.default)(n,[{key:r,get:function(){return"TransformFeedback"}},{key:"initialize",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,xi(this.buffers)||this.bind(function(){return a._unbindBuffers()}),this.setProps(o),this}},{key:"setProps",value:function(a){"program"in a&&(this.configuration=a.program&&a.program.configuration),"configuration"in a&&(this.configuration=a.configuration),"bindOnUse"in a&&(a=a.bindOnUse),"buffers"in a&&this.setBuffers(a.buffers)}},{key:"setBuffers",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(function(){for(var s in o)a.setBuffer(s,o[s])}),this}},{key:"setBuffer",value:function(a,o){var s=this._getVaryingIndex(a),u=this._getBufferParams(o),l=u.buffer,f=u.byteSize,c=u.byteOffset;return s<0?(this.unused[a]=l,re.warn("".concat(this.id," unused varying buffer ").concat(a))(),this):(this.buffers[s]=o,this.bindOnUse||this._bindBuffer(s,l,c,f),this)}},{key:"begin",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(a),this}},{key:"end",value:function(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}},{key:"_getBufferParams",value:function(a){var o,s,u;return a instanceof be?u=a:(u=a.buffer,s=a.byteSize,o=a.byteOffset),(o!==void 0||s!==void 0)&&(o=o||0,s=s||u.byteLength-o),{buffer:u,byteOffset:o,byteSize:s}}},{key:"_getVaryingInfo",value:function(a){return this.configuration&&this.configuration.getVaryingInfo(a)}},{key:"_getVaryingIndex",value:function(a){if(this.configuration)return this.configuration.getVaryingInfo(a).location;var o=Number(a);return Number.isFinite(o)?o:-1}},{key:"_bindBuffers",value:function(){if(this.bindOnUse)for(var a in this.buffers){var o=this._getBufferParams(this.buffers[a]),s=o.buffer,u=o.byteSize,l=o.byteOffset;this._bindBuffer(a,s,l,u)}}},{key:"_unbindBuffers",value:function(){if(this.bindOnUse)for(var a in this.buffers)this._bindBuffer(a,null)}},{key:"_bindBuffer",value:function(a,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0,l=o&&o.handle;return!l||u===void 0?this.gl.bindBufferBase(35982,a,l):this.gl.bindBufferRange(35982,a,l,s,u),this}},{key:"_createHandle",value:function(){return this.gl.createTransformFeedback()}},{key:"_deleteHandle",value:function(){this.gl.deleteTransformFeedback(this.handle)}},{key:"_bindHandle",value:function(a){this.gl.bindTransformFeedback(36386,this.handle)}}],[{key:"isSupported",value:function(a){return fe(a)}}]),n}(ur,Symbol.toStringTag);var v3=h(L()),m3=h(N()),g3=h(_e()),y3=h(Oe()),_3=h(Y()),b3=h(K()),xv=h(q());var bv=null;function Ide(t){return(!bv||bv.byteLength<t)&&(bv=new ArrayBuffer(t)),bv}function h3(t,r){var e=Ide(t.BYTES_PER_ELEMENT*r);return new t(e,0,r)}function d3(t){for(var r=t.target,e=t.source,n=t.start,i=n===void 0?0:n,a=t.count,o=a===void 0?1:a,s=e.length,u=o*s,l=0,f=i;l<s;l++)r[f++]=e[l];for(;l<u;)l<u-l?(r.copyWithin(i+l,i,i+l),l*=2):(r.copyWithin(i+l,i,i+u-l),l=u);return r}function Rde(t){var r=Lde();return function(){var n=(0,xv.default)(t),i;if(r){var a=(0,xv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,b3.default)(this,i)}}function Lde(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kde="elements must be GL.ELEMENT_ARRAY_BUFFER",Av=function(t,r){(0,_3.default)(n,t);var e=Rde(n);function n(i){var a;(0,v3.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.id||o.program&&o.program.id;return a=e.call(this,i,Object.assign({},o,{id:s})),a.buffer=null,a.bufferValue=null,a.isDefaultArray=o.isDefaultArray||!1,a.gl2=i,a.initialize(o),Object.seal((0,g3.default)(a)),a}return(0,m3.default)(n,[{key:r,get:function(){return"VertexArrayObject"}},{key:"delete",value:function(){return(0,y3.default)((0,xv.default)(n.prototype),"delete",this).call(this),this.buffer&&this.buffer.delete(),this}},{key:"MAX_ATTRIBUTES",get:function(){return n.getMaxAttributes(this.gl)}},{key:"initialize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(a)}},{key:"setProps",value:function(a){return this}},{key:"setElementBuffer",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return J(!o||o.target===34963,kde),this.bind(function(){a.gl.bindBuffer(34963,o?o.handle:null)}),this}},{key:"setBuffer",value:function(a,o,s){if(o.target===34963)return this.setElementBuffer(o,s);var u=s.size,l=s.type,f=s.stride,c=s.offset,p=s.normalized,d=s.integer,v=s.divisor,m=this.gl,g=this.gl2;return a=Number(a),this.bind(function(){m.bindBuffer(34962,o.handle),d?(J(fe(m)),g.vertexAttribIPointer(a,u,l,f,c)):m.vertexAttribPointer(a,u,l,p,f,c),m.enableVertexAttribArray(a),g.vertexAttribDivisor(a,v||0)}),this}},{key:"enable",value:function(a){var o=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,u=!s&&a===0&&!n.isSupported(this.gl,{constantAttributeZero:!0});return u||(a=Number(a),this.bind(function(){return s?o.gl.enableVertexAttribArray(a):o.gl.disableVertexAttribArray(a)})),this}},{key:"getConstantBuffer",value:function(a,o){var s=this._normalizeConstantArrayValue(o),u=s.byteLength*a,l=s.length*a,f=!this.buffer;if(this.buffer=this.buffer||new be(this.gl,u),f=f||this.buffer.reallocate(u),f=f||!this._compareConstantArrayValues(s,this.bufferValue),f){var c=h3(o.constructor,l);d3({target:c,source:s,start:0,count:l}),this.buffer.subData(c),this.bufferValue=o}return this.buffer}},{key:"_normalizeConstantArrayValue",value:function(a){return Array.isArray(a)?new Float32Array(a):a}},{key:"_compareConstantArrayValues",value:function(a,o){if(!a||!o||a.length!==o.length||a.constructor!==o.constructor)return!1;for(var s=0;s<a.length;++s)if(a[s]!==o[s])return!1;return!0}},{key:"_createHandle",value:function(){var a=this.gl;return a.createVertexArray()}},{key:"_deleteHandle",value:function(a){return this.gl2.deleteVertexArray(a),[this.elements]}},{key:"_bindHandle",value:function(a){this.gl2.bindVertexArray(a)}},{key:"_getParameter",value:function(a,o){var s=this,u=o.location;return J(Number.isFinite(u)),this.bind(function(){switch(a){case 34373:return s.gl.getVertexAttribOffset(u,a);default:return s.gl.getVertexAttrib(u,a)}})}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return o.constantAttributeZero?fe(a)||wu()==="Chrome":!0}},{key:"getDefaultArray",value:function(a){return a.luma=a.luma||{},a.luma.defaultVertexArray||(a.luma.defaultVertexArray=new n(a,{handle:null,isDefaultArray:!0})),a.luma.defaultVertexArray}},{key:"getMaxAttributes",value:function(a){return n.MAX_ATTRIBUTES=n.MAX_ATTRIBUTES||a.getParameter(34921),n.MAX_ATTRIBUTES}},{key:"setConstant",value:function(a,o,s){switch(s.constructor){case Float32Array:n._setConstantFloatArray(a,o,s);break;case Int32Array:n._setConstantIntArray(a,o,s);break;case Uint32Array:n._setConstantUintArray(a,o,s);break;default:J(!1)}}},{key:"_setConstantFloatArray",value:function(a,o,s){switch(s.length){case 1:a.vertexAttrib1fv(o,s);break;case 2:a.vertexAttrib2fv(o,s);break;case 3:a.vertexAttrib3fv(o,s);break;case 4:a.vertexAttrib4fv(o,s);break;default:J(!1)}}},{key:"_setConstantIntArray",value:function(a,o,s){switch(J(fe(a)),s.length){case 1:a.vertexAttribI1iv(o,s);break;case 2:a.vertexAttribI2iv(o,s);break;case 3:a.vertexAttribI3iv(o,s);break;case 4:a.vertexAttribI4iv(o,s);break;default:J(!1)}}},{key:"_setConstantUintArray",value:function(a,o,s){switch(J(fe(a)),s.length){case 1:a.vertexAttribI1uiv(o,s);break;case 2:a.vertexAttribI2uiv(o,s);break;case 3:a.vertexAttribI3uiv(o,s);break;case 4:a.vertexAttribI4uiv(o,s);break;default:J(!1)}}}]),n}(ur,Symbol.toStringTag);var x3=h(L()),A3=h(N());var Bde="VertexArray: attributes must be Buffers or constants (i.e. typed array)",Fde=/^(.+)__LOCATION_([0-9]+)$/,Dde=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"],zx=function(){function t(r){(0,x3.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.id||e.program&&e.program.id;this.id=n,this.gl=r,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Av(r),rv(this,"VertexArray","v6.0",Dde),this.initialize(e),Object.seal(this)}return(0,A3.default)(t,[{key:"delete",value:function(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}},{key:"initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}},{key:"reset",value:function(){this.elements=null,this.elementsAccessor=null;var e=this.vertexArrayObject.MAX_ATTRIBUTES;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}},{key:"setProps",value:function(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}},{key:"clearDrawParams",value:function(){this.drawParams=null}},{key:"getDrawParams",value:function(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}},{key:"setAttributes",value:function(e){var n=this;return Object.assign(this.attributes,e),this.vertexArrayObject.bind(function(){for(var i in e){var a=e[i];n._setAttribute(i,a)}n.gl.bindBuffer(34962,null)}),this}},{key:"setElementBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}},{key:"setBuffer",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);var a=this._resolveLocationAndAccessor(e,n,n.accessor,i),o=a.location,s=a.accessor;return o>=0&&(this.values[o]=n,this.accessors[o]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(o,n,s)),this}},{key:"setConstant",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i)),o=a.location,s=a.accessor;return o>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[o]=n,this.accessors[o]=s,this.clearDrawParams(),this.vertexArrayObject.enable(o,!1)),this}},{key:"unbindBuffers",value:function(){var e=this;return this.vertexArrayObject.bind(function(){e.elements&&e.vertexArrayObject.setElementBuffer(null),e.buffer=e.buffer||new be(e.gl,{accessor:{size:4}});for(var n=0;n<e.vertexArrayObject.MAX_ATTRIBUTES;n++)e.values[n]instanceof be&&(e.gl.disableVertexAttribArray(n),e.gl.bindBuffer(34962,e.buffer.handle),e.gl.vertexAttribPointer(n,1,5126,!1,0,0))}),this}},{key:"bindBuffers",value:function(){var e=this;return this.vertexArrayObject.bind(function(){e.elements&&e.setElementBuffer(e.elements);for(var n=0;n<e.vertexArrayObject.MAX_ATTRIBUTES;n++){var i=e.values[n];i instanceof be&&e.setBuffer(n,i)}}),this}},{key:"bindForDraw",value:function(e,n,i){var a=this,o;return this.vertexArrayObject.bind(function(){a._setConstantAttributes(e,n),o=i()}),o}},{key:"_resolveLocationAndAccessor",value:function(e,n,i,a){var o=this,s={location:-1,accessor:null},u=this._getAttributeIndex(e),l=u.location,f=u.name;if(!Number.isFinite(l)||l<0)return this.unused[e]=n,re.once(3,function(){return"unused value ".concat(e," in ").concat(o.id)})(),s;var c=this._getAttributeInfo(f||l);if(!c)return s;var p=this.accessors[l]||{},d=Mr.resolve(c.accessor,p,i,a),v=d.size,m=d.type;return J(Number.isFinite(v)&&Number.isFinite(m)),{location:l,accessor:d}}},{key:"_getAttributeInfo",value:function(e){return this.configuration&&this.configuration.getAttributeInfo(e)}},{key:"_getAttributeIndex",value:function(e){var n=Number(e);if(Number.isFinite(n))return{location:n};var i=Fde.exec(e),a=i?i[1]:e,o=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(a)+o,name:a}:{location:-1}}},{key:"_setAttribute",value:function(e,n){if(n instanceof be)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof be){var i=n[0],a=n[1];this.setBuffer(e,i,a)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){var o=n;this.setConstant(e,o)}else if(n.buffer instanceof be){var s=n;this.setBuffer(e,s.buffer,s)}else throw new Error(Bde)}},{key:"_setConstantAttributes",value:function(e,n){var i=Math.max(e|0,n|0),a=this.values[0];ArrayBuffer.isView(a)&&this._setConstantAttributeZero(a,i);for(var o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)a=this.values[o],ArrayBuffer.isView(a)&&this._setConstantAttribute(o,a)}},{key:"_setConstantAttributeZero",value:function(e,n){if(Av.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}var i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}},{key:"_setConstantAttribute",value:function(e,n){Av.setConstant(this.gl,e,n)}},{key:"_updateDrawParams",value:function(){for(var e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0},n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}},{key:"_updateDrawParamsForLocation",value:function(e,n){var i=this.values[n],a=this.accessors[n];if(i){var o=a.divisor,s=o>0;if(e.isInstanced=e.isInstanced||s,i instanceof be){var u=i;if(s){var l=u.getVertexCount(a);e.instanceCount=Math.min(e.instanceCount,l)}else{var f=u.getVertexCount(a);e.vertexCount=Math.min(e.vertexCount,f)}}}}},{key:"setElements",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return re.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}]),t}();var Tv=h(B());function Nde(t,r){for(var e=r.maxElts,n=e===void 0?16:e,i=r.size,a=i===void 0?1:i,o="[",s=0;s<t.length&&s<n;++s)s>0&&(o+=",".concat(s%a===0?" ":"")),o+=es(t[s],r);var u=t.length>n?"...":"]";return"".concat(o).concat(u)}function es(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=1e-16,n=r.isInteger,i=n===void 0?!1:n;if(Array.isArray(t)||ArrayBuffer.isView(t))return Nde(t,r);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<e)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);var a=t.toPrecision(2),o=a.indexOf(".0");return o===a.length-2?a.slice(0,-1):a}function Vx(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=jde(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function jde(t,r){if(t){if(typeof t=="string")return T3(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return T3(t,r)}}function T3(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Sv(t){var r=t.header,e=r===void 0?"Uniforms":r,n=t.program,i=t.uniforms,a=t.undefinedOnly,o=a===void 0?!1:a;J(n);var s=".*_.*",u=".*Matrix",l=n._uniformSetters,f={},c=Object.keys(l).sort(),p=0,d=Vx(c),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;!m.match(s)&&!m.match(u)&&Hx({table:f,header:e,uniforms:i,uniformName:m,undefinedOnly:o})&&p++}}catch(S){d.e(S)}finally{d.f()}var g=Vx(c),y;try{for(g.s();!(y=g.n()).done;){var _=y.value;_.match(u)&&Hx({table:f,header:e,uniforms:i,uniformName:_,undefinedOnly:o})&&p++}}catch(S){g.e(S)}finally{g.f()}var b=Vx(c),x;try{for(b.s();!(x=b.n()).done;){var A=x.value;f[A]||Hx({table:f,header:e,uniforms:i,uniformName:A,undefinedOnly:o})&&p++}}catch(S){b.e(S)}finally{b.f()}var T=0,O={};if(!o)for(var w in i){var E=i[w];f[w]||(T++,O[w]=(0,Tv.default)({Type:"NOT USED: ".concat(E)},e,es(E)))}return{table:f,count:p,unusedTable:O,unusedCount:T}}function Hx(t){var r=t.table,e=t.header,n=t.uniforms,i=t.uniformName,a=t.undefinedOnly,o=n[i],s=Ude(o);if(!a||!s){var u;return r[i]=(u={},(0,Tv.default)(u,e,s?es(o):"N/A"),(0,Tv.default)(u,"Uniform Type",s?o:"NOT PROVIDED"),u),!0}return!1}function Ude(t){return t!=null}var ts=h(B());function Wx(t){var r=t.vertexArray,e=t.header,n=e===void 0?"Attributes":e;if(!r.configuration)return{};var i={};r.elements&&(i.ELEMENT_ARRAY_BUFFER=S3(r,r.elements,null,n));var a=r.values;for(var o in a){var s=r._getAttributeInfo(o);if(s){var u="".concat(o,": ").concat(s.name),l=r.accessors[s.location];l&&(u="".concat(o,": ").concat(Gde(s.name,l))),i[u]=S3(r,a[o],l,n)}}return i}function S3(t,r,e,n){var i,a=t.gl;if(!r){var o;return o={},(0,ts.default)(o,n,"null"),(0,ts.default)(o,"Format ","N/A"),o}var s="NOT PROVIDED",u=1,l=0,f=0,c,p,d;if(e&&(s=e.type,u=e.size,s=String(s).replace("Array",""),c=s.indexOf("nt")!==-1),r instanceof be){var v,m=r,g=m.getDebugData(),y=g.data,_=g.changed;p=_?"*":"",d=y,f=m.byteLength,l=f/y.BYTES_PER_ELEMENT/u;var b;if(e){var x=e.divisor>0;b="".concat(x?"I ":"P "," ").concat(l," (x").concat(u,"=").concat(f," bytes ").concat(gn(a,s),")")}else c=!0,b="".concat(f," bytes");return v={},(0,ts.default)(v,n,"".concat(p).concat(es(d,{size:u,isInteger:c}))),(0,ts.default)(v,"Format ",b),v}return d=r,u=r.length,s=String(r.constructor.name).replace("Array",""),c=s.indexOf("nt")!==-1,i={},(0,ts.default)(i,n,"".concat(es(d,{size:u,isInteger:c})," (constant)")),(0,ts.default)(i,"Format ","".concat(u,"x").concat(s," (constant)")),i}function Gde(t,r){var e=r.type,n=r.size,i=gv(e,n);return i?"".concat(t," (").concat(i.name,")"):t}var $x=h(B());function P3(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=zde(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function zde(t,r){if(t){if(typeof t=="string")return w3(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return w3(t,r)}}function w3(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Xx(t){var r={},e="Accessors for ".concat(t.id),n=P3(t.attributeInfos),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;if(a){var o=O3(a);r["in ".concat(o)]=(0,$x.default)({},e,JSON.stringify(a.accessor))}}}catch(c){n.e(c)}finally{n.f()}var s=P3(t.varyingInfos),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;if(l){var f=O3(l);r["out ".concat(f)]=(0,$x.default)({},e,JSON.stringify(l.accessor))}}}catch(c){s.e(c)}finally{s.f()}return r}function O3(t){var r=t.accessor,e=r.type,n=r.size,i=gv(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}var C3=h(Je()),M3=h(ge()),I3=h(L()),R3=h(N()),qx=h(de());var E3=Qt()&&typeof document<"u",Vde=0,Pv=function(){function t(){(0,I3.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.onCreateContext,n=e===void 0?function(z){return Iu(z)}:e,i=r.onAddHTML,a=i===void 0?null:i,o=r.onInitialize,s=o===void 0?function(){}:o,u=r.onRender,l=u===void 0?function(){}:u,f=r.onFinalize,c=f===void 0?function(){}:f,p=r.onError,d=r.gl,v=d===void 0?null:d,m=r.glOptions,g=m===void 0?{}:m,y=r.debug,_=y===void 0?!1:y,b=r.createFramebuffer,x=b===void 0?!1:b,A=r.autoResizeViewport,T=A===void 0?!0:A,O=r.autoResizeDrawingBuffer,w=O===void 0?!0:O,E=r.stats,S=E===void 0?mn.get("animation-loop-".concat(Vde++)):E,I=r.useDevicePixels,R=I===void 0?!0:I;"useDevicePixelRatio"in r&&(re.deprecated("useDevicePixelRatio","useDevicePixels")(),R=r.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:a,onInitialize:s,onRender:l,onFinalize:c,onError:p,gl:v,glOptions:g,debug:_,createFramebuffer:x},this.gl=v,this.needsRedraw=null,this.timeline=null,this.stats=S,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:T,autoResizeDrawingBuffer:w,useDevicePixels:R}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}return(0,R3.default)(t,[{key:"delete",value:function(){this.stop(),this._setDisplay(null)}},{key:"setNeedsRedraw",value:function(e){return J(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}},{key:"setProps",value:function(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}},{key:"start",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;var i=this._getPageLoadPromise().then(function(){return!e._running||e._initialized?null:(e._createWebGLContext(n),e._createFramebuffer(),e._startEventHandling(),e._initializeCallbackData(),e._updateCallbackData(),e._resizeCanvasDrawingBuffer(),e._resizeViewport(),e._gpuTimeQuery=_v.isSupported(e.gl,["timers"])?new _v(e.gl):null,e._initialized=!0,e.onInitialize(e.animationProps))}).then(function(a){e._running&&(e._addCallbackData(a||{}),a!==!1&&e._startLoop())});return this.props.onError&&i.catch(this.props.onError),this}},{key:"redraw",value:function(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}},{key:"stop",value:function(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}},{key:"attachTimeline",value:function(e){return this.timeline=e,this.timeline}},{key:"detachTimeline",value:function(){this.timeline=null}},{key:"waitForRender",value:function(){var e=this;return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(function(n){e._resolveNextFrame=n})),this._nextFramePromise}},{key:"toDataURL",value:function(){var r=(0,M3.default)(qx.default.mark(function n(){return qx.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.setNeedsRedraw("toDataURL"),a.next=3,this.waitForRender();case 3:return a.abrupt("return",this.gl.canvas.toDataURL());case 4:case"end":return a.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"isContextLost",value:function(){return this.gl.isContextLost()}},{key:"onCreateContext",value:function(){var e;return(e=this.props).onCreateContext.apply(e,arguments)}},{key:"onInitialize",value:function(){var e;return(e=this.props).onInitialize.apply(e,arguments)}},{key:"onRender",value:function(){var e;return(e=this.props).onRender.apply(e,arguments)}},{key:"onFinalize",value:function(){var e;return(e=this.props).onFinalize.apply(e,arguments)}},{key:"getHTMLControlValue",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=document.getElementById(e);return i?Number(i.value):n}},{key:"setViewParameters",value:function(){return re.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}},{key:"_startLoop",value:function(){var e=this,n=function i(){e._running&&(e.redraw(),e._animationFrameId=e._requestAnimationFrame(i))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(n)}},{key:"_getPageLoadPromise",value:function(){return this._pageLoadPromise||(this._pageLoadPromise=E3?new Promise(function(e,n){if(E3&&document.readyState==="complete"){e(document);return}window.addEventListener("load",function(){e(document)})}):Promise.resolve({})),this._pageLoadPromise}},{key:"_setDisplay",value:function(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}},{key:"_cancelAnimationFrame",value:function(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):vx(e)}},{key:"_requestAnimationFrame",value:function(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):dx(e)}},{key:"_renderFrame",value:function(){if(this.display){var e;(e=this.display)._renderFrame.apply(e,arguments);return}this.onRender.apply(this,arguments)}},{key:"_clearNeedsRedraw",value:function(){this.needsRedraw=null}},{key:"_setupFrame",value:function(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}},{key:"_initializeCallbackData",value:function(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}},{key:"_updateCallbackData",value:function(){var e=this._getSizeAndAspect(),n=e.width,i=e.height,a=e.aspect;(n!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),a!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=n,this.animationProps.height=i,this.animationProps.aspect=a,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}},{key:"_finalizeCallbackData",value:function(){this.onFinalize(this.animationProps)}},{key:"_addCallbackData",value:function(e){(0,C3.default)(e)==="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}},{key:"_createWebGLContext",value:function(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?ea(this.props.gl,e):this.onCreateContext(e),!Zi(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");ev(this.gl),this._createInfoDiv()}},{key:"_createInfoDiv",value:function(){if(this.gl.canvas&&this.props.onAddHTML){var e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";var n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);var i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}},{key:"_getSizeAndAspect",value:function(){var e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight,i=1,a=this.gl.canvas;return a&&a.clientHeight?i=a.clientWidth/a.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}},{key:"_resizeViewport",value:function(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}},{key:"_resizeCanvasDrawingBuffer",value:function(){this.autoResizeDrawingBuffer&&px(this.gl,{useDevicePixels:this.useDevicePixels})}},{key:"_createFramebuffer",value:function(){this.props.createFramebuffer&&(this.framebuffer=new Me(this.gl))}},{key:"_resizeFramebuffer",value:function(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}},{key:"_beginTimers",value:function(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}},{key:"_endTimers",value:function(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}},{key:"_startEventHandling",value:function(){var e=this.gl.canvas;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}},{key:"_onMousemove",value:function(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}},{key:"_onMouseleave",value:function(e){this.animationProps._mousePosition=null}}]),t}();var MD=h(B()),ID=h(L()),RD=h(N());var SD=h(L()),PD=h(N());var rF=h(ye()),aA=h(B());var rs="vs",Nc="fs";var F3=h(L()),D3=h(N());function zt(t,r){if(!t)throw new Error(r||"shadertools: assertion failed.")}var k3=h(Je()),Yx={number:{validate:function(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},array:{validate:function(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function B3(t){var r={};for(var e in t){var n=t[e],i=Hde(n);r[e]=i}return r}function Hde(t){var r=L3(t);return r==="object"?t?"type"in t?Object.assign({},t,Yx[t.type]):"value"in t?(r=L3(t.value),Object.assign({type:r},t,Yx[r])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:r,value:t},Yx[r])}function L3(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":(0,k3.default)(t)}var Wde="vs",$de="fs",wv=function(){function t(r){(0,F3.default)(this,t);var e=r.name,n=r.vs,i=r.fs,a=r.dependencies,o=a===void 0?[]:a,s=r.uniforms,u=r.getUniforms,l=r.deprecations,f=l===void 0?[]:l,c=r.defines,p=c===void 0?{}:c,d=r.inject,v=d===void 0?{}:d,m=r.vertexShader,g=r.fragmentShader;zt(typeof e=="string"),this.name=e,this.vs=n||m,this.fs=i||g,this.getModuleUniforms=u,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(f),this.defines=p,this.injections=Xde(v),s&&(this.uniforms=B3(s))}return(0,D3.default)(t,[{key:"getModuleSource",value:function(e){var n;switch(e){case Wde:n=this.vs||"";break;case $de:n=this.fs||"";break;default:zt(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}},{key:"getUniforms",value:function(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}},{key:"getDefines",value:function(){return this.defines}},{key:"checkDeprecations",value:function(e,n){this.deprecations.forEach(function(i){i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}},{key:"_parseDeprecationDefinitions",value:function(e){return e.forEach(function(n){switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}},{key:"_defaultGetUniforms",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n={},i=this.uniforms;for(var a in i){var o=i[a];a in e&&!o.private?(o.validate&&zt(o.validate(e[a],o),"".concat(this.name,": invalid ").concat(a)),n[a]=e[a]):n[a]=o.value}return n}}]),t}();function Ov(t){if(!t.normalized&&(t.normalized=!0,t.uniforms&&!t.getUniforms)){var r=new wv(t);t.getUniforms=r.getUniforms.bind(r)}return t}function Xde(t){var r={vs:{},fs:{}};for(var e in t){var n=t[e],i=e.slice(0,2);typeof n=="string"&&(n={order:0,injection:n}),r[i][e]=n}return r}function N3(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=qde(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function qde(t,r){if(t){if(typeof t=="string")return j3(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return j3(t,r)}}function j3(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function U3(t){return Yde(z3(t))}function Yde(t){var r={},e={};return G3({modules:t,level:0,moduleMap:r,moduleDepth:e}),Object.keys(e).sort(function(n,i){return e[i]-e[n]}).map(function(n){return r[n]})}function G3(t){var r=t.modules,e=t.level,n=t.moduleMap,i=t.moduleDepth;if(e>=5)throw new Error("Possible loop in shader dependency graph");var a=N3(r),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n[s.name]=s,(i[s.name]===void 0||i[s.name]<e)&&(i[s.name]=e)}}catch(c){a.e(c)}finally{a.f()}var u=N3(r),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;f.dependencies&&G3({modules:f.dependencies,level:e+1,moduleMap:n,moduleDepth:i})}}catch(c){u.e(c)}finally{u.f()}}function z3(t,r){return t.map(function(e){return e instanceof wv||(zt(typeof e!="string","Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),zt(e.name,"shader module has no name"),e=new wv(e),e.dependencies=z3(e.dependencies)),e})}function Kx(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=typeof window<"u"?window.navigator||{}:{},e=t.userAgent||r.userAgent||"",n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i}var Kde=7936,Jde=7937,Zde=7938,Qde=35724,Zx={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Za={};Object.keys(Zx).forEach(function(t){Za[t]=t});function eve(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function V3(t){var r=t.getExtension("WEBGL_debug_renderer_info"),e=t.getParameter(r&&r.UNMASKED_VENDOR_WEBGL||Kde),n=t.getParameter(r&&r.UNMASKED_RENDERER_WEBGL||Jde),i=tve(e,n),a={gpuVendor:i,vendor:e,renderer:n,version:t.getParameter(Zde),shadingLanguageVersion:t.getParameter(Qde)};return a}function tve(t,r){return t.match(/NVIDIA/i)||r.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||r.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||r.match(/AMD/i)||t.match(/ATI/i)||r.match(/ATI/i)?"AMD":"UNKNOWN GPU"}var Jx={};function Qx(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=Zx[r];if(zt(n,r),!Kx(e))return!0;if(r in Jx)return Jx[r];var i=n[0],a=e.behavior||"enable",o="#extension GL_".concat(i," : ").concat(a,`
void main(void) {}`),s=t.createShader(35633);t.shaderSource(s,o),t.compileShader(s);var u=t.getShaderParameter(s,35713);return t.deleteShader(s),Jx[r]=u,u}function rve(t,r){var e=Zx[r];zt(e,r);var n=eve(t)&&e[1]||e[0],i=typeof n=="string"?Boolean(t.getExtension(n)):n;return zt(i===!1||i===!0),i}function jc(t,r){return r=Array.isArray(r)?r:[r],r.every(function(e){return rve(t,e)})}function H3(t){var r=V3(t);switch(r.gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function W3(t,r,e){var n=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return jc(t,Za.GLSL_FRAG_DEPTH)&&(n+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),jc(t,Za.GLSL_DERIVATIVES)&&Qx(t,Za.GLSL_DERIVATIVES)&&(n+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),jc(t,Za.GLSL_FRAG_DATA)&&Qx(t,Za.GLSL_FRAG_DATA,{behavior:"require"})&&(n+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),jc(t,Za.GLSL_TEXTURE_LOD)&&(n+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),n}var tA=h(B());var $3=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,X3=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`;var Ev,nve=(Ev={},(0,tA.default)(Ev,rs,$3),(0,tA.default)(Ev,Nc,X3),Ev),Uc="__LUMA_INJECT_DECLARATIONS__",q3=/void\s+main\s*\([^)]*\)\s*\{\n?/,Y3=/}\n?[^{}]*$/,eA=[];function Cv(t,r,e){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=r===rs,a=function(u){var l=e[u];l.sort(function(d,v){return d.order-v.order}),eA.length=l.length;for(var f=0,c=l.length;f<c;++f)eA[f]=l[f].injection;var p="".concat(eA.join(`
`),`
`);switch(u){case"vs:#decl":i&&(t=t.replace(Uc,p));break;case"vs:#main-start":i&&(t=t.replace(q3,function(d){return d+p}));break;case"vs:#main-end":i&&(t=t.replace(Y3,function(d){return p+d}));break;case"fs:#decl":i||(t=t.replace(Uc,p));break;case"fs:#main-start":i||(t=t.replace(q3,function(d){return d+p}));break;case"fs:#main-end":i||(t=t.replace(Y3,function(d){return p+d}));break;default:t=t.replace(u,function(d){return d+p})}};for(var o in e)a(o);return t=t.replace(Uc,""),n&&(t=t.replace(/\}\s*$/,function(s){return s+nve[r]})),t}function Du(t){var r={};return zt(Array.isArray(t)&&t.length>1),t.forEach(function(e){for(var n in e)r[n]=r[n]?"".concat(r[n],`
`).concat(e[n]):e[n]}),r}var J3=h(ye());function ive(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=ave(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function ave(t,r){if(t){if(typeof t=="string")return K3(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return K3(t,r)}}function K3(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Nu(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}var Z3=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],ove=[].concat(Z3,[[Nu("attribute"),"in $1"],[Nu("varying"),"out $1"]]),sve=[].concat(Z3,[[Nu("varying"),"in $1"]]),Q3=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],uve=[].concat(Q3,[[Nu("in"),"attribute $1"],[Nu("out"),"varying $1"]]),lve=[].concat(Q3,[[Nu("in"),"varying $1"]]),rA="gl_FragColor",nA=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,fve=/void\s+main\s*\([^)]*\)\s*\{\n?/;function iA(t,r,e){switch(r){case 300:return e?Mv(t,ove):cve(t);case 100:return e?Mv(t,uve):pve(t);default:throw new Error("unknown GLSL version ".concat(r))}}function Mv(t,r){var e=ive(r),n;try{for(e.s();!(n=e.n()).done;){var i=(0,J3.default)(n.value,2),a=i[0],o=i[1];t=t.replace(a,o)}}catch(s){e.e(s)}finally{e.f()}return t}function cve(t){t=Mv(t,sve);var r=t.match(nA);if(r){var e=r[1];t=t.replace(new RegExp("\\b".concat(rA,"\\b"),"g"),e)}else{var n="fragmentColor";t=t.replace(fve,function(i){return"out vec4 ".concat(n,`;
`).concat(i)}).replace(new RegExp("\\b".concat(rA,"\\b"),"g"),n)}return t}function pve(t){t=Mv(t,lve);var r=t.match(nA);if(r){var e=r[1];t=t.replace(nA,"").replace(new RegExp("\\b".concat(e,"\\b"),"g"),rA)}return t}var Iv;function oA(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=hve(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function hve(t,r){if(t){if(typeof t=="string")return eF(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return eF(t,r)}}function eF(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var dve=`

`.concat(Uc,`

`),nF=(Iv={},(0,aA.default)(Iv,rs,"vertex"),(0,aA.default)(Iv,Nc,"fragment"),Iv),vve=`precision highp float;

`;function sA(t,r){var e=r.vs,n=r.fs,i=U3(r.modules||[]);return{gl:t,vs:tF(t,Object.assign({},r,{source:e,type:rs,modules:i})),fs:tF(t,Object.assign({},r,{source:n,type:Nc,modules:i})),getUniforms:mve(i)}}function tF(t,r){var e=r.id,n=r.source,i=r.type,a=r.modules,o=r.defines,s=o===void 0?{}:o,u=r.hookFunctions,l=u===void 0?[]:u,f=r.inject,c=f===void 0?{}:f,p=r.transpileToGLSL100,d=p===void 0?!1:p,v=r.prologue,m=v===void 0?!0:v,g=r.log;zt(typeof n=="string","shader source must be a string");var y=i===rs,_=n.split(`
`),b=100,x="",A=n;_[0].indexOf("#version ")===0?(b=300,x=_[0],A=_.slice(1).join(`
`)):x="#version ".concat(b);var T={};a.forEach(function(me){Object.assign(T,me.getDefines())}),Object.assign(T,s);var O=m?"".concat(x,`
`).concat(yve({id:e,source:n,type:i}),`
`).concat(gve({type:i}),`
`).concat(H3(t),`
`).concat(W3(t,b,!y),`
`).concat(_ve(T),`
`).concat(y?"":vve,`
`):"".concat(x,`
`),w=xve(l),E={},S={},I={};for(var R in c){var z=typeof c[R]=="string"?{injection:c[R],order:0}:c[R],G=R.match(/^(v|f)s:(#)?([\w-]+)$/);if(G){var k=G[2],U=G[3];k?U==="decl"?S[R]=[z]:I[R]=[z]:E[R]=[z]}else I[R]=[z]}var j=oA(a),X;try{for(j.s();!(X=j.n()).done;){var H=X.value;g&&H.checkDeprecations(A,g);var Q=H.getModuleSource(i,b);O+=Q;var ne=H.injections[i];for(var le in ne){var xe=le.match(/^(v|f)s:#([\w-]+)$/);if(xe){var we=xe[2],ze=we==="decl"?S:I;ze[le]=ze[le]||[],ze[le].push(ne[le])}else E[le]=E[le]||[],E[le].push(ne[le])}}}catch(me){j.e(me)}finally{j.f()}return O+=dve,O=Cv(O,i,S),O+=bve(w[i],E),O+=A,O=Cv(O,i,I),O=iA(O,d?100:b,y),O}function mve(t){return function(e){var n={},i=oA(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.getUniforms(e,n);Object.assign(n,s)}}catch(u){i.e(u)}finally{i.f()}return n}}function gve(t){var r=t.type;return`
#define SHADER_TYPE_`.concat(nF[r].toUpperCase(),`
`)}function yve(t){var r=t.id,e=t.source,n=t.type,i=r&&typeof r=="string"&&e.indexOf("SHADER_NAME")===-1;return i?`
#define SHADER_NAME `.concat(r,"_").concat(nF[n],`

`):""}function _ve(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=0,e="";for(var n in t){r===0&&(e+=`
// APPLICATION DEFINES
`),r++;var i=t[n];(i||Number.isFinite(i))&&(e+="#define ".concat(n.toUpperCase()," ").concat(t[n],`
`))}return r===0&&(e+=`
`),e}function bve(t,r){var e="";for(var n in t){var i=t[n];if(e+="void ".concat(i.signature,` {
`),i.header&&(e+="  ".concat(i.header)),r[n]){var a=r[n];a.sort(function(l,f){return l.order-f.order});var o=oA(a),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;e+="  ".concat(u.injection,`
`)}}catch(l){o.e(l)}finally{o.f()}}i.footer&&(e+="  ".concat(i.footer)),e+=`}
`}return e}function xve(t){var r={vs:{},fs:{}};return t.forEach(function(e){var n;typeof e!="string"?(n=e,e=n.hook):n={},e=e.trim();var i=e.split(":"),a=(0,rF.default)(i,2),o=a[0],s=a[1],u=e.replace(/\(.+/,"");r[o][u]=Object.assign(n,{signature:s})}),r}var iF=h(ye());var Ave="void main() {gl_FragColor = vec4(0);}",aF=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,Tve=`#version 300 es
`.concat(aF);function Rv(t,r){r=Array.isArray(r)?r:[r];var e=t.replace(/^\s+/,"").split(/\s+/),n=(0,iF.default)(e,3),i=n[0],a=n[1],o=n[2];if(!r.includes(i)||!a||!o)return null;var s=o.split(";")[0];return{qualifier:i,type:a,name:s}}function Gc(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.version,e=r===void 0?100:r,n=t.input,i=t.inputType,a=t.output;if(!n)return e===300?Tve:e>300?"#version ".concat(e,`
`).concat(aF):Ave;var o=oF(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(a,`;
void main() {
  `).concat(a," = ").concat(o,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function uA(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return zt(!1),null}}function lA(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return zt(!1),null}}function oF(t,r){switch(r){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return zt(!1),null}}var Sve=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Lv={name:"fp32",vs:Sve,fs:null};function kv(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Math.fround(t),i=t-n;return r[e]=n,r[e+1]=i,r}function fA(t){return t-Math.fround(t)}function cA(t){for(var r=new Float32Array(32),e=0;e<4;++e)for(var n=0;n<4;++n){var i=e*4+n;kv(t[n*4+e],r,i*2)}return r}var sF=`uniform float ONE;
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * ONE - (t - a);
  float a_lo = a * ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * ONE;
  float err = b - (sum - a) * ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * ONE - a) * ONE;
  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * ONE - a) * ONE;
  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`;var uF=`const vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);
const vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);
const vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);
const vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);
const vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);
const vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);
const vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);
const vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);
const vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);
const vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);

const vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);
const vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);
const vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);
const vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);

const vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);
const vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);
const vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);
const vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);

const vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09);
const vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09);
const vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10);
const vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11);
const vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12);
const vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13);
const vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14);
const vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15);

float nint(float d) {
    if (d == floor(d)) return d;
    return floor(d + 0.5);
}

vec2 nint_fp64(vec2 a) {
    float hi = nint(a.x);
    float lo;
    vec2 tmp;
    if (hi == a.x) {
        lo = nint(a.y);
        tmp = quickTwoSum(hi, lo);
    } else {
        lo = 0.0;
        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {
            hi -= 1.0;
        }
        tmp = vec2(hi, lo);
    }
    return tmp;
}

vec2 exp_fp64(vec2 a) {

  const int k_power = 4;
  const float k = 16.0;

  const float inv_k = 1.0 / k;

  if (a.x <= -88.0) return vec2(0.0, 0.0);
  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);
  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);
  if (a.x == 1.0 && a.y == 0.0) return E_FP64;

  float m = floor(a.x / LOG2_FP64.x + 0.5);
  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;
  vec2 s, t, p;

  p = mul_fp64(r, r);
  s = sum_fp64(r, p * 0.5);
  p = mul_fp64(p, r);
  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);

  s = sum_fp64(s, t);
  p = mul_fp64(p, r);
  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);

  s = sum_fp64(s, t);
  p = mul_fp64(p, r);
  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);






  s = sum_fp64(s, t);
  for (int i = 0; i < k_power; i++) {
    s = sum_fp64(s * 2.0, mul_fp64(s, s));
  }

#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
  s = sum_fp64(s, vec2(ONE, 0.0));
#else
  s = sum_fp64(s, vec2(1.0, 0.0));
#endif

  return s * pow(2.0, m);
}

vec2 log_fp64(vec2 a)
{
  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
  vec2 x = vec2(log(a.x), 0.0);
  vec2 s;
#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
  s = vec2(ONE, 0.0);
#else
  s = vec2(1.0, 0.0);
#endif

  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);
  return x;
}

vec2 sin_taylor_fp64(vec2 a) {
  vec2 r, s, t, x;

  if (a.x == 0.0 && a.y == 0.0) {
    return vec2(0.0, 0.0);
  }

  x = -mul_fp64(a, a);
  s = a;
  r = a;

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);
  s = sum_fp64(s, t);

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);
  s = sum_fp64(s, t);






  return s;
}

vec2 cos_taylor_fp64(vec2 a) {
  vec2 r, s, t, x;

  if (a.x == 0.0 && a.y == 0.0) {
    return vec2(1.0, 0.0);
  }

  x = -mul_fp64(a, a);
  r = x;
  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);
  s = sum_fp64(s, t);

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);
  s = sum_fp64(s, t);






  return s;
}

void sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {
  if (a.x == 0.0 && a.y == 0.0) {
    sin_t = vec2(0.0, 0.0);
    cos_t = vec2(1.0, 0.0);
  }

  sin_t = sin_taylor_fp64(a);
  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));
}

vec2 sin_fp64(vec2 a) {
    if (a.x == 0.0 && a.y == 0.0) {
        return vec2(0.0, 0.0);
    }
    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));

    vec2 t;
    float q = floor(r.x / PI_2_FP64.x + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    }

    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));

    q = floor(t.x / PI_16_FP64.x + 0.5);
    int k = int(q);

    if (k == 0) {
        if (j == 0) {
            return sin_taylor_fp64(t);
        } else if (j == 1) {
            return cos_taylor_fp64(t);
        } else if (j == -1) {
            return -cos_taylor_fp64(t);
        } else {
            return -sin_taylor_fp64(t);
        }
    }

    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    } else {
        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
    }

    vec2 u = vec2(0.0, 0.0);
    vec2 v = vec2(0.0, 0.0);

#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
    if (abs(float(abs_k) - 1.0) < 0.5) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs(float(abs_k) - 2.0) < 0.5) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs(float(abs_k) - 3.0) < 0.5) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs(float(abs_k) - 4.0) < 0.5) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#else
    if (abs_k == 1) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs_k == 2) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs_k == 3) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs_k == 4) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#endif

    vec2 sin_t, cos_t;
    sincos_taylor_fp64(t, sin_t, cos_t);



    vec2 result = vec2(0.0, 0.0);
    if (j == 0) {
        if (k > 0) {
            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        }
    } else if (j == 1) {
        if (k > 0) {
            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        } else {
            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    } else if (j == -1) {
        if (k > 0) {
            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
        } else {
            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
        }
    } else {
        if (k > 0) {
            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));
        }
    }

    return result;
}

vec2 cos_fp64(vec2 a) {
    if (a.x == 0.0 && a.y == 0.0) {
        return vec2(1.0, 0.0);
    }
    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));

    vec2 t;
    float q = floor(r.x / PI_2_FP64.x + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    }

    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));

    q = floor(t.x / PI_16_FP64.x + 0.5);
    int k = int(q);

    if (k == 0) {
        if (j == 0) {
            return cos_taylor_fp64(t);
        } else if (j == 1) {
            return -sin_taylor_fp64(t);
        } else if (j == -1) {
            return sin_taylor_fp64(t);
        } else {
            return -cos_taylor_fp64(t);
        }
    }

    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    } else {
        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
    }

    vec2 u = vec2(0.0, 0.0);
    vec2 v = vec2(0.0, 0.0);

#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
    if (abs(float(abs_k) - 1.0) < 0.5) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs(float(abs_k) - 2.0) < 0.5) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs(float(abs_k) - 3.0) < 0.5) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs(float(abs_k) - 4.0) < 0.5) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#else
    if (abs_k == 1) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs_k == 2) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs_k == 3) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs_k == 4) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#endif

    vec2 sin_t, cos_t;
    sincos_taylor_fp64(t, sin_t, cos_t);

    vec2 result = vec2(0.0, 0.0);
    if (j == 0) {
        if (k > 0) {
            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        } else {
            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    } else if (j == 1) {
        if (k > 0) {
            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));
        }
    } else if (j == -1) {
        if (k > 0) {
            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        }
    } else {
        if (k > 0) {
            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
        } else {
            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    }

    return result;
}

vec2 tan_fp64(vec2 a) {
    vec2 sin_a;
    vec2 cos_a;

    if (a.x == 0.0 && a.y == 0.0) {
        return vec2(0.0, 0.0);
    }
    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));

    vec2 t;
    float q = floor(r.x / PI_2_FP64.x + 0.5);
    int j = int(q);


    if (j < -2 || j > 2) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    }

    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));

    q = floor(t.x / PI_16_FP64.x + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    } else {
        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
    }


    vec2 u = vec2(0.0, 0.0);
    vec2 v = vec2(0.0, 0.0);

    vec2 sin_t, cos_t;
    vec2 s, c;
    sincos_taylor_fp64(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0_FP64;
            v = SIN_TABLE_0_FP64;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1_FP64;
            v = SIN_TABLE_1_FP64;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2_FP64;
            v = SIN_TABLE_2_FP64;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3_FP64;
            v = SIN_TABLE_3_FP64;
        }
#else
        if (abs_k == 1) {
            u = COS_TABLE_0_FP64;
            v = SIN_TABLE_0_FP64;
        } else if (abs_k == 2) {
            u = COS_TABLE_1_FP64;
            v = SIN_TABLE_1_FP64;
        } else if (abs_k == 3) {
            u = COS_TABLE_2_FP64;
            v = SIN_TABLE_2_FP64;
        } else if (abs_k == 4) {
            u = COS_TABLE_3_FP64;
            v = SIN_TABLE_3_FP64;
        }
#endif
        if (k > 0) {
            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        } else {
            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return div_fp64(sin_a, cos_a);
}

vec2 radians_fp64(vec2 degree) {
  return mul_fp64(degree, PI_180_FP64);
}

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = sum_fp64(a[0], b[0]);
    out_val[1] = sum_fp64(a[1], b[1]);
}

void vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = sub_fp64(a[0], b[0]);
    out_val[1] = sub_fp64(a[1], b[1]);
}

void vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = mul_fp64(a[0], b[0]);
    out_val[1] = mul_fp64(a[1], b[1]);
}

void vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = div_fp64(a[0], b[0]);
    out_val[1] = div_fp64(a[1], b[1]);
}

void vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {
  vec2 range[2];
  vec2_sub_fp64(y, x, range);
  vec2 portion[2];
  portion[0] = range[0] * a;
  portion[1] = range[1] * a;
  vec2_sum_fp64(x, portion, out_val);
}

vec2 vec2_length_fp64(vec2 x[2]) {
  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));
}

void vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {
  vec2 length = vec2_length_fp64(x);
  vec2 length_vec2[2];
  length_vec2[0] = length;
  length_vec2[1] = length;

  vec2_div_fp64(x, length_vec2, out_val);
}

vec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {
  vec2 diff[2];
  vec2_sub_fp64(x, y, diff);
  return vec2_length_fp64(diff);
}

vec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {
  vec2 v[2];

  v[0] = mul_fp64(a[0], b[0]);
  v[1] = mul_fp64(a[1], b[1]);

  return sum_fp64(v[0], v[1]);
}
void vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {
  for (int i = 0; i < 3; i++) {
    out_val[i] = sum_fp64(a[i], b[i]);
  }
}

void vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {
  for (int i = 0; i < 3; i++) {
    out_val[i] = sum_fp64(a[i], b[i]);
  }
}

vec2 vec3_length_fp64(vec2 x[3]) {
  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),
    mul_fp64(x[2], x[2])));
}

vec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {
  vec2 diff[3];
  vec3_sub_fp64(x, y, diff);
  return vec3_length_fp64(diff);
}
void vec4_fp64(vec4 a, out vec2 out_val[4]) {
  out_val[0].x = a[0];
  out_val[0].y = 0.0;

  out_val[1].x = a[1];
  out_val[1].y = 0.0;

  out_val[2].x = a[2];
  out_val[2].y = 0.0;

  out_val[3].x = a[3];
  out_val[3].y = 0.0;
}

void vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {
  out_val[0] = mul_fp64(a[0], b);
  out_val[1] = mul_fp64(a[1], b);
  out_val[2] = mul_fp64(a[2], b);
  out_val[3] = mul_fp64(a[3], b);
}

void vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {
  for (int i = 0; i < 4; i++) {
    out_val[i] = sum_fp64(a[i], b[i]);
  }
}

void vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {
  vec2 v[4];

  v[0] = mul_fp64(a[0], b[0]);
  v[1] = mul_fp64(a[1], b[1]);
  v[2] = mul_fp64(a[2], b[2]);
  v[3] = mul_fp64(a[3], b[3]);

  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));
}

void mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {
  vec2 tmp[4];

  for (int i = 0; i < 4; i++)
  {
    for (int j = 0; j < 4; j++)
    {
      tmp[j] = b[j + i * 4];
    }
    vec4_dot_fp64(a, tmp, out_val[i]);
  }
}
`;var Pve={ONE:1};function wve(){return Pve}var ns={name:"fp64-arithmetic",vs:sF,fs:null,getUniforms:wve,fp64ify:kv,fp64LowPart:fA,fp64ifyMatrix4:cA},ju={name:"fp64",vs:uF,fs:null,dependencies:[ns],fp64ify:kv,fp64LowPart:fA,fp64ifyMatrix4:cA};function Vt(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function lF(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ht(t,r,e){return r&&lF(t.prototype,r),e&&lF(t,e),t}function zc(t,r){return zc=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},zc(t,r)}function tr(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&zc(t,r)}function is(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?is=function(e){return typeof e}:is=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},is(t)}function pA(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function rr(t,r){if(r&&(is(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pA(t)}function ot(t){return ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ot(t)}function qe(t,r){if(!t)throw new Error("math.gl assertion ".concat(r))}var Ove=1/Math.PI*180,Eve=1/180*Math.PI,ut={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function Vc(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.precision,n=e===void 0?ut.precision:e;return t=Cve(t),"".concat(parseFloat(t.toPrecision(n)))}function Lr(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function hA(t){return as(t)}function dA(t){return fr(t)}function as(t,r){return vA(t,function(e){return e*Eve},r)}function fr(t,r){return vA(t,function(e){return e*Ove},r)}function He(t,r,e){return vA(t,function(n){return Math.max(r,Math.min(e,n))})}function nr(t,r,e){return Lr(t)?t.map(function(n,i){return nr(n,r[i],e)}):e*r+(1-e)*t}function tt(t,r,e){var n=ut.EPSILON;e&&(ut.EPSILON=e);try{if(t===r)return!0;if(Lr(t)&&Lr(r)){if(t.length!==r.length)return!1;for(var i=0;i<t.length;++i)if(!tt(t[i],r[i]))return!1;return!0}return t&&t.equals?t.equals(r):r&&r.equals?r.equals(t):typeof t=="number"&&typeof r=="number"?Math.abs(t-r)<=ut.EPSILON*Math.max(1,Math.abs(t),Math.abs(r)):!1}finally{ut.EPSILON=n}}function Cve(t){return Math.round(t/ut.EPSILON)*ut.EPSILON}function Mve(t){return t.clone?t.clone():new Array(t.length)}function vA(t,r,e){if(Lr(t)){var n=t;e=e||Mve(n);for(var i=0;i<e.length&&i<n.length;++i)e[i]=r(t[i],i,e);return e}return r(t)}function Ive(t){var r=Rve();return function(){var n=ot(t),i;if(r){var a=ot(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return rr(this,i)}}function Rve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Lve(t){function r(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return r.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(r,t):r.__proto__=t,r}var Uu=function(t){tr(e,t);var r=Ive(e);function e(){return Vt(this,e),r.apply(this,arguments)}return Ht(e,[{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"fromArray",value:function(i){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=0;o<this.ELEMENTS;++o)this[o]=i[o+a];return this.check()}},{key:"toArray",value:function(){for(var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=0;o<this.ELEMENTS;++o)i[a+o]=this[o];return i}},{key:"from",value:function(i){return Array.isArray(i)?this.copy(i):this.fromObject(i)}},{key:"to",value:function(i){return i===this?this:Lr(i)?this.toArray(i):this.toObject(i)}},{key:"toTarget",value:function(i){return i?this.to(i):this}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(ut)}},{key:"formatString",value:function(i){for(var a="",o=0;o<this.ELEMENTS;++o)a+=(o>0?", ":"")+Vc(this[o],i);return"".concat(i.printTypes?this.constructor.name:"","[").concat(a,"]")}},{key:"equals",value:function(i){if(!i||this.length!==i.length)return!1;for(var a=0;a<this.ELEMENTS;++a)if(!tt(this[a],i[a]))return!1;return!0}},{key:"exactEquals",value:function(i){if(!i||this.length!==i.length)return!1;for(var a=0;a<this.ELEMENTS;++a)if(this[a]!==i[a])return!1;return!0}},{key:"negate",value:function(){for(var i=0;i<this.ELEMENTS;++i)this[i]=-this[i];return this.check()}},{key:"lerp",value:function(i,a,o){if(o===void 0)return this.lerp(this,i,a);for(var s=0;s<this.ELEMENTS;++s){var u=i[s];this[s]=u+o*(a[s]-u)}return this.check()}},{key:"min",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]=Math.min(i[a],this[a]);return this.check()}},{key:"max",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]=Math.max(i[a],this[a]);return this.check()}},{key:"clamp",value:function(i,a){for(var o=0;o<this.ELEMENTS;++o)this[o]=Math.min(Math.max(this[o],i[o]),a[o]);return this.check()}},{key:"add",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var l=u[s],f=0;f<this.ELEMENTS;++f)this[f]+=l[f];return this.check()}},{key:"subtract",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var l=u[s],f=0;f<this.ELEMENTS;++f)this[f]-=l[f];return this.check()}},{key:"scale",value:function(i){if(typeof i=="number")for(var a=0;a<this.ELEMENTS;++a)this[a]*=i;else for(var o=0;o<this.ELEMENTS&&o<i.length;++o)this[o]*=i[o];return this.check()}},{key:"multiplyByScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]*=i;return this.check()}},{key:"check",value:function(){if(ut.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var i=this.length===this.ELEMENTS,a=0;a<this.ELEMENTS;++a)i=i&&Number.isFinite(this[a]);return i}},{key:"sub",value:function(i){return this.subtract(i)}},{key:"setScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]=i;return this.check()}},{key:"addScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]+=i;return this.check()}},{key:"subScalar",value:function(i){return this.addScalar(-i)}},{key:"multiplyScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]*=i;return this.check()}},{key:"divideScalar",value:function(i){return this.multiplyByScalar(1/i)}},{key:"clampScalar",value:function(i,a){for(var o=0;o<this.ELEMENTS;++o)this[o]=Math.min(Math.max(this[o],i),a);return this.check()}},{key:"elements",get:function(){return this}}]),e}(Lve(Array));function kve(t,r){if(t.length!==r)return!1;for(var e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}function Ge(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Qa(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(ut.debug&&!kve(t,r))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return t}function Bve(t){var r=Fve();return function(){var n=ot(t),i;if(r){var a=ot(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return rr(this,i)}}function Fve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Gu=function(t){tr(e,t);var r=Bve(e);function e(){return Vt(this,e),r.apply(this,arguments)}return Ht(e,[{key:"x",get:function(){return this[0]},set:function(i){this[0]=Ge(i)}},{key:"y",get:function(){return this[1]},set:function(i){this[1]=Ge(i)}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var i=0,a=0;a<this.ELEMENTS;++a)i+=this[a]*this[a];return i}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(i){return Math.sqrt(this.distanceSquared(i))}},{key:"distanceSquared",value:function(i){for(var a=0,o=0;o<this.ELEMENTS;++o){var s=this[o]-i[o];a+=s*s}return Ge(a)}},{key:"dot",value:function(i){for(var a=0,o=0;o<this.ELEMENTS;++o)a+=this[o]*i[o];return Ge(a)}},{key:"normalize",value:function(){var i=this.magnitude();if(i!==0)for(var a=0;a<this.ELEMENTS;++a)this[a]/=i;return this.check()}},{key:"multiply",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var l=u[s],f=0;f<this.ELEMENTS;++f)this[f]*=l[f];return this.check()}},{key:"divide",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var l=u[s],f=0;f<this.ELEMENTS;++f)this[f]/=l[f];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(i){return this.distance(i)}},{key:"distanceToSquared",value:function(i){return this.distanceSquared(i)}},{key:"getComponent",value:function(i){return qe(i>=0&&i<this.ELEMENTS,"index is out of range"),Ge(this[i])}},{key:"setComponent",value:function(i,a){return qe(i>=0&&i<this.ELEMENTS,"index is out of range"),this[i]=a,this.check()}},{key:"addVectors",value:function(i,a){return this.copy(i).add(a)}},{key:"subVectors",value:function(i,a){return this.copy(i).subtract(a)}},{key:"multiplyVectors",value:function(i,a){return this.copy(i).multiply(a)}},{key:"addScaledVector",value:function(i,a){return this.add(new this.constructor(i).multiplyScalar(a))}}]),e}(Uu);var pt=1e-6,gr=typeof Float32Array<"u"?Float32Array:Array;var l8e=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});function Dve(){var t=new gr(2);return gr!=Float32Array&&(t[0]=0,t[1]=0),t}function Hc(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t}function Nve(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t}function fF(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t}function cF(t){var r=t[0],e=t[1];return Math.hypot(r,e)}function pF(t,r){return t[0]=-r[0],t[1]=-r[1],t}function Bv(t,r,e,n){var i=r[0],a=r[1];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t}function hF(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i,t[1]=e[1]*n+e[3]*i,t}function dF(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i+e[4],t[1]=e[1]*n+e[3]*i+e[5],t}function Fv(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[3]*i+e[6],t[1]=e[1]*n+e[4]*i+e[7],t}function Dv(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[4]*i+e[12],t[1]=e[1]*n+e[5]*i+e[13],t}var vF=Nve;var f8e=function(){var t=Dve();return function(r,e,n,i,a,o){var s,u;for(e||(e=2),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],a(t,t,o),r[s]=t[0],r[s+1]=t[1];return r}}();function Nv(t,r,e){var n=r[0],i=r[1],a=e[3]*n+e[7]*i||1;return t[0]=(e[0]*n+e[4]*i)/a,t[1]=(e[1]*n+e[5]*i)/a,t}function jv(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[3]*n+e[7]*i+e[11]*a||1;return t[0]=(e[0]*n+e[4]*i+e[8]*a)/o,t[1]=(e[1]*n+e[5]*i+e[9]*a)/o,t[2]=(e[2]*n+e[6]*i+e[10]*a)/o,t}function mF(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i,t[1]=e[1]*n+e[3]*i,t[2]=r[2],t}function gF(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i,t[1]=e[1]*n+e[3]*i,t[2]=r[2],t[3]=r[3],t}function Uv(t,r,e){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n+e[3]*i+e[6]*a,t[1]=e[1]*n+e[4]*i+e[7]*a,t[2]=e[2]*n+e[5]*i+e[8]*a,t[3]=r[3],t}function jve(t){var r=Uve();return function(){var n=ot(t),i;if(r){var a=ot(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return rr(this,i)}}function Uve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Xn=function(t){tr(e,t);var r=jve(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return Vt(this,e),n=r.call(this,2),Lr(i)&&arguments.length===1?n.copy(i):(ut.debug&&(Ge(i),Ge(a)),n[0]=i,n[1]=a),n}return Ht(e,[{key:"set",value:function(i,a){return this[0]=i,this[1]=a,this.check()}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this.check()}},{key:"fromObject",value:function(i){return ut.debug&&(Ge(i.x),Ge(i.y)),this[0]=i.x,this[1]=i.y,this.check()}},{key:"toObject",value:function(i){return i.x=this[0],i.y=this[1],i}},{key:"ELEMENTS",get:function(){return 2}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"transform",value:function(i){return this.transformAsPoint(i)}},{key:"transformAsPoint",value:function(i){return Dv(this,this,i),this.check()}},{key:"transformAsVector",value:function(i){return Nv(this,this,i),this.check()}},{key:"transformByMatrix3",value:function(i){return Fv(this,this,i),this.check()}},{key:"transformByMatrix2x3",value:function(i){return dF(this,this,i),this.check()}},{key:"transformByMatrix2",value:function(i){return hF(this,this,i),this.check()}}]),e}(Gu);function gA(){var t=new gr(3);return gr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Wc(t){var r=t[0],e=t[1],n=t[2];return Math.hypot(r,e,n)}function yA(t,r,e){var n=new gr(3);return n[0]=t,n[1]=r,n[2]=e,n}function yF(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t}function Gve(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t}function zve(t,r){var e=r[0]-t[0],n=r[1]-t[1],i=r[2]-t[2];return Math.hypot(e,n,i)}function _F(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t}function bF(t,r){var e=r[0],n=r[1],i=r[2],a=e*e+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a,t}function $c(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function Vu(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[0],s=e[1],u=e[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t}function Hu(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[3]*n+e[7]*i+e[11]*a+e[15];return o=o||1,t[0]=(e[0]*n+e[4]*i+e[8]*a+e[12])/o,t[1]=(e[1]*n+e[5]*i+e[9]*a+e[13])/o,t[2]=(e[2]*n+e[6]*i+e[10]*a+e[14])/o,t}function Gv(t,r,e){var n=r[0],i=r[1],a=r[2];return t[0]=n*e[0]+i*e[3]+a*e[6],t[1]=n*e[1]+i*e[4]+a*e[7],t[2]=n*e[2]+i*e[5]+a*e[8],t}function zv(t,r,e){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],l=r[2],f=i*l-a*u,c=a*s-n*l,p=n*u-i*s,d=i*p-a*c,v=a*f-n*p,m=n*c-i*f,g=o*2;return f*=g,c*=g,p*=g,d*=2,v*=2,m*=2,t[0]=s+f+d,t[1]=u+c+v,t[2]=l+p+m,t}function xF(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function AF(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function TF(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function SF(t,r){var e=t[0],n=t[1],i=t[2],a=r[0],o=r[1],s=r[2],u=Math.sqrt(e*e+n*n+i*i),l=Math.sqrt(a*a+o*o+s*s),f=u*l,c=f&&$c(t,r)/f;return Math.acos(Math.min(Math.max(c,-1),1))}var PF=Gve;var wF=zve;var OF=Wc;var A8e=function(){var t=gA();return function(r,e,n,i,a,o){var s,u;for(e||(e=3),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2];return r}}();function Vve(t){var r=Hve();return function(){var n=ot(t),i;if(r){var a=ot(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return rr(this,i)}}function Hve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _A=[0,0,0],Vv,V=function(t){tr(e,t);var r=Vve(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return Vt(this,e),n=r.call(this,-0,-0,-0),arguments.length===1&&Lr(i)?n.copy(i):(ut.debug&&(Ge(i),Ge(a),Ge(o)),n[0]=i,n[1]=a,n[2]=o),n}return Ht(e,[{key:"set",value:function(i,a,o){return this[0]=i,this[1]=a,this[2]=o,this.check()}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this.check()}},{key:"fromObject",value:function(i){return ut.debug&&(Ge(i.x),Ge(i.y),Ge(i.z)),this[0]=i.x,this[1]=i.y,this[2]=i.z,this.check()}},{key:"toObject",value:function(i){return i.x=this[0],i.y=this[1],i.z=this[2],i}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(i){this[2]=Ge(i)}},{key:"angle",value:function(i){return SF(this,i)}},{key:"cross",value:function(i){return Vu(this,this,i),this.check()}},{key:"rotateX",value:function(i){var a=i.radians,o=i.origin,s=o===void 0?_A:o;return xF(this,this,s,a),this.check()}},{key:"rotateY",value:function(i){var a=i.radians,o=i.origin,s=o===void 0?_A:o;return AF(this,this,s,a),this.check()}},{key:"rotateZ",value:function(i){var a=i.radians,o=i.origin,s=o===void 0?_A:o;return TF(this,this,s,a),this.check()}},{key:"transform",value:function(i){return this.transformAsPoint(i)}},{key:"transformAsPoint",value:function(i){return Hu(this,this,i),this.check()}},{key:"transformAsVector",value:function(i){return jv(this,this,i),this.check()}},{key:"transformByMatrix3",value:function(i){return Gv(this,this,i),this.check()}},{key:"transformByMatrix2",value:function(i){return mF(this,this,i),this.check()}},{key:"transformByQuaternion",value:function(i){return zv(this,this,i),this.check()}}],[{key:"ZERO",get:function(){return Vv||(Vv=new e(0,0,0),Object.freeze(Vv)),Vv}}]),e}(Gu);function Wve(t){var r=$ve();return function(){var n=ot(t),i;if(r){var a=ot(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return rr(this,i)}}function $ve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Hv,EF=function(t){tr(e,t);var r=Wve(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;return Vt(this,e),n=r.call(this,-0,-0,-0,-0),Lr(i)&&arguments.length===1?n.copy(i):(ut.debug&&(Ge(i),Ge(a),Ge(o),Ge(s)),n[0]=i,n[1]=a,n[2]=o,n[3]=s),n}return Ht(e,[{key:"set",value:function(i,a,o,s){return this[0]=i,this[1]=a,this[2]=o,this[3]=s,this.check()}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this[3]=i[3],this.check()}},{key:"fromObject",value:function(i){return ut.debug&&(Ge(i.x),Ge(i.y),Ge(i.z),Ge(i.w)),this[0]=i.x,this[1]=i.y,this[2]=i.z,this[3]=i.w,this}},{key:"toObject",value:function(i){return i.x=this[0],i.y=this[1],i.z=this[2],i.w=this[3],i}},{key:"ELEMENTS",get:function(){return 4}},{key:"z",get:function(){return this[2]},set:function(i){this[2]=Ge(i)}},{key:"w",get:function(){return this[3]},set:function(i){this[3]=Ge(i)}},{key:"transform",value:function(i){return Hu(this,this,i),this.check()}},{key:"transformByMatrix3",value:function(i){return Uv(this,this,i),this.check()}},{key:"transformByMatrix2",value:function(i){return gF(this,this,i),this.check()}},{key:"transformByQuaternion",value:function(i){return zv(this,this,i),this.check()}},{key:"applyMatrix4",value:function(i){return i.transform(this,this),this}}],[{key:"ZERO",get:function(){return Hv||(Hv=new e(0,0,0,0),Object.freeze(Hv)),Hv}}]),e}(Gu);function Xve(t){var r=qve();return function(){var n=ot(t),i;if(r){var a=ot(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return rr(this,i)}}function qve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Wv=function(t){tr(e,t);var r=Xve(e);function e(){return Vt(this,e),r.apply(this,arguments)}return Ht(e,[{key:"toString",value:function(){var i="[";if(ut.printRowMajor){i+="row-major:";for(var a=0;a<this.RANK;++a)for(var o=0;o<this.RANK;++o)i+=" ".concat(this[o*this.RANK+a])}else{i+="column-major:";for(var s=0;s<this.ELEMENTS;++s)i+=" ".concat(this[s])}return i+="]",i}},{key:"getElementIndex",value:function(i,a){return a*this.RANK+i}},{key:"getElement",value:function(i,a){return this[a*this.RANK+i]}},{key:"setElement",value:function(i,a,o){return this[a*this.RANK+i]=Ge(o),this}},{key:"getColumn",value:function(i){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0),o=i*this.RANK,s=0;s<this.RANK;++s)a[s]=this[o+s];return a}},{key:"setColumn",value:function(i,a){for(var o=i*this.RANK,s=0;s<this.RANK;++s)this[o+s]=a[s];return this}}]),e}(Uu);function CF(){var t=new gr(9);return gr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function MF(t,r){if(t===r){var e=r[1],n=r[2],i=r[5];t[1]=r[3],t[2]=r[6],t[3]=e,t[5]=r[7],t[6]=n,t[7]=i}else t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8];return t}function IF(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],l=r[7],f=r[8],c=f*o-s*l,p=-f*a+s*u,d=l*a-o*u,v=e*c+n*p+i*d;return v?(v=1/v,t[0]=c*v,t[1]=(-f*n+i*l)*v,t[2]=(s*n-i*o)*v,t[3]=p*v,t[4]=(f*e-i*u)*v,t[5]=(-s*e+i*a)*v,t[6]=d*v,t[7]=(-l*e+n*u)*v,t[8]=(o*e-n*a)*v,t):null}function RF(t){var r=t[0],e=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8];return r*(l*a-o*u)+e*(-l*i+o*s)+n*(u*i-a*s)}function bA(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],f=r[7],c=r[8],p=e[0],d=e[1],v=e[2],m=e[3],g=e[4],y=e[5],_=e[6],b=e[7],x=e[8];return t[0]=p*n+d*o+v*l,t[1]=p*i+d*s+v*f,t[2]=p*a+d*u+v*c,t[3]=m*n+g*o+y*l,t[4]=m*i+g*s+y*f,t[5]=m*a+g*u+y*c,t[6]=_*n+b*o+x*l,t[7]=_*i+b*s+x*f,t[8]=_*a+b*u+x*c,t}function LF(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],f=r[7],c=r[8],p=e[0],d=e[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=p*n+d*o+l,t[7]=p*i+d*s+f,t[8]=p*a+d*u+c,t}function kF(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],f=r[7],c=r[8],p=Math.sin(e),d=Math.cos(e);return t[0]=d*n+p*o,t[1]=d*i+p*s,t[2]=d*a+p*u,t[3]=d*o-p*n,t[4]=d*s-p*i,t[5]=d*u-p*a,t[6]=l,t[7]=f,t[8]=c,t}function xA(t,r,e){var n=e[0],i=e[1];return t[0]=n*r[0],t[1]=n*r[1],t[2]=n*r[2],t[3]=i*r[3],t[4]=i*r[4],t[5]=i*r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t}function BF(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e+e,s=n+n,u=i+i,l=e*o,f=n*o,c=n*s,p=i*o,d=i*s,v=i*u,m=a*o,g=a*s,y=a*u;return t[0]=1-c-v,t[3]=f-y,t[6]=p+g,t[1]=f+y,t[4]=1-l-v,t[7]=d-m,t[2]=p-g,t[5]=d+m,t[8]=1-l-c,t}function Yve(t){var r=Kve();return function(){var n=ot(t),i;if(r){var a=ot(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return rr(this,i)}}function Kve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AA;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(AA||(AA={}));var Jve=Object.freeze([1,0,0,0,1,0,0,0,1]),lt=function(t){tr(e,t);var r=Yve(e);function e(n){for(var i,a=arguments.length,o=new Array(a>1?a-1:0),s=1;s<a;s++)o[s-1]=arguments[s];return Vt(this,e),i=r.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(n)?i.copy(n):o.length>0?i.copy([n].concat(o)):i.identity(),i}return Ht(e,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return AA}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this[3]=i[3],this[4]=i[4],this[5]=i[5],this[6]=i[6],this[7]=i[7],this[8]=i[8],this.check()}},{key:"identity",value:function(){return this.copy(Jve)}},{key:"fromObject",value:function(i){return this.check()}},{key:"fromQuaternion",value:function(i){return BF(this,i),this.check()}},{key:"set",value:function(i,a,o,s,u,l,f,c,p){return this[0]=i,this[1]=a,this[2]=o,this[3]=s,this[4]=u,this[5]=l,this[6]=f,this[7]=c,this[8]=p,this.check()}},{key:"setRowMajor",value:function(i,a,o,s,u,l,f,c,p){return this[0]=i,this[1]=s,this[2]=f,this[3]=a,this[4]=u,this[5]=c,this[6]=o,this[7]=l,this[8]=p,this.check()}},{key:"determinant",value:function(){return RF(this)}},{key:"transpose",value:function(){return MF(this,this),this.check()}},{key:"invert",value:function(){return IF(this,this),this.check()}},{key:"multiplyLeft",value:function(i){return bA(this,i,this),this.check()}},{key:"multiplyRight",value:function(i){return bA(this,this,i),this.check()}},{key:"rotate",value:function(i){return kF(this,this,i),this.check()}},{key:"scale",value:function(i){return Array.isArray(i)?xA(this,this,i):xA(this,this,[i,i]),this.check()}},{key:"translate",value:function(i){return LF(this,this,i),this.check()}},{key:"transform",value:function(i,a){var o;switch(i.length){case 2:o=Fv(a||[-0,-0],i,this);break;case 3:o=Gv(a||[-0,-0,-0],i,this);break;case 4:o=Uv(a||[-0,-0,-0,-0],i,this);break;default:throw new Error("Illegal vector")}return Qa(o,i.length),o}},{key:"transformVector",value:function(i,a){return this.transform(i,a)}},{key:"transformVector2",value:function(i,a){return this.transform(i,a)}},{key:"transformVector3",value:function(i,a){return this.transform(i,a)}}],[{key:"IDENTITY",get:function(){return Qve()}},{key:"ZERO",get:function(){return Zve()}}]),e}(Wv);var $v,Xv;function Zve(){return $v||($v=new lt([0,0,0,0,0,0,0,0,0]),Object.freeze($v)),$v}function Qve(){return Xv||(Xv=new lt,Object.freeze(Xv)),Xv}function eme(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function DF(t,r){if(t===r){var e=r[1],n=r[2],i=r[3],a=r[6],o=r[7],s=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=e,t[6]=r[9],t[7]=r[13],t[8]=n,t[9]=a,t[11]=r[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t}function qv(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],l=r[7],f=r[8],c=r[9],p=r[10],d=r[11],v=r[12],m=r[13],g=r[14],y=r[15],_=e*s-n*o,b=e*u-i*o,x=e*l-a*o,A=n*u-i*s,T=n*l-a*s,O=i*l-a*u,w=f*m-c*v,E=f*g-p*v,S=f*y-d*v,I=c*g-p*m,R=c*y-d*m,z=p*y-d*g,G=_*z-b*R+x*I+A*S-T*E+O*w;return G?(G=1/G,t[0]=(s*z-u*R+l*I)*G,t[1]=(i*R-n*z-a*I)*G,t[2]=(m*O-g*T+y*A)*G,t[3]=(p*T-c*O-d*A)*G,t[4]=(u*S-o*z-l*E)*G,t[5]=(e*z-i*S+a*E)*G,t[6]=(g*x-v*O-y*b)*G,t[7]=(f*O-p*x+d*b)*G,t[8]=(o*R-s*S+l*w)*G,t[9]=(n*S-e*R-a*w)*G,t[10]=(v*T-m*x+y*_)*G,t[11]=(c*x-f*T-d*_)*G,t[12]=(s*E-o*I-u*w)*G,t[13]=(e*I-n*E+i*w)*G,t[14]=(m*b-v*A-g*_)*G,t[15]=(f*A-c*b+p*_)*G,t):null}function NF(t){var r=t[0],e=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],f=t[9],c=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=r*o-e*a,_=r*s-n*a,b=r*u-i*a,x=e*s-n*o,A=e*u-i*o,T=n*u-i*s,O=l*v-f*d,w=l*m-c*d,E=l*g-p*d,S=f*m-c*v,I=f*g-p*v,R=c*g-p*m;return y*R-_*I+b*S+x*E-A*w+T*O}function ss(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],f=r[7],c=r[8],p=r[9],d=r[10],v=r[11],m=r[12],g=r[13],y=r[14],_=r[15],b=e[0],x=e[1],A=e[2],T=e[3];return t[0]=b*n+x*s+A*c+T*m,t[1]=b*i+x*u+A*p+T*g,t[2]=b*a+x*l+A*d+T*y,t[3]=b*o+x*f+A*v+T*_,b=e[4],x=e[5],A=e[6],T=e[7],t[4]=b*n+x*s+A*c+T*m,t[5]=b*i+x*u+A*p+T*g,t[6]=b*a+x*l+A*d+T*y,t[7]=b*o+x*f+A*v+T*_,b=e[8],x=e[9],A=e[10],T=e[11],t[8]=b*n+x*s+A*c+T*m,t[9]=b*i+x*u+A*p+T*g,t[10]=b*a+x*l+A*d+T*y,t[11]=b*o+x*f+A*v+T*_,b=e[12],x=e[13],A=e[14],T=e[15],t[12]=b*n+x*s+A*c+T*m,t[13]=b*i+x*u+A*p+T*g,t[14]=b*a+x*l+A*d+T*y,t[15]=b*o+x*f+A*v+T*_,t}function us(t,r,e){var n=e[0],i=e[1],a=e[2],o,s,u,l,f,c,p,d,v,m,g,y;return r===t?(t[12]=r[0]*n+r[4]*i+r[8]*a+r[12],t[13]=r[1]*n+r[5]*i+r[9]*a+r[13],t[14]=r[2]*n+r[6]*i+r[10]*a+r[14],t[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(o=r[0],s=r[1],u=r[2],l=r[3],f=r[4],c=r[5],p=r[6],d=r[7],v=r[8],m=r[9],g=r[10],y=r[11],t[0]=o,t[1]=s,t[2]=u,t[3]=l,t[4]=f,t[5]=c,t[6]=p,t[7]=d,t[8]=v,t[9]=m,t[10]=g,t[11]=y,t[12]=o*n+f*i+v*a+r[12],t[13]=s*n+c*i+m*a+r[13],t[14]=u*n+p*i+g*a+r[14],t[15]=l*n+d*i+y*a+r[15]),t}function Wu(t,r,e){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=r[7]*i,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function jF(t,r,e,n){var i=n[0],a=n[1],o=n[2],s=Math.hypot(i,a,o),u,l,f,c,p,d,v,m,g,y,_,b,x,A,T,O,w,E,S,I,R,z,G,k;return s<pt?null:(s=1/s,i*=s,a*=s,o*=s,u=Math.sin(e),l=Math.cos(e),f=1-l,c=r[0],p=r[1],d=r[2],v=r[3],m=r[4],g=r[5],y=r[6],_=r[7],b=r[8],x=r[9],A=r[10],T=r[11],O=i*i*f+l,w=a*i*f+o*u,E=o*i*f-a*u,S=i*a*f-o*u,I=a*a*f+l,R=o*a*f+i*u,z=i*o*f+a*u,G=a*o*f-i*u,k=o*o*f+l,t[0]=c*O+m*w+b*E,t[1]=p*O+g*w+x*E,t[2]=d*O+y*w+A*E,t[3]=v*O+_*w+T*E,t[4]=c*S+m*I+b*R,t[5]=p*S+g*I+x*R,t[6]=d*S+y*I+A*R,t[7]=v*S+_*I+T*R,t[8]=c*z+m*G+b*k,t[9]=p*z+g*G+x*k,t[10]=d*z+y*G+A*k,t[11]=v*z+_*G+T*k,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)}function Yv(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[4],o=r[5],s=r[6],u=r[7],l=r[8],f=r[9],c=r[10],p=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=a*i+l*n,t[5]=o*i+f*n,t[6]=s*i+c*n,t[7]=u*i+p*n,t[8]=l*i-a*n,t[9]=f*i-o*n,t[10]=c*i-s*n,t[11]=p*i-u*n,t}function UF(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[0],o=r[1],s=r[2],u=r[3],l=r[8],f=r[9],c=r[10],p=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*i-l*n,t[1]=o*i-f*n,t[2]=s*i-c*n,t[3]=u*i-p*n,t[8]=a*n+l*i,t[9]=o*n+f*i,t[10]=s*n+c*i,t[11]=u*n+p*i,t}function Kv(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[0],o=r[1],s=r[2],u=r[3],l=r[4],f=r[5],c=r[6],p=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*i+l*n,t[1]=o*i+f*n,t[2]=s*i+c*n,t[3]=u*i+p*n,t[4]=l*i-a*n,t[5]=f*i-o*n,t[6]=c*i-s*n,t[7]=p*i-u*n,t}function GF(t,r){var e=r[0],n=r[1],i=r[2],a=r[4],o=r[5],s=r[6],u=r[8],l=r[9],f=r[10];return t[0]=Math.hypot(e,n,i),t[1]=Math.hypot(a,o,s),t[2]=Math.hypot(u,l,f),t}function zF(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e+e,s=n+n,u=i+i,l=e*o,f=n*o,c=n*s,p=i*o,d=i*s,v=i*u,m=a*o,g=a*s,y=a*u;return t[0]=1-c-v,t[1]=f+y,t[2]=p-g,t[3]=0,t[4]=f-y,t[5]=1-l-v,t[6]=d+m,t[7]=0,t[8]=p+g,t[9]=d-m,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function VF(t,r,e,n,i,a,o){var s=1/(e-r),u=1/(i-n),l=1/(a-o);return t[0]=a*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*u,t[6]=0,t[7]=0,t[8]=(e+r)*s,t[9]=(i+n)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t}function tme(t,r,e,n,i){var a=1/Math.tan(r/2),o;return t[0]=a/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(n-i),t[10]=(i+n)*o,t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t}var Jv=tme;function rme(t,r,e,n,i,a,o){var s=1/(r-e),u=1/(n-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(r+e)*s,t[13]=(i+n)*u,t[14]=(o+a)*l,t[15]=1,t}var HF=rme;function WF(t,r,e,n){var i,a,o,s,u,l,f,c,p,d,v=r[0],m=r[1],g=r[2],y=n[0],_=n[1],b=n[2],x=e[0],A=e[1],T=e[2];return Math.abs(v-x)<pt&&Math.abs(m-A)<pt&&Math.abs(g-T)<pt?eme(t):(f=v-x,c=m-A,p=g-T,d=1/Math.hypot(f,c,p),f*=d,c*=d,p*=d,i=_*p-b*c,a=b*f-y*p,o=y*c-_*f,d=Math.hypot(i,a,o),d?(d=1/d,i*=d,a*=d,o*=d):(i=0,a=0,o=0),s=c*o-p*a,u=p*i-f*o,l=f*a-c*i,d=Math.hypot(s,u,l),d?(d=1/d,s*=d,u*=d,l*=d):(s=0,u=0,l=0),t[0]=i,t[1]=s,t[2]=f,t[3]=0,t[4]=a,t[5]=u,t[6]=c,t[7]=0,t[8]=o,t[9]=l,t[10]=p,t[11]=0,t[12]=-(i*v+a*m+o*g),t[13]=-(s*v+u*m+l*g),t[14]=-(f*v+c*m+p*g),t[15]=1,t)}function TA(t,r){var e=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],f=t[8],c=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],_=r[0],b=r[1],x=r[2],A=r[3],T=r[4],O=r[5],w=r[6],E=r[7],S=r[8],I=r[9],R=r[10],z=r[11],G=r[12],k=r[13],U=r[14],j=r[15];return Math.abs(e-_)<=pt*Math.max(1,Math.abs(e),Math.abs(_))&&Math.abs(n-b)<=pt*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-x)<=pt*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(a-A)<=pt*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(o-T)<=pt*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(s-O)<=pt*Math.max(1,Math.abs(s),Math.abs(O))&&Math.abs(u-w)<=pt*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(l-E)<=pt*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(f-S)<=pt*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(c-I)<=pt*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(p-R)<=pt*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(d-z)<=pt*Math.max(1,Math.abs(d),Math.abs(z))&&Math.abs(v-G)<=pt*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(m-k)<=pt*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(g-U)<=pt*Math.max(1,Math.abs(g),Math.abs(U))&&Math.abs(y-j)<=pt*Math.max(1,Math.abs(y),Math.abs(j))}function nme(){var t=new gr(4);return gr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function $F(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t[3]=r[3]+e[3],t}function Qv(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t}function XF(t){var r=t[0],e=t[1],n=t[2],i=t[3];return Math.hypot(r,e,n,i)}function qF(t){var r=t[0],e=t[1],n=t[2],i=t[3];return r*r+e*e+n*n+i*i}function YF(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e*e+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=e*o,t[1]=n*o,t[2]=i*o,t[3]=a*o,t}function KF(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]}function JF(t,r,e,n){var i=r[0],a=r[1],o=r[2],s=r[3];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t[2]=o+n*(e[2]-o),t[3]=s+n*(e[3]-s),t}function em(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3];return t[0]=e[0]*n+e[4]*i+e[8]*a+e[12]*o,t[1]=e[1]*n+e[5]*i+e[9]*a+e[13]*o,t[2]=e[2]*n+e[6]*i+e[10]*a+e[14]*o,t[3]=e[3]*n+e[7]*i+e[11]*a+e[15]*o,t}function ZF(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[0],s=e[1],u=e[2],l=e[3],f=l*n+s*a-u*i,c=l*i+u*n-o*a,p=l*a+o*i-s*n,d=-o*n-s*i-u*a;return t[0]=f*l+d*-o+c*-u-p*-s,t[1]=c*l+d*-s+p*-o-f*-u,t[2]=p*l+d*-u+f*-s-c*-o,t[3]=r[3],t}var s5e=function(){var t=nme();return function(r,e,n,i,a,o){var s,u;for(e||(e=4),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}();function ime(t){var r=ame();return function(){var n=ot(t),i;if(r){var a=ot(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return rr(this,i)}}function ame(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OA;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(OA||(OA={}));var ome=45*Math.PI/180,sme=1,PA=.1,wA=500,ume=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),ce=function(t){tr(e,t);var r=ime(e);function e(n){var i;return Vt(this,e),i=r.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(n)?i.copy(n):i.identity(),i}return Ht(e,[{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}},{key:"INDICES",get:function(){return OA}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this[3]=i[3],this[4]=i[4],this[5]=i[5],this[6]=i[6],this[7]=i[7],this[8]=i[8],this[9]=i[9],this[10]=i[10],this[11]=i[11],this[12]=i[12],this[13]=i[13],this[14]=i[14],this[15]=i[15],this.check()}},{key:"set",value:function(i,a,o,s,u,l,f,c,p,d,v,m,g,y,_,b){return this[0]=i,this[1]=a,this[2]=o,this[3]=s,this[4]=u,this[5]=l,this[6]=f,this[7]=c,this[8]=p,this[9]=d,this[10]=v,this[11]=m,this[12]=g,this[13]=y,this[14]=_,this[15]=b,this.check()}},{key:"setRowMajor",value:function(i,a,o,s,u,l,f,c,p,d,v,m,g,y,_,b){return this[0]=i,this[1]=u,this[2]=p,this[3]=g,this[4]=a,this[5]=l,this[6]=d,this[7]=y,this[8]=o,this[9]=f,this[10]=v,this[11]=_,this[12]=s,this[13]=c,this[14]=m,this[15]=b,this.check()}},{key:"toRowMajor",value:function(i){return i[0]=this[0],i[1]=this[4],i[2]=this[8],i[3]=this[12],i[4]=this[1],i[5]=this[5],i[6]=this[9],i[7]=this[13],i[8]=this[2],i[9]=this[6],i[10]=this[10],i[11]=this[14],i[12]=this[3],i[13]=this[7],i[14]=this[11],i[15]=this[15],i}},{key:"identity",value:function(){return this.copy(ume)}},{key:"fromObject",value:function(i){return this.check()}},{key:"fromQuaternion",value:function(i){return zF(this,i),this.check()}},{key:"frustum",value:function(i){var a=i.left,o=i.right,s=i.bottom,u=i.top,l=i.near,f=l===void 0?PA:l,c=i.far,p=c===void 0?wA:c;return p===1/0?cme(this,a,o,s,u,f):VF(this,a,o,s,u,f,p),this.check()}},{key:"lookAt",value:function(i){var a=i.eye,o=i.center,s=o===void 0?[0,0,0]:o,u=i.up,l=u===void 0?[0,1,0]:u;return WF(this,a,s,l),this.check()}},{key:"ortho",value:function(i){var a=i.left,o=i.right,s=i.bottom,u=i.top,l=i.near,f=l===void 0?PA:l,c=i.far,p=c===void 0?wA:c;return HF(this,a,o,s,u,f,p),this.check()}},{key:"orthographic",value:function(i){var a=i.fovy,o=a===void 0?ome:a,s=i.aspect,u=s===void 0?sme:s,l=i.focalDistance,f=l===void 0?1:l,c=i.near,p=c===void 0?PA:c,d=i.far,v=d===void 0?wA:d;QF(o);var m=o/2,g=f*Math.tan(m),y=g*u;return this.ortho({left:-y,right:y,bottom:-g,top:g,near:p,far:v})}},{key:"perspective",value:function(i){var a=i.fovy,o=a===void 0?45*Math.PI/180:a,s=i.aspect,u=s===void 0?1:s,l=i.near,f=l===void 0?.1:l,c=i.far,p=c===void 0?500:c;return QF(o),Jv(this,o,u,f,p),this.check()}},{key:"determinant",value:function(){return NF(this)}},{key:"getScale",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return i[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),i[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),i[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),i}},{key:"getTranslation",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return i[0]=this[12],i[1]=this[13],i[2]=this[14],i}},{key:"getRotation",value:function(i,a){i=i||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],a=a||[-0,-0,-0];var o=this.getScale(a),s=1/o[0],u=1/o[1],l=1/o[2];return i[0]=this[0]*s,i[1]=this[1]*u,i[2]=this[2]*l,i[3]=0,i[4]=this[4]*s,i[5]=this[5]*u,i[6]=this[6]*l,i[7]=0,i[8]=this[8]*s,i[9]=this[9]*u,i[10]=this[10]*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}},{key:"getRotationMatrix3",value:function(i,a){i=i||[-0,-0,-0,-0,-0,-0,-0,-0,-0],a=a||[-0,-0,-0];var o=this.getScale(a),s=1/o[0],u=1/o[1],l=1/o[2];return i[0]=this[0]*s,i[1]=this[1]*u,i[2]=this[2]*l,i[3]=this[4]*s,i[4]=this[5]*u,i[5]=this[6]*l,i[6]=this[8]*s,i[7]=this[9]*u,i[8]=this[10]*l,i}},{key:"transpose",value:function(){return DF(this,this),this.check()}},{key:"invert",value:function(){return qv(this,this),this.check()}},{key:"multiplyLeft",value:function(i){return ss(this,i,this),this.check()}},{key:"multiplyRight",value:function(i){return ss(this,this,i),this.check()}},{key:"rotateX",value:function(i){return Yv(this,this,i),this.check()}},{key:"rotateY",value:function(i){return UF(this,this,i),this.check()}},{key:"rotateZ",value:function(i){return Kv(this,this,i),this.check()}},{key:"rotateXYZ",value:function(i){return this.rotateX(i[0]).rotateY(i[1]).rotateZ(i[2])}},{key:"rotateAxis",value:function(i,a){return jF(this,this,i,a),this.check()}},{key:"scale",value:function(i){return Wu(this,this,Array.isArray(i)?i:[i,i,i]),this.check()}},{key:"translate",value:function(i){return us(this,this,i),this.check()}},{key:"transform",value:function(i,a){return i.length===4?(a=em(a||[-0,-0,-0,-0],i,this),Qa(a,4),a):this.transformAsPoint(i,a)}},{key:"transformAsPoint",value:function(i,a){var o=i.length,s;switch(o){case 2:s=Dv(a||[-0,-0],i,this);break;case 3:s=Hu(a||[-0,-0,-0],i,this);break;default:throw new Error("Illegal vector")}return Qa(s,i.length),s}},{key:"transformAsVector",value:function(i,a){var o;switch(i.length){case 2:o=Nv(a||[-0,-0],i,this);break;case 3:o=jv(a||[-0,-0,-0],i,this);break;default:throw new Error("Illegal vector")}return Qa(o,i.length),o}},{key:"transformPoint",value:function(i,a){return this.transformAsPoint(i,a)}},{key:"transformVector",value:function(i,a){return this.transformAsPoint(i,a)}},{key:"transformDirection",value:function(i,a){return this.transformAsVector(i,a)}},{key:"makeRotationX",value:function(i){return this.identity().rotateX(i)}},{key:"makeTranslation",value:function(i,a,o){return this.identity().translate([i,a,o])}}],[{key:"IDENTITY",get:function(){return fme()}},{key:"ZERO",get:function(){return lme()}}]),e}(Wv);var tm,rm;function lme(){return tm||(tm=new ce([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(tm)),tm}function fme(){return rm||(rm=new ce,Object.freeze(rm)),rm}function QF(t){if(t>Math.PI*2)throw Error("expected radians")}function cme(t,r,e,n,i,a){var o=2*a/(e-r),s=2*a/(i-n),u=(e+r)/(e-r),l=(i+n)/(i-n),f=-1,c=-1,p=-2*a;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=l,t[10]=f,t[11]=c,t[12]=0,t[13]=0,t[14]=p,t[15]=0,t}function eD(){var t=new gr(4);return gr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function tD(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function EA(t,r,e){e=e*.5;var n=Math.sin(e);return t[0]=n*r[0],t[1]=n*r[1],t[2]=n*r[2],t[3]=Math.cos(e),t}function CA(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=e[0],u=e[1],l=e[2],f=e[3];return t[0]=n*f+o*s+i*l-a*u,t[1]=i*f+o*u+a*s-n*l,t[2]=a*f+o*l+n*u-i*s,t[3]=o*f-n*s-i*u-a*l,t}function rD(t,r,e){e*=.5;var n=r[0],i=r[1],a=r[2],o=r[3],s=Math.sin(e),u=Math.cos(e);return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-n*s,t}function nD(t,r,e){e*=.5;var n=r[0],i=r[1],a=r[2],o=r[3],s=Math.sin(e),u=Math.cos(e);return t[0]=n*u-a*s,t[1]=i*u+o*s,t[2]=a*u+n*s,t[3]=o*u-i*s,t}function iD(t,r,e){e*=.5;var n=r[0],i=r[1],a=r[2],o=r[3],s=Math.sin(e),u=Math.cos(e);return t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t}function aD(t,r){var e=r[0],n=r[1],i=r[2];return t[0]=e,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-e*e-n*n-i*i)),t}function Xc(t,r,e,n){var i=r[0],a=r[1],o=r[2],s=r[3],u=e[0],l=e[1],f=e[2],c=e[3],p,d,v,m,g;return d=i*u+a*l+o*f+s*c,d<0&&(d=-d,u=-u,l=-l,f=-f,c=-c),1-d>pt?(p=Math.acos(d),v=Math.sin(p),m=Math.sin((1-n)*p)/v,g=Math.sin(n*p)/v):(m=1-n,g=n),t[0]=m*i+g*u,t[1]=m*a+g*l,t[2]=m*o+g*f,t[3]=m*s+g*c,t}function oD(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e*e+n*n+i*i+a*a,s=o?1/o:0;return t[0]=-e*s,t[1]=-n*s,t[2]=-i*s,t[3]=a*s,t}function sD(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=r[3],t}function MA(t,r){var e=r[0]+r[4]+r[8],n;if(e>0)n=Math.sqrt(e+1),t[3]=.5*n,n=.5/n,t[0]=(r[5]-r[7])*n,t[1]=(r[6]-r[2])*n,t[2]=(r[1]-r[3])*n;else{var i=0;r[4]>r[0]&&(i=1),r[8]>r[i*3+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;n=Math.sqrt(r[i*3+i]-r[a*3+a]-r[o*3+o]+1),t[i]=.5*n,n=.5/n,t[3]=(r[a*3+o]-r[o*3+a])*n,t[a]=(r[a*3+i]+r[i*3+a])*n,t[o]=(r[o*3+i]+r[i*3+o])*n}return t}var uD=$F;var lD=Qv,fD=KF,cD=JF,pD=XF;var hD=qF;var dD=YF;var vD=function(){var t=gA(),r=yA(1,0,0),e=yA(0,1,0);return function(n,i,a){var o=$c(i,a);return o<-.999999?(Vu(t,r,i),OF(t)<1e-6&&Vu(t,e,i),bF(t,t),EA(n,t,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Vu(t,i,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+o,dD(n,n))}}(),T5e=function(){var t=eD(),r=eD();return function(e,n,i,a,o,s){return Xc(t,n,o,s),Xc(r,i,a,s),Xc(e,t,r,2*s*(1-s)),e}}(),S5e=function(){var t=CF();return function(r,e,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-e[0],t[5]=-e[1],t[8]=-e[2],dD(r,MA(r,t))}}();function hme(t){var r=dme();return function(){var n=ot(t),i;if(r){var a=ot(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return rr(this,i)}}function dme(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vme=[0,0,0,1],Ti=function(t){tr(e,t);var r=hme(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;return Vt(this,e),n=r.call(this,-0,-0,-0,-0),Array.isArray(i)&&arguments.length===1?n.copy(i):n.set(i,a,o,s),n}return Ht(e,[{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this[3]=i[3],this.check()}},{key:"set",value:function(i,a,o,s){return this[0]=i,this[1]=a,this[2]=o,this[3]=s,this.check()}},{key:"fromObject",value:function(i){return this[0]=i.x,this[1]=i.y,this[2]=i.z,this[3]=i.w,this.check()}},{key:"fromMatrix3",value:function(i){return MA(this,i),this.check()}},{key:"fromAxisRotation",value:function(i,a){return EA(this,i,a),this.check()}},{key:"identity",value:function(){return tD(this),this.check()}},{key:"setAxisAngle",value:function(i,a){return this.fromAxisRotation(i,a)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(i){this[0]=Ge(i)}},{key:"y",get:function(){return this[1]},set:function(i){this[1]=Ge(i)}},{key:"z",get:function(){return this[2]},set:function(i){this[2]=Ge(i)}},{key:"w",get:function(){return this[3]},set:function(i){this[3]=Ge(i)}},{key:"len",value:function(){return pD(this)}},{key:"lengthSquared",value:function(){return hD(this)}},{key:"dot",value:function(i){return fD(this,i)}},{key:"rotationTo",value:function(i,a){return vD(this,i,a),this.check()}},{key:"add",value:function(i){return uD(this,this,i),this.check()}},{key:"calculateW",value:function(){return aD(this,this),this.check()}},{key:"conjugate",value:function(){return sD(this,this),this.check()}},{key:"invert",value:function(){return oD(this,this),this.check()}},{key:"lerp",value:function(i,a,o){return o===void 0?this.lerp(this,i,a):(cD(this,i,a,o),this.check())}},{key:"multiplyRight",value:function(i){return CA(this,this,i),this.check()}},{key:"multiplyLeft",value:function(i){return CA(this,i,this),this.check()}},{key:"normalize",value:function(){var i=this.len(),a=i>0?1/i:0;return this[0]=this[0]*a,this[1]=this[1]*a,this[2]=this[2]*a,this[3]=this[3]*a,i===0&&(this[3]=1),this.check()}},{key:"rotateX",value:function(i){return rD(this,this,i),this.check()}},{key:"rotateY",value:function(i){return nD(this,this,i),this.check()}},{key:"rotateZ",value:function(i){return iD(this,this,i),this.check()}},{key:"scale",value:function(i){return lD(this,this,i),this.check()}},{key:"slerp",value:function(i,a,o){var s,u,l;switch(arguments.length){case 1:var f=i.start;s=f===void 0?vme:f,u=i.target,l=i.ratio;break;case 2:s=this,u=i,l=a;break;default:s=i,u=a,l=o}return Xc(this,s,u,l),this.check()}},{key:"transformVector4",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new EF;return ZF(a,i,this),Qa(a,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(i,a){return this.setAxisAngle(i,a)}},{key:"premultiply",value:function(i){return this.multiplyLeft(i)}},{key:"multiply",value:function(i){return this.multiplyRight(i)}}]),e}(Uu);function IA(t){if(Array.isArray(t))return t}function RA(t,r){var e=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(e!=null){var n=[],i=!0,a=!1,o,s;try{for(e=e.call(t);!(i=(o=e.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(u){a=!0,s=u}finally{try{!i&&e.return!=null&&e.return()}finally{if(a)throw s}}return n}}function nm(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function LA(t,r){if(t){if(typeof t=="string")return nm(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return nm(t,r)}}function kA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BA(t,r){return IA(t)||RA(t,r)||LA(t,r)||kA()}function $u(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var mD=1e-6,mme=6371e3,qc=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.phi,n=e===void 0?0:e,i=r.theta,a=i===void 0?0:i,o=r.radius,s=o===void 0?1:o,u=r.bearing,l=r.pitch,f=r.altitude,c=r.radiusScale,p=c===void 0?mme:c;Vt(this,t),$u(this,"phi",void 0),$u(this,"theta",void 0),$u(this,"radius",void 0),$u(this,"radiusScale",void 0),this.phi=n,this.theta=a,this.radius=s||f||1,this.radiusScale=p||1,u!==void 0&&(this.bearing=u),l!==void 0&&(this.pitch=l),this.check()}return Ht(t,[{key:"toString",value:function(){return this.formatString(ut)}},{key:"formatString",value:function(e){var n=e.printTypes,i=n===void 0?!1:n,a=Vc;return"".concat(i?"Spherical":"","[rho:").concat(a(this.radius),",theta:").concat(a(this.theta),",phi:").concat(a(this.phi),"]")}},{key:"equals",value:function(e){return tt(this.radius,e.radius)&&tt(this.theta,e.theta)&&tt(this.phi,e.phi)}},{key:"exactEquals",value:function(e){return this.radius===e.radius&&this.theta===e.theta&&this.phi===e.phi}},{key:"bearing",get:function(){return 180-fr(this.phi)},set:function(e){this.phi=Math.PI-as(e)}},{key:"pitch",get:function(){return fr(this.theta)},set:function(e){this.theta=as(e)}},{key:"longitude",get:function(){return fr(this.phi)}},{key:"latitude",get:function(){return fr(this.theta)}},{key:"lng",get:function(){return fr(this.phi)}},{key:"lat",get:function(){return fr(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}},{key:"set",value:function(e,n,i){return this.radius=e,this.phi=n,this.theta=i,this.check()}},{key:"clone",value:function(){return new t().copy(this)}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this.check()}},{key:"fromLngLatZ",value:function(e){var n=BA(e,3),i=n[0],a=n[1],o=n[2];return this.radius=1+o/this.radiusScale,this.phi=as(a),this.theta=as(i),this.check()}},{key:"fromVector3",value:function(e){return this.radius=Wc(e),this.radius>0&&(this.theta=Math.atan2(e[0],e[1]),this.phi=Math.acos(He(e[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new V(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){return this.phi=Math.max(mD,Math.min(Math.PI-mD,this.phi)),this}},{key:"check",value:function(){if(!Number.isFinite(this.phi)||!Number.isFinite(this.theta)||!(this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}]),t}();var Si={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2};var FA=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`;function gme(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=yme(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function yme(t,r){if(t){if(typeof t=="string")return gD(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return gD(t,r)}}function gD(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var _me={lightSources:{}};function DA(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.color,e=r===void 0?[0,0,0]:r,n=t.intensity,i=n===void 0?1:n;return e.map(function(a){return a*i/255})}function bme(t){var r=t.ambientLight,e=t.pointLights,n=e===void 0?[]:e,i=t.directionalLights,a=i===void 0?[]:i,o={};return r?o["lighting_uAmbientLight.color"]=DA(r):o["lighting_uAmbientLight.color"]=[0,0,0],n.forEach(function(s,u){o["lighting_uPointLight[".concat(u,"].color")]=DA(s),o["lighting_uPointLight[".concat(u,"].position")]=s.position,o["lighting_uPointLight[".concat(u,"].attenuation")]=s.attenuation||[1,0,0]}),o.lighting_uPointLightCount=n.length,a.forEach(function(s,u){o["lighting_uDirectionalLight[".concat(u,"].color")]=DA(s),o["lighting_uDirectionalLight[".concat(u,"].direction")]=s.direction}),o.lighting_uDirectionalLightCount=a.length,o}function yD(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_me;if("lightSources"in t){var r=t.lightSources||{},e=r.ambientLight,n=r.pointLights,i=r.directionalLights,a=e||n&&n.length>0||i&&i.length>0;return a?Object.assign({},bme({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){var o={pointLights:[],directionalLights:[]},s=gme(t.lights||[]),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;switch(l.type){case"ambient":o.ambientLight=l;break;case"directional":o.directionalLights.push(l);break;case"point":o.pointLights.push(l);break;default:}}}catch(f){s.e(f)}finally{s.f()}return yD({lightSources:o})}return{}}var Yc={name:"lights",vs:FA,fs:FA,getUniforms:yD,defines:{MAX_LIGHTS:3}};var xme=new Uint8Array([0,255,255,255]),Ame={pickingSelectedColor:null,pickingHighlightColor:xme,pickingActive:!1,pickingAttribute:!1};function Tme(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ame,r={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)r.picking_uSelectedColorValid=0;else{var e=t.pickingSelectedColor.slice(0,3);r.picking_uSelectedColorValid=1,r.picking_uSelectedColor=e}if(t.pickingHighlightColor){var n=Array.from(t.pickingHighlightColor,function(i){return i/255});Number.isFinite(n[3])||(n[3]=1),r.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(r.picking_uActive=Boolean(t.pickingActive),r.picking_uAttribute=Boolean(t.pickingAttribute)),r}var Sme=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Pme=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,im={name:"picking",vs:Sme,fs:Pme,getUniforms:Tme};var NA=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`;var wme={};function Ome(t){var r=t.ambient,e=r===void 0?.35:r,n=t.diffuse,i=n===void 0?.6:n,a=t.shininess,o=a===void 0?32:a,s=t.specularColor,u=s===void 0?[30,30,30]:s;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:o,lighting_uSpecularColor:u.map(function(l){return l/255})}}function _D(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wme;if(!("material"in t))return{};var r=t.material;return r?Ome(r):{lighting_uEnabled:!1}}var on={name:"gouraud-lighting",dependencies:[Yc],vs:NA,defines:{LIGHTING_VERTEX:1},getUniforms:_D},ia={name:"phong-lighting",dependencies:[Yc],fs:NA,defines:{LIGHTING_FRAGMENT:1},getUniforms:_D};var bD=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`;var xD=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`;var eo={name:"pbr",vs:bD,fs:xD,defines:{LIGHTING_FRAGMENT:1},dependencies:[Yc]};var Eme=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,jA={name:"transform",vs:Eme,fs:null};function AD(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Cme(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Cme(t,r){if(t){if(typeof t=="string")return TD(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return TD(t,r)}}function TD(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var _n=function(){function t(r){(0,SD.default)(this,t),this.gl=r,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}return(0,PD.default)(t,[{key:"addDefaultModule",value:function(e){this._defaultModules.find(function(n){return n.name===e.name})||this._defaultModules.push(e),this.stateHash++}},{key:"removeDefaultModule",value:function(e){var n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(function(i){return i.name!==n}),this.stateHash++}},{key:"addShaderHook",value:function(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}},{key:"get",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.vs,a=i===void 0?"":i,o=n.fs,s=o===void 0?"":o,u=n.defines,l=u===void 0?{}:u,f=n.inject,c=f===void 0?{}:f,p=n.varyings,d=p===void 0?[]:p,v=n.bufferMode,m=v===void 0?35981:v,g=n.transpileToGLSL100,y=g===void 0?!1:g,_=this._getModuleList(n.modules),b=this._getHash(a),x=this._getHash(s),A=_.map(function(H){return e._getHash(H.name)}).sort(),T=d.map(function(H){return e._getHash(H)}),O=Object.keys(l).sort(),w=Object.keys(c).sort(),E=[],S=[],I=AD(O),R;try{for(I.s();!(R=I.n()).done;){var z=R.value;E.push(this._getHash(z)),E.push(this._getHash(l[z]))}}catch(H){I.e(H)}finally{I.f()}var G=AD(w),k;try{for(G.s();!(k=G.n()).done;){var U=k.value;S.push(this._getHash(U)),S.push(this._getHash(c[U]))}}catch(H){G.e(H)}finally{G.f()}var j="".concat(b,"/").concat(x,"D").concat(E.join("/"),"M").concat(A.join("/"),"I").concat(S.join("/"),"V").concat(T.join("/"),"H").concat(this.stateHash,"B").concat(m).concat(y?"T":"");if(!this._programCache[j]){var X=sA(this.gl,{vs:a,fs:s,modules:_,inject:c,defines:l,hookFunctions:this._hookFunctions,transpileToGLSL100:y});this._programCache[j]=new Ka(this.gl,{hash:j,vs:X.vs,fs:X.fs,varyings:d,bufferMode:m}),this._getUniforms[j]=X.getUniforms||function(H){},this._useCounts[j]=0}return this._useCounts[j]++,this._programCache[j]}},{key:"getUniforms",value:function(e){return this._getUniforms[e.hash]||null}},{key:"release",value:function(e){var n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}},{key:"_getHash",value:function(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}},{key:"_getModuleList",value:function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=new Array(this._defaultModules.length+e.length),i={},a=0,o=0,s=this._defaultModules.length;o<s;++o){var u=this._defaultModules[o],l=u.name;n[a++]=u,i[l]=!0}for(var f=0,c=e.length;f<c;++f){var p=e[f],d=p.name;i[d]||(n[a++]=p,i[d]=!0)}return n.length=a,n}}],[{key:"getDefaultProgramManager",value:function(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new t(e),e.luma.defaultProgramManager}}]),t}();var OD=h(B());function wD(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Mme(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?wD(Object(e),!0).forEach(function(n){(0,OD.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):wD(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Ime={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function ED(t,r,e){var n={},i=r.indices;for(var a in r.attributes){var o=r.attributes[a],s=Rme(a,e);if(a==="indices")i=o;else if(o.constant)n[s]=o.value;else{var u=o.value,l=Mme({},o);delete l.value,n[s]=[new be(t,u),l],Lme(a,l)}}if(i){var f=i.value||i;J(f instanceof Uint16Array||f instanceof Uint32Array,'attribute array for "indices" must be of integer type');var c={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};n.indices=[new be(t,{data:f,target:34963}),c]}return n}function Rme(t,r){var e=r||{},n=e.attributeMap,i=n===void 0?Ime:n;return i&&i[t]||t}function Lme(t,r){var e;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":e="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":e="vectors";break;default:}switch(e){case"vectors":r.size=r.size||3;break;case"uvs":r.size=r.size||2;break;default:}J(Number.isFinite(r.size),"attribute ".concat(t," needs size"))}var Xu=2,kme=1e4,Bme="Model needs drawMode and vertexCount",CD=function(){},Fme={},Ee=function(){function t(r){(0,ID.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.id,i=n===void 0?Xe("model"):n;J(Zi(r)),this.id=i,this.gl=r,this.id=e.id||Xe("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}return(0,RD.default)(t,[{key:"initialize",value:function(e){this.props={},this.programManager=e.programManager||_n.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;var n=e.program,i=n===void 0?null:n,a=e.vs,o=e.fs,s=e.modules,u=e.defines,l=e.inject,f=e.varyings,c=e.bufferMode,p=e.transpileToGLSL100;this.programProps={program:i,vs:a,fs:o,modules:s,defines:u,inject:l,varyings:f,bufferMode:c,transpileToGLSL100:p},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},J(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),Bme)}},{key:"setProps",value:function(e){this._setModelProps(e)}},{key:"delete",value:function(){for(var e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}},{key:"getDrawMode",value:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getInstanceCount",value:function(){return this.instanceCount}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getProgram",value:function(){return this.program}},{key:"setProgram",value:function(e){var n=e.program,i=e.vs,a=e.fs,o=e.modules,s=e.defines,u=e.inject,l=e.varyings,f=e.bufferMode,c=e.transpileToGLSL100;this.programProps={program:n,vs:i,fs:a,modules:o,defines:s,inject:u,varyings:l,bufferMode:f,transpileToGLSL100:c},this._programDirty=!0}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"setDrawMode",value:function(e){return this.drawMode=e,this}},{key:"setVertexCount",value:function(e){return J(Number.isFinite(e)),this.vertexCount=e,this}},{key:"setInstanceCount",value:function(e){return J(Number.isFinite(e)),this.instanceCount=e,this}},{key:"setGeometry",value:function(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=ED(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}},{key:"setAttributes",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(xi(e))return this;var n={};for(var i in e){var a=e[i];n[i]=a.getValue?a.getValue():a}return this.vertexArray.setAttributes(n),this}},{key:"setUniforms",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}},{key:"getModuleUniforms",value:function(e){this._checkProgram();var n=this.programManager.getUniforms(this.program);return n?n(e):{}}},{key:"updateModuleSettings",value:function(e){var n=this.getModuleUniforms(e||{});return this.setUniforms(n)}},{key:"clear",value:function(e){return yn(this.program.gl,e),this}},{key:"draw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();var n=e.moduleSettings,i=n===void 0?null:n,a=e.framebuffer,o=e.uniforms,s=o===void 0?{}:o,u=e.attributes,l=u===void 0?{}:u,f=e.transformFeedback,c=f===void 0?this.transformFeedback:f,p=e.parameters,d=p===void 0?{}:p,v=e.vertexArray,m=v===void 0?this.vertexArray:v;this.setAttributes(l),this.updateModuleSettings(i),this.setUniforms(s);var g;re.priority>=Xu&&(g=this._logDrawCallStart(Xu));var y=this.vertexArray.getDrawParams(),_=this.props,b=_.isIndexed,x=b===void 0?y.isIndexed:b,A=_.indexType,T=A===void 0?y.indexType:A,O=_.indexOffset,w=O===void 0?y.indexOffset:O,E=_.vertexArrayInstanced,S=E===void 0?y.isInstanced:E;S&&!this.isInstanced&&re.warn("Found instanced attributes on non-instanced model",this.id)();var I=this.isInstanced,R=this.instanceCount,z=this.props,G=z.onBeforeRender,k=G===void 0?CD:G,U=z.onAfterRender,j=U===void 0?CD:U;k(),this.program.setUniforms(this.uniforms);var X=this.program.draw(Object.assign(Fme,e,{logPriority:g,uniforms:null,framebuffer:a,parameters:d,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:m,transformFeedback:c,isIndexed:x,indexType:T,isInstanced:I,instanceCount:R,offset:x?w:0}));return j(),re.priority>=Xu&&this._logDrawCallEnd(g,m,a),X}},{key:"transform",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.discard,i=n===void 0?!0:n,a=e.feedbackBuffers,o=e.unbindModels,s=o===void 0?[]:o,u=e.parameters;a&&this._setFeedbackBuffers(a),i&&(u=Object.assign({},u,(0,MD.default)({},35977,i))),s.forEach(function(l){return l.vertexArray.unbindBuffers()});try{this.draw(Object.assign({},e,{parameters:u}))}finally{s.forEach(function(l){return l.vertexArray.bindBuffers()})}return this}},{key:"render",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return re.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}},{key:"_setModelProps",value:function(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}},{key:"_checkProgram",value:function(){var e=this._programDirty||this.programManager.stateHash!==this._programManagerState;if(e){var n=this.programProps.program;if(n)this._managedProgram=!1;else{var i=this.programProps,a=i.vs,o=i.fs,s=i.modules,u=i.inject,l=i.defines,f=i.varyings,c=i.bufferMode,p=i.transpileToGLSL100;n=this.programManager.get({vs:a,fs:o,modules:s,inject:u,defines:l,varyings:f,bufferMode:c,transpileToGLSL100:p}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}J(n instanceof Ka,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new zx(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}}},{key:"_deleteGeometryBuffers",value:function(){for(var e in this.geometryBuffers){var n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof be&&n.delete()}}},{key:"_setAnimationProps",value:function(e){this.animated&&J(e,"Model.draw(): animated uniforms but no animationProps")}},{key:"_setFeedbackBuffers",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(xi(e))return this;var n=this.program.gl;return this.transformFeedback=this.transformFeedback||new Ja(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}},{key:"_logDrawCallStart",value:function(e){var n=e>3?0:kme;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),re.group(Xu,">>> DRAWING MODEL ".concat(this.id),{collapsed:re.level<=2})(),e}},{key:"_logDrawCallEnd",value:function(e,n,i,a){if(e!==void 0){var o=Wx({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),s=Sv({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),u=s.table,l=s.unusedTable,f=s.unusedCount,c=Sv({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0}),p=c.table,d=c.count;d>0&&re.log("MISSING UNIFORMS",Object.keys(p))(),f>0&&re.log("UNUSED UNIFORMS",Object.keys(l))();var v=Xx(this.vertexArray.configuration);re.table(e,o)(),re.table(e,u)(),re.table(e+1,v)(),a&&a.log({logLevel:Xu,message:"Rendered to ".concat(a.id)}),re.groupEnd(Xu)()}}}]),t}();var HD=h(L()),WD=h(N());var kD=h(L()),BD=h(N());function Dme(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Nme(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Nme(t,r){if(t){if(typeof t=="string")return LD(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return LD(t,r)}}function LD(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var FD=function(){function t(r){(0,kD.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}return(0,BD.default)(t,[{key:"setupResources",value:function(e){var n=Dme(this.bindings),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;this._setupTransformFeedback(a,e)}}catch(o){n.e(o)}finally{n.f()}}},{key:"updateModelProps",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.varyings;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}},{key:"getDrawOptions",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.bindings[this.currentIndex],i=n.sourceBuffers,a=n.transformFeedback,o=Object.assign({},i,e.attributes);return{attributes:o,transformFeedback:a}}},{key:"swap",value:function(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}},{key:"getBuffer",value:function(e){var n=this.bindings[this.currentIndex].feedbackBuffers,i=e?n[e]:null;return i?i instanceof be?i:i.buffer:null}},{key:"getData",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.varyingName,i=this.getBuffer(n);return i?i.getData():null}},{key:"delete",value:function(){for(var e in this.resources)this.resources[e].delete()}},{key:"_initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&J(fe(this.gl))}},{key:"_getFeedbackBuffers",value:function(e){var n=e.sourceBuffers,i=n===void 0?{}:n,a={};if(this.bindings[this.currentIndex]&&Object.assign(a,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(var o in this.feedbackMap){var s=this.feedbackMap[o];o in i&&(a[s]=o)}Object.assign(a,e.feedbackBuffers);for(var u in a){var l=a[u];if(typeof l=="string"){var f=i[l],c=f.byteLength,p=f.usage,d=f.accessor;a[u]=this._createNewBuffer(u,{byteLength:c,usage:p,accessor:d})}}return a}},{key:"_setupBuffers",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.sourceBuffers,i=n===void 0?null:n;Object.assign(this.feedbackMap,e.feedbackMap);var a=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:i,feedbackBuffers:a})}},{key:"_setupTransformFeedback",value:function(e,n){var i=n.model,a=i.program;e.transformFeedback=new Ja(this.gl,{program:a,buffers:e.feedbackBuffers})}},{key:"_updateBindings",value:function(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){var n=this._swapBuffers(this.bindings[this.currentIndex]),i=n.sourceBuffers,a=n.feedbackBuffers,o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceBuffers:i,feedbackBuffers:a})}}},{key:"_updateBinding",value:function(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}},{key:"_swapBuffers",value:function(e){if(!this.feedbackMap)return null;var n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(var a in this.feedbackMap){var o=this.feedbackMap[a];n[a]=e.feedbackBuffers[o],i[o]=e.sourceBuffers[a],J(i[o]instanceof be)}return{sourceBuffers:n,feedbackBuffers:i}}},{key:"_createNewBuffer",value:function(e,n){var i=new be(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}}]),t}();var UD=h(L()),GD=h(N()),bn=h(B());var jme="transform_uSampler_",am="transform_uSize_",DD="transform_position";function ND(t){var r=t.vs,e=t.sourceTextureMap,n=t.targetTextureVarying,i=t.targetTexture,a=Object.keys(e),o=a.length,s=null,u={},l=r,f={};if(o>0||n){var c=l.split(`
`),p=c.slice();if(c.forEach(function(y,_,b){if(o>0){var x=Vme(y,e);if(x){var A=x.updatedLine,T=x.inject;p[_]=A,f=Du([f,T]),Object.assign(u,x.samplerTextureMap),o--}}n&&!s&&(s=zme(y,n))}),n){J(i);var d="".concat(am).concat(n),v="uniform vec2 ".concat(d,`;
`),m="     vec2 ".concat(DD," = transform_getPos(").concat(d,`);
     gl_Position = vec4(`).concat(DD,`, 0, 1.);
`),g={"vs:#decl":v,"vs:#main-start":m};f=Du([f,g])}l=p.join(`
`)}return{vs:l,targetTextureType:s,inject:f,samplerTextureMap:u}}function jD(t){var r=t.sourceTextureMap,e=t.targetTextureVarying,n=t.targetTexture,i={},a,o;e&&(a=n.width,o=n.height,i["".concat(am).concat(e)]=[a,o]);for(var s in r){var u=r[s];a=u.width,o=u.height,i["".concat(am).concat(s)]=[a,o]}return i}function Ume(t){return Rv(t,["attribute","in"])}function Gme(t){var r="".concat(jme).concat(t),e="".concat(am).concat(t),n="  uniform sampler2D ".concat(r,`;
  uniform vec2 `).concat(e,";");return{samplerName:r,sizeName:e,uniformDeclerations:n}}function zme(t,r){var e=Rv(t,["varying","out"]);return e&&e.name===r?e.type:null}function Vme(t,r){var e={},n=Ume(t);if(!n)return null;var i=n.type,a=n.name;if(a&&r[a]){var o="// ".concat(t," => Replaced by Transform with a sampler"),s=Gme(a),u=s.samplerName,l=s.sizeName,f=s.uniformDeclerations,c=uA(i),p="  ".concat(i," ").concat(a," = transform_getInput(").concat(u,", ").concat(l,").").concat(c,`;
`);e[u]=a;var d={"vs:#decl":f,"vs:#main-start":p};return{updatedLine:o,inject:d,samplerTextureMap:e}}return null}var qu,Hme=(qu={},(0,bn.default)(qu,10241,9728),(0,bn.default)(qu,10240,9728),(0,bn.default)(qu,10242,33071),(0,bn.default)(qu,10243,33071),qu),Wme="transform_output",zD=function(){function t(r){(0,UD.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}return(0,GD.default)(t,[{key:"updateModelProps",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this._processVertexShader(e);return Object.assign({},e,n)}},{key:"getDrawOptions",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.bindings[this.currentIndex],i=n.sourceBuffers,a=n.sourceTextures,o=n.framebuffer,s=n.targetTexture,u=Object.assign({},i,e.attributes),l=Object.assign({},e.uniforms),f=Object.assign({},e.parameters),c=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){u.transform_elementID=this.elementIDBuffer;for(var p in this.samplerTextureMap){var d=this.samplerTextureMap[p];l[p]=a[d]}this._setSourceTextureParameters();var v=jD({sourceTextureMap:a,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(l,v)}return this.hasTargetTexture&&(c=!1,f.viewport=[0,0,o.width,o.height]),{attributes:u,framebuffer:o,uniforms:l,discard:c,parameters:f}}},{key:"swap",value:function(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}},{key:"getTargetTexture",value:function(){var e=this.bindings[this.currentIndex].targetTexture;return e}},{key:"getData",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.packed,i=n===void 0?!1:n,a=this.bindings[this.currentIndex].framebuffer,o=Wn(a);if(!i)return o;for(var s=o.constructor,u=lA(this.targetTextureType),l=new s(o.length*u/4),f=0,c=0;c<o.length;c+=4)for(var p=0;p<u;p++)l[f++]=o[c+p];return l}},{key:"getFramebuffer",value:function(){var e=this.bindings[this.currentIndex];return e.framebuffer}},{key:"delete",value:function(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}},{key:"_initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e._targetTextureVarying,i=e._swapTexture;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}},{key:"_createTargetTexture",value:function(e){var n=e.sourceTextures,i=e.textureOrReference;if(i instanceof Se)return i;var a=n[i];return a?(this._targetRefTexName=i,this._createNewTexture(a)):null}},{key:"_setupTextures",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.sourceBuffers,i=e._sourceTextures,a=i===void 0?{}:i,o=e._targetTexture,s=this._createTargetTexture({sourceTextures:a,textureOrReference:o});this.hasSourceTextures=this.hasSourceTextures||a&&Object.keys(a).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:a,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}},{key:"_updateElementIDBuffer",value:function(e){if(!(typeof e!="number"||this.elementCount>=e)){var n=new Float32Array(e);n.forEach(function(i,a,o){o[a]=a}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new be(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}}},{key:"_updateBindings",value:function(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){var n=this._swapTextures(this.bindings[this.currentIndex]),i=n.sourceTextures,a=n.targetTexture,o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceTextures:i,targetTexture:a})}}},{key:"_updateBinding",value:function(e,n){var i=n.sourceBuffers,a=n.sourceTextures,o=n.targetTexture;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,a),Object.assign(e.sourceBuffers,i),o){e.targetTexture=o;var s=o.width,u=o.height,l=e,f=l.framebuffer;f?(f.update({attachments:(0,bn.default)({},36064,o),resizeAttachments:!1}),f.resize({width:s,height:u})):e.framebuffer=new Me(this.gl,{id:"transform-framebuffer",width:s,height:u,attachments:(0,bn.default)({},36064,o)})}return e}},{key:"_setSourceTextureParameters",value:function(){var e=this.currentIndex,n=this.bindings[e].sourceTextures;for(var i in n)n[i].setParameters(Hme)}},{key:"_swapTextures",value:function(e){if(!this._swapTexture)return null;var n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;var i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}},{key:"_createNewTexture",value:function(e){var n,i=Bu(e,{parameters:(n={},(0,bn.default)(n,10241,9728),(0,bn.default)(n,10240,9728),(0,bn.default)(n,10242,33071),(0,bn.default)(n,10243,33071),n),pixelStore:(0,bn.default)({},37440,!1)});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=i,i}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}},{key:"_processVertexShader",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.bindings[this.currentIndex],i=n.sourceTextures,a=n.targetTexture,o=ND({vs:e.vs,sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:a}),s=o.vs,u=o.uniforms,l=o.targetTextureType,f=o.inject,c=o.samplerTextureMap,p=Du([e.inject||{},f]);this.targetTextureType=l,this.samplerTextureMap=c;var d=e._fs||Gc({version:Fu(s),input:this.targetTextureVarying,inputType:l,output:Wme}),v=this.hasSourceTextures||this.targetTextureVarying?[jA].concat(e.modules||[]):e.modules;return{vs:s,fs:d,modules:v,uniforms:u,inject:p}}}]),t}();function Kc(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=$me(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function $me(t,r){if(t){if(typeof t=="string")return VD(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return VD(t,r)}}function VD(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var kr=function(){function t(r){(0,HD.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}return(0,WD.default)(t,[{key:"delete",value:function(){var e=this.model,n=this.bufferTransform,i=this.textureTransform;e&&e.delete(),n&&n.delete(),i&&i.delete()}},{key:"run",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.clearRenderTarget,i=n===void 0?!0:n,a=this._updateDrawOptions(e);i&&a.framebuffer&&a.framebuffer.clear({color:!0}),this.model.transform(a)}},{key:"swap",value:function(){var e=!1,n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=Kc(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;e=e||o.swap()}}catch(s){i.e(s)}finally{i.f()}J(e,"Nothing to swap")}},{key:"getBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}},{key:"getData",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=Kc(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.getData(e);if(s)return s}}catch(u){i.e(u)}finally{i.f()}return null}},{key:"getFramebuffer",value:function(){return this.textureTransform&&this.textureTransform.getFramebuffer()}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);var n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=Kc(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.update(e)}}catch(s){i.e(s)}finally{i.f()}}},{key:"_initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.gl;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Ee(n,Object.assign({},e,{fs:e.fs||Gc({version:Fu(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}},{key:"_updateModelProps",value:function(e){var n=Object.assign({},e),i=[this.bufferTransform,this.textureTransform].filter(Boolean),a=Kc(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n=s.updateModelProps(n)}}catch(u){a.e(u)}finally{a.f()}return n}},{key:"_buildResourceTransforms",value:function(e,n){Xme(n)&&(this.bufferTransform=new FD(e,n)),qme(n)&&(this.textureTransform=new zD(e,n)),J(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}},{key:"_updateDrawOptions",value:function(e){var n=Object.assign({},e),i=[this.bufferTransform,this.textureTransform].filter(Boolean),a=Kc(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n=Object.assign(n,s.getDrawOptions(n))}}catch(u){a.e(u)}finally{a.f()}return n}}],[{key:"isSupported",value:function(e){return fe(e)}}]),t}();function Xme(t){return!!(!xi(t.feedbackBuffers)||!xi(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function qme(t){return!!(!xi(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}var qD=h(B()),YD=h(L()),KD=h(N());function $D(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Yme(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?$D(Object(e),!0).forEach(function(n){(0,qD.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):$D(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var XD={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Ce=function(){function t(){(0,YD.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.id,n=e===void 0?Xe("geometry"):e,i=r.drawMode,a=i===void 0?XD.TRIANGLES:i,o=r.attributes,s=o===void 0?{}:o,u=r.indices,l=u===void 0?null:u,f=r.vertexCount,c=f===void 0?null:f;this.id=n,this.drawMode=a|0,this.attributes={},this.userData={},this._setAttributes(s,l),this.vertexCount=c||this._calculateVertexCount(this.attributes,this.indices)}return(0,KD.default)(t,[{key:"mode",get:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getAttributes",value:function(){return this.indices?Yme({indices:this.indices},this.attributes):this.attributes}},{key:"_print",value:function(e){return"Geometry ".concat(this.id," attribute ").concat(e)}},{key:"_setAttributes",value:function(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(var i in e){var a=e[i];a=ArrayBuffer.isView(a)?{value:a}:a,J(ArrayBuffer.isView(a.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!a.size&&(a.size=3),i==="indices"?(J(!this.indices),this.indices=a):this.attributes[i]=a}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}},{key:"_calculateVertexCount",value:function(e,n){if(n)return n.value.length;var i=1/0;for(var a in e){var o=e[a],s=o.value,u=o.size,l=o.constant;!l&&s&&u>=1&&(i=Math.min(i,s.length/u))}return J(Number.isFinite(i)),i}}],[{key:"DRAW_MODE",get:function(){return XD}}]),t}();var iN=h(B()),aN=h(L()),oN=h(Y()),sN=h(K()),GA=h(q());var ZD=h(B()),QD=h(L()),eN=h(Y()),tN=h(K()),UA=h(q());function JD(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function om(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?JD(Object(e),!0).forEach(function(n){(0,ZD.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):JD(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Kme(t){var r=Jme();return function(){var n=(0,UA.default)(t),i;if(r){var a=(0,UA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,tN.default)(this,i)}}function Jme(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Zme={x:[2,0,1],y:[0,1,2],z:[1,2,0]},to=function(t){(0,eN.default)(e,t);var r=Kme(e);function e(){(0,QD.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Xe("truncated-code-geometry"):i,o=Qme(n),s=o.indices,u=o.attributes;return r.call(this,om(om({},n),{},{id:a,indices:s,attributes:om(om({},u),n.attributes)}))}return e}(Ce);function Qme(t){for(var r=t.bottomRadius,e=r===void 0?0:r,n=t.topRadius,i=n===void 0?0:n,a=t.height,o=a===void 0?1:a,s=t.nradial,u=s===void 0?10:s,l=t.nvertical,f=l===void 0?10:l,c=t.verticalAxis,p=c===void 0?"y":c,d=t.topCap,v=d===void 0?!1:d,m=t.bottomCap,g=m===void 0?!1:m,y=(v?2:0)+(g?2:0),_=(u+1)*(f+1+y),b=Math.atan2(e-i,o),x=Math.sin,A=Math.cos,T=Math.PI,O=A(b),w=x(b),E=v?-2:0,S=f+(g?2:0),I=u+1,R=new Uint16Array(u*(f+y)*6),z=Zme[p],G=new Float32Array(_*3),k=new Float32Array(_*3),U=new Float32Array(_*2),j=0,X=0,H=E;H<=S;H++){var Q=H/f,ne=o*Q,le=void 0;H<0?(ne=0,Q=1,le=e):H>f?(ne=o,Q=1,le=i):le=e+(i-e)*(H/f),(H===-2||H===f+2)&&(le=0,Q=0),ne-=o/2;for(var xe=0;xe<I;xe++){var we=x(xe*T*2/u),ze=A(xe*T*2/u);G[j+z[0]]=we*le,G[j+z[1]]=ne,G[j+z[2]]=ze*le,k[j+z[0]]=H<0||H>f?0:we*O,k[j+z[1]]=H<0?-1:H>f?1:w,k[j+z[2]]=H<0||H>f?0:ze*O,U[X+0]=xe/u,U[X+1]=Q,X+=2,j+=3}}for(var me=0;me<f+y;me++)for(var $e=0;$e<u;$e++){var Le=(me*u+$e)*6;R[Le+0]=I*(me+0)+0+$e,R[Le+1]=I*(me+0)+1+$e,R[Le+2]=I*(me+1)+1+$e,R[Le+3]=I*(me+0)+0+$e,R[Le+4]=I*(me+1)+1+$e,R[Le+5]=I*(me+1)+0+$e}return{indices:R,attributes:{POSITION:{size:3,value:G},NORMAL:{size:3,value:k},TEXCOORD_0:{size:2,value:U}}}}function rN(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function nN(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?rN(Object(e),!0).forEach(function(n){(0,iN.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):rN(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function ege(t){var r=tge();return function(){var n=(0,GA.default)(t),i;if(r){var a=(0,GA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,sN.default)(this,i)}}function tge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sm=function(t){(0,oN.default)(e,t);var r=ege(e);function e(){(0,aN.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Xe("cone-geometry"):i,o=n.radius,s=o===void 0?1:o,u=n.cap,l=u===void 0?!0:u;return r.call(this,nN(nN({},n),{},{id:a,topRadius:0,topCap:Boolean(l),bottomCap:Boolean(l),bottomRadius:s}))}return e}(to);var lN=h(B()),fN=h(L()),cN=h(Y()),pN=h(K()),zA=h(q());function uN(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function um(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?uN(Object(e),!0).forEach(function(n){(0,lN.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):uN(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function rge(t){var r=nge();return function(){var n=(0,zA.default)(t),i;if(r){var a=(0,zA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,pN.default)(this,i)}}function nge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ige=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),age=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),oge=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),sge=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),uge={POSITION:{size:3,value:new Float32Array(age)},NORMAL:{size:3,value:new Float32Array(oge)},TEXCOORD_0:{size:2,value:new Float32Array(sge)}},ro=function(t){(0,cN.default)(e,t);var r=rge(e);function e(){(0,fN.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Xe("cube-geometry"):i;return r.call(this,um(um({},n),{},{id:a,indices:{size:1,value:new Uint16Array(ige)},attributes:um(um({},uge),n.attributes)}))}return e}(Ce);var vN=h(B()),mN=h(L()),gN=h(Y()),yN=h(K()),VA=h(q());function hN(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function dN(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?hN(Object(e),!0).forEach(function(n){(0,vN.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):hN(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function lge(t){var r=fge();return function(){var n=(0,VA.default)(t),i;if(r){var a=(0,VA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,yN.default)(this,i)}}function fge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var lm=function(t){(0,gN.default)(e,t);var r=lge(e);function e(){(0,mN.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Xe("cylinder-geometry"):i,o=n.radius,s=o===void 0?1:o;return r.call(this,dN(dN({},n),{},{id:a,bottomRadius:s,topRadius:s}))}return e}(to);var bN=h(B()),xN=h(L()),AN=h(Y()),TN=h(K()),HA=h(q());function _N(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function fm(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?_N(Object(e),!0).forEach(function(n){(0,bN.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):_N(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function cge(t){var r=pge();return function(){var n=(0,HA.default)(t),i;if(r){var a=(0,HA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,TN.default)(this,i)}}function pge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hge=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],dge=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1],cm=function(t){(0,AN.default)(e,t);var r=cge(e);function e(){(0,xN.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Xe("ico-sphere-geometry"):i,o=vge(n),s=o.indices,u=o.attributes;return r.call(this,fm(fm({},n),{},{id:a,indices:s,attributes:fm(fm({},u),n.attributes)}))}return e}(Ce);function vge(t){var r=t.iterations,e=r===void 0?0:r,n=Math.PI,i=n*2,a=[].concat(hge),o=[].concat(dge);a.push(),o.push();for(var s=function(){var Bn={};return function(Fn,Dn){Fn*=3,Dn*=3;var xu=Fn<Dn?Fn:Dn,zr=Fn>Dn?Fn:Dn,Kf="".concat(xu,"|").concat(zr);if(Kf in Bn)return Bn[Kf];var ob=a[Fn],sb=a[Fn+1],ub=a[Fn+2],lb=a[Dn],yd=a[Dn+1],_d=a[Dn+2],Uo=(ob+lb)/2,Go=(sb+yd)/2,Xi=(ub+_d)/2,zo=Math.sqrt(Uo*Uo+Go*Go+Xi*Xi);return Uo/=zo,Go/=zo,Xi/=zo,a.push(Uo,Go,Xi),Bn[Kf]=a.length/3-1}}(),u=0;u<e;u++){for(var l=[],f=0;f<o.length;f+=3){var c=s(o[f+0],o[f+1]),p=s(o[f+1],o[f+2]),d=s(o[f+2],o[f+0]);l.push(d,o[f+0],c,c,o[f+1],p,p,o[f+2],d,c,p,d)}o=l}for(var v=new Array(a.length),m=new Array(a.length/3*2),g=o.length,y=g-3;y>=0;y-=3){var _=o[y+0],b=o[y+1],x=o[y+2],A=_*3,T=b*3,O=x*3,w=_*2,E=b*2,S=x*2,I=a[A+0],R=a[A+1],z=a[A+2],G=Math.acos(z/Math.sqrt(I*I+R*R+z*z)),k=Math.atan2(R,I)+n,U=G/n,j=1-k/i,X=a[T+0],H=a[T+1],Q=a[T+2],ne=Math.acos(Q/Math.sqrt(X*X+H*H+Q*Q)),le=Math.atan2(H,X)+n,xe=ne/n,we=1-le/i,ze=a[O+0],me=a[O+1],$e=a[O+2],Le=Math.acos($e/Math.sqrt(ze*ze+me*me+$e*$e)),Pt=Math.atan2(me,ze)+n,$i=Le/n,wt=1-Pt/i,No=[ze-X,me-H,$e-Q],jo=[I-X,R-H,z-Q],ar=new V(No).cross(jo).normalize(),et=void 0;(j===0||we===0||wt===0)&&(j===0||j>.5)&&(we===0||we>.5)&&(wt===0||wt>.5)&&(a.push(a[A+0],a[A+1],a[A+2]),et=a.length/3-1,o.push(et),m[et*2+0]=1,m[et*2+1]=U,v[et*3+0]=ar.x,v[et*3+1]=ar.y,v[et*3+2]=ar.z,a.push(a[T+0],a[T+1],a[T+2]),et=a.length/3-1,o.push(et),m[et*2+0]=1,m[et*2+1]=xe,v[et*3+0]=ar.x,v[et*3+1]=ar.y,v[et*3+2]=ar.z,a.push(a[O+0],a[O+1],a[O+2]),et=a.length/3-1,o.push(et),m[et*2+0]=1,m[et*2+1]=$i,v[et*3+0]=ar.x,v[et*3+1]=ar.y,v[et*3+2]=ar.z),v[A+0]=v[T+0]=v[O+0]=ar.x,v[A+1]=v[T+1]=v[O+1]=ar.y,v[A+2]=v[T+2]=v[O+2]=ar.z,m[w+0]=j,m[w+1]=U,m[E+0]=we,m[E+1]=xe,m[S+0]=wt,m[S+1]=$i}return{indices:{size:1,value:new Uint16Array(o)},attributes:{POSITION:{size:3,value:new Float32Array(a)},NORMAL:{size:3,value:new Float32Array(v)},TEXCOORD_0:{size:2,value:new Float32Array(m)}}}}var wN=h(B()),ON=h(L()),EN=h(Y()),CN=h(K()),WA=h(q());function SN(t){var r=t.indices,e=t.attributes;if(!r)return t;var n=r.value.length,i={};for(var a in e){var o=e[a],s=o.constant,u=o.value,l=o.size;if(!(s||!l)){for(var f=new u.constructor(n*l),c=0;c<n;++c)for(var p=r.value[c],d=0;d<l;d++)f[c*l+d]=u[p*l+d];i[a]={size:l,value:f}}}return{attributes:Object.assign({},e,i)}}function PN(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function pm(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?PN(Object(e),!0).forEach(function(n){(0,wN.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):PN(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function mge(t){var r=gge();return function(){var n=(0,WA.default)(t),i;if(r){var a=(0,WA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,CN.default)(this,i)}}function gge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hm=function(t){(0,EN.default)(e,t);var r=mge(e);function e(){(0,ON.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Xe("plane-geometry"):i,o=yge(n),s=o.indices,u=o.attributes;return r.call(this,pm(pm({},n),{},{id:a,indices:s,attributes:pm(pm({},u),n.attributes)}))}return e}(Ce);function yge(t){var r=t.type,e=r===void 0?"x,y":r,n=t.offset,i=n===void 0?0:n,a=t.flipCull,o=a===void 0?!1:a,s=t.unpack,u=s===void 0?!1:s,l=e.split(","),f=t["".concat(l[0],"len")]||1,c=t["".concat(l[1],"len")]||1,p=t["n".concat(l[0])]||1,d=t["n".concat(l[1])]||1,v=(p+1)*(d+1),m=new Float32Array(v*3),g=new Float32Array(v*3),y=new Float32Array(v*2);o&&(f=-f);for(var _=0,b=0,x=0;x<=d;x++)for(var A=0;A<=p;A++){var T=A/p,O=x/d;switch(y[_+0]=o?1-T:T,y[_+1]=O,e){case"x,y":m[b+0]=f*T-f*.5,m[b+1]=c*O-c*.5,m[b+2]=i,g[b+0]=0,g[b+1]=0,g[b+2]=o?1:-1;break;case"x,z":m[b+0]=f*T-f*.5,m[b+1]=i,m[b+2]=c*O-c*.5,g[b+0]=0,g[b+1]=o?1:-1,g[b+2]=0;break;case"y,z":m[b+0]=i,m[b+1]=f*T-f*.5,m[b+2]=c*O-c*.5,g[b+0]=o?1:-1,g[b+1]=0,g[b+2]=0;break;default:throw new Error("PlaneGeometry: unknown type")}_+=2,b+=3}for(var w=p+1,E=new Uint16Array(p*d*6),S=0;S<d;S++)for(var I=0;I<p;I++){var R=(S*p+I)*6;E[R+0]=(S+0)*w+I,E[R+1]=(S+1)*w+I,E[R+2]=(S+0)*w+I+1,E[R+3]=(S+1)*w+I,E[R+4]=(S+1)*w+I+1,E[R+5]=(S+0)*w+I+1}var z={indices:{size:1,value:E},attributes:{POSITION:{size:3,value:m},NORMAL:{size:3,value:g},TEXCOORD_0:{size:2,value:y}}};return u?SN(z):z}var IN=h(B()),RN=h(L()),LN=h(Y()),kN=h(K()),$A=h(q());function MN(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function dm(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?MN(Object(e),!0).forEach(function(n){(0,IN.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):MN(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function _ge(t){var r=bge();return function(){var n=(0,$A.default)(t),i;if(r){var a=(0,$A.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,kN.default)(this,i)}}function bge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vm=function(t){(0,LN.default)(e,t);var r=_ge(e);function e(){(0,RN.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Xe("sphere-geometry"):i,o=xge(n),s=o.indices,u=o.attributes;return r.call(this,dm(dm({},n),{},{id:a,indices:s,attributes:dm(dm({},u),n.attributes)}))}return e}(Ce);function xge(t){var r=t.nlat,e=r===void 0?10:r,n=t.nlong,i=n===void 0?10:n,a=t.radius,o=a===void 0?1:a,s=0,u=Math.PI,l=u-s,f=0,c=2*Math.PI,p=c-f,d=(e+1)*(i+1);if(typeof o=="number"){var v=o;o=function(me,$e,Le,Pt,$i){return v}}for(var m=new Float32Array(d*3),g=new Float32Array(d*3),y=new Float32Array(d*2),_=d>65535?Uint32Array:Uint16Array,b=new _(e*i*6),x=0;x<=e;x++)for(var A=0;A<=i;A++){var T=A/i,O=x/e,w=A+x*(i+1),E=w*2,S=w*3,I=p*T,R=l*O,z=Math.sin(I),G=Math.cos(I),k=Math.sin(R),U=Math.cos(R),j=G*k,X=U,H=z*k,Q=o(j,X,H,T,O);m[S+0]=Q*j,m[S+1]=Q*X,m[S+2]=Q*H,g[S+0]=j,g[S+1]=X,g[S+2]=H,y[E+0]=T,y[E+1]=1-O}for(var ne=i+1,le=0;le<i;le++)for(var xe=0;xe<e;xe++){var we=(le*e+xe)*6;b[we+0]=xe*ne+le,b[we+1]=xe*ne+le+1,b[we+2]=(xe+1)*ne+le,b[we+3]=(xe+1)*ne+le,b[we+4]=xe*ne+le+1,b[we+5]=(xe+1)*ne+le+1}return{indices:{size:1,value:b},attributes:{POSITION:{size:3,value:m},NORMAL:{size:3,value:g},TEXCOORD_0:{size:2,value:y}}}}var FN=h(ye()),DN=h(L()),NN=h(N());function XA(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Age(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Age(t,r){if(t){if(typeof t=="string")return BN(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return BN(t,r)}}function BN(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Tge=1,Sge=1,no=function(){function t(){(0,DN.default)(this,t),this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}return(0,NN.default)(t,[{key:"addChannel",value:function(e){var n=e.delay,i=n===void 0?0:n,a=e.duration,o=a===void 0?Number.POSITIVE_INFINITY:a,s=e.rate,u=s===void 0?1:s,l=e.repeat,f=l===void 0?1:l,c=Tge++,p={time:0,delay:i,duration:o,rate:u,repeat:f};return this._setChannelTime(p,this.time),this.channels.set(c,p),c}},{key:"removeChannel",value:function(e){this.channels.delete(e);var n=XA(this.animations),i;try{for(n.s();!(i=n.n()).done;){var a=(0,FN.default)(i.value,2),o=a[0],s=a[1];s.channel===e&&this.detachAnimation(o)}}catch(u){n.e(u)}finally{n.f()}}},{key:"isFinished",value:function(e){var n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}},{key:"getTime",value:function(e){if(e===void 0)return this.time;var n=this.channels.get(e);return n===void 0?-1:n.time}},{key:"setTime",value:function(e){this.time=Math.max(0,e);var n=this.channels.values(),i=XA(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;this._setChannelTime(o,this.time)}}catch(d){i.e(d)}finally{i.f()}var s=this.animations.values(),u=XA(s),l;try{for(u.s();!(l=u.n()).done;){var f=l.value,c=f.animation,p=f.channel;c.setTime(this.getTime(p))}}catch(d){u.e(d)}finally{u.f()}}},{key:"play",value:function(){this.playing=!0}},{key:"pause",value:function(){this.playing=!1,this.lastEngineTime=-1}},{key:"reset",value:function(){this.setTime(0)}},{key:"attachAnimation",value:function(e,n){var i=Sge++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}},{key:"detachAnimation",value:function(e){this.animations.delete(e)}},{key:"update",value:function(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}},{key:"_setChannelTime",value:function(e,n){var i=n-e.delay,a=e.duration*e.repeat;i>=a?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}]),t}();var UN=h(L()),GN=h(Y()),zN=h(K()),qA=h(q());function Pge(t){var r=wge();return function(){var n=(0,qA.default)(t),i;if(r){var a=(0,qA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,zN.default)(this,i)}}function wge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Oge=`attribute vec2 aClipSpacePosition;
attribute vec2 aTexCoord;
attribute vec2 aCoordinate;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main(void) {
  gl_Position = vec4(aClipSpacePosition, 0., 1.);
  position = aClipSpacePosition;
  coordinate = aCoordinate;
  uv = aTexCoord;
}
`,jN=[-1,-1,1,-1,-1,1,1,1],mm=function(t){(0,GN.default)(e,t);var r=Pge(e);function e(n,i){var a;(0,UN.default)(this,e);var o=jN.map(function(s){return s===-1?0:s});return a=r.call(this,n,Object.assign({},i,{vs:Oge,geometry:new Ce({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(jN)},aTexCoord:{size:2,value:new Float32Array(o)},aCoordinate:{size:2,value:new Float32Array(o)}}})})),a.setVertexCount(4),a}return e}(Ee);var VN=h(L()),Jc=h(B()),Ege=[255,255,255],Cge=1,Mge=0,gm=function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,VN.default)(this,t),(0,Jc.default)(this,"id",void 0),(0,Jc.default)(this,"color",void 0),(0,Jc.default)(this,"intensity",void 0),(0,Jc.default)(this,"type","ambient");var e=r.color,n=e===void 0?Ege:e,i=r.intensity,a=i===void 0?Cge:i;this.id=r.id||"ambient-".concat(Mge++),this.color=n,this.intensity=a};var HN=h(L()),WN=h(N()),ls=h(B());var Ige=[255,255,255],Rge=1,Lge=[0,0,-1],kge=0,fs=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,HN.default)(this,t),(0,ls.default)(this,"id",void 0),(0,ls.default)(this,"color",void 0),(0,ls.default)(this,"intensity",void 0),(0,ls.default)(this,"type","directional"),(0,ls.default)(this,"direction",void 0),(0,ls.default)(this,"shadow",void 0);var e=r.color,n=e===void 0?Ige:e,i=r.intensity,a=i===void 0?Rge:i,o=r.direction,s=o===void 0?Lge:o,u=r._shadow,l=u===void 0?!1:u;this.id=r.id||"directional-".concat(kge++),this.color=n,this.intensity=a,this.type="directional",this.direction=new V(s).normalize().toArray(),this.shadow=l}return(0,WN.default)(t,[{key:"getProjectedLight",value:function(e){return this}}]),t}();var aj=h(L()),oj=h(N()),_m=h(_e()),sj=h(Oe()),uj=h(Y()),lj=h(K()),bm=h(q()),qn=h(B());var KN=h(L()),JN=h(N()),ZN=h(_e()),QN=h(Y()),ej=h(K()),KA=h(q()),tj=h(B());var XN=h(L()),qN=h(N()),Zc=h(B());function $N(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Bge(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?$N(Object(e),!0).forEach(function(n){(0,Zc.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):$N(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var ym=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};(0,XN.default)(this,t),(0,Zc.default)(this,"id",void 0),(0,Zc.default)(this,"gl",void 0),(0,Zc.default)(this,"props",void 0);var n=e.id;this.id=n,this.gl=r,this.props=Bge({},e)}return(0,qN.default)(t,[{key:"setProps",value:function(e){Object.assign(this.props,e)}},{key:"render",value:function(e){}},{key:"cleanup",value:function(){}}]),t}();function YA(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Fge(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Fge(t,r){if(t){if(typeof t=="string")return YN(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return YN(t,r)}}function YN(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Dge(t){var r=Nge();return function(){var n=(0,KA.default)(t),i;if(r){var a=(0,KA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,ej.default)(this,i)}}function Nge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Vr=function(t){(0,QN.default)(e,t);var r=Dge(e);function e(){var n;(0,KN.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,tj.default)((0,ZN.default)(n),"_lastRenderIndex",-1),n}return(0,JN.default)(e,[{key:"render",value:function(i){var a=this.gl;return Gt(a,{framebuffer:i.target}),this._drawLayers(i)}},{key:"_drawLayers",value:function(i){var a=i.target,o=i.moduleParameters,s=i.viewports,u=i.views,l=i.onViewportActive,f=i.clearStack,c=f===void 0?!0:f,p=i.clearCanvas,d=p===void 0?!0:p;i.pass=i.pass||"unknown";var v=this.gl;d&&Uge(v,a),c&&(this._lastRenderIndex=-1);var m=[],g=YA(s),y;try{for(g.s();!(y=g.n()).done;){var _=y.value,b=u&&u[_.id];l?.(_);var x=this._getDrawLayerParams(_,i),A=_.subViewports||[_],T=YA(A),O;try{for(T.s();!(O=T.n()).done;){var w=O.value,E=this._drawLayersInViewport(v,{target:a,moduleParameters:o,viewport:w,view:b,pass:i.pass,layers:i.layers},x);m.push(E)}}catch(S){T.e(S)}finally{T.f()}}}catch(S){g.e(S)}finally{g.f()}return m}},{key:"_getDrawLayerParams",value:function(i,a){for(var o=a.layers,s=a.pass,u=a.isPicking,l=u===void 0?!1:u,f=a.layerFilter,c=a.cullRect,p=a.effects,d=a.moduleParameters,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,m=[],g=rj(this._lastRenderIndex+1),y={layer:o[0],viewport:i,isPicking:l,renderPass:s,cullRect:c},_={},b=0;b<o.length;b++){var x=o[b],A=this._shouldDrawLayer(x,y,f,_),T={shouldDrawLayer:A};A&&!v&&(T.layerRenderIndex=g(x,A),T.moduleParameters=this._getModuleParameters(x,p,s,d),T.layerParameters=this.getLayerParameters(x,b,i)),m[b]=T}return m}},{key:"_drawLayersInViewport",value:function(i,a,o){var s=a.layers,u=a.moduleParameters,l=a.pass,f=a.target,c=a.viewport,p=a.view,d=jge(i,{moduleParameters:u,target:f,viewport:c});if(p&&p.props.clear){var v=p.props.clear===!0?{color:!0,depth:!0}:p.props.clear;Ie(i,{scissorTest:!0,scissor:d},function(){return yn(i,v)})}var m={totalCount:s.length,visibleCount:0,compositeCount:0,pickableCount:0};Gt(i,{viewport:d});for(var g=0;g<s.length;g++){var y=s[g],_=o[g],b=_.shouldDrawLayer,x=_.layerRenderIndex,A=_.moduleParameters,T=_.layerParameters;if(b&&y.props.pickable&&m.pickableCount++,y.isComposite)m.compositeCount++;else if(b){m.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,x),A.viewport=c;try{y._drawLayer({moduleParameters:A,uniforms:{layerIndex:x},parameters:T})}catch(O){y.raiseError(O,"drawing ".concat(y," to ").concat(l))}}}return m}},{key:"shouldDrawLayer",value:function(i){return!0}},{key:"getModuleParameters",value:function(i,a){return null}},{key:"getLayerParameters",value:function(i,a,o){return i.props.parameters}},{key:"_shouldDrawLayer",value:function(i,a,o,s){var u=i.props.visible&&this.shouldDrawLayer(i);if(!u)return!1;a.layer=i;for(var l=i.parent;l;){if(!l.props.visible||!l.filterSubLayer(a))return!1;a.layer=l,l=l.parent}if(o){var f=a.layer.id;if(f in s||(s[f]=o(a)),!s[f])return!1}return i.activateViewport(a.viewport),!0}},{key:"_getModuleParameters",value:function(i,a,o,s){var u,l=Object.assign(Object.create(((u=i.internalState)===null||u===void 0?void 0:u.propsInTransition)||i.props),{autoWrapLongitude:i.wrapLongitude,viewport:i.context.viewport,mousePosition:i.context.mousePosition,pickingActive:0,devicePixelRatio:vr(this.gl)});if(a){var f=YA(a),c;try{for(f.s();!(c=f.n()).done;){var p,d=c.value;Object.assign(l,(p=d.getModuleParameters)===null||p===void 0?void 0:p.call(d,i))}}catch(v){f.e(v)}finally{f.f()}}return Object.assign(l,this.getModuleParameters(i,a),s)}}]),e}(ym);function rj(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e={},n=function i(a,o){var s=a.props._offset,u=a.id,l=a.parent&&a.parent.id,f;if(l&&!(l in r)&&i(a.parent,!1),l in e){var c=e[l]=e[l]||rj(r[l],r);f=c(a,o),e[u]=c}else Number.isFinite(s)?(f=s+(r[l]||0),e[u]=null):f=t;return o&&f>=t&&(t=f+1),r[u]=f,f};return n}function jge(t,r){var e=r.moduleParameters,n=r.target,i=r.viewport,a=n&&n.id!=="default-framebuffer",o=e&&e.devicePixelRatio||vr(t),s=a?n.height:t.drawingBufferHeight,u=i;return[u.x*o,s-(u.y+u.height)*o,u.width*o,u.height*o]}function Uge(t,r){var e=r?r.width:t.drawingBufferWidth,n=r?r.height:t.drawingBufferHeight;Gt(t,{viewport:[0,0,e,n]}),t.clear(16640)}function nj(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ij(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?nj(Object(e),!0).forEach(function(n){(0,qn.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):nj(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Gge(t){var r=zge();return function(){var n=(0,bm.default)(t),i;if(r){var a=(0,bm.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lj.default)(this,i)}}function zge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fj=function(t){(0,uj.default)(e,t);var r=Gge(e);function e(n,i){var a,o,s;return(0,aj.default)(this,e),s=r.call(this,n,i),(0,qn.default)((0,_m.default)(s),"shadowMap",void 0),(0,qn.default)((0,_m.default)(s),"depthBuffer",void 0),(0,qn.default)((0,_m.default)(s),"fbo",void 0),s.shadowMap=new Se(n,{width:1,height:1,parameters:(a={},(0,qn.default)(a,10241,9729),(0,qn.default)(a,10240,9729),(0,qn.default)(a,10242,33071),(0,qn.default)(a,10243,33071),a)}),s.depthBuffer=new Rr(n,{format:33189,width:1,height:1}),s.fbo=new Me(n,{id:"shadowmap",width:1,height:1,attachments:(o={},(0,qn.default)(o,36064,s.shadowMap),(0,qn.default)(o,36096,s.depthBuffer),o)}),s}return(0,oj.default)(e,[{key:"render",value:function(i){var a=this,o=this.fbo;Ie(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},function(){var s=i.viewports[0],u=vr(a.gl),l=s.width*u,f=s.height*u;(l!==o.width||f!==o.height)&&o.resize({width:l,height:f}),(0,sj.default)((0,bm.default)(e.prototype),"render",a).call(a,ij(ij({},i),{},{target:o,pass:"shadow"}))})}},{key:"shouldDrawLayer",value:function(i){return i.props.shadowEnabled!==!1}},{key:"getModuleParameters",value:function(){return{drawToShadowMap:!0}}},{key:"delete",value:function(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}]),e}(Vr);var ms=h(dr()),Dj=h(ye());var cj="#define SMOOTH_EDGE_RADIUS 0.5",Vge=`
`.concat(cj,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),Hge=`
`.concat(cj,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),pj={name:"geometry",vs:Vge,fs:Hge};var Wge=Object.keys(se).map(function(t){return"const int COORDINATE_SYSTEM_".concat(t," = ").concat(se[t],";")}).join(""),$ge=Object.keys(_r).map(function(t){return"const int PROJECTION_MODE_".concat(t," = ").concat(_r[t],";")}).join(""),Xge=Object.keys(bt).map(function(t){return"const int UNIT_".concat(t.toUpperCase()," = ").concat(bt[t],";")}).join(""),hj="".concat(Wge,`
`).concat($ge,`
`).concat(Xge,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }

    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);var aa=typeof Float32Array<"u"?Float32Array:Array;var FWe=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});function ZA(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],l=r[7],f=r[8],c=r[9],p=r[10],d=r[11],v=r[12],m=r[13],g=r[14],y=r[15],_=e*s-n*o,b=e*u-i*o,x=e*l-a*o,A=n*u-i*s,T=n*l-a*s,O=i*l-a*u,w=f*m-c*v,E=f*g-p*v,S=f*y-d*v,I=c*g-p*m,R=c*y-d*m,z=p*y-d*g,G=_*z-b*R+x*I+A*S-T*E+O*w;return G?(G=1/G,t[0]=(s*z-u*R+l*I)*G,t[1]=(i*R-n*z-a*I)*G,t[2]=(m*O-g*T+y*A)*G,t[3]=(p*T-c*O-d*A)*G,t[4]=(u*S-o*z-l*E)*G,t[5]=(e*z-i*S+a*E)*G,t[6]=(g*x-v*O-y*b)*G,t[7]=(f*O-p*x+d*b)*G,t[8]=(o*R-s*S+l*w)*G,t[9]=(n*S-e*R-a*w)*G,t[10]=(v*T-m*x+y*_)*G,t[11]=(c*x-f*T-d*_)*G,t[12]=(s*E-o*I-u*w)*G,t[13]=(e*I-n*E+i*w)*G,t[14]=(m*b-v*A-g*_)*G,t[15]=(f*A-c*b+p*_)*G,t):null}function cs(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],f=r[7],c=r[8],p=r[9],d=r[10],v=r[11],m=r[12],g=r[13],y=r[14],_=r[15],b=e[0],x=e[1],A=e[2],T=e[3];return t[0]=b*n+x*s+A*c+T*m,t[1]=b*i+x*u+A*p+T*g,t[2]=b*a+x*l+A*d+T*y,t[3]=b*o+x*f+A*v+T*_,b=e[4],x=e[5],A=e[6],T=e[7],t[4]=b*n+x*s+A*c+T*m,t[5]=b*i+x*u+A*p+T*g,t[6]=b*a+x*l+A*d+T*y,t[7]=b*o+x*f+A*v+T*_,b=e[8],x=e[9],A=e[10],T=e[11],t[8]=b*n+x*s+A*c+T*m,t[9]=b*i+x*u+A*p+T*g,t[10]=b*a+x*l+A*d+T*y,t[11]=b*o+x*f+A*v+T*_,b=e[12],x=e[13],A=e[14],T=e[15],t[12]=b*n+x*s+A*c+T*m,t[13]=b*i+x*u+A*p+T*g,t[14]=b*a+x*l+A*d+T*y,t[15]=b*o+x*f+A*v+T*_,t}function dj(t,r,e){var n=e[0],i=e[1],a=e[2],o,s,u,l,f,c,p,d,v,m,g,y;return r===t?(t[12]=r[0]*n+r[4]*i+r[8]*a+r[12],t[13]=r[1]*n+r[5]*i+r[9]*a+r[13],t[14]=r[2]*n+r[6]*i+r[10]*a+r[14],t[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(o=r[0],s=r[1],u=r[2],l=r[3],f=r[4],c=r[5],p=r[6],d=r[7],v=r[8],m=r[9],g=r[10],y=r[11],t[0]=o,t[1]=s,t[2]=u,t[3]=l,t[4]=f,t[5]=c,t[6]=p,t[7]=d,t[8]=v,t[9]=m,t[10]=g,t[11]=y,t[12]=o*n+f*i+v*a+r[12],t[13]=s*n+c*i+m*a+r[13],t[14]=u*n+p*i+g*a+r[14],t[15]=l*n+d*i+y*a+r[15]),t}function vj(t,r,e){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=r[7]*i,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function qge(){var t=new aa(4);return aa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function _j(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t}function ps(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3];return t[0]=e[0]*n+e[4]*i+e[8]*a+e[12]*o,t[1]=e[1]*n+e[5]*i+e[9]*a+e[13]*o,t[2]=e[2]*n+e[6]*i+e[10]*a+e[14]*o,t[3]=e[3]*n+e[7]*i+e[11]*a+e[15]*o,t}var DWe=function(){var t=qge();return function(r,e,n,i,a,o){var s,u;for(e||(e=4),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}();function Yge(t,r){if(t===r)return!0;if(Array.isArray(t)){var e=t.length;if(!r||r.length!==e)return!1;for(var n=0;n<e;n++)if(t[n]!==r[n])return!1;return!0}return!1}function Hr(t){var r={},e;return function(n){for(var i in n)if(!Yge(n[i],r[i])){e=t(n),r=n;break}return e}}var bj=[0,0,0,0],Kge=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],xj=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Jge=[0,0,0],Aj=[0,0,0],Zge=Hr(eye);function eT(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Aj;e.length<3&&(e=[e[0],e[1],0]);var n=e,i,a=!0;switch(r===se.LNGLAT_OFFSETS||r===se.METER_OFFSETS?i=e:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case _r.WEB_MERCATOR:(r===se.LNGLAT||r===se.CARTESIAN)&&(i=[0,0,0],a=!1);break;case _r.WEB_MERCATOR_AUTO_OFFSET:r===se.LNGLAT?n=i:r===se.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(n),n[0]-=e[0],n[1]-=e[1],n[2]-=e[2]);break;case _r.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case _r.GLOBE:a=!1,i=null;break;default:a=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:a}}function Qge(t,r,e){var n=t.viewMatrixUncentered,i=t.projectionMatrix,a=t.viewMatrix,o=t.viewProjectionMatrix,s=bj,u=bj,l=t.cameraPosition,f=eT(t,r,e),c=f.geospatialOrigin,p=f.shaderCoordinateOrigin,d=f.offsetMode;return d&&(u=t.projectPosition(c||p),l=[l[0]-u[0],l[1]-u[1],l[2]-u[2]],u[3]=1,s=ps([],u,o),a=n||a,o=cs([],i,a),o=cs([],o,Kge)),{viewMatrix:a,viewProjectionMatrix:o,projectionCenter:s,originCommon:u,cameraPosCommon:l,shaderCoordinateOrigin:p,geospatialOrigin:c}}function xm(t){var r=t.viewport,e=t.devicePixelRatio,n=e===void 0?1:e,i=t.modelMatrix,a=i===void 0?null:i,o=t.coordinateSystem,s=o===void 0?se.DEFAULT:o,u=t.coordinateOrigin,l=u===void 0?Aj:u,f=t.autoWrapLongitude,c=f===void 0?!1:f;s===se.DEFAULT&&(s=r.isGeospatial?se.LNGLAT:se.CARTESIAN);var p=Zge({viewport:r,devicePixelRatio:n,coordinateSystem:s,coordinateOrigin:l});return p.project_uWrapLongitude=c,p.project_uModelMatrix=a||xj,p}function eye(t){var r=t.viewport,e=t.devicePixelRatio,n=t.coordinateSystem,i=t.coordinateOrigin,a=Qge(r,n,i),o=a.projectionCenter,s=a.viewProjectionMatrix,u=a.originCommon,l=a.cameraPosCommon,f=a.shaderCoordinateOrigin,c=a.geospatialOrigin,p=r.getDistanceScales(),d=[r.width*e,r.height*e],v=ps([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,m={project_uCoordinateSystem:n,project_uProjectionMode:r.projectionMode,project_uCoordinateOrigin:f,project_uCommonOrigin:u.slice(0,3),project_uCenter:o,project_uPseudoMeters:Boolean(r._pseudoMeters),project_uViewportSize:d,project_uDevicePixelRatio:e,project_uFocalDistance:v,project_uCommonUnitsPerMeter:p.unitsPerMeter,project_uCommonUnitsPerWorldUnit:p.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:Jge,project_uScale:r.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:xj,project_uCameraPosition:l};if(c){var g=r.getDistanceScales(c);switch(n){case se.METER_OFFSETS:m.project_uCommonUnitsPerWorldUnit=g.unitsPerMeter,m.project_uCommonUnitsPerWorldUnit2=g.unitsPerMeter2;break;case se.LNGLAT:case se.LNGLAT_OFFSETS:r._pseudoMeters||(m.project_uCommonUnitsPerMeter=g.unitsPerMeter),m.project_uCommonUnitsPerWorldUnit=g.unitsPerDegree,m.project_uCommonUnitsPerWorldUnit2=g.unitsPerDegree2;break;case se.CARTESIAN:m.project_uCommonUnitsPerWorldUnit=[1,1,g.unitsPerMeter[2]],m.project_uCommonUnitsPerWorldUnit2=[0,0,g.unitsPerMeter2[2]];break;default:break}}return m}var tye={};function rye(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:tye;return"viewport"in t?xm(t):{}}var Yt={name:"project",dependencies:[Lv,pj],vs:hj,getUniforms:rye};function Yu(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function tT(t){if(Array.isArray(t))return Yu(t)}function rT(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Qc(t,r){if(t){if(typeof t=="string")return Yu(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Yu(t,r)}}function nT(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ku(t){return tT(t)||rT(t)||Qc(t)||nT()}function iT(t){if(Array.isArray(t))return t}function aT(t,r){var e=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(e!=null){var n=[],i=!0,a=!1,o,s;try{for(e=e.call(t);!(i=(o=e.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(u){a=!0,s=u}finally{try{!i&&e.return!=null&&e.return()}finally{if(a)throw s}}return n}}function oT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cr(t,r){return iT(t)||aT(t,r)||Qc(t,r)||oT()}function sT(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Tj(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function uT(t,r,e){return r&&Tj(t.prototype,r),e&&Tj(t,e),t}function ht(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function Ju(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function io(t,r){var e=em([],r,t);return Qv(e,e,1/e[3]),e}function lT(t,r){var e=t%r;return e<0?r+e:e}function Sj(t,r,e){return e*r+(1-e)*t}function ep(t,r,e){return t<r?r:t>e?e:t}function nye(t){return Math.log(t)*Math.LOG2E}var Zu=Math.log2||nye;function xn(t,r){if(!t)throw new Error(r||"@math.gl/web-mercator: assertion failed.")}var Yn=Math.PI,Pj=Yn/4,An=Yn/180,fT=180/Yn,Qu=512,Am=4003e4,el=85.051129,cT=1.5;function tl(t){return Math.pow(2,t)}function Tm(t){return Zu(t)}function At(t){var r=cr(t,2),e=r[0],n=r[1];xn(Number.isFinite(e)),xn(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var i=e*An,a=n*An,o=Qu*(i+Yn)/(2*Yn),s=Qu*(Yn+Math.log(Math.tan(Pj+a*.5)))/(2*Yn);return[o,s]}function Kt(t){var r=cr(t,2),e=r[0],n=r[1],i=e/Qu*(2*Yn)-Yn,a=2*(Math.atan(Math.exp(n/Qu*(2*Yn)-Yn))-Pj);return[i*fT,a*fT]}function tp(t){var r=t.latitude;xn(Number.isFinite(r));var e=Math.cos(r*An);return Tm(Am*e)-9}function hs(t){var r=Math.cos(t*An);return Qu/Am/r}function ds(t){var r=t.latitude,e=t.longitude,n=t.highPrecision,i=n===void 0?!1:n;xn(Number.isFinite(r)&&Number.isFinite(e));var a=Qu,o=Math.cos(r*An),s=a/360,u=s/o,l=a/Am/o,f={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[s,u,l],degreesPerUnit:[1/s,1/u,1/l]};if(i){var c=An*Math.tan(r*An)/o,p=s*c/2,d=a/Am*c,v=d/u*l;f.unitsPerDegree2=[0,p,d],f.unitsPerMeter2=[v,0,v]}return f}function rp(t,r){var e=cr(t,3),n=e[0],i=e[1],a=e[2],o=cr(r,3),s=o[0],u=o[1],l=o[2],f=ds({longitude:n,latitude:i,highPrecision:!0}),c=f.unitsPerMeter,p=f.unitsPerMeter2,d=At(t);d[0]+=s*(c[0]+p[0]*u),d[1]+=u*(c[1]+p[1]*u);var v=Kt(d),m=(a||0)+(l||0);return Number.isFinite(a)||Number.isFinite(l)?[v[0],v[1],m]:v}function np(t){var r=t.height,e=t.pitch,n=t.bearing,i=t.altitude,a=t.scale,o=t.center,s=Ju();us(s,s,[0,0,-i]),Yv(s,s,-e*An),Kv(s,s,n*An);var u=a/r;return Wu(s,s,[u,u,u]),o&&us(s,s,_F([],o)),s}function Sm(t){var r=t.width,e=t.height,n=t.altitude,i=t.pitch,a=i===void 0?0:i,o=t.offset,s=t.center,u=t.scale,l=t.nearZMultiplier,f=l===void 0?1:l,c=t.farZMultiplier,p=c===void 0?1:c,d=t.fovy,v=d===void 0?oa(cT):d;n!==void 0&&(v=oa(n));var m=v*An,g=a*An,y=ao(v),_=y;s&&(_+=s[2]*u/Math.cos(g)/e);var b=m*(.5+(o?o[1]:0)/e),x=Math.sin(b)*_/Math.sin(ep(Math.PI/2-g-b,.01,Math.PI-.01)),A=Math.sin(g)*x+_,T=_*10,O=Math.min(A*p,T);return{fov:m,aspect:r/e,focalDistance:y,near:f,far:O}}function pT(t){var r=Sm(t),e=r.fov,n=r.aspect,i=r.near,a=r.far,o=Jv([],e,n,i,a);return o}function oa(t){return 2*Math.atan(.5/t)*fT}function ao(t){return .5/Math.tan(.5*t*An)}function vs(t,r){var e=cr(t,3),n=e[0],i=e[1],a=e[2],o=a===void 0?0:a;return xn(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),io(r,[n,i,o,1])}function Wr(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=cr(t,3),i=n[0],a=n[1],o=n[2];if(xn(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var s=io(r,[i,a,o,1]);return s}var u=io(r,[i,a,0,1]),l=io(r,[i,a,1,1]),f=u[2],c=l[2],p=f===c?0:((e||0)-f)/(c-f);return Bv([],u,l,p)}function rl(t){var r=t.width,e=t.height,n=t.bounds,i=t.minExtent,a=i===void 0?0:i,o=t.maxZoom,s=o===void 0?24:o,u=t.offset,l=u===void 0?[0,0]:u,f=cr(n,2),c=cr(f[0],2),p=c[0],d=c[1],v=cr(f[1],2),m=v[0],g=v[1],y=iye(t.padding),_=At([p,ep(g,-el,el)]),b=At([m,ep(d,-el,el)]),x=[Math.max(Math.abs(b[0]-_[0]),a),Math.max(Math.abs(b[1]-_[1]),a)],A=[r-y.left-y.right-Math.abs(l[0])*2,e-y.top-y.bottom-Math.abs(l[1])*2];xn(A[0]>0&&A[1]>0);var T=A[0]/x[0],O=A[1]/x[1],w=(y.right-y.left)/2/T,E=(y.bottom-y.top)/2/O,S=[(b[0]+_[0])/2+w,(b[1]+_[1])/2+E],I=Kt(S),R=Math.min(s,Zu(Math.abs(Math.min(T,O))));return xn(Number.isFinite(R)),{longitude:I[0],latitude:I[1],zoom:R}}function iye(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(xn(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}var wj=Math.PI/180;function nl(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=t.width,n=t.height,i=t.unproject,a={targetZ:r},o=i([0,n],a),s=i([e,n],a),u,l,f=t.fovy?.5*t.fovy*wj:Math.atan(.5/t.altitude),c=(90-t.pitch)*wj;return f>c-.01?(u=Oj(t,0,r),l=Oj(t,e,r)):(u=i([0,0],a),l=i([e,0],a)),[o,s,l,u]}function Oj(t,r,e){var n=t.pixelUnprojectionMatrix,i=io(n,[r,0,1,1]),a=io(n,[r,t.height,1,1]),o=e*t.distanceScales.unitsPerMeter[2],s=(o-i[2])/(a[2]-i[2]),u=Bv([],i,a,s),l=Kt(u);return l.push(e),l}var Ej=function(){function t(){var r=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{width:1,height:1};sT(this,t),ht(this,"latitude",void 0),ht(this,"longitude",void 0),ht(this,"zoom",void 0),ht(this,"pitch",void 0),ht(this,"bearing",void 0),ht(this,"altitude",void 0),ht(this,"fovy",void 0),ht(this,"meterOffset",void 0),ht(this,"center",void 0),ht(this,"width",void 0),ht(this,"height",void 0),ht(this,"scale",void 0),ht(this,"distanceScales",void 0),ht(this,"viewMatrix",void 0),ht(this,"projectionMatrix",void 0),ht(this,"viewProjectionMatrix",void 0),ht(this,"pixelProjectionMatrix",void 0),ht(this,"pixelUnprojectionMatrix",void 0),ht(this,"equals",function(R){return R instanceof t?R.width===r.width&&R.height===r.height&&TA(R.projectionMatrix,r.projectionMatrix)&&TA(R.viewMatrix,r.viewMatrix):!1}),ht(this,"project",function(R){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},G=z.topLeft,k=G===void 0?!0:G,U=r.projectPosition(R),j=vs(U,r.pixelProjectionMatrix),X=cr(j,2),H=X[0],Q=X[1],ne=k?Q:r.height-Q;return R.length===2?[H,ne]:[H,ne,j[2]]}),ht(this,"unproject",function(R){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},G=z.topLeft,k=G===void 0?!0:G,U=z.targetZ,j=U===void 0?void 0:U,X=cr(R,3),H=X[0],Q=X[1],ne=X[2],le=k?Q:r.height-Q,xe=j&&j*r.distanceScales.unitsPerMeter[2],we=Wr([H,le,ne],r.pixelUnprojectionMatrix,xe),ze=r.unprojectPosition(we),me=cr(ze,3),$e=me[0],Le=me[1],Pt=me[2];return Number.isFinite(ne)?[$e,Le,Pt]:Number.isFinite(j)?[$e,Le,j]:[$e,Le]}),ht(this,"projectPosition",function(R){var z=At(R),G=cr(z,2),k=G[0],U=G[1],j=(R[2]||0)*r.distanceScales.unitsPerMeter[2];return[k,U,j]}),ht(this,"unprojectPosition",function(R){var z=Kt(R),G=cr(z,2),k=G[0],U=G[1],j=(R[2]||0)*r.distanceScales.metersPerUnit[2];return[k,U,j]});var n=e.width,i=e.height,a=e.altitude,o=a===void 0?null:a,s=e.fovy,u=s===void 0?null:s,l=e.latitude,f=l===void 0?0:l,c=e.longitude,p=c===void 0?0:c,d=e.zoom,v=d===void 0?0:d,m=e.pitch,g=m===void 0?0:m,y=e.bearing,_=y===void 0?0:y,b=e.position,x=b===void 0?null:b,A=e.nearZMultiplier,T=A===void 0?.02:A,O=e.farZMultiplier,w=O===void 0?1.01:O;n=n||1,i=i||1,u===null&&o===null?(o=cT,u=oa(o)):u===null?u=oa(o):o===null&&(o=ao(u));var E=tl(v);o=Math.max(.75,o);var S=ds({longitude:p,latitude:f}),I=At([p,f]);I.push(0),x&&yF(I,I,PF([],x,S.unitsPerMeter)),this.projectionMatrix=pT({width:n,height:i,scale:E,center:I,pitch:g,fovy:u,nearZMultiplier:T,farZMultiplier:w}),this.viewMatrix=np({height:i,scale:E,center:I,pitch:g,bearing:_,altitude:o}),this.width=n,this.height=i,this.scale=E,this.latitude=f,this.longitude=p,this.zoom=v,this.pitch=g,this.bearing=_,this.altitude=o,this.fovy=u,this.center=I,this.meterOffset=x||[0,0,0],this.distanceScales=S,this._initMatrices(),Object.freeze(this)}return uT(t,[{key:"_initMatrices",value:function(){var e=this.width,n=this.height,i=this.projectionMatrix,a=this.viewMatrix,o=Ju();ss(o,o,i),ss(o,o,a),this.viewProjectionMatrix=o;var s=Ju();Wu(s,s,[e/2,-n/2,1]),us(s,s,[1,-1,0]),ss(s,s,o);var u=qv(Ju(),s);if(!u)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=u}},{key:"projectFlat",value:function(e){return At(e)}},{key:"unprojectFlat",value:function(e){return Kt(e)}},{key:"getMapCenterByLngLatPosition",value:function(e){var n=e.lngLat,i=e.pos,a=Wr(i,this.pixelUnprojectionMatrix),o=At(n),s=Hc([],o,pF([],a)),u=Hc([],this.center,s);return Kt(u)}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=this.width,a=this.height,o=rl(Object.assign({width:i,height:a,bounds:e},n)),s=o.longitude,u=o.latitude,l=o.zoom;return new t({width:i,height:a,longitude:s,latitude:u,zoom:l})}},{key:"getBounds",value:function(e){var n=this.getBoundingRegion(e),i=Math.min.apply(Math,Ku(n.map(function(u){return u[0]}))),a=Math.max.apply(Math,Ku(n.map(function(u){return u[0]}))),o=Math.min.apply(Math,Ku(n.map(function(u){return u[1]}))),s=Math.max.apply(Math,Ku(n.map(function(u){return u[1]})));return[[i,o],[a,s]]}},{key:"getBoundingRegion",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return nl(this,e.z||0)}},{key:"getLocationAtPoint",value:function(e){var n=e.lngLat,i=e.pos;return this.getMapCenterByLngLatPosition({lngLat:n,pos:i})}}]),t}();var Cj=512;function Pm(t){var r=t.width,e=t.height,n=t.pitch,i=n===void 0?0:n,a=t.longitude,o=t.latitude,s=t.zoom,u=t.bearing,l=u===void 0?0:u;(a<-180||a>180)&&(a=lT(a+180,360)-180),(l<-180||l>180)&&(l=lT(l+180,360)-180);var f=Zu(e/Cj);if(s<=f)s=f,o=0;else{var c=e/2/Math.pow(2,s),p=Kt([0,c])[1];if(o<p)o=p;else{var d=Kt([0,Cj-c])[1];o>d&&(o=d)}}return{width:r,height:e,longitude:a,latitude:o,zoom:s,pitch:i,bearing:l}}function Mj(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ij(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Mj(Object(e),!0).forEach(function(n){ht(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Mj(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function aye(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=oye(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function oye(t,r){if(t){if(typeof t=="string")return Rj(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Rj(t,r)}}function Rj(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Lj=.01,sye=["longitude","latitude","zoom"],kj={curve:1.414,speed:1.2};function wm(t,r,e,n){var i=Bj(t,r,n),a=i.startZoom,o=i.startCenterXY,s=i.uDelta,u=i.w0,l=i.u1,f=i.S,c=i.rho,p=i.rho2,d=i.r0;if(l<Lj){var v={},m=aye(sye),g;try{for(m.s();!(g=m.n()).done;){var y=g.value,_=t[y],b=r[y];v[y]=Sj(_,b,e)}}catch(I){m.e(I)}finally{m.f()}return v}var x=e*f,A=Math.cosh(d)/Math.cosh(d+c*x),T=u*((Math.cosh(d)*Math.tanh(d+c*x)-Math.sinh(d))/p)/l,O=1/A,w=a+Tm(O),E=fF([],s,T);Hc(E,E,o);var S=Kt(E);return{longitude:S[0],latitude:S[1],zoom:w}}function hT(t,r,e){var n=Ij(Ij({},kj),e),i=n.screenSpeed,a=n.speed,o=n.maxDuration,s=Bj(t,r,n),u=s.S,l=s.rho,f=1e3*u,c;return Number.isFinite(i)?c=f/(i/l):c=f/a,Number.isFinite(o)&&c>o?0:c}function Bj(t,r,e){e=Object.assign({},kj,e);var n=e.curve,i=t.zoom,a=[t.longitude,t.latitude],o=tl(i),s=r.zoom,u=[r.longitude,r.latitude],l=tl(s-i),f=At(a),c=At(u),p=vF([],c,f),d=Math.max(t.width,t.height),v=d/l,m=cF(p)*o,g=Math.max(m,Lj),y=n*n,_=(v*v-d*d+y*y*g*g)/(2*d*y*g),b=(v*v-d*d-y*y*g*g)/(2*v*y*g),x=Math.log(Math.sqrt(_*_+1)-_),A=Math.log(Math.sqrt(b*b+1)-b),T=(A-x)/n;return{startZoom:i,startCenterXY:f,uDelta:p,w0:d,u1:m,S:T,rho:n,rho2:y,r0:x,r1:A}}function uye(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=lye(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function lye(t,r){if(t){if(typeof t=="string")return Fj(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Fj(t,r)}}function Fj(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var fye=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,cye=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,pye=Hr(gye),hye=Hr(yye),dye=[0,0,0,1],vye=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function mye(t,r){var e=(0,Dj.default)(t,3),n=e[0],i=e[1],a=e[2],o=Wr([n,i,a],r);return Number.isFinite(a)?o:[o[0],o[1],0]}function gye(t){var r=t.viewport,e=t.center;return new ce(r.viewProjectionMatrix).invert().transform(e)}function yye(t){var r=t.viewport,e=t.shadowMatrices,n=[],i=r.pixelUnprojectionMatrix,a=r.isGeospatial?void 0:1,o=[[0,0,a],[r.width,0,a],[0,r.height,a],[r.width,r.height,a],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(function(f){return mye(f,i)}),s=uye(e),u;try{var l=function(){var c=u.value,p=c.clone().translate(new V(r.center).negate()),d=o.map(function(m){return p.transform(m)}),v=new ce().ortho({left:Math.min.apply(Math,(0,ms.default)(d.map(function(m){return m[0]}))),right:Math.max.apply(Math,(0,ms.default)(d.map(function(m){return m[0]}))),bottom:Math.min.apply(Math,(0,ms.default)(d.map(function(m){return m[1]}))),top:Math.max.apply(Math,(0,ms.default)(d.map(function(m){return m[1]}))),near:Math.min.apply(Math,(0,ms.default)(d.map(function(m){return-m[2]}))),far:Math.max.apply(Math,(0,ms.default)(d.map(function(m){return-m[2]})))});n.push(v.multiplyRight(c))};for(s.s();!(u=s.n()).done;)l()}catch(f){s.e(f)}finally{s.f()}return n}function _ye(t,r){var e=t.shadowEnabled,n=e===void 0?!0:e;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};for(var i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||dye,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},a=pye({viewport:t.viewport,center:r.project_uCenter}),o=[],s=hye({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice(),u=0;u<t.shadowMatrices.length;u++){var l=s[u],f=l.clone().translate(new V(t.viewport.center).negate());r.project_uCoordinateSystem===se.LNGLAT&&r.project_uProjectionMode===_r.WEB_MERCATOR?(s[u]=f,o[u]=a):(s[u]=l.clone().multiplyRight(vye),o[u]=f.transform(a))}for(var c=0;c<s.length;c++)i["shadow_uViewProjectionMatrices[".concat(c,"]")]=s[c],i["shadow_uProjectCenters[".concat(c,"]")]=o[c],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(c)]=t.shadowMaps[c]:i["shadow_uShadowMap".concat(c)]=t.dummyShadowMap;return i}var gs={name:"shadow",dependencies:[Yt],vs:fye,fs:cye,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?_ye(r,e):{}}};function Nj(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=bye(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function bye(t,r){if(t){if(typeof t=="string")return jj(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return jj(t,r)}}function jj(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var xye={color:[255,255,255],intensity:1},Uj=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Aye=[0,0,0,200/255],ip=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Gj.default)(this,t),(0,sn.default)(this,"id","lighting-effect"),(0,sn.default)(this,"props",void 0),(0,sn.default)(this,"shadowColor",Aye),(0,sn.default)(this,"shadow",void 0),(0,sn.default)(this,"ambientLight",void 0),(0,sn.default)(this,"directionalLights",void 0),(0,sn.default)(this,"pointLights",void 0),(0,sn.default)(this,"shadowPasses",[]),(0,sn.default)(this,"shadowMaps",[]),(0,sn.default)(this,"dummyShadowMap",null),(0,sn.default)(this,"programManager",void 0),(0,sn.default)(this,"shadowMatrices",void 0),this.setProps(r)}return(0,zj.default)(t,[{key:"setProps",value:function(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(var n in e){var i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(function(a){return a.shadow}),this.props=e}},{key:"preRender",value:function(e,n){var i=n.layers,a=n.layerFilter,o=n.viewports,s=n.onViewportActive,u=n.views;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=_n.getDefaultProgramManager(e),gs&&this.programManager.addDefaultModule(gs)),this.dummyShadowMap||(this.dummyShadowMap=new Se(e,{width:1,height:1}));for(var l=0;l<this.shadowPasses.length;l++){var f=this.shadowPasses[l];f.render({layers:i,layerFilter:a,viewports:o,onViewportActive:s,views:u,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}},{key:"getModuleParameters",value:function(e){var n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(function(i){return i.getProjectedLight({layer:e})}),pointLights:this.pointLights.map(function(i){return i.getProjectedLight({layer:e})})},n}},{key:"cleanup",value:function(){var e=Nj(this.shadowPasses),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(gs),this.programManager=null)}},{key:"_calculateMatrices",value:function(){var e=[],n=Nj(this.directionalLights),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=new ce().lookAt({eye:new V(a.direction).negate()});e.push(o)}}catch(s){n.e(s)}finally{n.f()}return e}},{key:"_createShadowPasses",value:function(e){for(var n=0;n<this.directionalLights.length;n++){var i=new fj(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}},{key:"_applyDefaultLights",value:function(){var e=this.ambientLight,n=this.pointLights,i=this.directionalLights;!e&&n.length===0&&i.length===0&&(this.ambientLight=new gm(xye),this.directionalLights.push(new fs(Uj[0]),new fs(Uj[1])))}}]),t}();var f4=h(L()),c4=h(N()),sa=h(B());var Rm=h(ye());var Cm=h(ye()),t4=h(L()),r4=h(N()),Zn=h(_e()),vT=h(Oe()),n4=h(Y()),i4=h(K()),op=h(q()),Tn=h(B());var ol=h(ye()),Jj=h(L()),Zj=h(N()),_t=h(B());var Vj=h(L()),Hj=h(N()),dT=h(B()),Tye=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Vj.default)(this,t),(0,dT.default)(this,"_pool",[]),(0,dT.default)(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(r)}return(0,Hj.default)(t,[{key:"setOptions",value:function(e){Object.assign(this.opts,e)}},{key:"allocate",value:function(e,n,i){var a=i.size,o=a===void 0?1:a,s=i.type,u=i.padding,l=u===void 0?0:u,f=i.copy,c=f===void 0?!1:f,p=i.initialize,d=p===void 0?!1:p,v=i.maxCount,m=s||e&&e.constructor||Float32Array,g=n*o+l;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new m(e.buffer,0,g)}var y=1/0;v&&(y=v*o+l);var _=this._allocate(m,g,d,y);return e&&c?_.set(e):d||_.fill(0,0,4),this._release(e),_}},{key:"release",value:function(e){this._release(e)}},{key:"_allocate",value:function(e,n,i,a){var o=Math.max(Math.ceil(n*this.opts.overAlloc),1);o>a&&(o=a);var s=this._pool,u=e.BYTES_PER_ELEMENT*o,l=s.findIndex(function(c){return c.byteLength>=u});if(l>=0){var f=new e(s.splice(l,1)[0],0,o);return i&&f.fill(0),f}return new e(o)}},{key:"_release",value:function(e){if(ArrayBuffer.isView(e)){var n=this._pool,i=e.buffer,a=i.byteLength,o=n.findIndex(function(s){return s.byteLength>=a});o<0?n.push(i):(o>0||n.length<this.opts.poolSize)&&n.splice(o,0,i),n.length>this.opts.poolSize&&n.shift()}}}]),t}(),Kn=new Tye;function Sye(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Pye(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Pye(t,r){if(t){if(typeof t=="string")return Wj(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Wj(t,r)}}function Wj(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function al(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ys(t,r){var e=t%r;return e<0?r+e:e}function Xj(t){return[t[12],t[13],t[14]]}function qj(t){return{left:il(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:il(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:il(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:il(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:il(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:il(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}var $j=new V;function il(t,r,e,n){$j.set(t,r,e);var i=$j.len();return{distance:n/i,normal:new V(-t/i,-r/i,-e/i)}}function Jn(t){return t-Math.fround(t)}var ap;function Om(t,r){var e=r.size,n=e===void 0?1:e,i=r.startIndex,a=i===void 0?0:i,o=r.endIndex!==void 0?r.endIndex:t.length,s=(o-a)/n;ap=Kn.allocate(ap,s,{type:Float32Array,size:n*2});for(var u=a,l=0;u<o;){for(var f=0;f<n;f++){var c=t[u++];ap[l+f]=c,ap[l+f+n]=Jn(c)}l+=n*2}return ap.subarray(0,s*n*2)}function Yj(t){var r=null,e=!1,n=Sye(t),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a&&(r?(e||(r=[[r[0][0],r[0][1]],[r[1][0],r[1][1]]],e=!0),r[0][0]=Math.min(r[0][0],a[0][0]),r[0][1]=Math.min(r[0][1],a[0][1]),r[1][0]=Math.max(r[1][0],a[1][0]),r[1][1]=Math.max(r[1][1],a[1][1])):r=a)}}catch(o){n.e(o)}finally{n.f()}return r}var wye=Math.PI/180,Oye=al(),Kj=[0,0,0],Eye={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Cye(t){var r=t.width,e=t.height,n=t.orthographic,i=t.fovyRadians,a=t.focalDistance,o=t.padding,s=t.near,u=t.far,l=r/e,f=n?new ce().orthographic({fovy:i,aspect:l,focalDistance:a,near:s,far:u}):new ce().perspective({fovy:i,aspect:l,near:s,far:u});if(o){var c=o.left,p=c===void 0?0:c,d=o.right,v=d===void 0?0:d,m=o.top,g=m===void 0?0:m,y=o.bottom,_=y===void 0?0:y,b=He((p+r-v)/2,0,r)-r/2,x=He((g+e-_)/2,0,e)-e/2;f[8]-=b*2/r,f[9]+=x*2/e}return f}var yr=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Jj.default)(this,t),(0,_t.default)(this,"id",void 0),(0,_t.default)(this,"x",void 0),(0,_t.default)(this,"y",void 0),(0,_t.default)(this,"width",void 0),(0,_t.default)(this,"height",void 0),(0,_t.default)(this,"padding",void 0),(0,_t.default)(this,"isGeospatial",void 0),(0,_t.default)(this,"zoom",void 0),(0,_t.default)(this,"focalDistance",void 0),(0,_t.default)(this,"position",void 0),(0,_t.default)(this,"modelMatrix",void 0),(0,_t.default)(this,"distanceScales",void 0),(0,_t.default)(this,"scale",void 0),(0,_t.default)(this,"center",void 0),(0,_t.default)(this,"cameraPosition",void 0),(0,_t.default)(this,"projectionMatrix",void 0),(0,_t.default)(this,"viewMatrix",void 0),(0,_t.default)(this,"viewMatrixUncentered",void 0),(0,_t.default)(this,"viewMatrixInverse",void 0),(0,_t.default)(this,"viewProjectionMatrix",void 0),(0,_t.default)(this,"pixelProjectionMatrix",void 0),(0,_t.default)(this,"pixelUnprojectionMatrix",void 0),(0,_t.default)(this,"resolution",void 0),(0,_t.default)(this,"_frustumPlanes",{}),this.id=r.id||this.constructor.displayName||"viewport",this.x=r.x||0,this.y=r.y||0,this.width=r.width||1,this.height=r.height||1,this.zoom=r.zoom||0,this.padding=r.padding,this.distanceScales=r.distanceScales||Eye,this.focalDistance=r.focalDistance||1,this.position=r.position||Kj,this.modelMatrix=r.modelMatrix||null;var e=r.longitude,n=r.latitude;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(r),this._initMatrices(r),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Zj.default)(t,[{key:"subViewports",get:function(){return null}},{key:"metersPerPixel",get:function(){return this.distanceScales.metersPerUnit[2]/this.scale}},{key:"projectionMode",get:function(){return this.isGeospatial?this.zoom<12?_r.WEB_MERCATOR:_r.WEB_MERCATOR_AUTO_OFFSET:_r.IDENTITY}},{key:"equals",value:function(e){return e instanceof t?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&tt(e.projectionMatrix,this.projectionMatrix)&&tt(e.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=this.projectPosition(e),s=vs(o,this.pixelProjectionMatrix),u=(0,ol.default)(s,2),l=u[0],f=u[1],c=a?f:this.height-f;return e.length===2?[l,c]:[l,c,s[2]]}},{key:"unproject",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=n.targetZ,s=(0,ol.default)(e,3),u=s[0],l=s[1],f=s[2],c=a?l:this.height-l,p=o&&o*this.distanceScales.unitsPerMeter[2],d=Wr([u,c,f],this.pixelUnprojectionMatrix,p),v=this.unprojectPosition(d),m=(0,ol.default)(v,3),g=m[0],y=m[1],_=m[2];return Number.isFinite(f)?[g,y,_]:Number.isFinite(o)?[g,y,o]:[g,y]}},{key:"projectPosition",value:function(e){var n=this.projectFlat(e),i=(0,ol.default)(n,2),a=i[0],o=i[1],s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[a,o,s]}},{key:"unprojectPosition",value:function(e){var n=this.unprojectFlat(e),i=(0,ol.default)(n,2),a=i[0],o=i[1],s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[a,o,s]}},{key:"projectFlat",value:function(e){if(this.isGeospatial){var n=At(e);return n[1]=He(n[1],-318,830),n}return e}},{key:"unprojectFlat",value:function(e){return this.isGeospatial?Kt(e):e}},{key:"getBounds",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n={targetZ:e.z||0},i=this.unproject([0,0],n),a=this.unproject([this.width,0],n),o=this.unproject([0,this.height],n),s=this.unproject([this.width,this.height],n);return[Math.min(i[0],a[0],o[0],s[0]),Math.min(i[1],a[1],o[1],s[1]),Math.max(i[0],a[0],o[0],s[0]),Math.max(i[1],a[1],o[1],s[1])]}},{key:"getDistanceScales",value:function(e){return e?ds({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}},{key:"containsPixel",value:function(e){var n=e.x,i=e.y,a=e.width,o=a===void 0?1:a,s=e.height,u=s===void 0?1:s;return n<this.x+this.width&&this.x<n+o&&i<this.y+this.height&&this.y<i+u}},{key:"getFrustumPlanes",value:function(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,qj(this.viewProjectionMatrix)),this._frustumPlanes)}},{key:"panByPosition",value:function(e,n){return null}},{key:"_initProps",value:function(e){var n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=tp({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||ds({latitude:i,longitude:n}));var a=Math.pow(2,this.zoom);this.scale=a;var o=e.position,s=e.modelMatrix,u=Kj;if(o&&(u=s?new ce(s).transformAsVector(o,[]):o),this.isGeospatial){var l=this.projectPosition([n,i,0]);this.center=new V(u).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(u)}},{key:"_initMatrices",value:function(e){var n=e.viewMatrix,i=n===void 0?Oye:n,a=e.projectionMatrix,o=a===void 0?null:a,s=e.orthographic,u=s===void 0?!1:s,l=e.fovyRadians,f=e.fovy,c=f===void 0?75:f,p=e.near,d=p===void 0?.1:p,v=e.far,m=v===void 0?1e3:v,g=e.padding,y=g===void 0?null:g,_=e.focalDistance,b=_===void 0?1:_;this.viewMatrixUncentered=i,this.viewMatrix=new ce().multiplyRight(i).translate(new V(this.center).negate()),this.projectionMatrix=o||Cye({width:this.width,height:this.height,orthographic:u,fovyRadians:l||c*wye,focalDistance:b,padding:y,near:d,far:m});var x=al();cs(x,x,this.projectionMatrix),cs(x,x,this.viewMatrix),this.viewProjectionMatrix=x,this.viewMatrixInverse=ZA([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Xj(this.viewMatrixInverse);var A=al(),T=al();vj(A,A,[this.width/2,-this.height/2,1]),dj(A,A,[1,-1,0]),cs(T,A,this.viewProjectionMatrix),this.pixelProjectionMatrix=T,this.pixelUnprojectionMatrix=ZA(al(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Z.warn("Pixel project matrix not invertible")()}}]),t}();(0,_t.default)(yr,"displayName","Viewport");function Mye(){var t=new aa(2);return aa!=Float32Array&&(t[0]=0,t[1]=0),t}function sl(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t}function Em(t,r){return t[0]=-r[0],t[1]=-r[1],t}var P$e=function(){var t=Mye();return function(r,e,n,i,a,o){var s,u;for(e||(e=2),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],a(t,t,o),r[s]=t[0],r[s+1]=t[1];return r}}();function e4(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ul(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?e4(Object(e),!0).forEach(function(n){(0,Tn.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):e4(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Iye(t){var r=Rye();return function(){var n=(0,op.default)(t),i;if(r){var a=(0,op.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,i4.default)(this,i)}}function Rye(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $r=function(t){(0,n4.default)(e,t);var r=Iye(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,t4.default)(this,e);var a=i.latitude,o=a===void 0?0:a,s=i.longitude,u=s===void 0?0:s,l=i.zoom,f=l===void 0?0:l,c=i.pitch,p=c===void 0?0:c,d=i.bearing,v=d===void 0?0:d,m=i.nearZMultiplier,g=m===void 0?.1:m,y=i.farZMultiplier,_=y===void 0?1.01:y,b=i.orthographic,x=b===void 0?!1:b,A=i.projectionMatrix,T=i.repeat,O=T===void 0?!1:T,w=i.worldOffset,E=w===void 0?0:w,S=i.position,I=i.padding,R=i.legacyMeterSizes,z=R===void 0?!1:R,G=i.width,k=i.height,U=i.altitude,j=U===void 0?1.5:U,X=Math.pow(2,f);G=G||1,k=k||1;var H,Q=null;if(A)j=A[5]/2,H=oa(j);else{i.fovy?(H=i.fovy,j=ao(H)):H=oa(j);var ne;if(I){var le=I.top,xe=le===void 0?0:le,we=I.bottom,ze=we===void 0?0:we;ne=[0,He((xe+k-ze)/2,0,k)-k/2]}Q=Sm({width:G,height:k,scale:X,center:S&&[0,0,S[2]*hs(o)],offset:ne,pitch:p,fovy:H,nearZMultiplier:g,farZMultiplier:_})}var me=np({height:k,pitch:p,bearing:v,scale:X,altitude:j});if(E){var $e=new ce().translate([512*E,0,0]);me=$e.multiplyLeft(me)}return n=r.call(this,ul(ul(ul({},i),{},{width:G,height:k,viewMatrix:me,longitude:u,latitude:o,zoom:f},Q),{},{fovy:H,focalDistance:j})),(0,Tn.default)((0,Zn.default)(n),"longitude",void 0),(0,Tn.default)((0,Zn.default)(n),"latitude",void 0),(0,Tn.default)((0,Zn.default)(n),"pitch",void 0),(0,Tn.default)((0,Zn.default)(n),"bearing",void 0),(0,Tn.default)((0,Zn.default)(n),"altitude",void 0),(0,Tn.default)((0,Zn.default)(n),"fovy",void 0),(0,Tn.default)((0,Zn.default)(n),"orthographic",void 0),(0,Tn.default)((0,Zn.default)(n),"_subViewports",void 0),(0,Tn.default)((0,Zn.default)(n),"_pseudoMeters",void 0),n.latitude=o,n.longitude=u,n.zoom=f,n.pitch=p,n.bearing=v,n.altitude=j,n.fovy=H,n.orthographic=x,n._subViewports=O?[]:null,n._pseudoMeters=z,Object.freeze((0,Zn.default)(n)),n}return(0,r4.default)(e,[{key:"subViewports",get:function(){if(this._subViewports&&!this._subViewports.length)for(var i=this.getBounds(),a=Math.floor((i[0]+180)/360),o=Math.ceil((i[2]-180)/360),s=a;s<=o;s++){var u=s?new e(ul(ul({},this),{},{worldOffset:s})):this;this._subViewports.push(u)}return this._subViewports}},{key:"projectPosition",value:function(i){if(this._pseudoMeters)return(0,vT.default)((0,op.default)(e.prototype),"projectPosition",this).call(this,i);var a=this.projectFlat(i),o=(0,Cm.default)(a,2),s=o[0],u=o[1],l=(i[2]||0)*hs(i[1]);return[s,u,l]}},{key:"unprojectPosition",value:function(i){if(this._pseudoMeters)return(0,vT.default)((0,op.default)(e.prototype),"unprojectPosition",this).call(this,i);var a=this.unprojectFlat(i),o=(0,Cm.default)(a,2),s=o[0],u=o[1],l=(i[2]||0)/hs(u);return[s,u,l]}},{key:"addMetersToLngLat",value:function(i,a){return rp(i,a)}},{key:"panByPosition",value:function(i,a){var o=Wr(a,this.pixelUnprojectionMatrix),s=this.projectFlat(i),u=sl([],s,Em([],o)),l=sl([],this.center,u),f=this.unprojectFlat(l),c=(0,Cm.default)(f,2),p=c[0],d=c[1];return{longitude:p,latitude:d}}},{key:"getBounds",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=nl(this,i.z||0);return[Math.min(a[0][0],a[1][0],a[2][0],a[3][0]),Math.min(a[0][1],a[1][1],a[2][1],a[3][1]),Math.max(a[0][0],a[1][0],a[2][0],a[3][0]),Math.max(a[0][1],a[1][1],a[2][1],a[3][1])]}},{key:"fitBounds",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,s=this.height,u=rl(ul({width:o,height:s,bounds:i},a)),l=u.longitude,f=u.latitude,c=u.zoom;return new e({width:o,height:s,longitude:l,latitude:f,zoom:c})}}]),e}(yr);(0,Tn.default)($r,"displayName","WebMercatorViewport");function Lye(){var t=new aa(3);return aa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function kye(t){var r=t[0],e=t[1],n=t[2];return Math.hypot(r,e,n)}function Bye(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t}function Fye(t){var r=t[0],e=t[1],n=t[2];return r*r+e*e+n*n}function a4(t,r,e,n){var i=r[0],a=r[1],o=r[2];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t[2]=o+n*(e[2]-o),t}var Mm=Bye;var o4=kye,Im=Fye,M$e=function(){var t=Lye();return function(r,e,n,i,a,o){var s,u;for(e||(e=3),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2];return r}}();var u4=[0,0,0];function mT(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=r.projectPosition(t);if(e&&r instanceof $r){var i=(0,Rm.default)(t,3),a=i[0],o=i[1],s=i[2],u=s===void 0?0:s,l=r.getDistanceScales([a,o]);n[2]=u*l.unitsPerMeter[2]}return n}function Dye(t){var r=t.viewport,e=t.modelMatrix,n=t.coordinateOrigin,i=t.coordinateSystem,a=t.fromCoordinateSystem,o=t.fromCoordinateOrigin;return i===se.DEFAULT&&(i=r.isGeospatial?se.LNGLAT:se.CARTESIAN),a===void 0&&(a=i),o===void 0&&(o=n),{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:e,fromCoordinateSystem:a,fromCoordinateOrigin:o}}function gT(t,r){var e=r.viewport,n=r.modelMatrix,i=r.coordinateSystem,a=r.coordinateOrigin,o=r.offsetMode,s=(0,Rm.default)(t,3),u=s[0],l=s[1],f=s[2],c=f===void 0?0:f;if(n){var p=ps([],[u,l,c,1],n),d=(0,Rm.default)(p,3);u=d[0],l=d[1],c=d[2]}switch(i){case se.LNGLAT:return mT([u,l,c],e,o);case se.LNGLAT_OFFSETS:return mT([u+a[0],l+a[1],c+(a[2]||0)],e,o);case se.METER_OFFSETS:return mT(rp(a,[u,l,c]),e,o);case se.CARTESIAN:default:return e.isGeospatial?[u+a[0],l+a[1],c+a[2]]:e.projectPosition([u,l,c])}}function Lm(t,r){var e=Dye(r),n=e.viewport,i=e.coordinateSystem,a=e.coordinateOrigin,o=e.modelMatrix,s=e.fromCoordinateSystem,u=e.fromCoordinateOrigin,l=r.autoOffset,f=l===void 0?!0:l,c=f?eT(n,i,a):{},p=c.geospatialOrigin,d=p===void 0?u4:p,v=c.shaderCoordinateOrigin,m=v===void 0?u4:v,g=c.offsetMode,y=g===void 0?!1:g,_=gT(t,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:u,offsetMode:y});if(y){var b=n.projectPosition(d||m);Mm(_,_,b)}return _}function l4(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Nye(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?l4(Object(e),!0).forEach(function(n){(0,sa.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):l4(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var jye=[255,255,255],Uye=1,Gye=[0,0,1],zye=[0,0,1],Vye=0,km=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,f4.default)(this,t),(0,sa.default)(this,"id",void 0),(0,sa.default)(this,"color",void 0),(0,sa.default)(this,"intensity",void 0),(0,sa.default)(this,"type","point"),(0,sa.default)(this,"position",void 0),(0,sa.default)(this,"attenuation",void 0),(0,sa.default)(this,"projectedLight",void 0);var e=r.color,n=e===void 0?jye:e,i=r.intensity,a=i===void 0?Uye:i,o=r.position,s=o===void 0?zye:o;this.id=r.id||"point-".concat(Vye++),this.color=n,this.intensity=a,this.type="point",this.position=s,this.attenuation=Hye(r),this.projectedLight=Nye({},this)}return(0,c4.default)(t,[{key:"getProjectedLight",value:function(e){var n=e.layer,i=this.projectedLight,a=n.context.viewport,o=n.props,s=o.coordinateSystem,u=o.coordinateOrigin,l=Lm(this.position,{viewport:a,coordinateSystem:s,coordinateOrigin:u,fromCoordinateSystem:a.isGeospatial?se.LNGLAT:se.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return i.color=this.color,i.intensity=this.intensity,i.position=l,i}}]),t}();function Hye(t){return t.attenuation?t.attenuation:"intensity"in t?[0,0,t.intensity||0]:Gye}var p4=h(L()),h4=h(N()),d4=h(Y()),v4=h(K()),yT=h(q());function Wye(t){var r=$ye();return function(){var n=(0,yT.default)(t),i;if(r){var a=(0,yT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,v4.default)(this,i)}}function $ye(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var m4=function(t){(0,d4.default)(e,t);var r=Wye(e);function e(){return(0,p4.default)(this,e),r.apply(this,arguments)}return(0,h4.default)(e,[{key:"getProjectedLight",value:function(i){var a=i.layer,o=this.projectedLight,s=a.context.viewport,u=a.props,l=u.coordinateSystem,f=u.coordinateOrigin,c=u.modelMatrix,p=xm({viewport:s,modelMatrix:c,coordinateSystem:l,coordinateOrigin:f}),d=p.project_uCameraPosition;return o.color=this.color,o.intensity=this.intensity,o.position=d,o}}]),e}(km);var y4=h(ye()),_4=h(L()),b4=h(N()),x4=h(_e()),A4=h(Y()),T4=h(K()),_T=h(q()),S4=h(B());var _s=Math.PI/180,Xye=1e3*60*60*24,qye=2440588,Yye=2451545,Bm=_s*23.4397,Kye=357.5291,Jye=.98560028,Zye=280.147,Qye=360.9856235;function g4(t,r,e){var n=_s*-e,i=_s*r,a=t0e(t),o=l0e(a),s=o0e(a,n)-o.rightAscension;return{azimuth:i0e(s,i,o.declination),altitude:a0e(s,i,o.declination)}}function Fm(t,r,e){var n=g4(t,r,e),i=n.azimuth,a=n.altitude;return[Math.sin(i)*Math.cos(a),Math.cos(i)*Math.cos(a),-Math.sin(a)]}function e0e(t){var r=typeof t=="number"?t:t.getTime();return r/Xye-.5+qye}function t0e(t){return e0e(t)-Yye}function r0e(t,r){var e=t;return Math.atan2(Math.sin(e)*Math.cos(Bm)-Math.tan(r)*Math.sin(Bm),Math.cos(e))}function n0e(t,r){var e=t;return Math.asin(Math.sin(r)*Math.cos(Bm)+Math.cos(r)*Math.sin(Bm)*Math.sin(e))}function i0e(t,r,e){var n=t,i=r,a=e;return Math.atan2(Math.sin(n),Math.cos(n)*Math.sin(i)-Math.tan(a)*Math.cos(i))}function a0e(t,r,e){var n=t,i=r,a=e;return Math.asin(Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos(n))}function o0e(t,r){return _s*(Zye+Qye*t)-r}function s0e(t){return _s*(Kye+Jye*t)}function u0e(t){var r=t,e=_s*(1.9148*Math.sin(r)+.02*Math.sin(2*r)+3e-4*Math.sin(3*r)),n=_s*102.9372;return r+e+n+Math.PI}function l0e(t){var r=s0e(t),e=u0e(r);return{declination:n0e(e,0),rightAscension:r0e(e,0)}}function f0e(t){var r=c0e();return function(){var n=(0,_T.default)(t),i;if(r){var a=(0,_T.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,T4.default)(this,i)}}function c0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var P4=function(t){(0,A4.default)(e,t);var r=f0e(e);function e(n){var i;return(0,_4.default)(this,e),i=r.call(this,n),(0,S4.default)((0,x4.default)(i),"timestamp",void 0),i.timestamp=n.timestamp,i}return(0,b4.default)(e,[{key:"getProjectedLight",value:function(i){var a=i.layer,o=a.context.viewport,s=o.resolution&&o.resolution>0;if(s){var u=Fm(this.timestamp,0,0),l=(0,y4.default)(u,3),f=l[0],c=l[1],p=l[2];this.direction=[f,-p,c]}else{var d=o.latitude,v=o.longitude;this.direction=Fm(this.timestamp,d,v)}return this}}]),e}(fs);var k4=h(L()),B4=h(N()),sp=h(B());var w4=h(L()),O4=h(N()),E4=h(_e()),C4=h(Y()),M4=h(K()),bT=h(q()),I4=h(B());function p0e(t){var r=h0e();return function(){var n=(0,bT.default)(t),i;if(r){var a=(0,bT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,M4.default)(this,i)}}function h0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xT=function(t){(0,C4.default)(e,t);var r=p0e(e);function e(n,i){var a;(0,w4.default)(this,e),a=r.call(this,n,i),(0,I4.default)((0,E4.default)(a),"model",void 0);var o=i.module,s=i.fs,u=i.id;return a.model=new mm(n,{id:u,fs:s,modules:[o]}),a}return(0,O4.default)(e,[{key:"render",value:function(i){var a=this,o=this.gl;Gt(o,{viewport:[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}),Ie(o,{framebuffer:i.outputBuffer,clearColor:[0,0,0,0]},function(){return a._renderPass(o,i)})}},{key:"delete",value:function(){this.model.delete(),this.model=null}},{key:"_renderPass",value:function(i,a){var o=a.inputBuffer;yn(i,{color:!0}),this.model.draw({moduleSettings:a.moduleSettings,uniforms:{texture:o,texSize:[o.width,o.height]},parameters:{depthWrite:!1,depthTest:!1}})}}]),e}(ym);function d0e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=v0e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function v0e(t,r){if(t){if(typeof t=="string")return R4(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return R4(t,r)}}function R4(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var F4=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,k4.default)(this,t),(0,sp.default)(this,"id",void 0),(0,sp.default)(this,"props",void 0),(0,sp.default)(this,"module",void 0),(0,sp.default)(this,"passes",void 0),this.id="".concat(r.name,"-pass"),this.props=e,Ov(r),this.module=r}return(0,B4.default)(t,[{key:"setProps",value:function(e){this.props=e}},{key:"preRender",value:function(){}},{key:"postRender",value:function(e,n){var i=this.passes||m0e(e,this.module,this.id);this.passes=i;for(var a=n.target,o=n.inputBuffer,s=n.swapBuffer,u=0;u<this.passes.length;u++){a&&u===this.passes.length-1&&(s=a),this.passes[u].render({inputBuffer:o,outputBuffer:s,moduleSettings:this.props});var l=s;s=o,o=l}return o}},{key:"cleanup",value:function(){if(this.passes){var e=d0e(this.passes),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.passes=void 0}}}]),t}();function m0e(t,r,e){if(!r.passes){var n=L4(r),i=new xT(t,{id:e,module:r,fs:n});return[i]}return r.passes.map(function(a,o){var s=L4(r,a),u="".concat(e,"-").concat(o);return new xT(t,{id:u,module:r,fs:s})})}var g0e=function(r){return`uniform sampler2D texture;
uniform vec2 texSize;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main() {
  vec2 texCoord = coordinate;

  gl_FragColor = texture2D(texture, texCoord);
  gl_FragColor = `.concat(r,`(gl_FragColor, texSize, texCoord);
}
`)},y0e=function(r){return`uniform sampler2D texture;
uniform vec2 texSize;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main() {
  vec2 texCoord = coordinate;

  gl_FragColor = `.concat(r,`(texture, texSize, texCoord);
}
`)};function L4(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;if(r.filter){var e=typeof r.filter=="string"?r.filter:"".concat(t.name,"_filterColor");return g0e(e)}if(r.sampler){var n=typeof r.sampler=="string"?r.sampler:"".concat(t.name,"_sampleColor");return y0e(n)}return null}var j4=h(L()),U4=h(N()),TT=h(_e()),ST=h(Oe()),G4=h(Y()),z4=h(K()),up=h(q()),Dm=h(B());function D4(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function AT(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?D4(Object(e),!0).forEach(function(n){(0,Dm.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):D4(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function _0e(t){var r=b0e();return function(){var n=(0,up.default)(t),i;if(r){var a=(0,up.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,z4.default)(this,i)}}function b0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var N4={blendFunc:[1,0,32771,0],blendEquation:32774},oo=function(t){(0,G4.default)(e,t);var r=_0e(e);function e(){var n;(0,j4.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Dm.default)((0,TT.default)(n),"pickZ",void 0),(0,Dm.default)((0,TT.default)(n),"_colorEncoderState",null),n}return(0,U4.default)(e,[{key:"render",value:function(i){return"pickingFBO"in i?this._drawPickingBuffer(i):(0,ST.default)((0,up.default)(e.prototype),"render",this).call(this,i)}},{key:"_drawPickingBuffer",value:function(i){var a=this,o=i.layers,s=i.layerFilter,u=i.views,l=i.viewports,f=i.onViewportActive,c=i.pickingFBO,p=i.deviceRect,d=p.x,v=p.y,m=p.width,g=p.height,y=i.cullRect,_=i.effects,b=i.pass,x=b===void 0?"picking":b,A=i.pickZ,T=i.moduleParameters,O=this.gl;this.pickZ=A;var w=this._resetColorEncoder(A),E=Ie(O,AT(AT({scissorTest:!0,scissor:[d,v,m,g],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]},N4),{},{blend:!A}),function(){return(0,ST.default)((0,up.default)(e.prototype),"render",a).call(a,{target:c,layers:o,layerFilter:s,views:u,viewports:l,onViewportActive:f,cullRect:y,effects:_?.filter(function(I){return I.useInPicking}),pass:x,isPicking:!0,moduleParameters:T})});this._colorEncoderState=null;var S=w&&A0e.bind(null,w);return{decodePickingColor:S,stats:E}}},{key:"shouldDrawLayer",value:function(i){var a=i.props,o=a.pickable,s=a.operation;return o&&s.includes("draw")||s.includes("terrain")}},{key:"getModuleParameters",value:function(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}},{key:"getLayerParameters",value:function(i,a,o){var s=AT({},i.props.parameters),u=i.props,l=u.pickable,f=u.operation;return this._colorEncoderState?l&&f.includes("draw")&&(Object.assign(s,N4),s.blend=!0,s.blendColor=x0e(this._colorEncoderState,i,o)):s.blend=!1,f.includes("terrain")&&(s.blend=!1),s}},{key:"_resetColorEncoder",value:function(i){return this._colorEncoderState=i?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}]),e}(Vr);function x0e(t,r,e){var n=t.byLayer,i=t.byAlpha,a,o=n.get(r);return o?(o.viewports.push(e),a=o.a):(a=n.size+1,a<=255?(o={a,layer:r,viewports:[e]},n.set(r,o),i[a]=o):(Z.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function A0e(t,r){var e=t.byAlpha[r[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(r)}}var R6=h(L()),L6=h(N()),ft=h(B());var nU=h(L()),iU=h(N()),wi=h(B());var so={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},ll=Symbol.for("component"),Sn=Symbol.for("propTypes"),Nm=Symbol.for("deprecatedProps"),ua=Symbol.for("asyncPropDefaults"),Pi=Symbol.for("asyncPropOriginal"),Qn=Symbol.for("asyncPropResolved");function Br(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};return Array.isArray(t)?V4(t,r,[]):r(t)?[t]:[]}function V4(t,r,e){for(var n=-1;++n<t.length;){var i=t[n];Array.isArray(i)?V4(i,r,e):r(i)&&e.push(i)}return e}function jm(t){for(var r=t.target,e=t.source,n=t.start,i=n===void 0?0:n,a=t.count,o=a===void 0?1:a,s=e.length,u=o*s,l=0,f=i;l<s;l++)r[f++]=e[l];for(;l<u;)l<u-l?(r.copyWithin(i+l,i,i+l),l*=2):(r.copyWithin(i+l,i,i+u-l),l=u);return r}var q4=h(L()),Y4=h(N()),fl=h(B());var W4=h(L()),$4=h(N()),ei=h(B());function T0e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=S0e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function S0e(t,r){if(t){if(typeof t=="string")return H4(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return H4(t,r)}}function H4(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var X4=function(){function t(r,e,n){(0,W4.default)(this,t),(0,ei.default)(this,"id",void 0),(0,ei.default)(this,"context",void 0),(0,ei.default)(this,"isLoaded",void 0),(0,ei.default)(this,"persistent",void 0),(0,ei.default)(this,"_loadCount",0),(0,ei.default)(this,"_subscribers",new Set),(0,ei.default)(this,"_data",void 0),(0,ei.default)(this,"_loader",void 0),(0,ei.default)(this,"_error",void 0),(0,ei.default)(this,"_content",void 0),this.id=r,this.context=n,this.setData(e)}return(0,$4.default)(t,[{key:"subscribe",value:function(e){this._subscribers.add(e)}},{key:"unsubscribe",value:function(e){this._subscribers.delete(e)}},{key:"inUse",value:function(){return this._subscribers.size>0}},{key:"delete",value:function(){}},{key:"getData",value:function(){var e=this;return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(function(){return e.getData()})}},{key:"setData",value:function(e,n){var i=this;if(!(e===this._data&&!n)){this._data=e;var a=++this._loadCount,o=e;typeof e=="string"&&(o=qt(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(function(f){i._loadCount===a&&(i.isLoaded=!0,i._error=void 0,i._content=f)}).catch(function(f){i._loadCount===a&&(i.isLoaded=!0,i._error=f||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);var s=T0e(this._subscribers),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;l.onChange(this.getData())}}catch(f){s.e(f)}finally{s.f()}}}}]),t}();var K4=function(){function t(r){var e=r.gl,n=r.protocol;(0,q4.default)(this,t),(0,fl.default)(this,"protocol",void 0),(0,fl.default)(this,"_context",void 0),(0,fl.default)(this,"_resources",void 0),(0,fl.default)(this,"_consumers",void 0),(0,fl.default)(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}return(0,Y4.default)(t,[{key:"contains",value:function(e){return e.startsWith(this.protocol)?!0:e in this._resources}},{key:"add",value:function(e){var n=e.resourceId,i=e.data,a=e.forceUpdate,o=a===void 0?!1:a,s=e.persistent,u=s===void 0?!0:s,l=this._resources[n];l?l.setData(i,o):(l=new X4(n,i,this._context),this._resources[n]=l),l.persistent=u}},{key:"remove",value:function(e){var n=this._resources[e];n&&(n.delete(),delete this._resources[e])}},{key:"unsubscribe",value:function(e){var n=e.consumerId,i=this._consumers[n];if(i){for(var a in i){var o=i[a],s=this._resources[o.resourceId];s&&s.unsubscribe(o)}delete this._consumers[n],this.prune()}}},{key:"subscribe",value:function(e){var n=e.resourceId,i=e.onChange,a=e.consumerId,o=e.requestId,s=o===void 0?"default":o,u=this._resources,l=this.protocol;n.startsWith(l)&&(n=n.replace(l,""),u[n]||this.add({resourceId:n,data:null,persistent:!1}));var f=u[n];if(this._track(a,s,f,i),f)return f.getData()}},{key:"prune",value:function(){var e=this;this._pruneRequest||(this._pruneRequest=setTimeout(function(){return e._prune()},0))}},{key:"finalize",value:function(){for(var e in this._resources)this._resources[e].delete()}},{key:"_track",value:function(e,n,i,a){var o=this._consumers,s=o[e]=o[e]||{},u=s[n]||{},l=u.resourceId&&this._resources[u.resourceId];l&&(l.unsubscribe(u),this.prune()),i&&(s[n]=u,u.onChange=a,u.resourceId=i.id,i.subscribe(u))}},{key:"_prune",value:function(){this._pruneRequest=null;for(var e=0,n=Object.keys(this._resources);e<n.length;e++){var i=n[e],a=this._resources[i];!a.persistent&&!a.inUse()&&(a.delete(),delete this._resources[i])}}}]),t}();var P0e=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Ze={name:"project32",dependencies:[Yt],vs:P0e};var Z4=h(B());function J4(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function w0e(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?J4(Object(e),!0).forEach(function(n){(0,Z4.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):J4(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var it=w0e({inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},im);function Q4(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=O0e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function O0e(t,r){if(t){if(typeof t=="string")return eU(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return eU(t,r)}}function eU(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var E0e=[Yt],C0e=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function tU(t){var r=_n.getDefaultProgramManager(t),e=Q4(E0e),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;r.addDefaultModule(i)}}catch(u){e.e(u)}finally{e.f()}var a=Q4(C0e),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;r.addShaderHook(s)}}catch(u){a.e(u)}finally{a.f()}return r}function lp(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=M0e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function M0e(t,r){if(t){if(typeof t=="string")return rU(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return rU(t,r)}}function rU(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var I0e="layerManager.setLayers",R0e="layerManager.activateViewport",Um=function(){function t(r){var e=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.deck,a=n.stats,o=n.viewport,s=n.timeline;(0,nU.default)(this,t),(0,wi.default)(this,"layers",void 0),(0,wi.default)(this,"context",void 0),(0,wi.default)(this,"resourceManager",void 0),(0,wi.default)(this,"_lastRenderedLayers",[]),(0,wi.default)(this,"_needsRedraw",!1),(0,wi.default)(this,"_needsUpdate",!1),(0,wi.default)(this,"_nextLayers",null),(0,wi.default)(this,"_debug",!1),(0,wi.default)(this,"activateViewport",function(u){Ft(R0e,e,u),u&&(e.context.viewport=u)}),this.layers=[],this.resourceManager=new K4({gl:r,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:r,deck:i,programManager:r&&tU(r),stats:a||new Un({id:"deck.gl"}),viewport:o||new yr({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new no,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}return(0,iU.default)(t,[{key:"finalize",value:function(){this.resourceManager.finalize();var e=lp(this.layers),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;this._finalizeLayer(i)}}catch(a){e.e(a)}finally{e.f()}}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);var i=lp(this.layers),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.getNeedsRedraw(e);n=n||s}}catch(u){i.e(u)}finally{i.f()}return n}},{key:"needsUpdate",value:function(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}},{key:"setNeedsRedraw",value:function(e){this._needsRedraw=this._needsRedraw||e}},{key:"setNeedsUpdate",value:function(e){this._needsUpdate=this._needsUpdate||e}},{key:"getLayers",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.layerIds;return n?this.layers.filter(function(i){return n.find(function(a){return i.id.indexOf(a)===0})}):this.layers}},{key:"setProps",value:function(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}},{key:"setLayers",value:function(e,n){Ft(I0e,this,n,e),this._lastRenderedLayers=e;var i=Br(e,Boolean),a=lp(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.context=this.context}}catch(u){a.e(u)}finally{a.f()}this._updateLayers(this.layers,i)}},{key:"updateLayers",value:function(){var e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}},{key:"_handleError",value:function(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}},{key:"_updateLayers",value:function(e,n){var i={},a=lp(e),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;i[s.id]?Z.warn("Multiple old layers with same id ".concat(s.id))():i[s.id]=s}}catch(d){a.e(d)}finally{a.f()}var u=[];this._updateSublayersRecursively(n,i,u),this._finalizeOldLayers(i);for(var l=!1,f=0,c=u;f<c.length;f++){var p=c[f];if(p.hasUniformTransition()){l="Uniform transition in ".concat(p);break}}this._needsUpdate=l,this.layers=u}},{key:"_updateSublayersRecursively",value:function(e,n,i){var a=lp(e),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.context=this.context;var u=n[s.id];u===null&&Z.warn("Multiple new layers with same id ".concat(s.id))(),n[s.id]=null;var l=null;try{this._debug&&u!==s&&s.validateProps(),u?(this._transferLayerState(u,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),l=s.isComposite?s.getSubLayers():null}catch(f){this._handleError("matching",f,s)}l&&this._updateSublayersRecursively(l,n,i)}}catch(f){a.e(f)}finally{a.f()}}},{key:"_finalizeOldLayers",value:function(e){for(var n in e){var i=e[n];i&&this._finalizeLayer(i)}}},{key:"_initializeLayer",value:function(e){try{e._initialize(),e.lifecycle=so.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}},{key:"_transferLayerState",value:function(e,n){n._transferState(e),n.lifecycle=so.MATCHED,n!==e&&(e.lifecycle=so.AWAITING_GC)}},{key:"_updateLayer",value:function(e){try{e._update()}catch(n){this._handleError("update",n,e)}}},{key:"_finalizeLayer",value:function(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=so.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=so.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}]),t}();var oU=h(L()),sU=h(N()),Fr=h(B());var PT=h(Je());function It(t,r,e){if(t===r)return!0;if(!e||!t||!r)return!1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var n=0;n<t.length;n++)if(!It(t[n],r[n],e-1))return!1;return!0}if(Array.isArray(r))return!1;if((0,PT.default)(t)==="object"&&(0,PT.default)(r)==="object"){var i=Object.keys(t),a=Object.keys(r);if(i.length!==a.length)return!1;for(var o=0,s=i;o<s.length;o++){var u=s[o];if(!r.hasOwnProperty(u)||!It(t[u],r[u],e-1))return!1}return!0}return!1}function aU(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function fp(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?aU(Object(e),!0).forEach(function(n){(0,Fr.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):aU(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var uU=function(){function t(r){(0,oU.default)(this,t),(0,Fr.default)(this,"width",void 0),(0,Fr.default)(this,"height",void 0),(0,Fr.default)(this,"views",void 0),(0,Fr.default)(this,"viewState",void 0),(0,Fr.default)(this,"controllers",void 0),(0,Fr.default)(this,"timeline",void 0),(0,Fr.default)(this,"_viewports",void 0),(0,Fr.default)(this,"_viewportMap",void 0),(0,Fr.default)(this,"_isUpdating",void 0),(0,Fr.default)(this,"_needsRedraw",void 0),(0,Fr.default)(this,"_needsUpdate",void 0),(0,Fr.default)(this,"_eventManager",void 0),(0,Fr.default)(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=r.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=r.eventManager,this._eventCallbacks={onViewStateChange:r.onViewStateChange,onInteractionStateChange:r.onInteractionStateChange},Object.seal(this),this.setProps(r)}return(0,sU.default)(t,[{key:"finalize",value:function(){for(var e in this.controllers){var n=this.controllers[e];n&&n.finalize()}this.controllers={}}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}},{key:"setNeedsUpdate",value:function(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}},{key:"updateViewStates",value:function(){for(var e in this.controllers){var n=this.controllers[e];n&&n.updateTransition()}}},{key:"getViewports",value:function(e){return e?this._viewports.filter(function(n){return n.containsPixel(e)}):this._viewports}},{key:"getViews",value:function(){var e={};return this.views.forEach(function(n){e[n.id]=n}),e}},{key:"getView",value:function(e){return this.views.find(function(n){return n.id===e})}},{key:"getViewState",value:function(e){var n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}},{key:"getViewport",value:function(e){return this._viewportMap[e]}},{key:"unproject",value:function(e,n){for(var i=this.getViewports(),a={x:e[0],y:e[1]},o=i.length-1;o>=0;--o){var s=i[o];if(s.containsPixel(a)){var u=e.slice();return u[0]-=s.x,u[1]-=s.y,s.unproject(u,n)}}return null}},{key:"setProps",value:function(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}},{key:"_update",value:function(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}},{key:"_setSize",value:function(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}},{key:"_setViews",value:function(e){e=Br(e,Boolean);var n=this._diffViews(e,this.views);n&&this.setNeedsUpdate("views changed"),this.views=e}},{key:"_setViewState",value:function(e){if(e){var n=!It(e,this.viewState,3);n&&this.setNeedsUpdate("viewState changed"),this.viewState=e}else Z.warn("missing `viewState` or `initialViewState`")()}},{key:"_onViewStateChange",value:function(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange(fp(fp({},n),{},{viewId:e}))}},{key:"_createController",value:function(e,n){var i=this,a=n.type,o=new a({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:function(u){var l;return(l=i.getView(e.id))===null||l===void 0?void 0:l.makeViewport({viewState:u,width:i.width,height:i.height})}});return o}},{key:"_updateController",value:function(e,n,i,a){var o=e.controller;if(o){var s=fp(fp(fp({},n),o),{},{id:e.id,x:i.x,y:i.y,width:i.width,height:i.height});return a||(a=this._createController(e,s)),a&&a.setProps(s),a}return null}},{key:"_rebuildViewports",value:function(){var e=this.views,n=this.controllers;this._viewports=[],this.controllers={};for(var i=!1,a=e.length;a--;){var o=e[a],s=this.getViewState(o),u=o.makeViewport({viewState:s,width:this.width,height:this.height}),l=n[o.id],f=Boolean(o.controller);f&&!l&&(i=!0),(i||!f)&&l&&(l.finalize(),l=null),this.controllers[o.id]=this._updateController(o,s,u,l),this._viewports.unshift(u)}for(var c in n){var p=n[c];p&&!this.controllers[c]&&p.finalize()}this._buildViewportMap()}},{key:"_buildViewportMap",value:function(){var e=this;this._viewportMap={},this._viewports.forEach(function(n){n.id&&(e._viewportMap[n.id]=e._viewportMap[n.id]||n)})}},{key:"_diffViews",value:function(e,n){return e.length!==n.length?!0:e.some(function(i,a){return!e[a].equals(n[a])})}}]),t}();var HU=h(L()),WU=h(N()),$U=h(Y()),XU=h(K()),RT=h(q()),qU=h(B());var cU=h(Je()),pU=h(L()),hU=h(N()),Oi=h(B());var lU=h(Je()),L0e=/([0-9]+\.?[0-9]*)(%|px)/;function la(t){switch((0,lU.default)(t)){case"number":return{position:t,relative:!1};case"string":var r=L0e.exec(t);if(r&&r.length>=3){var e=r[2]==="%",n=parseFloat(r[1]);return{position:e?n/100:n,relative:e}}default:throw new Error("Could not parse position string ".concat(t))}}function fa(t,r){return t.relative?Math.round(t.position*r):t.position}function rt(t,r){if(!t)throw new Error(r||"deck.gl: assertion failed.")}function fU(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function bs(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?fU(Object(e),!0).forEach(function(n){(0,Oi.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):fU(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Pn=function(){function t(r){(0,pU.default)(this,t),(0,Oi.default)(this,"id",void 0),(0,Oi.default)(this,"viewportInstance",void 0),(0,Oi.default)(this,"_x",void 0),(0,Oi.default)(this,"_y",void 0),(0,Oi.default)(this,"_width",void 0),(0,Oi.default)(this,"_height",void 0),(0,Oi.default)(this,"_padding",void 0),(0,Oi.default)(this,"props",void 0);var e=r||{},n=e.id,i=e.x,a=i===void 0?0:i,o=e.y,s=o===void 0?0:o,u=e.width,l=u===void 0?"100%":u,f=e.height,c=f===void 0?"100%":f,p=e.padding,d=p===void 0?null:p,v=e.viewportInstance;rt(!v||v instanceof yr),this.viewportInstance=v,this.id=n||this.constructor.displayName||"view",this.props=bs(bs({},r),{},{id:this.id}),this._x=la(a),this._y=la(s),this._width=la(l),this._height=la(c),this._padding=d&&{left:la(d.left||0),right:la(d.right||0),top:la(d.top||0),bottom:la(d.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}return(0,hU.default)(t,[{key:"equals",value:function(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&It(this.props,e.props,2)}},{key:"makeViewport",value:function(e){var n=e.width,i=e.height,a=e.viewState;if(this.viewportInstance)return this.viewportInstance;a=this.filterViewState(a);var o=this.getDimensions({width:n,height:i});return new this.ViewportType(bs(bs(bs({},a),this.props),o))}},{key:"getViewStateId",value:function(){var e=this.props.viewState;return typeof e=="string"?e:e?.id||this.id}},{key:"filterViewState",value:function(e){if(this.props.viewState&&(0,cU.default)(this.props.viewState)==="object"){if(!this.props.viewState.id)return this.props.viewState;var n=bs({},e);for(var i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}},{key:"getDimensions",value:function(e){var n=e.width,i=e.height,a={x:fa(this._x,n),y:fa(this._y,i),width:fa(this._width,n),height:fa(this._height,i)};return this._padding&&(a.padding={left:fa(this._padding.left,n),top:fa(this._padding.top,i),right:fa(this._padding.right,n),bottom:fa(this._padding.bottom,i)}),a}},{key:"controller",get:function(){var e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:bs({type:this.ControllerType},e):null}}]),t}();var GU=h(Oe()),ET=h(L()),CT=h(N()),pp=h(_e()),MT=h(Y()),zU=h(K()),Wm=h(q()),vl=h(B());var BU=h(L()),FU=h(N()),Tt=h(B());var yU=h(L()),_U=h(N()),ca=h(B());var dU=h(L()),vU=h(N()),cl=h(B()),Ei=function(){function t(r){(0,dU.default)(this,t),(0,cl.default)(this,"_inProgress",void 0),(0,cl.default)(this,"_handle",void 0),(0,cl.default)(this,"_timeline",void 0),(0,cl.default)(this,"time",void 0),(0,cl.default)(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=r,this.time=0,this.settings={duration:0}}return(0,vU.default)(t,[{key:"inProgress",get:function(){return this._inProgress}},{key:"start",value:function(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}},{key:"end",value:function(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}},{key:"cancel",value:function(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}},{key:"update",value:function(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){var i=this._timeline,a=this.settings;this._handle=i.addChannel({delay:i.getTime(),duration:a.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}},{key:"_onUpdate",value:function(){}}]),t}();function mU(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Gm(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?mU(Object(e),!0).forEach(function(n){(0,ca.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):mU(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var gU=function(){},cp={BREAK:1,SNAP_TO_END:2,IGNORE:3},k0e=function(r){return r},B0e=cp.BREAK,bU=function(){function t(r){var e=this;(0,yU.default)(this,t),(0,ca.default)(this,"getControllerState",void 0),(0,ca.default)(this,"props",void 0),(0,ca.default)(this,"propsInTransition",void 0),(0,ca.default)(this,"transition",void 0),(0,ca.default)(this,"onViewStateChange",void 0),(0,ca.default)(this,"onStateChange",void 0),(0,ca.default)(this,"_onTransitionUpdate",function(n){var i=n.time,a=n.settings,o=a.interpolator,s=a.startProps,u=a.endProps,l=a.duration,f=a.easing,c=f(i/l),p=o.interpolateProps(s,u,c);e.propsInTransition=e.getControllerState(Gm(Gm({},e.props),p)).getViewportProps(),e.onViewStateChange({viewState:e.propsInTransition,oldViewState:e.props})}),this.getControllerState=r.getControllerState,this.propsInTransition=null,this.transition=new Ei(r.timeline),this.onViewStateChange=r.onViewStateChange||gU,this.onStateChange=r.onStateChange||gU}return(0,_U.default)(t,[{key:"finalize",value:function(){this.transition.cancel()}},{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(e){var n=!1,i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){var a=i;if(this.transition.inProgress){var o=this.transition.settings,s=o.interruption,u=o.endProps;a=Gm(Gm({},i),s===cp.SNAP_TO_END?u:this.propsInTransition||i)}this._triggerTransition(a,e),n=!0}else this.transition.cancel();return n}},{key:"updateTransition",value:function(){this.transition.update()}},{key:"_isTransitionEnabled",value:function(e){var n=e.transitionDuration,i=e.transitionInterpolator;return(n>0||n==="auto")&&Boolean(i)}},{key:"_isUpdateDueToCurrentTransition",value:function(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(e,n){return this.transition.inProgress?this.transition.settings.interruption===cp.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}},{key:"_triggerTransition",value:function(e,n){var i=this.getControllerState(e),a=this.getControllerState(n).shortestPathFrom(i),o=n.transitionInterpolator,s=o.getDuration?o.getDuration(e,n):n.transitionDuration;if(s!==0){var u=o.initializeProps(e,a);this.propsInTransition={};var l={duration:s,easing:n.transitionEasing||k0e,interpolator:o,interruption:n.transitionInterruption||B0e,startProps:u.start,endProps:u.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}}},{key:"_onTransitionEnd",value:function(e){var n=this;return function(i){n.propsInTransition=null,n.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(i)}}}]),t}();var EU=h(L()),CU=h(N()),MU=h(_e()),IU=h(Oe()),RU=h(Y()),LU=h(K()),Vm=h(q()),wT=h(B());var TU=h(L()),SU=h(N()),zm=h(B());function xU(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=F0e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function F0e(t,r){if(t){if(typeof t=="string")return AU(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return AU(t,r)}}function AU(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var pl=function(){function t(r){(0,TU.default)(this,t),(0,zm.default)(this,"_propsToCompare",void 0),(0,zm.default)(this,"_propsToExtract",void 0),(0,zm.default)(this,"_requiredProps",void 0);var e=r.compare,n=r.extract,i=r.required;this._propsToCompare=e,this._propsToExtract=n||e,this._requiredProps=i}return(0,SU.default)(t,[{key:"arePropsEqual",value:function(e,n){var i=xU(this._propsToCompare),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!(o in e)||!(o in n)||!tt(e[o],n[o]))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}},{key:"initializeProps",value:function(e,n){var i={},a={},o=xU(this._propsToExtract),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;(u in e||u in n)&&(i[u]=e[u],a[u]=n[u])}}catch(l){o.e(l)}finally{o.f()}return this._checkRequiredProps(i),this._checkRequiredProps(a),{start:i,end:a}}},{key:"getDuration",value:function(e,n){return n.transitionDuration}},{key:"_checkRequiredProps",value:function(e){this._requiredProps&&this._requiredProps.forEach(function(n){var i=e[n];rt(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}]),t}();function PU(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function wU(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?PU(Object(e),!0).forEach(function(n){(0,wT.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):PU(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function D0e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=N0e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function N0e(t,r){if(t){if(typeof t=="string")return OU(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return OU(t,r)}}function OU(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function j0e(t){var r=U0e();return function(){var n=(0,Vm.default)(t),i;if(r){var a=(0,Vm.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,LU.default)(this,i)}}function U0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var G0e=["longitude","latitude","zoom","bearing","pitch"],z0e=["longitude","latitude","zoom"],Xr=function(t){(0,RU.default)(e,t);var r=j0e(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,EU.default)(this,e);var a=Array.isArray(i)?i:i.transitionProps,o=Array.isArray(i)?{}:i;return o.transitionProps=Array.isArray(a)?{compare:a,required:a}:a||{compare:G0e,required:z0e},n=r.call(this,o.transitionProps),(0,wT.default)((0,MU.default)(n),"opts",void 0),n.opts=o,n}return(0,CU.default)(e,[{key:"initializeProps",value:function(i,a){var o=(0,IU.default)((0,Vm.default)(e.prototype),"initializeProps",this).call(this,i,a),s=this.opts,u=s.makeViewport,l=s.around;if(u&&l){var f=u(i),c=u(a),p=f.unproject(l);o.start.around=l,Object.assign(o.end,{around:c.project(p),aroundPosition:p,width:a.width,height:a.height})}return o}},{key:"interpolateProps",value:function(i,a,o){var s={},u=D0e(this._propsToExtract),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;s[f]=nr(i[f]||0,a[f]||0,o)}}catch(p){u.e(p)}finally{u.f()}if(a.aroundPosition&&this.opts.makeViewport){var c=this.opts.makeViewport(wU(wU({},a),s));Object.assign(s,c.panByPosition(a.aroundPosition,nr(i.around,a.around,o)))}return s}}]),e}(pl);function kU(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Rt(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?kU(Object(e),!0).forEach(function(n){(0,Tt.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):kU(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var uo={transitionDuration:0},V0e=300,Hm=function(r){return 1-(1-r)*(1-r)},hl={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},xs={},wn=function(){function t(r){var e=this;(0,BU.default)(this,t),(0,Tt.default)(this,"props",void 0),(0,Tt.default)(this,"state",{}),(0,Tt.default)(this,"transitionManager",void 0),(0,Tt.default)(this,"eventManager",void 0),(0,Tt.default)(this,"onViewStateChange",void 0),(0,Tt.default)(this,"onStateChange",void 0),(0,Tt.default)(this,"makeViewport",void 0),(0,Tt.default)(this,"_controllerState",void 0),(0,Tt.default)(this,"_events",{}),(0,Tt.default)(this,"_interactionState",{isDragging:!1}),(0,Tt.default)(this,"_customEvents",[]),(0,Tt.default)(this,"_eventStartBlocked",null),(0,Tt.default)(this,"_panMove",!1),(0,Tt.default)(this,"invertPan",!1),(0,Tt.default)(this,"dragMode","rotate"),(0,Tt.default)(this,"inertia",0),(0,Tt.default)(this,"scrollZoom",!0),(0,Tt.default)(this,"dragPan",!0),(0,Tt.default)(this,"dragRotate",!0),(0,Tt.default)(this,"doubleClickZoom",!0),(0,Tt.default)(this,"touchZoom",!0),(0,Tt.default)(this,"touchRotate",!1),(0,Tt.default)(this,"keyboard",!0),this.transitionManager=new bU(Rt(Rt({},r),{},{getControllerState:function(i){return new e.ControllerState(i)},onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)})),this.handleEvent=this.handleEvent.bind(this),this.eventManager=r.eventManager,this.onViewStateChange=r.onViewStateChange||function(){},this.onStateChange=r.onStateChange||function(){},this.makeViewport=r.makeViewport}return(0,FU.default)(t,[{key:"events",set:function(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}},{key:"finalize",value:function(){for(var e in this._events)if(this._events[e]){var n;(n=this.eventManager)===null||n===void 0||n.off(e,this.handleEvent)}this.transitionManager.finalize()}},{key:"handleEvent",value:function(e){this._controllerState=void 0;var n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}},{key:"controllerState",get:function(){return this._controllerState=this._controllerState||new this.ControllerState(Rt(Rt({makeViewport:this.makeViewport},this.props),this.state)),this._controllerState}},{key:"getCenter",value:function(e){var n=this.props,i=n.x,a=n.y,o=e.offsetCenter;return[o.x-i,o.y-a]}},{key:"isPointInBounds",value:function(e,n){var i=this.props,a=i.width,o=i.height;if(n&&n.handled)return!1;var s=e[0]>=0&&e[0]<=a&&e[1]>=0&&e[1]<=o;return s&&n&&n.stopPropagation(),s}},{key:"isFunctionKeyPressed",value:function(e){var n=e.srcEvent;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}},{key:"isDragging",value:function(){return this._interactionState.isDragging||!1}},{key:"blockEvents",value:function(e){var n=this,i=setTimeout(function(){n._eventStartBlocked===i&&(n._eventStartBlocked=null)},e);this._eventStartBlocked=i}},{key:"setProps",value:function(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);var n=e.inertia;this.inertia=Number.isFinite(n)?n:n===!0?V0e:0;var i=e.scrollZoom,a=i===void 0?!0:i,o=e.dragPan,s=o===void 0?!0:o,u=e.dragRotate,l=u===void 0?!0:u,f=e.doubleClickZoom,c=f===void 0?!0:f,p=e.touchZoom,d=p===void 0?!0:p,v=e.touchRotate,m=v===void 0?!1:v,g=e.keyboard,y=g===void 0?!0:g,_=Boolean(this.onViewStateChange);this.toggleEvents(hl.WHEEL,_&&a),this.toggleEvents(hl.PAN,_&&(s||l)),this.toggleEvents(hl.PINCH,_&&(d||m)),this.toggleEvents(hl.TRIPLE_PAN,_&&m),this.toggleEvents(hl.DOUBLE_TAP,_&&c),this.toggleEvents(hl.KEYBOARD,_&&y),this.scrollZoom=a,this.dragPan=s,this.dragRotate=l,this.doubleClickZoom=c,this.touchZoom=d,this.touchRotate=m,this.keyboard=y}},{key:"updateTransition",value:function(){this.transitionManager.updateTransition()}},{key:"toggleEvents",value:function(e,n){var i=this;this.eventManager&&e.forEach(function(a){i._events[a]!==n&&(i._events[a]=n,n?i.eventManager.on(a,i.handleEvent):i.eventManager.off(a,i.handleEvent))})}},{key:"updateViewport",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=Rt(Rt({},e.getViewportProps()),n),o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),o){var s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:a,interactionState:this._interactionState,oldViewState:s})}}},{key:"_onTransition",value:function(e){this.onViewStateChange(Rt(Rt({},e),{},{interactionState:this._interactionState}))}},{key:"_setInteractionState",value:function(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}},{key:"_onPanStart",value:function(e){var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);var a=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(a,uo,{isDragging:!0}),!0}},{key:"_onPan",value:function(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}},{key:"_onPanEnd",value:function(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}},{key:"_onPanMove",value:function(e){if(!this.dragPan)return!1;var n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,uo,{isDragging:!0,isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(e){var n=this.inertia;if(this.dragPan&&n&&e.velocity){var i=this.getCenter(e),a=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],o=this.controllerState.pan({pos:a}).panEnd();this.updateViewport(o,Rt(Rt({},this._getTransitionProps()),{},{transitionDuration:n,transitionEasing:Hm}),{isDragging:!1,isPanning:!0})}else{var s=this.controllerState.panEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1})}return!0}},{key:"_onPanRotate",value:function(e){if(!this.dragRotate)return!1;var n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,uo,{isDragging:!0,isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(e){var n=this.inertia;if(this.dragRotate&&n&&e.velocity){var i=this.getCenter(e),a=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],o=this.controllerState.rotate({pos:a}).rotateEnd();this.updateViewport(o,Rt(Rt({},this._getTransitionProps()),{},{transitionDuration:n,transitionEasing:Hm}),{isDragging:!1,isRotating:!0})}else{var s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}},{key:"_onWheel",value:function(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.scrollZoom===!0?{}:this.scrollZoom,a=i.speed,o=a===void 0?.01:a,s=i.smooth,u=s===void 0?!1:s,l=e.delta,f=2/(1+Math.exp(-Math.abs(l*o)));l<0&&f!==0&&(f=1/f);var c=this.controllerState.zoom({pos:n,scale:f});return this.updateViewport(c,Rt(Rt({},this._getTransitionProps({around:n})),{},{transitionDuration:u?250:1}),{isZooming:!0,isPanning:!0}),!0}},{key:"_onTriplePanStart",value:function(e){var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,uo,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(e){if(!this.touchRotate||!this.isDragging())return!1;var n=this.getCenter(e);n[0]-=e.deltaX;var i=this.controllerState.rotate({pos:n});return this.updateViewport(i,uo,{isDragging:!0,isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(e){if(!this.isDragging())return!1;var n=this.inertia;if(this.touchRotate&&n&&e.velocityY){var i=this.getCenter(e),a=[i[0],i[1]+=e.velocityY*n/2],o=this.controllerState.rotate({pos:a});this.updateViewport(o,Rt(Rt({},this._getTransitionProps()),{},{transitionDuration:n,transitionEasing:Hm}),{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{var s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}},{key:"_onPinchStart",value:function(e){var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return xs._startPinchRotation=e.rotation,xs._lastPinchEvent=e,this.updateViewport(i,uo,{isDragging:!0}),!0}},{key:"_onPinch",value:function(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;var n=this.controllerState;if(this.touchZoom){var i=e.scale,a=this.getCenter(e);n=n.zoom({pos:a,scale:i})}if(this.touchRotate){var o=e.rotation;n=n.rotate({deltaAngleX:xs._startPinchRotation-o})}return this.updateViewport(n,uo,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),xs._lastPinchEvent=e,!0}},{key:"_onPinchEnd",value:function(e){if(!this.isDragging())return!1;var n=this.inertia,i=xs._lastPinchEvent;if(this.touchZoom&&n&&i&&e.scale!==i.scale){var a=this.getCenter(e),o=this.controllerState.rotateEnd(),s=Math.log2(e.scale),u=(s-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,s+u*n/2);o=o.zoom({pos:a,scale:l}).zoomEnd(),this.updateViewport(o,Rt(Rt({},this._getTransitionProps({around:a})),{},{transitionDuration:n,transitionEasing:Hm}),{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{var f=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(f,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return xs._startPinchRotation=null,xs._lastPinchEvent=null,!0}},{key:"_onDoubleTap",value:function(e){if(!this.doubleClickZoom)return!1;var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.isFunctionKeyPressed(e),a=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(a,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}},{key:"_onKeyDown",value:function(e){if(!this.keyboard)return!1;var n=this.isFunctionKeyPressed(e),i=this.keyboard===!0?{}:this.keyboard,a=i.zoomSpeed,o=i.moveSpeed,s=i.rotateSpeedX,u=i.rotateSpeedY,l=this.controllerState,f,c={};switch(e.srcEvent.code){case"Minus":f=n?l.zoomOut(a).zoomOut(a):l.zoomOut(a),c.isZooming=!0;break;case"Equal":f=n?l.zoomIn(a).zoomIn(a):l.zoomIn(a),c.isZooming=!0;break;case"ArrowLeft":n?(f=l.rotateLeft(s),c.isRotating=!0):(f=l.moveLeft(o),c.isPanning=!0);break;case"ArrowRight":n?(f=l.rotateRight(s),c.isRotating=!0):(f=l.moveRight(o),c.isPanning=!0);break;case"ArrowUp":n?(f=l.rotateUp(u),c.isRotating=!0):(f=l.moveUp(o),c.isPanning=!0);break;case"ArrowDown":n?(f=l.rotateDown(u),c.isRotating=!0):(f=l.moveDown(o),c.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),c),!0}},{key:"_getTransitionProps",value:function(e){var n=this.transition;return!n||!n.transitionInterpolator?uo:e?Rt(Rt({},n),{},{transitionInterpolator:new Xr(Rt(Rt(Rt({},e),n.transitionInterpolator.opts),{},{makeViewport:this.controllerState.makeViewport}))}):n}}]),t}();var DU=h(L()),NU=h(N()),OT=h(B()),dl=function(){function t(r,e){(0,DU.default)(this,t),(0,OT.default)(this,"_viewportProps",void 0),(0,OT.default)(this,"_state",void 0),this._viewportProps=this.applyConstraints(r),this._state=e}return(0,NU.default)(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}}]),t}();function jU(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function pa(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?jU(Object(e),!0).forEach(function(n){(0,vl.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):jU(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function VU(t){var r=H0e();return function(){var n=(0,Wm.default)(t),i;if(r){var a=(0,Wm.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,zU.default)(this,i)}}function H0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var UU=5,W0e=1.2,IT=function(t){(0,MT.default)(e,t);var r=VU(e);function e(n){var i;(0,ET.default)(this,e);var a=n.width,o=n.height,s=n.latitude,u=n.longitude,l=n.zoom,f=n.bearing,c=f===void 0?0:f,p=n.pitch,d=p===void 0?0:p,v=n.altitude,m=v===void 0?1.5:v,g=n.position,y=g===void 0?[0,0,0]:g,_=n.maxZoom,b=_===void 0?20:_,x=n.minZoom,A=x===void 0?0:x,T=n.maxPitch,O=T===void 0?60:T,w=n.minPitch,E=w===void 0?0:w,S=n.startPanLngLat,I=n.startZoomLngLat,R=n.startRotatePos,z=n.startBearing,G=n.startPitch,k=n.startZoom,U=n.normalize,j=U===void 0?!0:U;return rt(Number.isFinite(u)),rt(Number.isFinite(s)),rt(Number.isFinite(l)),i=r.call(this,{width:a,height:o,latitude:s,longitude:u,zoom:l,bearing:c,pitch:d,altitude:m,maxZoom:b,minZoom:A,maxPitch:O,minPitch:E,normalize:j,position:y},{startPanLngLat:S,startZoomLngLat:I,startRotatePos:R,startBearing:z,startPitch:G,startZoom:k}),(0,vl.default)((0,pp.default)(i),"makeViewport",void 0),i.makeViewport=n.makeViewport,i}return(0,CT.default)(e,[{key:"panStart",value:function(i){var a=i.pos;return this._getUpdatedState({startPanLngLat:this._unproject(a)})}},{key:"pan",value:function(i){var a=i.pos,o=i.startPos,s=this.getState().startPanLngLat||this._unproject(o);if(!s)return this;var u=this.makeViewport(this.getViewportProps()),l=u.panByPosition(s,a);return this._getUpdatedState(l)}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(i){var a=i.pos;return this._getUpdatedState({startRotatePos:a,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}},{key:"rotate",value:function(i){var a=i.pos,o=i.deltaAngleX,s=o===void 0?0:o,u=i.deltaAngleY,l=u===void 0?0:u,f=this.getState(),c=f.startRotatePos,p=f.startBearing,d=f.startPitch;if(!c||p===void 0||d===void 0)return this;var v;return a?v=this._getNewRotation(a,c,d,p):v={bearing:p+s,pitch:d+l},this._getUpdatedState(v)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(i){var a=i.pos;return this._getUpdatedState({startZoomLngLat:this._unproject(a),startZoom:this.getViewportProps().zoom})}},{key:"zoom",value:function(i){var a=i.pos,o=i.startPos,s=i.scale,u=this.getState(),l=u.startZoom,f=u.startZoomLngLat;if(f||(l=this.getViewportProps().zoom,f=this._unproject(o)||this._unproject(a)),!f)return this;var c=this.getViewportProps(),p=c.maxZoom,d=c.minZoom,v=l+Math.log2(s);v=He(v,d,p);var m=this.makeViewport(pa(pa({},this.getViewportProps()),{},{zoom:v}));return this._getUpdatedState(pa({zoom:v},m.panByPosition(f,a)))}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(i)}},{key:"zoomOut",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/i)}},{key:"moveLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([i,0])}},{key:"moveRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-i,0])}},{key:"moveUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,i])}},{key:"moveDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-i])}},{key:"rotateLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-i})}},{key:"rotateRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+i})}},{key:"rotateUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+i})}},{key:"rotateDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-i})}},{key:"shortestPathFrom",value:function(i){var a=i.getViewportProps(),o=pa({},this.getViewportProps()),s=o.bearing,u=o.longitude;return Math.abs(s-a.bearing)>180&&(o.bearing=s<0?s+360:s-360),Math.abs(u-a.longitude)>180&&(o.longitude=u<0?u+360:u-360),o}},{key:"applyConstraints",value:function(i){var a=i.maxZoom,o=i.minZoom,s=i.zoom;i.zoom=He(s,o,a);var u=i.maxPitch,l=i.minPitch,f=i.pitch;i.pitch=He(f,l,u);var c=i.normalize,p=c===void 0?!0:c;return p&&Object.assign(i,Pm(i)),i}},{key:"_zoomFromCenter",value:function(i){var a=this.getViewportProps(),o=a.width,s=a.height;return this.zoom({pos:[o/2,s/2],scale:i})}},{key:"_panFromCenter",value:function(i){var a=this.getViewportProps(),o=a.width,s=a.height;return this.pan({startPos:[o/2,s/2],pos:[o/2+i[0],s/2+i[1]]})}},{key:"_getUpdatedState",value:function(i){return new this.constructor(pa(pa(pa({makeViewport:this.makeViewport},this.getViewportProps()),this.getState()),i))}},{key:"_unproject",value:function(i){var a=this.makeViewport(this.getViewportProps());return i&&a.unproject(i)}},{key:"_getNewRotation",value:function(i,a,o,s){var u=i[0]-a[0],l=i[1]-a[1],f=i[1],c=a[1],p=this.getViewportProps(),d=p.width,v=p.height,m=u/d,g=0;l>0?Math.abs(v-c)>UU&&(g=l/(c-v)*W0e):l<0&&c>UU&&(g=1-f/c),g=He(g,-1,1);var y=this.getViewportProps(),_=y.minPitch,b=y.maxPitch,x=s+180*m,A=o;return g>0?A=o+g*(b-o):g<0&&(A=o-g*(_-o)),{pitch:A,bearing:x}}}]),e}(dl),$m=function(t){(0,MT.default)(e,t);var r=VU(e);function e(){var n;(0,ET.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,vl.default)((0,pp.default)(n),"ControllerState",IT),(0,vl.default)((0,pp.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Xr({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),(0,vl.default)((0,pp.default)(n),"dragMode","pan"),n}return(0,CT.default)(e,[{key:"setProps",value:function(i){i.position=i.position||[0,0,0];var a=this.props;(0,GU.default)((0,Wm.default)(e.prototype),"setProps",this).call(this,i);var o=!a||a.height!==i.height;o&&this.updateViewport(new this.ControllerState(pa(pa({makeViewport:this.makeViewport},i),this.state)))}}]),e}(wn);function $0e(t){var r=X0e();return function(){var n=(0,RT.default)(t),i;if(r){var a=(0,RT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,XU.default)(this,i)}}function X0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var As=function(t){(0,$U.default)(e,t);var r=$0e(e);function e(){return(0,HU.default)(this,e),r.apply(this,arguments)}return(0,WU.default)(e,[{key:"ViewportType",get:function(){return $r}},{key:"ControllerType",get:function(){return $m}}]),e}(Pn);(0,qU.default)(As,"displayName","MapView");var KU=h(L()),JU=h(N()),hp=h(B());function LT(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=q0e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function q0e(t,r){if(t){if(typeof t=="string")return YU(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return YU(t,r)}}function YU(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Y0e=new ip;function K0e(t,r){var e,n,i=(e=t.order)!==null&&e!==void 0?e:1/0,a=(n=r.order)!==null&&n!==void 0?n:1/0;return i-a}var ZU=function(){function t(){(0,KU.default)(this,t),(0,hp.default)(this,"effects",void 0),(0,hp.default)(this,"_resolvedEffects",[]),(0,hp.default)(this,"_defaultEffects",[]),(0,hp.default)(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}return(0,JU.default)(t,[{key:"addDefaultEffect",value:function(e){var n=this._defaultEffects;if(!n.find(function(a){return a.id===e.id})){var i=n.findIndex(function(a){return K0e(a,e)>0});i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}},{key:"setProps",value:function(e){"effects"in e&&(It(e.effects,this.effects,1)||this._setEffects(e.effects))}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}},{key:"getEffects",value:function(){return this._resolvedEffects}},{key:"_setEffects",value:function(e){var n={},i=LT(this.effects),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n[o.id]=o}}catch(d){i.e(d)}finally{i.f()}var s=[],u=LT(e),l;try{for(u.s();!(l=u.n()).done;){var f=l.value,c=n[f.id];c&&c!==f?c.setProps?(c.setProps(f.props),s.push(c)):(c.cleanup(),s.push(f)):s.push(f),delete n[f.id]}}catch(d){u.e(d)}finally{u.f()}for(var p in n)n[p].cleanup();this.effects=s,this._resolvedEffects=s.concat(this._defaultEffects),e.some(function(d){return d instanceof ip})||this._resolvedEffects.push(Y0e),this._needsRedraw="effects changed"}},{key:"finalize",value:function(){var e=LT(this._resolvedEffects),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.cleanup()}}catch(a){e.e(a)}finally{e.f()}this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}]),t}();var oG=h(L()),sG=h(N()),ti=h(B());var QU=h(L()),eG=h(N()),tG=h(Y()),rG=h(K()),kT=h(q());function J0e(t){var r=Z0e();return function(){var n=(0,kT.default)(t),i;if(r){var a=(0,kT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rG.default)(this,i)}}function Z0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var nG=function(t){(0,tG.default)(e,t);var r=J0e(e);function e(){return(0,QU.default)(this,e),r.apply(this,arguments)}return(0,eG.default)(e,[{key:"shouldDrawLayer",value:function(i){var a=i.props.operation;return a.includes("draw")||a.includes("terrain")}}]),e}(Vr);function Xm(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Q0e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Q0e(t,r){if(t){if(typeof t=="string")return iG(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return iG(t,r)}}function iG(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function aG(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ml(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?aG(Object(e),!0).forEach(function(n){(0,ti.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):aG(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var e_e="deckRenderer.renderLayers",qm=function(){function t(r){(0,oG.default)(this,t),(0,ti.default)(this,"gl",void 0),(0,ti.default)(this,"layerFilter",void 0),(0,ti.default)(this,"drawPickingColors",void 0),(0,ti.default)(this,"drawLayersPass",void 0),(0,ti.default)(this,"pickLayersPass",void 0),(0,ti.default)(this,"renderCount",void 0),(0,ti.default)(this,"_needsRedraw",void 0),(0,ti.default)(this,"renderBuffers",void 0),(0,ti.default)(this,"lastPostProcessEffect",void 0),this.gl=r,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new nG(r),this.pickLayersPass=new oo(r),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}return(0,sG.default)(t,[{key:"setProps",value:function(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}},{key:"renderLayers",value:function(e){var n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i=ml(ml({layerFilter:this.layerFilter,isPicking:this.drawPickingColors},e),{},{target:e.target||Me.getDefaultFramebuffer(this.gl)});i.effects&&this._preRender(i.effects,i);var a=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,o=n.render(ml(ml({},i),{},{target:a}));i.effects&&this._postRender(i.effects,i),this.renderCount++,Ft(e_e,this,o,e)}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}},{key:"finalize",value:function(){var e=this.renderBuffers,n=Xm(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.delete()}}catch(o){n.e(o)}finally{n.f()}e.length=0}},{key:"_preRender",value:function(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};var i=Xm(e),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n.preRenderStats[o.id]=o.preRender(this.gl,n),o.postRender&&(this.lastPostProcessEffect=o.id)}}catch(s){i.e(s)}finally{i.f()}this.lastPostProcessEffect&&this._resizeRenderBuffers()}},{key:"_resizeRenderBuffers",value:function(){var e=this.renderBuffers;e.length===0&&e.push(new Me(this.gl),new Me(this.gl));var n=Xm(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.resize()}}catch(o){n.e(o)}finally{n.f()}}},{key:"_postRender",value:function(e,n){var i=this.renderBuffers,a=ml(ml({},n),{},{inputBuffer:i[0],swapBuffer:i[1],target:null}),o=Xm(e),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;if(u.postRender){if(u.id===this.lastPostProcessEffect){a.target=n.target,u.postRender(this.gl,a);break}var l=u.postRender(this.gl,a);a.inputBuffer=l,a.swapBuffer=l===i[0]?i[1]:i[0]}}}catch(f){o.e(f)}finally{o.f()}}}]),t}();var gG=h(L()),yG=h(N()),Ci=h(B());var lG=h(B());function uG(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ym(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?uG(Object(e),!0).forEach(function(n){(0,lG.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):uG(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var t_e={pickedColor:null,pickedObjectIndex:-1};function fG(t){for(var r=t.pickedColors,e=t.decodePickingColor,n=t.deviceX,i=t.deviceY,a=t.deviceRadius,o=t.deviceRect,s=o.x,u=o.y,l=o.width,f=o.height,c=a*a,p=-1,d=0,v=0;v<f;v++){var m=v+u-i,g=m*m;if(g>c)d+=4*l;else for(var y=0;y<l;y++){var _=r[d+3]-1;if(_>=0){var b=y+s-n,x=b*b+g;x<=c&&(c=x,p=d)}d+=4}}if(p>=0){var A=r.slice(p,p+4),T=e(A);if(T){var O=Math.floor(p/4/l),w=p/4-O*l;return Ym(Ym({},T),{},{pickedColor:A,pickedX:s+w,pickedY:u+O})}Z.error("Picked non-existent layer. Is picking buffer corrupt?")()}return t_e}function cG(t){var r=t.pickedColors,e=t.decodePickingColor,n=new Map;if(r)for(var i=0;i<r.length;i+=4){var a=r[i+3]-1;if(a>=0){var o=r.slice(i,i+4),s=o.join(",");if(!n.has(s)){var u=e(o);u?n.set(s,Ym(Ym({},u),{},{color:o})):Z.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}var hG=h(B());function pG(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function r_e(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?pG(Object(e),!0).forEach(function(n){(0,hG.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):pG(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function BT(t){var r=t.pickInfo,e=t.viewports,n=t.pixelRatio,i=t.x,a=t.y,o=t.z,s=e[0];e.length>1&&(s=n_e(r?.pickedViewports||e,{x:i,y:a}));var u;if(s){var l=[i-s.x,a-s.y];o!==void 0&&(l[2]=o),u=s.unproject(l)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:i,y:a,pixel:[i,a],coordinate:u,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:n}}function dG(t){var r=t.pickInfo,e=t.lastPickedInfo,n=t.mode,i=t.layers,a=r.pickedColor,o=r.pickedLayer,s=r.pickedObjectIndex,u=o?[o]:[];if(n==="hover"){var l=e.index,f=e.layerId,c=o?o.props.id:null;if(c!==f||s!==l){if(c!==f){var p=i.find(function(m){return m.props.id===f});p&&u.unshift(p)}e.layerId=c,e.index=s,e.info=null}}var d=BT(t),v=new Map;return v.set(null,d),u.forEach(function(m){var g=r_e({},d);m===o&&(g.color=a,g.index=s,g.picked=!0),g=FT({layer:m,info:g,mode:n});var y=g.layer;m===o&&n==="hover"&&(e.info=g),v.set(y.id,g),n==="hover"&&y.updateAutoHighlight(g)}),v}function FT(t){for(var r=t.layer,e=t.info,n=t.mode;r&&e;){var i=e.layer||null;e.sourceLayer=i,e.layer=r,e=r.getPickingInfo({info:e,mode:n,sourceLayer:i}),r=r.parent}return e}function n_e(t,r){for(var e=t.length-1;e>=0;e--){var n=t[e];if(n.containsPixel(r))return n}return t[0]}function DT(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=i_e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function i_e(t,r){if(t){if(typeof t=="string")return vG(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return vG(t,r)}}function vG(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function mG(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Km(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?mG(Object(e),!0).forEach(function(n){(0,Ci.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):mG(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var _G=function(){function t(r){(0,gG.default)(this,t),(0,Ci.default)(this,"gl",void 0),(0,Ci.default)(this,"pickingFBO",void 0),(0,Ci.default)(this,"depthFBO",void 0),(0,Ci.default)(this,"pickLayersPass",void 0),(0,Ci.default)(this,"layerFilter",void 0),(0,Ci.default)(this,"lastPickedInfo",void 0),(0,Ci.default)(this,"_pickable",!0),this.gl=r,this.pickLayersPass=new oo(r),this.lastPickedInfo={index:-1,layerId:null,info:null}}return(0,yG.default)(t,[{key:"setProps",value:function(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}},{key:"finalize",value:function(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}},{key:"pickObject",value:function(e){return this._pickClosestObject(e)}},{key:"pickObjects",value:function(e){return this._pickVisibleObjects(e)}},{key:"getLastPickedObject",value:function(e){var n=e.x,i=e.y,a=e.layers,o=e.viewports,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info,u=s&&s.layer&&s.layer.id,l=s&&s.viewport&&s.viewport.id,f=u?a.find(function(v){return v.id===u}):null,c=l&&o.find(function(v){return v.id===l})||o[0],p=c&&c.unproject([n-c.x,i-c.y]),d={x:n,y:i,viewport:c,coordinate:p,layer:f};return Km(Km({},s),d)}},{key:"_resizeBuffer",value:function(){var e,n,i=this.gl;if(!this.pickingFBO&&(this.pickingFBO=new Me(i),Me.isSupported(i,{colorBufferFloat:!0}))){var a=new Me(i);a.attach((0,Ci.default)({},36064,new Se(i,{format:fe(i)?34836:6408,type:5126}))),this.depthFBO=a}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}},{key:"_getPickable",value:function(e){var n=this;if(this._pickable===!1)return null;var i=e.filter(function(a){return n.pickLayersPass.shouldDrawLayer(a)&&!a.isComposite});return i.length?i:null}},{key:"_pickClosestObject",value:function(e){var n=e.layers,i=e.views,a=e.viewports,o=e.x,s=e.y,u=e.radius,l=u===void 0?0:u,f=e.depth,c=f===void 0?1:f,p=e.mode,d=p===void 0?"query":p,v=e.unproject3D,m=e.onViewportActive,g=e.effects,y=this._getPickable(n),_=vr(this.gl);if(!y)return{result:[],emptyInfo:BT({viewports:a,x:o,y:s,pixelRatio:_})};this._resizeBuffer();for(var b=Mu(this.gl,[o,s],!0),x=[b.x+Math.floor(b.width/2),b.y+Math.floor(b.height/2)],A=Math.round(l*_),T=this.pickingFBO,O=T.width,w=T.height,E=this._getPickingRect({deviceX:x[0],deviceY:x[1],deviceRadius:A,deviceWidth:O,deviceHeight:w}),S={x:o-l,y:s-l,width:l*2+1,height:l*2+1},I,R=[],z=new Set,G=0;G<c;G++){var k=void 0;if(E){var U=this._drawAndSample({layers:y,views:i,viewports:a,onViewportActive:m,deviceRect:E,cullRect:S,effects:g,pass:"picking:".concat(d)});k=fG(Km(Km({},U),{},{deviceX:x[0],deviceY:x[1],deviceRadius:A,deviceRect:E}))}else k={pickedColor:null,pickedObjectIndex:-1};var j=void 0;if(k.pickedLayer&&v&&this.depthFBO){var X=this._drawAndSample({layers:[k.pickedLayer],views:i,viewports:a,onViewportActive:m,deviceRect:{x:k.pickedX,y:k.pickedY,width:1,height:1},cullRect:S,effects:g,pass:"picking:".concat(d,":z")},!0),H=X.pickedColors;H[3]&&(j=H[0])}k.pickedLayer&&G+1<c&&(z.add(k.pickedLayer),k.pickedLayer.disablePickingIndex(k.pickedObjectIndex)),I=dG({pickInfo:k,lastPickedInfo:this.lastPickedInfo,mode:d,layers:y,viewports:a,x:o,y:s,z:j,pixelRatio:_});var Q=DT(I.values()),ne;try{for(Q.s();!(ne=Q.n()).done;){var le=ne.value;le.layer&&R.push(le)}}catch(me){Q.e(me)}finally{Q.f()}if(!k.pickedColor)break}var xe=DT(z),we;try{for(xe.s();!(we=xe.n()).done;){var ze=we.value;ze.restorePickingColors()}}catch(me){xe.e(me)}finally{xe.f()}return{result:R,emptyInfo:I.get(null)}}},{key:"_pickVisibleObjects",value:function(e){var n=e.layers,i=e.views,a=e.viewports,o=e.x,s=e.y,u=e.width,l=u===void 0?1:u,f=e.height,c=f===void 0?1:f,p=e.mode,d=p===void 0?"query":p,v=e.maxObjects,m=v===void 0?null:v,g=e.onViewportActive,y=e.effects,_=this._getPickable(n);if(!_)return[];this._resizeBuffer();for(var b=vr(this.gl),x=Mu(this.gl,[o,s],!0),A=x.x,T=x.y+x.height,O=Mu(this.gl,[o+l,s+c],!0),w=O.x+O.width,E=O.y,S={x:A,y:E,width:w-A,height:T-E},I=this._drawAndSample({layers:_,views:i,viewports:a,onViewportActive:g,deviceRect:S,cullRect:{x:o,y:s,width:l,height:c},effects:y,pass:"picking:".concat(d)}),R=cG(I),z=new Map,G=Number.isFinite(m),k=0;k<R.length&&!(G&&m&&z.size>=m);k++){var U=R[k],j={color:U.pickedColor,layer:null,index:U.pickedObjectIndex,picked:!0,x:o,y:s,pixelRatio:b};j=FT({layer:U.pickedLayer,info:j,mode:d}),z.has(j.object)||z.set(j.object,j)}return Array.from(z.values())}},{key:"_drawAndSample",value:function(e){var n=e.layers,i=e.views,a=e.viewports,o=e.onViewportActive,s=e.deviceRect,u=e.cullRect,l=e.effects,f=e.pass,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,p=c?this.depthFBO:this.pickingFBO,d={layers:n,layerFilter:this.layerFilter,views:i,viewports:a,onViewportActive:o,pickingFBO:p,deviceRect:s,cullRect:u,effects:l,pass:f,pickZ:c,preRenderStats:{}},v=DT(l),m;try{for(v.s();!(m=v.n()).done;){var g=m.value;g.useInPicking&&(d.preRenderStats[g.id]=g.preRender(this.gl,d))}}catch(w){v.e(w)}finally{v.f()}var y=this.pickLayersPass.render(d),_=y.decodePickingColor,b=s.x,x=s.y,A=s.width,T=s.height,O=new(c?Float32Array:Uint8Array)(A*T*4);return Wn(p,{sourceX:b,sourceY:x,sourceWidth:A,sourceHeight:T,target:O}),{pickedColors:O,decodePickingColor:_}}},{key:"_getPickingRect",value:function(e){var n=e.deviceX,i=e.deviceY,a=e.deviceRadius,o=e.deviceWidth,s=e.deviceHeight,u=Math.max(0,n-a),l=Math.max(0,i-a),f=Math.min(o,n+a+1)-u,c=Math.min(s,i+a+1)-l;return f<=0||c<=0?null:{x:u,y:l,width:f,height:c}}}]),t}();var bG=h(L()),xG=h(N()),NT=h(B()),a_e={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},AG=function(){function t(r){(0,bG.default)(this,t),(0,NT.default)(this,"el",null),(0,NT.default)(this,"isVisible",!1);var e=r.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,a_e),e.appendChild(this.el))}return(0,xG.default)(t,[{key:"setTooltip",value:function(e,n,i){var a=this.el;if(a){if(typeof e=="string")a.innerText=e;else if(e)e.text&&(a.innerText=e.text),e.html&&(a.innerHTML=e.html),e.className&&(a.className=e.className),Object.assign(a.style,e.style);else{this.isVisible=!1,a.style.display="none";return}this.isVisible=!0,a.style.display="block",a.style.transform="translate(".concat(n,"px, ").concat(i,"px)")}}},{key:"remove",value:function(){this.el&&(this.el.remove(),this.el=null)}}]),t}();var P6=h(ye()),w6=h(B()),O6=h(L()),E6=h(N());var dp=h(TG());var SG=1,PG=2,jT=4,o_e={mousedown:SG,mousemove:PG,mouseup:jT};function s_e(t,r){for(var e=0;e<t.length;e++)if(r(t[e]))return!0;return!1}function wG(t){var r=t.prototype.handler;t.prototype.handler=function(n){var i=this.store;n.button>0&&n.type==="pointerdown"&&(s_e(i,function(a){return a.pointerId===n.pointerId})||i.push(n)),r.call(this,n)}}function OG(t){t.prototype.handler=function(e){var n=o_e[e.type];n&SG&&e.button>=0&&(this.pressed=!0),n&PG&&e.which===0&&(n=jT),this.pressed&&(n&jT&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}wG(dp.default.PointerEventInput);OG(dp.default.MouseInput);var EG=dp.default.Manager,ri=dp.default;var UG=h(L()),GG=h(N()),zG=h(Y()),VG=h(K()),zT=h(q());var MG=h(B()),IG=h(L());function CG(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function u_e(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?CG(Object(e),!0).forEach(function(n){(0,MG.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):CG(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var lo=function t(r,e,n){(0,IG.default)(this,t),this.element=r,this.callback=e,this.options=u_e({enable:!0},n)};var RG=ri?[[ri.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[ri.Rotate,{enable:!1}],[ri.Pinch,{enable:!1}],[ri.Swipe,{enable:!1}],[ri.Pan,{threshold:0,enable:!1}],[ri.Press,{enable:!1}],[ri.Tap,{event:"doubletap",taps:2,enable:!1}],[ri.Tap,{event:"anytap",enable:!1}],[ri.Tap,{enable:!1}]]:null,UT={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},LG={doubletap:["tap"]},kG={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},gl={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},BG={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},GT={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"};var DG=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Ts=typeof window<"u"?window:global;var Zm=!1;try{FG={get passive(){return Zm=!0,!0}},Ts.addEventListener("test",null,FG),Ts.removeEventListener("test",null)}catch{Zm=!1}var FG;function l_e(t){var r=f_e();return function(){var n=(0,zT.default)(t),i;if(r){var a=(0,zT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,VG.default)(this,i)}}function f_e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var c_e=DG.indexOf("firefox")!==-1,p_e=gl.WHEEL_EVENTS,NG="wheel",jG=4.000244140625,h_e=40,d_e=.25,HG=function(t){(0,zG.default)(e,t);var r=l_e(e);function e(n,i,a){var o;return(0,UG.default)(this,e),o=r.call(this,n,i,a),o.handleEvent=function(s){if(o.options.enable){var u=s.deltaY;Ts.WheelEvent&&(c_e&&s.deltaMode===Ts.WheelEvent.DOM_DELTA_PIXEL&&(u/=Ts.devicePixelRatio),s.deltaMode===Ts.WheelEvent.DOM_DELTA_LINE&&(u*=h_e)),u!==0&&u%jG===0&&(u=Math.floor(u/jG)),s.shiftKey&&u&&(u=u*d_e),o.callback({type:NG,center:{x:s.clientX,y:s.clientY},delta:-u,srcEvent:s,pointerType:"mouse",target:s.target})}},o.events=(o.options.events||[]).concat(p_e),o.events.forEach(function(s){return n.addEventListener(s,o.handleEvent,Zm?{passive:!1}:!1)}),o}return(0,GG.default)(e,[{key:"destroy",value:function(){var i=this;this.events.forEach(function(a){return i.element.removeEventListener(a,i.handleEvent)})}},{key:"enableEventType",value:function(i,a){i===NG&&(this.options.enable=a)}}]),e}(lo);var KG=h(L()),JG=h(N()),ZG=h(Y()),QG=h(K()),VT=h(q());function v_e(t){var r=m_e();return function(){var n=(0,VT.default)(t),i;if(r){var a=(0,VT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,QG.default)(this,i)}}function m_e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var g_e=gl.MOUSE_EVENTS,WG="pointermove",$G="pointerover",XG="pointerout",qG="pointerenter",YG="pointerleave",e6=function(t){(0,ZG.default)(e,t);var r=v_e(e);function e(n,i,a){var o;(0,KG.default)(this,e),o=r.call(this,n,i,a),o.handleEvent=function(u){o.handleOverEvent(u),o.handleOutEvent(u),o.handleEnterEvent(u),o.handleLeaveEvent(u),o.handleMoveEvent(u)},o.pressed=!1;var s=o.options.enable;return o.enableMoveEvent=s,o.enableLeaveEvent=s,o.enableEnterEvent=s,o.enableOutEvent=s,o.enableOverEvent=s,o.events=(o.options.events||[]).concat(g_e),o.events.forEach(function(u){return n.addEventListener(u,o.handleEvent)}),o}return(0,JG.default)(e,[{key:"destroy",value:function(){var i=this;this.events.forEach(function(a){return i.element.removeEventListener(a,i.handleEvent)})}},{key:"enableEventType",value:function(i,a){i===WG&&(this.enableMoveEvent=a),i===$G&&(this.enableOverEvent=a),i===XG&&(this.enableOutEvent=a),i===qG&&(this.enableEnterEvent=a),i===YG&&(this.enableLeaveEvent=a)}},{key:"handleOverEvent",value:function(i){this.enableOverEvent&&i.type==="mouseover"&&this._emit($G,i)}},{key:"handleOutEvent",value:function(i){this.enableOutEvent&&i.type==="mouseout"&&this._emit(XG,i)}},{key:"handleEnterEvent",value:function(i){this.enableEnterEvent&&i.type==="mouseenter"&&this._emit(qG,i)}},{key:"handleLeaveEvent",value:function(i){this.enableLeaveEvent&&i.type==="mouseleave"&&this._emit(YG,i)}},{key:"handleMoveEvent",value:function(i){if(this.enableMoveEvent)switch(i.type){case"mousedown":i.button>=0&&(this.pressed=!0);break;case"mousemove":i.which===0&&(this.pressed=!1),this.pressed||this._emit(WG,i);break;case"mouseup":this.pressed=!1;break;default:}}},{key:"_emit",value:function(i,a){this.callback({type:i,center:{x:a.clientX,y:a.clientY},srcEvent:a,pointerType:"mouse",target:a.target})}}]),e}(lo);var n6=h(L()),i6=h(N()),a6=h(Y()),o6=h(K()),HT=h(q());function y_e(t){var r=__e();return function(){var n=(0,HT.default)(t),i;if(r){var a=(0,HT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,o6.default)(this,i)}}function __e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var b_e=gl.KEY_EVENTS,t6="keydown",r6="keyup",s6=function(t){(0,a6.default)(e,t);var r=y_e(e);function e(n,i,a){var o;return(0,n6.default)(this,e),o=r.call(this,n,i,a),o.handleEvent=function(s){var u=s.target||s.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(o.enableDownEvent&&s.type==="keydown"&&o.callback({type:t6,srcEvent:s,key:s.key,target:s.target}),o.enableUpEvent&&s.type==="keyup"&&o.callback({type:r6,srcEvent:s,key:s.key,target:s.target}))},o.enableDownEvent=o.options.enable,o.enableUpEvent=o.options.enable,o.events=(o.options.events||[]).concat(b_e),n.tabIndex=o.options.tabIndex||0,n.style.outline="none",o.events.forEach(function(s){return n.addEventListener(s,o.handleEvent)}),o}return(0,i6.default)(e,[{key:"destroy",value:function(){var i=this;this.events.forEach(function(a){return i.element.removeEventListener(a,i.handleEvent)})}},{key:"enableEventType",value:function(i,a){i===t6&&(this.enableDownEvent=a),i===r6&&(this.enableUpEvent=a)}}]),e}(lo);var l6=h(L()),f6=h(N()),c6=h(Y()),p6=h(K()),WT=h(q());function x_e(t){var r=A_e();return function(){var n=(0,WT.default)(t),i;if(r){var a=(0,WT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,p6.default)(this,i)}}function A_e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var u6="contextmenu",h6=function(t){(0,c6.default)(e,t);var r=x_e(e);function e(n,i,a){var o;return(0,l6.default)(this,e),o=r.call(this,n,i,a),o.handleEvent=function(s){o.options.enable&&o.callback({type:u6,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},n.addEventListener("contextmenu",o.handleEvent),o}return(0,f6.default)(e,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(i,a){i===u6&&(this.options.enable=a)}}]),e}(lo);var g6=h(B()),y6=h(L()),_6=h(N());var $T=1,Qm=2,XT=4,T_e={pointerdown:$T,pointermove:Qm,pointerup:XT,mousedown:$T,mousemove:Qm,mouseup:XT},S_e=1,P_e=2,w_e=3,O_e=0,E_e=1,C_e=2,M_e=1,I_e=2,R_e=4;function d6(t){var r=T_e[t.srcEvent.type];if(!r)return null;var e=t.srcEvent,n=e.buttons,i=e.button,a=e.which,o=!1,s=!1,u=!1;return r===XT||r===Qm&&!Number.isFinite(n)?(o=a===S_e,s=a===P_e,u=a===w_e):r===Qm?(o=Boolean(n&M_e),s=Boolean(n&R_e),u=Boolean(n&I_e)):r===$T&&(o=i===O_e,s=i===E_e,u=i===C_e),{leftButton:o,middleButton:s,rightButton:u}}function v6(t,r){var e=t.center;if(!e)return null;var n=r.getBoundingClientRect(),i=n.width/r.offsetWidth||1,a=n.height/r.offsetHeight||1,o={x:(e.x-n.left-r.clientLeft)/i,y:(e.y-n.top-r.clientTop)/a};return{center:e,offsetCenter:o}}function m6(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Mi(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?m6(Object(e),!0).forEach(function(n){(0,g6.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):m6(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var qT={srcElement:"root",priority:0},b6=function(){function t(r){var e=this;(0,y6.default)(this,t),this.handleEvent=function(n){if(!e.isEmpty()){for(var i=e._normalizeEvent(n),a=n.srcEvent.target;a&&a!==i.rootElement;){if(e._emit(i,a),i.handled)return;a=a.parentNode}e._emit(i,"root")}},this.eventManager=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}return(0,_6.default)(t,[{key:"isEmpty",value:function(){return!this._active}},{key:"add",value:function(e,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,s=this.handlers,u=this.handlersByElement,l=qT;typeof i=="string"||i&&i.addEventListener?l=Mi(Mi({},qT),{},{srcElement:i}):i&&(l=Mi(Mi({},qT),i));var f=u.get(l.srcElement);f||(f=[],u.set(l.srcElement,f));var c={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};a&&(c.once=!0),o&&(c.passive=!0),s.push(c),this._active=this._active||!c.passive;for(var p=f.length-1;p>=0&&!(f[p].priority>=c.priority);)p--;f.splice(p+1,0,c)}},{key:"remove",value:function(e,n){for(var i=this.handlers,a=this.handlersByElement,o=i.length-1;o>=0;o--){var s=i[o];if(s.type===e&&s.handler===n){i.splice(o,1);var u=a.get(s.srcElement);u.splice(u.indexOf(s),1),u.length===0&&a.delete(s.srcElement)}}this._active=i.some(function(l){return!l.passive})}},{key:"_emit",value:function(e,n){var i=this.handlersByElement.get(n);if(i){for(var a=!1,o=function(){e.handled=!0},s=function(){e.handled=!0,a=!0},u=[],l=0;l<i.length;l++){var f=i[l],c=f.type,p=f.handler,d=f.once;if(p(Mi(Mi({},e),{},{type:c,stopPropagation:o,stopImmediatePropagation:s})),d&&u.push(i[l]),a)break}for(var v=0;v<u.length;v++){var m=u[v],g=m.type,y=m.handler;this.remove(g,y)}}}},{key:"_normalizeEvent",value:function(e){var n=this.eventManager.getElement();return Mi(Mi(Mi(Mi({},e),d6(e)),v6(e,n)),{},{preventDefault:function(){e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n})}}]),t}();function x6(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=L_e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function L_e(t,r){if(t){if(typeof t=="string")return A6(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return A6(t,r)}}function A6(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function T6(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function S6(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?T6(Object(e),!0).forEach(function(n){(0,w6.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):T6(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var k_e={events:null,recognizers:null,recognizerOptions:{},Manager:EG,touchAction:"none",tabIndex:0},YT=function(){function t(){var r=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;(0,O6.default)(this,t),this._onBasicInput=function(a){var o=a.srcEvent,s=kG[o.type];s&&r.manager.emit(s,a)},this._onOtherEvent=function(a){r.manager.emit(a.type,a)},this.options=S6(S6({},k_e),n),this.events=new Map,this.setElement(e);var i=this.options.events;i&&this.on(i)}return(0,E6.default)(t,[{key:"getElement",value:function(){return this.element}},{key:"setElement",value:function(e){var n=this;if(this.element&&this.destroy(),this.element=e,!!e){var i=this.options,a=i.Manager;this.manager=new a(e,{touchAction:i.touchAction,recognizers:i.recognizers||RG}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(UT).forEach(function(v){var m=n.manager.get(v);m&&UT[v].forEach(function(g){m.recognizeWith(g)})});for(var o in i.recognizerOptions){var s=this.manager.get(o);if(s){var u=i.recognizerOptions[o];delete u.enable,s.set(u)}}this.wheelInput=new HG(e,this._onOtherEvent,{enable:!1}),this.moveInput=new e6(e,this._onOtherEvent,{enable:!1}),this.keyInput=new s6(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new h6(e,this._onOtherEvent,{enable:!1});var l=x6(this.events),f;try{for(l.s();!(f=l.n()).done;){var c=(0,P6.default)(f.value,2),p=c[0],d=c[1];d.isEmpty()||(this._toggleRecognizer(d.recognizerName,!0),this.manager.on(p,d.handleEvent))}}catch(v){l.e(v)}finally{l.f()}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(e,n,i){this._addEventHandler(e,n,i,!1)}},{key:"once",value:function(e,n,i){this._addEventHandler(e,n,i,!0)}},{key:"watch",value:function(e,n,i){this._addEventHandler(e,n,i,!1,!0)}},{key:"off",value:function(e,n){this._removeEventHandler(e,n)}},{key:"_toggleRecognizer",value:function(e,n){var i=this.manager;if(i){var a=i.get(e);if(a&&a.options.enable!==n){a.set({enable:n});var o=LG[e];o&&!this.options.recognizers&&o.forEach(function(s){var u=i.get(s);n?(u.requireFailure(e),a.dropRequireFailure(s)):u.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}}},{key:"_addEventHandler",value:function(e,n,i,a,o){if(typeof e!="string"){i=n;for(var s in e)this._addEventHandler(s,e[s],i,a,o);return}var u=this.manager,l=this.events,f=GT[e]||e,c=l.get(f);c||(c=new b6(this),l.set(f,c),c.recognizerName=BG[f]||f,u&&u.on(f,c.handleEvent)),c.add(e,n,i,a,o),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}},{key:"_removeEventHandler",value:function(e,n){if(typeof e!="string"){for(var i in e)this._removeEventHandler(i,e[i]);return}var a=this.events,o=GT[e]||e,s=a.get(o);if(s&&(s.remove(e,n),s.isEmpty())){var u=s.recognizerName,l=!1,f=x6(a.values()),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;if(p.recognizerName===u&&!p.isEmpty()){l=!0;break}}}catch(d){f.e(d)}finally{f.f()}l||this._toggleRecognizer(u,!1)}}}]),t}();function C6(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=B_e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function B_e(t,r){if(t){if(typeof t=="string")return M6(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return M6(t,r)}}function M6(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function I6(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ha(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?I6(Object(e),!0).forEach(function(n){(0,ft.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):I6(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Ss(){}var F_e=function(r){var e=r.isDragging;return e?"grabbing":"grab"},k6={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Ss,onResize:Ss,onViewStateChange:Ss,onInteractionStateChange:Ss,onBeforeRender:Ss,onAfterRender:Ss,onLoad:Ss,onError:function(r){return Z.error(r.message)()},onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:F_e,getTooltip:null,debug:!1,drawPickingColors:!1},un=function(){function t(r){var e=this;(0,R6.default)(this,t),(0,ft.default)(this,"props",void 0),(0,ft.default)(this,"width",0),(0,ft.default)(this,"height",0),(0,ft.default)(this,"userData",{}),(0,ft.default)(this,"canvas",null),(0,ft.default)(this,"viewManager",null),(0,ft.default)(this,"layerManager",null),(0,ft.default)(this,"effectManager",null),(0,ft.default)(this,"deckRenderer",null),(0,ft.default)(this,"deckPicker",null),(0,ft.default)(this,"eventManager",null),(0,ft.default)(this,"tooltip",null),(0,ft.default)(this,"metrics",void 0),(0,ft.default)(this,"animationLoop",void 0),(0,ft.default)(this,"stats",void 0),(0,ft.default)(this,"viewState",void 0),(0,ft.default)(this,"cursorState",void 0),(0,ft.default)(this,"_needsRedraw",void 0),(0,ft.default)(this,"_pickRequest",void 0),(0,ft.default)(this,"_lastPointerDownInfo",null),(0,ft.default)(this,"_metricsCounter",void 0),(0,ft.default)(this,"_onPointerMove",function(n){var i=e._pickRequest;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;var a=n.offsetCenter;if(!a)return;i.x=a.x,i.y=a.y,i.radius=e.props.pickingRadius}e.layerManager&&(e.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),(0,ft.default)(this,"_onEvent",function(n){var i=ix[n.type],a=n.offsetCenter;if(!(!i||!a||!e.layerManager)){var o=e.layerManager.getLayers(),s=e.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:o,viewports:e.getViewports(a)},e._lastPointerDownInfo),u=s.layer,l=u&&(u[i.handler]||u.props[i.handler]),f=e.props[i.handler],c=!1;l&&(c=l.call(u,s,n)),!c&&f&&f(s,n)}}),(0,ft.default)(this,"_onPointerDown",function(n){var i=n.offsetCenter,a=e._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:e.props.pickingRadius});e._lastPointerDownInfo=a.result[0]||a.emptyInfo}),this.props=ha(ha({},k6),r),r=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},r.viewState&&r.initialViewState&&Z.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),wu()==="IE"&&Z.warn("IE 11 is not supported")(),this.viewState=r.initialViewState,r.gl||typeof document<"u"&&(this.canvas=this._createCanvas(r)),this.animationLoop=this._createAnimationLoop(r),this.stats=new Un({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(r),r._typedArrayManagerProps&&Kn.setOptions(r._typedArrayManagerProps),this.animationLoop.start()}return(0,L6.default)(t,[{key:"finalize",value:function(){var e,n,i,a,o,s,u;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(a=this.deckRenderer)===null||a===void 0||a.finalize(),this.deckRenderer=null,(o=this.deckPicker)===null||o===void 0||o.finalize(),this.deckPicker=null,(s=this.eventManager)===null||s===void 0||s.destroy(),this.eventManager=null,(u=this.tooltip)===null||u===void 0||u.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var l;(l=this.canvas.parentElement)===null||l===void 0||l.removeChild(this.canvas),this.canvas=null}}},{key:"setProps",value:function(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Z.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Z.removed("onLayerClick","onClick")(),e.initialViewState&&!It(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);var n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";var n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);var i=this.viewManager.needsRedraw(e),a=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return n=n||i||a||o||s,n}},{key:"redraw",value:function(e){if(this.layerManager){var n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}}},{key:"isInitialized",get:function(){return this.viewManager!==null}},{key:"getViews",value:function(){return rt(this.viewManager),this.viewManager.views}},{key:"getViewports",value:function(e){return rt(this.viewManager),this.viewManager.getViewports(e)}},{key:"pickObject",value:function(e){var n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}},{key:"pickMultipleObjects",value:function(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}},{key:"pickObjects",value:function(e){return this._pick("pickObjects","pickObjects Time",e)}},{key:"_addResources",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(var i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}},{key:"_removeResources",value:function(e){var n=C6(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;this.layerManager.resourceManager.remove(a)}}catch(o){n.e(o)}finally{n.f()}}},{key:"_addDefaultEffect",value:function(e){this.effectManager.addDefaultEffect(e)}},{key:"_pick",value:function(e,n,i){rt(this.deckPicker);var a=this.stats;a.get("Pick Count").incrementCount(),a.get(n).timeStart();var o=this.deckPicker[e](ha({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects()},i));return a.get(n).timeEnd(),o}},{key:"_createCanvas",value:function(e){var n=e.canvas;if(typeof n=="string"&&(n=document.getElementById(n),rt(n)),!n){n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay";var i=e.parent||document.body;i.appendChild(n)}return Object.assign(n.style,e.style),n}},{key:"_setCanvasSize",value:function(e){if(this.canvas){var n=e.width,i=e.height;if(n||n===0){var a=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=a}if(i||i===0){var o,s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((o=e.style)===null||o===void 0?void 0:o.position)||"absolute",this.canvas.style.height=s}}}},{key:"_updateCanvasSize",value:function(){var e=this.canvas;if(e){var n=e.clientWidth||e.width,i=e.clientHeight||e.height;if(n!==this.width||i!==this.height){var a;this.width=n,this.height=i,(a=this.viewManager)===null||a===void 0||a.setProps({width:n,height:i}),this.props.onResize({width:n,height:i})}}}},{key:"_createAnimationLoop",value:function(e){var n=this,i=e.width,a=e.height,o=e.gl,s=e.glOptions,u=e.debug,l=e.onError,f=e.onBeforeRender,c=e.onAfterRender,p=e.useDevicePixels;return new Pv({width:i,height:a,useDevicePixels:p,autoResizeViewport:!1,gl:o,onCreateContext:function(v){return Iu(ha(ha(ha({},s),v),{},{canvas:n.canvas,debug:u,onContextLost:function(){return n._onContextLost()}}))},onInitialize:function(v){return n._setGLContext(v.gl)},onRender:this._onRenderFrame.bind(this),onBeforeRender:f,onAfterRender:c,onError:l})}},{key:"_getViewState",value:function(){return this.props.viewState||this.viewState}},{key:"_getViews",value:function(){var e=this.props.views||[new As({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}},{key:"_onContextLost",value:function(){var e=this.props.onError;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}},{key:"_pickAndCallback",value:function(){var e=this._pickRequest;if(e.event){var n=this._pick("pickObject","pickObject Time",e),i=n.result,a=n.emptyInfo;this.cursorState.isHovering=i.length>0;var o=a,s=!1,u=C6(i),l;try{for(u.s();!(l=u.n()).done;){var f,c=l.value;o=c,s=((f=c.layer)===null||f===void 0?void 0:f.onHover(c,e.event))||s}}catch(d){u.e(d)}finally{u.f()}if(!s&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){var p=this.props.getTooltip(o);this.tooltip.setTooltip(p,o.x,o.y)}e.event=null}}},{key:"_updateCursor",value:function(){var e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}},{key:"_setGLContext",value:function(e){if(!this.layerManager){this.canvas||(this.canvas=e.canvas,ea(e,{enable:!0,copyState:!0})),this.tooltip=new AG(this.canvas),Gt(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);var n=new no;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new YT(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(var i in ix)this.eventManager.on(i,this._onEvent);this.viewManager=new uU({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});var a=this.viewManager.getViewports()[0];this.layerManager=new Um(e,{deck:this,stats:this.stats,viewport:a,timeline:n}),this.effectManager=new ZU,this.deckRenderer=new qm(e),this.deckPicker=new _G(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}},{key:"_drawLayers",value:function(e,n){var i=this.layerManager.context.gl;Gt(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers(ha({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects()},n)),this.props.onAfterRender({gl:i})}},{key:"_onRenderFrame",value:function(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Z.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}},{key:"_onViewStateChange",value:function(e){var n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState=ha(ha({},this.viewState),{},(0,ft.default)({},e.viewId,n)),this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}},{key:"_onInteractionStateChange",value:function(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}},{key:"_getFrameStats",value:function(){var e=this.stats;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();var n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}},{key:"_getMetrics",value:function(){var e=this.metrics,n=this.stats;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();var i=mn.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}]),t}();(0,ft.default)(un,"defaultProps",k6);(0,ft.default)(un,"VERSION",Yd);var Az=h(L()),Tz=h(N()),ni=h(B());var JT=h(ye()),Q6=h(L()),ez=h(N()),tz=h(_e()),pg=h(Oe()),rz=h(Y()),nz=h(K()),yl=h(q()),ZT=h(B());var G6=h(L()),z6=h(N()),On=h(B());var D6=h(L()),N6=h(N()),eg=h(B());function B6(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function F6(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?B6(Object(e),!0).forEach(function(n){(0,eg.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):B6(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var tg=function(){function t(r,e){(0,D6.default)(this,t),(0,eg.default)(this,"opts",void 0),(0,eg.default)(this,"source",void 0),this.opts=e,this.source=r}return(0,N6.default)(t,[{key:"value",get:function(){return this.source.value}},{key:"getValue",value:function(){var e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];var i=this.source.value,a=n.size,o=i;if(i&&i.length!==a){o=new Float32Array(a);for(var s=n.elementOffset||0,u=0;u<a;++u)o[u]=i[s+u]}return o}},{key:"getAccessor",value:function(){return F6(F6({},this.source.getAccessor()),this.opts)}}]),t}();function j6(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function U6(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ii(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?U6(Object(e),!0).forEach(function(n){(0,On.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):U6(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function rg(t){return t.stride||t.size*t.bytesPerElement}function V6(t,r){r.offset&&Z.removed("shaderAttribute.offset","vertexOffset, elementOffset")();var e=rg(t),n=r.vertexOffset!==void 0?r.vertexOffset:t.vertexOffset||0,i=r.elementOffset||0,a=n*e+i*t.bytesPerElement+(t.offset||0);return Ii(Ii({},r),{},{offset:a,stride:e})}function D_e(t,r){var e=V6(t,r);return{high:e,low:Ii(Ii({},e),{},{offset:e.offset+t.size*4})}}var H6=function(){function t(r,e,n){(0,G6.default)(this,t),(0,On.default)(this,"gl",void 0),(0,On.default)(this,"id",void 0),(0,On.default)(this,"size",void 0),(0,On.default)(this,"settings",void 0),(0,On.default)(this,"value",void 0),(0,On.default)(this,"doublePrecision",void 0),(0,On.default)(this,"_buffer",void 0),(0,On.default)(this,"state",void 0),this.gl=r,this.id=e.id||"",this.size=e.size||1;var i=e.logicalType||e.type,a=i===5130,o=e.defaultValue;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);var s;a?s=5126:!i&&e.isIndexed?s=r&&$n(r,Ae.ELEMENT_INDEX_UINT32)?5125:5123:s=i||5126;var u=j6(i||s||5126);this.doublePrecision=a,a&&e.fp64===!1&&(u=Float32Array),this.value=null,this.settings=Ii(Ii({},e),{},{defaultType:u,defaultValue:o,logicalType:i,type:s,size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT}),this.state=Ii(Ii({},n),{},{externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}),this._buffer=null}return(0,z6.default)(t,[{key:"isConstant",get:function(){return this.state.constant}},{key:"buffer",get:function(){if(!this._buffer){var e=this.settings,n=e.isIndexed,i=e.type;this._buffer=new be(this.gl,{id:this.id,target:n?34963:34962,accessor:{type:i}})}return this._buffer}},{key:"byteOffset",get:function(){var e=this.getAccessor();return e.vertexOffset?e.vertexOffset*rg(e):0}},{key:"numInstances",get:function(){return this.state.numInstances},set:function(e){this.state.numInstances=e}},{key:"delete",value:function(){this._buffer&&(this._buffer.delete(),this._buffer=null),Kn.release(this.state.allocatedValue)}},{key:"getShaderAttributes",value:function(e,n){if(this.doublePrecision){var i={},a=this.value instanceof Float64Array,o=D_e(this.getAccessor(),n||{});return i[e]=new tg(this,o.high),i["".concat(e,"64Low")]=a?new tg(this,o.low):new Float32Array(this.size),i}if(n){var s=V6(this.getAccessor(),n);return(0,On.default)({},e,new tg(this,s))}return(0,On.default)({},e,this)}},{key:"getBuffer",value:function(){return this.state.constant?null:this.state.externalBuffer||this._buffer}},{key:"getValue",value:function(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}},{key:"getAccessor",value:function(){return this.state.bufferAccessor}},{key:"getBounds",value:function(){if(this.state.bounds)return this.state.bounds;var e=null;if(this.state.constant&&this.value){var n=Array.from(this.value);e=[n,n]}else{var i=this.value,a=this.numInstances,o=this.size,s=a*o;if(i&&s&&i.length>=s){for(var u=new Array(o).fill(1/0),l=new Array(o).fill(-1/0),f=0;f<s;)for(var c=0;c<o;c++){var p=i[f++];p<u[c]&&(u[c]=p),p>l[c]&&(l[c]=p)}e=[u,l]}}return this.state.bounds=e,e}},{key:"setData",value:function(e){var n=this.state,i;ArrayBuffer.isView(e)?i={value:e}:e instanceof be?i={buffer:e}:i=e;var a=Ii(Ii({},this.settings),i);if(n.bufferAccessor=a,n.bounds=null,i.constant){var o=i.value;o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o));var s=!n.constant||!this._areValuesEqual(o,this.value);if(!s)return!1;n.externalBuffer=null,n.constant=!0,this.value=o}else if(i.buffer){var u=i.buffer;n.externalBuffer=u,n.constant=!1,this.value=i.value||null;var l=i.value instanceof Float64Array;a.type=i.type||u.accessor.type,a.bytesPerElement=u.accessor.BYTES_PER_ELEMENT*(l?2:1),a.stride=rg(a)}else if(i.value){this._checkExternalBuffer(i);var f=i.value;n.externalBuffer=null,n.constant=!1,this.value=f,a.bytesPerElement=f.BYTES_PER_ELEMENT,a.stride=rg(a);var c=this.buffer,p=this.byteOffset;this.doublePrecision&&f instanceof Float64Array&&(f=Om(f,a));var d=f.byteLength+p+a.stride*2;c.byteLength<d&&c.reallocate(d),c.setAccessor(null),c.subData({data:f,offset:p}),a.type=i.type||c.accessor.type}return!0}},{key:"updateSubBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;var n=this.value,i=e.startOffset,a=i===void 0?0:i,o=e.endOffset;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?Om(n,{size:this.size,startIndex:a,endIndex:o}):n.subarray(a,o),offset:a*n.BYTES_PER_ELEMENT+this.byteOffset})}},{key:"allocate",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=this.state,a=i.allocatedValue,o=Kn.allocate(a,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=o;var s=this.buffer,u=this.byteOffset;return s.byteLength<o.byteLength+u&&(s.reallocate(o.byteLength+u),n&&a&&s.subData({data:a instanceof Float64Array?Om(a,this):a,offset:u})),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}},{key:"_checkExternalBuffer",value:function(e){var n=e.value;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));var i=this.settings.defaultType,a=!1;if(this.doublePrecision&&(a=n.BYTES_PER_ELEMENT<4),a)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&Z.warn("Attribute ".concat(this.id," is normalized"))()}},{key:"normalizeConstant",value:function(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(function(n){return(n+128)/255*2-1});case 5122:return new Float32Array(e).map(function(n){return(n+32768)/65535*2-1});case 5121:return new Float32Array(e).map(function(n){return n/255});case 5123:return new Float32Array(e).map(function(n){return n/65535});default:return e}}},{key:"_normalizeValue",value:function(e,n,i){var a=this.settings,o=a.defaultValue,s=a.size;if(Number.isFinite(e))return n[i]=e,n;if(!e){for(var u=s;--u>=0;)n[i+u]=o[u];return n}switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:for(var l=s;--l>=0;)n[i+l]=Number.isFinite(e[l])?e[l]:o[l]}return n}},{key:"_areValuesEqual",value:function(e,n){if(!e||!n)return!1;for(var i=this.size,a=0;a<i;a++)if(e[a]!==n[a])return!1;return!0}}]),t}();var W6=[],$6=[];function Nt(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=W6,i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&($6.length=t.length,n=$6):n=W6,(r>0||Number.isFinite(e))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(r,e),i.index=r-1),{iterable:n,objectInfo:i}}function ng(t){return t&&t[Symbol.asyncIterator]}function ig(t,r){var e=r.size,n=r.stride,i=r.offset,a=r.startIndices,o=r.nested,s=t.BYTES_PER_ELEMENT,u=n?n/s:e,l=i?i/s:0,f=Math.floor((t.length-l)/u);return function(c,p){var d=p.index,v=p.target;if(!a){for(var m=d*u+l,g=0;g<e;g++)v[g]=t[m+g];return v}var y=a[d],_=a[d+1]||f,b;if(o){b=new Array(_-y);for(var x=y;x<_;x++){var A=x*u+l;v=new Array(e);for(var T=0;T<e;T++)v[T]=t[A+T];b[x-y]=v}}else if(u===e)b=t.subarray(y*e+l,_*e+l);else{b=new t.constructor((_-y)*e);for(var O=0,w=y;w<_;w++)for(var E=w*u+l,S=0;S<e;S++)b[O++]=t[E+S]}return b}}var X6=[],vp=[[0,1/0]];function q6(t,r){if(t===vp||(r[0]<0&&(r[0]=0),r[0]>=r[1]))return t;for(var e=[],n=t.length,i=0,a=0;a<n;a++){var o=t[a];o[1]<r[0]?(e.push(o),i=a+1):o[0]>r[1]?e.push(o):r=[Math.min(o[0],r[0]),Math.max(o[1],r[1])]}return e.splice(i,0,r),e}var J6=h(B());function KT(t){var r=t.source,e=t.target,n=t.start,i=n===void 0?0:n,a=t.size,o=t.getData,s=t.end||e.length,u=r.length,l=s-i;if(u>l){e.set(r.subarray(0,l),i);return}if(e.set(r,i),!!o)for(var f=u;f<l;)for(var c=o(f,r),p=0;p<a;p++)e[i+f]=c[p]||0,f++}function Y6(t){var r=t.source,e=t.target,n=t.size,i=t.getData,a=t.sourceStartIndices,o=t.targetStartIndices;if(!Array.isArray(o))return KT({source:r,target:e,size:n,getData:i}),e;for(var s=0,u=0,l=i&&function(v,m){return i(v+u,m)},f=Math.min(a.length,o.length),c=1;c<f;c++){var p=a[c]*n,d=o[c]*n;KT({source:r.subarray(s,p),target:e,start:u,end:d,size:n,getData:l}),s=p,u=d}return u<e.length&&KT({source:[],target:e,start:u,size:n,getData:l}),e}function K6(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ag(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?K6(Object(e),!0).forEach(function(n){(0,J6.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):K6(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var j_e={interpolation:{duration:0,easing:function(r){return r}},spring:{stiffness:.05,damping:.5}};function og(t,r){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});var e=t.type||"interpolation";return ag(ag(ag(ag({},j_e[e]),r),t),{},{type:e})}function sg(t,r){var e=r.getBuffer();return e?[e,{divisor:0,size:r.size,normalized:r.settings.normalized}]:r.value}function ug(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function lg(t){t.push(t.shift())}function mp(t,r){var e=t.doublePrecision,n=t.settings,i=t.value,a=t.size,o=e&&i instanceof Float64Array?2:1;return(n.noAlloc?i.length:r*a)*o}function fg(t){var r=t.buffer,e=t.numInstances,n=t.attribute,i=t.fromLength,a=t.fromStartIndices,o=t.getData,s=o===void 0?function(x){return x}:o,u=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*u,f=n.byteOffset,c=n.startIndices,p=a&&c,d=mp(n,e),v=n.isConstant;if(!(!p&&i>=d)){var m=v?n.value:n.getBuffer().getData({srcByteOffset:f});if(n.settings.normalized&&!v){var g=s;s=function(A,T){return n.normalizeConstant(g(A,T))}}var y=v?function(x,A){return s(m,A)}:function(x,A){return s(m.subarray(x,x+l),A)},_=r.getData({length:i}),b=new Float32Array(d);Y6({source:_,target:b,sourceStartIndices:a,targetStartIndices:c,size:l,getData:y}),r.byteLength<b.byteLength+f&&r.reallocate(b.byteLength+f),r.subData({data:b,offset:f})}}function cg(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=U_e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function U_e(t,r){if(t){if(typeof t=="string")return Z6(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Z6(t,r)}}function Z6(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function G_e(t){var r=z_e();return function(){var n=(0,yl.default)(t),i;if(r){var a=(0,yl.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,nz.default)(this,i)}}function z_e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _l=function(t){(0,rz.default)(e,t);var r=G_e(e);function e(n,i){var a;return(0,Q6.default)(this,e),a=r.call(this,n,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:vp}),(0,ZT.default)((0,tz.default)(a),"constant",!1),a.settings.update=i.update||(i.accessor?a._autoUpdater:void 0),Object.seal(a.settings),Object.seal(a.state),a._validateAttributeUpdaters(),a}return(0,ez.default)(e,[{key:"startIndices",get:function(){return this.state.startIndices},set:function(i){this.state.startIndices=i}},{key:"needsUpdate",value:function(){return this.state.needsUpdate}},{key:"needsRedraw",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=i.clearChangedFlags,o=a===void 0?!1:a,s=this.state.needsRedraw;return this.state.needsRedraw=s&&!o,s}},{key:"getUpdateTriggers",value:function(){var i=this.settings.accessor;return[this.id].concat(typeof i!="function"&&i||[])}},{key:"supportsTransition",value:function(){return Boolean(this.settings.transition)}},{key:"getTransitionSetting",value:function(i){if(!i||!this.supportsTransition())return null;var a=this.settings.accessor,o=this.settings.transition,s=Array.isArray(a)?i[a.find(function(u){return i[u]})]:i[a];return og(s,o)}},{key:"setNeedsUpdate",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,a=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||i,this.setNeedsRedraw(i),a){var o=a.startRow,s=o===void 0?0:o,u=a.endRow,l=u===void 0?1/0:u;this.state.updateRanges=q6(this.state.updateRanges,[s,l])}else this.state.updateRanges=vp}},{key:"clearNeedsUpdate",value:function(){this.state.needsUpdate=!1,this.state.updateRanges=X6}},{key:"setNeedsRedraw",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||i}},{key:"allocate",value:function(i){var a=this.state,o=this.settings;return o.noAlloc?!1:o.update?((0,pg.default)((0,yl.default)(e.prototype),"allocate",this).call(this,i,a.updateRanges!==vp),!0):!1}},{key:"updateBuffer",value:function(i){var a=i.numInstances,o=i.data,s=i.props,u=i.context;if(!this.needsUpdate())return!1;var l=this.state.updateRanges,f=this.settings,c=f.update,p=f.noAlloc,d=!0;if(c){var v=cg(l),m;try{for(v.s();!(m=v.n()).done;){var g=(0,JT.default)(m.value,2),y=g[0],_=g[1];c.call(u,this,{data:o,startRow:y,endRow:_,props:s,numInstances:a})}}catch(S){v.e(S)}finally{v.f()}if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else{var b=cg(l),x;try{for(b.s();!(x=b.n()).done;){var A=(0,JT.default)(x.value,2),T=A[0],O=A[1],w=Number.isFinite(T)?this.getVertexOffset(T):0,E=Number.isFinite(O)?this.getVertexOffset(O):p||!Number.isFinite(a)?this.value.length:a*this.size;(0,pg.default)((0,yl.default)(e.prototype),"updateSubBuffer",this).call(this,{startOffset:w,endOffset:E})}}catch(S){b.e(S)}finally{b.f()}}this._checkAttributeArray()}else d=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),d}},{key:"setConstantValue",value:function(i){if(i===void 0||typeof i=="function")return!1;var a=this.setData({constant:!0,value:i});return a&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}},{key:"setExternalBuffer",value:function(i){var a=this.state;return i?(this.clearNeedsUpdate(),a.lastExternalBuffer===i||(a.lastExternalBuffer=i,this.setNeedsRedraw(),this.setData(i)),!0):(a.lastExternalBuffer=null,!1)}},{key:"setBinaryValue",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=this.state,s=this.settings;if(!i)return o.binaryValue=null,o.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(o.binaryValue===i)return this.clearNeedsUpdate(),!0;o.binaryValue=i,this.setNeedsRedraw();var u=s.transform||a!==this.startIndices;if(u){ArrayBuffer.isView(i)&&(i={value:i});var l=i;rt(ArrayBuffer.isView(l.value),"invalid ".concat(s.accessor));var f=Boolean(l.size)&&l.size!==this.size;return o.binaryAccessor=ig(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:a,nested:f}),!1}return this.clearNeedsUpdate(),this.setData(i),!0}},{key:"getVertexOffset",value:function(i){var a=this.startIndices,o=a?i<a.length?a[i]:this.numInstances:i;return o*this.size}},{key:"getShaderAttributes",value:function(){var i=this.settings.shaderAttributes||(0,ZT.default)({},this.id,null),a={};for(var o in i)Object.assign(a,(0,pg.default)((0,yl.default)(e.prototype),"getShaderAttributes",this).call(this,o,i[o]));return a}},{key:"_autoUpdater",value:function(i,a){var o=a.data,s=a.startRow,u=a.endRow,l=a.props,f=a.numInstances;if(!i.constant){var c=i.settings,p=i.state,d=i.value,v=i.size,m=i.startIndices,g=c.accessor,y=c.transform,_=p.binaryAccessor||(typeof g=="function"?g:l[g]);rt(typeof _=="function",'accessor "'.concat(g,'" is not a function'));var b=i.getVertexOffset(s),x=Nt(o,s,u),A=x.iterable,T=x.objectInfo,O=cg(A),w;try{for(O.s();!(w=O.n()).done;){var E=w.value;T.index++;var S=_(E,T);if(y&&(S=y.call(this,S)),m){var I=(T.index<m.length-1?m[T.index+1]:f)-m[T.index];if(S&&Array.isArray(S[0])){var R=b,z=cg(S),G;try{for(z.s();!(G=z.n()).done;){var k=G.value;i._normalizeValue(k,d,R),R+=v}}catch(U){z.e(U)}finally{z.f()}}else S&&S.length>v?d.set(S,b):(i._normalizeValue(S,T.target,0),jm({target:d,source:T.target,start:b,count:I}));b+=I*v}else i._normalizeValue(S,d,b),b+=v}}catch(U){O.e(U)}finally{O.f()}}}},{key:"_validateAttributeUpdaters",value:function(){var i=this.settings,a=i.noAlloc||typeof i.update=="function";if(!a)throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var i=this.value,a=Math.min(4,this.size);if(i&&i.length>=a){var o=!0;switch(a){case 4:o=o&&Number.isFinite(i[3]);case 3:o=o&&Number.isFinite(i[2]);case 2:o=o&&Number.isFinite(i[1]);case 1:o=o&&Number.isFinite(i[0]);break;default:o=!1}if(!o)throw new Error("Illegal attribute generated for ".concat(this.id))}}}]),e}(H6);var mz=h(L()),gz=h(N()),fo=h(B());var sz=h(L()),uz=h(N()),En=h(B());function iz(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function V_e(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?iz(Object(e),!0).forEach(function(n){(0,En.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):iz(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function az(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=H_e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function H_e(t,r){if(t){if(typeof t=="string")return oz(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return oz(t,r)}}function oz(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var lz=function(){function t(r){var e=r.gl,n=r.attribute,i=r.timeline;(0,sz.default)(this,t),(0,En.default)(this,"gl",void 0),(0,En.default)(this,"type","interpolation"),(0,En.default)(this,"attributeInTransition",void 0),(0,En.default)(this,"settings",void 0),(0,En.default)(this,"attribute",void 0),(0,En.default)(this,"transition",void 0),(0,En.default)(this,"currentStartIndices",void 0),(0,En.default)(this,"currentLength",void 0),(0,En.default)(this,"transform",void 0),(0,En.default)(this,"buffers",void 0),this.gl=e,this.transition=new Ei(i),this.attribute=n,this.attributeInTransition=new _l(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=$_e(e,n);var a={byteLength:0,usage:35050};this.buffers=[new be(e,a),new be(e,a)]}return(0,uz.default)(t,[{key:"inProgress",get:function(){return this.transition.inProgress}},{key:"start",value:function(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;var i=this.gl,a=this.buffers,o=this.attribute;lg(a);var s={numInstances:n,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter},u=az(a),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;fg(V_e({buffer:f},s))}}catch(c){u.e(c)}finally{u.f()}this.currentStartIndices=o.startIndices,this.currentLength=mp(o,n),this.attributeInTransition.setData({buffer:a[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:a[0],aTo:sg(i,o)},feedbackBuffers:{vCurrent:a[1]}})}},{key:"update",value:function(){var e=this.transition.update();if(e){var n=this.settings,i=n.duration,a=n.easing,o=this.transition.time,s=o/i;a&&(s=a(s)),this.transform.run({uniforms:{time:s}})}return e}},{key:"cancel",value:function(){this.transition.cancel(),this.transform.delete();var e=az(this.buffers),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.buffers.length=0}}]),t}();var W_e=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function $_e(t,r){var e=ug(r.size);return new kr(t,{vs:W_e,defines:{ATTRIBUTE_TYPE:e},varyings:["vCurrent"]})}var hz=h(L()),dz=h(N()),Dr=h(B());function fz(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=X_e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function X_e(t,r){if(t){if(typeof t=="string")return cz(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return cz(t,r)}}function cz(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function pz(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function gp(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?pz(Object(e),!0).forEach(function(n){(0,Dr.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):pz(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var vz=function(){function t(r){var e=r.gl,n=r.attribute,i=r.timeline;(0,hz.default)(this,t),(0,Dr.default)(this,"gl",void 0),(0,Dr.default)(this,"type","spring"),(0,Dr.default)(this,"attributeInTransition",void 0),(0,Dr.default)(this,"settings",void 0),(0,Dr.default)(this,"attribute",void 0),(0,Dr.default)(this,"transition",void 0),(0,Dr.default)(this,"currentStartIndices",void 0),(0,Dr.default)(this,"currentLength",void 0),(0,Dr.default)(this,"texture",void 0),(0,Dr.default)(this,"framebuffer",void 0),(0,Dr.default)(this,"transform",void 0),(0,Dr.default)(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Ei(i),this.attribute=n,this.attributeInTransition=new _l(e,gp(gp({},n.settings),{},{normalized:!1})),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=Y_e(e),this.framebuffer=K_e(e,this.texture),this.transform=q_e(e,n,this.framebuffer);var a={byteLength:0,usage:35050};this.buffers=[new be(e,a),new be(e,a),new be(e,a)]}return(0,dz.default)(t,[{key:"inProgress",get:function(){return this.transition.inProgress}},{key:"start",value:function(e,n){var i=this.gl,a=this.buffers,o=this.attribute,s={numInstances:n,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter},u=fz(a),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;fg(gp({buffer:f},s))}}catch(c){u.e(c)}finally{u.f()}this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=mp(o,n),this.attributeInTransition.setData({buffer:a[1],value:o.value}),this.transition.start(gp(gp({},e),{},{duration:1/0})),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:sg(i,o)}})}},{key:"update",value:function(){var e=this.buffers,n=this.transform,i=this.framebuffer,a=this.transition,o=a.update();if(!o)return!1;var s=this.settings;n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:s.stiffness,damping:s.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),lg(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value});var u=Wn(i)[0]>0;return u||a.end(),!0}},{key:"cancel",value:function(){this.transition.cancel(),this.transform.delete();var e=fz(this.buffers),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}]),t}();function q_e(t,r,e){var n=ug(r.size);return new kr(t,{framebuffer:e,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:n},varyings:["vNext"]})}function Y_e(t){return new Se(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function K_e(t,r){return new Me(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:(0,Dr.default)({},36064,r)})}var J_e={interpolation:lz,spring:vz},yz=function(){function t(r,e){var n=e.id,i=e.timeline;(0,mz.default)(this,t),(0,fo.default)(this,"id",void 0),(0,fo.default)(this,"isSupported",void 0),(0,fo.default)(this,"gl",void 0),(0,fo.default)(this,"timeline",void 0),(0,fo.default)(this,"transitions",void 0),(0,fo.default)(this,"needsRedraw",void 0),(0,fo.default)(this,"numInstances",void 0),this.id=n,this.gl=r,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=kr.isSupported(r)}return(0,gz.default)(t,[{key:"finalize",value:function(){for(var e in this.transitions)this._removeTransition(e)}},{key:"update",value:function(e){var n=e.attributes,i=e.transitions,a=e.numInstances;this.numInstances=a||1;for(var o in n){var s=n[o],u=s.getTransitionSetting(i);u&&this._updateAttribute(o,s,u)}for(var l in this.transitions){var f=n[l];(!f||!f.getTransitionSetting(i))&&this._removeTransition(l)}}},{key:"hasAttribute",value:function(e){var n=this.transitions[e];return n&&n.inProgress}},{key:"getAttributes",value:function(){var e={};for(var n in this.transitions){var i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}},{key:"run",value:function(){if(!this.isSupported||this.numInstances===0)return!1;for(var e in this.transitions){var n=this.transitions[e].update();n&&(this.needsRedraw=!0)}var i=this.needsRedraw;return this.needsRedraw=!1,i}},{key:"_removeTransition",value:function(e){this.transitions[e].cancel(),delete this.transitions[e]}},{key:"_updateAttribute",value:function(e,n,i){var a=this.transitions[e],o=!a||a.type!==i.type;if(o){if(!this.isSupported){Z.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}a&&this._removeTransition(e);var s=J_e[i.type];s?this.transitions[e]=new s({attribute:n,timeline:this.timeline,gl:this.gl}):(Z.error("unsupported transition type '".concat(i.type,"'"))(),o=!1)}(o||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}]),t}();function _z(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function QT(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?_z(Object(e),!0).forEach(function(n){(0,ni.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):_z(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Z_e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Q_e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Q_e(t,r){if(t){if(typeof t=="string")return bz(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return bz(t,r)}}function bz(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var xz="attributeManager.invalidate",ebe="attributeManager.updateStart",tbe="attributeManager.updateEnd",rbe="attribute.updateStart",nbe="attribute.allocate",ibe="attribute.updateEnd",co=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.id,i=n===void 0?"attribute-manager":n,a=e.stats,o=e.timeline;(0,Az.default)(this,t),(0,ni.default)(this,"id",void 0),(0,ni.default)(this,"gl",void 0),(0,ni.default)(this,"attributes",void 0),(0,ni.default)(this,"updateTriggers",void 0),(0,ni.default)(this,"needsRedraw",void 0),(0,ni.default)(this,"userData",void 0),(0,ni.default)(this,"stats",void 0),(0,ni.default)(this,"attributeTransitionManager",void 0),(0,ni.default)(this,"mergeBoundsMemoized",Hr(Yj)),this.id=i,this.gl=r,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=a,this.attributeTransitionManager=new yz(r,{id:"".concat(i,"-transitions"),timeline:o}),Object.seal(this)}return(0,Tz.default)(t,[{key:"finalize",value:function(){for(var e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}},{key:"setNeedsRedraw",value:function(){this.needsRedraw=!0}},{key:"add",value:function(e){this._add(e)}},{key:"addInstanced",value:function(e){this._add(e,{instanced:1})}},{key:"remove",value:function(e){var n=Z_e(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;this.attributes[a]!==void 0&&(this.attributes[a].delete(),delete this.attributes[a])}}catch(o){n.e(o)}finally{n.f()}}},{key:"invalidate",value:function(e,n){var i=this._invalidateTrigger(e,n);Ft(xz,this,e,i)}},{key:"invalidateAll",value:function(e){for(var n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Ft(xz,this,"all")}},{key:"update",value:function(e){var n=e.data,i=e.numInstances,a=e.startIndices,o=a===void 0?null:a,s=e.transitions,u=e.props,l=u===void 0?{}:u,f=e.buffers,c=f===void 0?{}:f,p=e.context,d=p===void 0?{}:p,v=!1;Ft(ebe,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(var m in this.attributes){var g=this.attributes[m],y=g.settings.accessor;g.startIndices=o,g.numInstances=i,l[m]&&Z.removed("props.".concat(m),"data.attributes.".concat(m))(),g.setExternalBuffer(c[m])||g.setBinaryValue(typeof y=="string"?c[y]:void 0,n.startIndices)||typeof y=="string"&&!c[y]&&g.setConstantValue(l[y])||g.needsUpdate()&&(v=!0,this._updateAttribute({attribute:g,numInstances:i,data:n,props:l,context:d})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}v&&Ft(tbe,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:s})}},{key:"updateTransition",value:function(){var e=this.attributeTransitionManager,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getBounds",value:function(e){var n=this,i=e.map(function(a){var o;return(o=n.attributes[a])===null||o===void 0?void 0:o.getBounds()});return this.mergeBoundsMemoized(i)}},{key:"getChangedAttributes",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1},n=this.attributes,i=this.attributeTransitionManager,a=QT({},i.getAttributes());for(var o in n){var s=n[o];s.needsRedraw(e)&&!i.hasAttribute(o)&&(a[o]=s)}return a}},{key:"getShaderAttributes",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=this.getAttributes());var i={};for(var a in e)n[a]||Object.assign(i,e[a].getShaderAttributes());return i}},{key:"_add",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var i in e){var a=e[i];this.attributes[i]=this._createAttribute(i,a,n)}this._mapUpdateTriggersToAttributes()}},{key:"_createAttribute",value:function(e,n,i){var a=QT(QT({},n),{},{id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0});return new _l(this.gl,a)}},{key:"_mapUpdateTriggersToAttributes",value:function(){var e=this,n={},i=function(s){var u=e.attributes[s];u.getUpdateTriggers().forEach(function(l){n[l]||(n[l]=[]),n[l].push(s)})};for(var a in this.attributes)i(a);this.updateTriggers=n}},{key:"_invalidateTrigger",value:function(e,n){var i=this.attributes,a=this.updateTriggers,o=a[e];return o&&o.forEach(function(s){var u=i[s];u&&u.setNeedsUpdate(u.id,n)}),o}},{key:"_updateAttribute",value:function(e){var n=e.attribute,i=e.numInstances;if(Ft(rbe,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Ft(nbe,n,i);var a=n.updateBuffer(e);a&&(this.needsRedraw=!0,Ft(ibe,n,i))}}]),t}();var pS=h(ye()),PV=h(L()),wV=h(N()),Tl=h(_e()),OV=h(Y()),EV=h(K()),hS=h(q()),va=h(B());var Gz=h(ye()),zz=h(B()),Vz=h(L()),Hz=h(N());var Sz=h(L()),Pz=h(N()),wz=h(Y()),Oz=h(K()),eS=h(q());function abe(t){var r=obe();return function(){var n=(0,eS.default)(t),i;if(r){var a=(0,eS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Oz.default)(this,i)}}function obe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ez=function(t){(0,wz.default)(e,t);var r=abe(e);function e(){return(0,Sz.default)(this,e),r.apply(this,arguments)}return(0,Pz.default)(e,[{key:"value",get:function(){return this._value}},{key:"_onUpdate",value:function(){var i=this.time,a=this.settings,o=a.fromValue,s=a.toValue,u=a.duration,l=a.easing,f=l(i/u);this._value=nr(o,s,f)}}]),e}(Ei);var Rz=h(L()),Lz=h(N()),kz=h(Y()),Bz=h(K()),tS=h(q());function sbe(t){var r=ube();return function(){var n=(0,tS.default)(t),i;if(r){var a=(0,tS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Bz.default)(this,i)}}function ube(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Cz=1e-5;function Mz(t,r,e,n,i){var a=r-t,o=e-r,s=o*i,u=-a*n;return s+u+a+r}function lbe(t,r,e,n,i){if(Array.isArray(e)){for(var a=[],o=0;o<e.length;o++)a[o]=Mz(t[o],r[o],e[o],n,i);return a}return Mz(t,r,e,n,i)}function Iz(t,r){if(Array.isArray(t)){for(var e=0,n=0;n<t.length;n++){var i=t[n]-r[n];e+=i*i}return Math.sqrt(e)}return Math.abs(t-r)}var Fz=function(t){(0,kz.default)(e,t);var r=sbe(e);function e(){return(0,Rz.default)(this,e),r.apply(this,arguments)}return(0,Lz.default)(e,[{key:"value",get:function(){return this._currValue}},{key:"_onUpdate",value:function(){var i=this.settings,a=i.fromValue,o=i.toValue,s=i.damping,u=i.stiffness,l=this._prevValue,f=l===void 0?a:l,c=this._currValue,p=c===void 0?a:c,d=lbe(f,p,o,s,u),v=Iz(d,o),m=Iz(d,p);v<Cz&&m<Cz&&(d=o,this.end()),this._prevValue=p,this._currValue=d}}]),e}(Ei);function Dz(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=fbe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function fbe(t,r){if(t){if(typeof t=="string")return Nz(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Nz(t,r)}}function Nz(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function jz(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Uz(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?jz(Object(e),!0).forEach(function(n){(0,zz.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):jz(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var cbe={interpolation:Ez,spring:Fz},Wz=function(){function t(r){(0,Vz.default)(this,t),this.transitions=new Map,this.timeline=r}return(0,Hz.default)(t,[{key:"active",get:function(){return this.transitions.size>0}},{key:"add",value:function(e,n,i,a){var o=this.transitions;if(o.has(e)){var s=o.get(e),u=s.value,l=u===void 0?s.settings.fromValue:u;n=l,this.remove(e)}if(a=og(a),!!a){var f=cbe[a.type];if(!f){Z.error("unsupported transition type '".concat(a.type,"'"))();return}var c=new f(this.timeline);c.start(Uz(Uz({},a),{},{fromValue:n,toValue:i})),o.set(e,c)}}},{key:"remove",value:function(e){var n=this.transitions;n.has(e)&&(n.get(e).cancel(),n.delete(e))}},{key:"update",value:function(){var e={},n=Dz(this.transitions),i;try{for(n.s();!(i=n.n()).done;){var a=(0,Gz.default)(i.value,2),o=a[0],s=a[1];s.update(),e[o]=s.value,s.inProgress||this.remove(o)}}catch(u){n.e(u)}finally{n.f()}return e}},{key:"clear",value:function(){var e=Dz(this.transitions.keys()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;this.remove(i)}}catch(a){e.e(a)}finally{e.f()}}}]),t}();var rS=h(Je());function Xz(t){var r=t[Sn];for(var e in r){var n=r[e],i=n.validate;if(i&&!i(t[e],n))throw new Error("Invalid prop ".concat(e,": ").concat(t[e]))}}function qz(t,r){var e=bl({newProps:t,oldProps:r,propTypes:t[Sn],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=hbe(t,r),i=!1;return n||(i=dbe(t,r)),{dataChanged:n,propsChanged:e,updateTriggersChanged:i,extensionsChanged:vbe(t,r),transitionsChanged:pbe(t,r)}}function pbe(t,r){if(!t.transitions)return!1;var e={},n=t[Sn],i=!1;for(var a in t.transitions){var o=n[a],s=o&&o.type,u=s==="number"||s==="color"||s==="array";u&&nS(t[a],r[a],o)&&(e[a]=!0,i=!0)}return i?e:!1}function bl(t){var r=t.newProps,e=t.oldProps,n=t.ignoreProps,i=n===void 0?{}:n,a=t.propTypes,o=a===void 0?{}:a,s=t.triggerName,u=s===void 0?"props":s;if(e===r)return!1;if((0,rS.default)(r)!=="object"||r===null||(0,rS.default)(e)!=="object"||e===null)return"".concat(u," changed shallowly");for(var l=0,f=Object.keys(r);l<f.length;l++){var c=f[l];if(!(c in i)){if(!(c in e))return"".concat(u,".").concat(c," added");var p=nS(r[c],e[c],o[c]);if(p)return"".concat(u,".").concat(c," ").concat(p)}}for(var d=0,v=Object.keys(e);d<v.length;d++){var m=v[d];if(!(m in i)){if(!(m in r))return"".concat(u,".").concat(m," dropped");if(!Object.hasOwnProperty.call(r,m)){var g=nS(r[m],e[m],o[m]);if(g)return"".concat(u,".").concat(m," ").concat(g)}}}return!1}function nS(t,r,e){var n=e&&e.equal;return n&&!n(t,r,e)||!n&&(n=t&&r&&t.equals,n&&!n.call(t,r))?"changed deeply":!n&&r!==t?"changed shallowly":null}function hbe(t,r){if(r===null)return"oldProps is null, initial diff";var e=!1,n=t.dataComparator,i=t._dataDiff;return n?n(t.data,r.data)||(e="Data comparator detected a change"):t.data!==r.data&&(e="A new data container was supplied"),e&&i&&(e=i(t.data,r.data)||e),e}function dbe(t,r){if(r===null)return{all:!0};if("all"in t.updateTriggers){var e=$z(t,r,"all");if(e)return{all:!0}}var n={},i=!1;for(var a in t.updateTriggers)if(a!=="all"){var o=$z(t,r,a);o&&(n[a]=!0,i=!0)}return i?n:!1}function vbe(t,r){if(r===null)return!0;var e=r.extensions,n=t.extensions;if(n===e)return!1;if(!e||!n||n.length!==e.length)return!0;for(var i=0;i<n.length;i++)if(!n[i].equals(e[i]))return!0;return!1}function $z(t,r,e){var n=t.updateTriggers[e];n=n??{};var i=r.updateTriggers[e];i=i??{};var a=bl({oldProps:i,newProps:n,triggerName:e});return a}var iS=h(Je()),mbe="count(): argument not an object",gbe="count(): argument not a container";function hg(t){if(!_be(t))throw new Error(mbe);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(ybe(t))return Object.keys(t).length;throw new Error(gbe)}function ybe(t){return t!==null&&(0,iS.default)(t)==="object"&&t.constructor===Object}function _be(t){return t!==null&&(0,iS.default)(t)==="object"}var Kz=h(B());function Yz(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function yp(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Yz(Object(e),!0).forEach(function(n){(0,Kz.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Yz(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function da(t,r){if(!r)return t;var e=yp(yp({},t),r);if("defines"in r&&(e.defines=yp(yp({},t.defines),r.defines)),"modules"in r&&(e.modules=(t.modules||[]).concat(r.modules),r.modules.some(function(o){return o.name==="project64"}))){var n=e.modules.findIndex(function(o){return o.name==="project32"});n>=0&&e.modules.splice(n,1)}if("inject"in r)if(!t.inject)e.inject=r.inject;else{var i=yp({},t.inject);for(var a in r.inject)i[a]=(i[a]||"")+r.inject[a];e.inject=i}return e}var lV=h(L()),fV=h(N()),ws=h(B());var tV=h(Je()),rV=h(ye()),nV=h(B());var Ps=h(B());var xl;function Jz(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function _p(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Jz(Object(e),!0).forEach(function(n){(0,Ps.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Jz(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var bbe=(xl={},(0,Ps.default)(xl,10241,9987),(0,Ps.default)(xl,10240,9729),(0,Ps.default)(xl,10242,33071),(0,Ps.default)(xl,10243,33071),xl),aS={};function Zz(t,r,e){if(r instanceof Se)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});var n=null;r.compressed&&(n=(0,Ps.default)({},10241,r.data.length>1?9985:9729));var i=new Se(t,_p(_p({},r),{},{parameters:_p(_p(_p({},bbe),n),e)}));return aS[i.id]=!0,i}function Qz(t){!t||!(t instanceof Se)||aS[t.id]&&(t.delete(),delete aS[t.id])}function eV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function xp(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?eV(Object(e),!0).forEach(function(n){(0,nV.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):eV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var xbe={boolean:{validate:function(r,e){return!0},equal:function(r,e,n){return Boolean(r)===Boolean(e)}},number:{validate:function(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate:function(r,e){return e.optional&&!r||oS(r)&&(r.length===3||r.length===4)},equal:function(r,e,n){return It(r,e,1)}},accessor:{validate:function(r,e){var n=dg(r);return n==="function"||n===dg(e.value)},equal:function(r,e,n){return typeof e=="function"?!0:It(r,e,1)}},array:{validate:function(r,e){return e.optional&&!r||oS(r)},equal:function(r,e,n){var i=n.compare,a=Number.isInteger(i)?i:i?1:0;return i?It(r,e,a):r===e}},object:{equal:function(r,e,n){if(n.ignore)return!0;var i=n.compare,a=Number.isInteger(i)?i:i?1:0;return i?It(r,e,a):r===e}},function:{validate:function(r,e){return e.optional&&!r||typeof r=="function"},equal:function(r,e,n){var i=!n.compare&&n.ignore!==!1;return i||r===e}},data:{transform:function(r,e,n){var i=n.props.dataTransform;return i&&r?i(r):r}},image:{transform:function(r,e,n){var i=n.context;return!i||!i.gl?null:Zz(i.gl,r,xp(xp({},e.parameters),n.props.textureParameters))},release:function(r){Qz(r)}}};function iV(t){for(var r={},e={},n={},i=0,a=Object.entries(t);i<a.length;i++){var o=(0,rV.default)(a[i],2),s=o[0],u=o[1],l=u?.deprecatedFor;if(l)n[s]=Array.isArray(l)?l:[l];else{var f=Abe(s,u);r[s]=f,e[s]=f.value}}return{propTypes:r,defaultProps:e,deprecatedProps:n}}function Abe(t,r){switch(dg(r)){case"object":return bp(t,r);case"array":return bp(t,{type:"array",value:r,compare:!1});case"boolean":return bp(t,{type:"boolean",value:r});case"number":return bp(t,{type:"number",value:r});case"function":return bp(t,{type:"function",value:r,compare:!0});default:return{name:t,type:"unknown",value:r}}}function bp(t,r){return"type"in r?xp(xp({name:t},xbe[r.type]),r):"value"in r?xp({name:t,type:dg(r.value)},r):{name:t,type:"object",value:r}}function oS(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function dg(t){return oS(t)?"array":t===null?"null":(0,tV.default)(t)}function uS(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Tbe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Tbe(t,r){if(t){if(typeof t=="string")return aV(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return aV(t,r)}}function aV(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function oV(t,r){for(var e,n=r.length-1;n>=0;n--){var i=r[n];"extensions"in i&&(e=i.extensions)}var a=sS(t.constructor,e),o=Object.create(a);o[ll]=t,o[Pi]={},o[Qn]={};for(var s=0;s<r.length;++s){var u=r[s];for(var l in u)o[l]=u[l]}return Object.freeze(o),o}var Sbe="_mergedDefaultProps";function sS(t,r){var e=Sbe;if(r){var n=uS(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.constructor;o&&(e+=":".concat(o.extensionName||o.name))}}catch(u){n.e(u)}finally{n.f()}}var s=sV(t,e);return s||(t[e]=Pbe(t,r||[]))}function Pbe(t,r){var e=t.prototype;if(!e)return null;var n=Object.getPrototypeOf(t),i=sS(n),a=sV(t,"defaultProps")||{},o=iV(a),s=Object.assign(Object.create(null),i,o.defaultProps),u=Object.assign(Object.create(null),i?.[Sn],o.propTypes),l=Object.assign(Object.create(null),i?.[Nm],o.deprecatedProps),f=uS(r),c;try{for(f.s();!(c=f.n()).done;){var p=c.value,d=sS(p.constructor);d&&(Object.assign(s,d),Object.assign(u,d[Sn]),Object.assign(l,d[Nm]))}}catch(v){f.e(v)}finally{f.f()}return wbe(s,t),Ebe(s,u),Obe(s,l),s[Sn]=u,s[Nm]=l,r.length===0&&!lS(t,"_propTypes")&&(t._propTypes=u),s}function wbe(t,r){var e=Mbe(r);Object.defineProperties(t,{id:{writable:!0,value:e}})}function Obe(t,r){var e=function(a){Object.defineProperty(t,a,{enumerable:!1,set:function(s){var u="".concat(this.id,": ").concat(a),l=uS(r[a]),f;try{for(l.s();!(f=l.n()).done;){var c=f.value;lS(this,c)||(this[c]=s)}}catch(p){l.e(p)}finally{l.f()}Z.deprecated(u,r[a].join("/"))()}})};for(var n in r)e(n)}function Ebe(t,r){var e={},n={};for(var i in r){var a=r[i],o=a.name,s=a.value;a.async&&(e[o]=s,n[o]=Cbe(o))}t[ua]=e,t[Pi]={},Object.defineProperties(t,n)}function Cbe(t){return{enumerable:!0,set:function(e){typeof e=="string"||e instanceof Promise||ng(e)?this[Pi][t]=e:this[Qn][t]=e},get:function(){if(this[Qn]){if(t in this[Qn]){var e=this[Qn][t];return e||this[ua][t]}if(t in this[Pi]){var n=this[ll]&&this[ll].internalState;if(n&&n.hasAsyncProp(t))return n.getAsyncProp(t)||this[ua][t]}}return this[ua][t]}}}function lS(t,r){return Object.prototype.hasOwnProperty.call(t,r)}function sV(t,r){return lS(t,r)&&t[r]}function Mbe(t){var r=t.componentName;return r||Z.warn("".concat(t.name,".componentName not specified"))(),r||t.name}function uV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function fS(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?uV(Object(e),!0).forEach(function(n){(0,ws.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):uV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Ibe=0,vg=function(){function t(){(0,lV.default)(this,t),(0,ws.default)(this,"id",void 0),(0,ws.default)(this,"props",void 0),(0,ws.default)(this,"count",void 0);for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];this.props=oV(this,e),this.id=this.props.id,this.count=Ibe++}return(0,fV.default)(t,[{key:"clone",value:function(e){var n=this.props,i={};for(var a in n[ua])a in n[Qn]?i[a]=n[Qn][a]:a in n[Pi]&&(i[a]=n[Pi][a]);return new this.constructor(fS(fS(fS({},n),i),e))}}]),t}();(0,ws.default)(vg,"componentName","Component");(0,ws.default)(vg,"defaultProps",{});var mV=h(L()),gV=h(N()),ii=h(_e()),yV=h(Oe()),_V=h(Y()),bV=h(K()),mg=h(q()),ai=h(B());var cV=h(ge()),pV=h(L()),hV=h(N()),Al=h(B()),dV=h(Ld()),cS=h(de());var Rbe=Object.freeze({}),vV=function(){function t(r){(0,pV.default)(this,t),(0,Al.default)(this,"component",void 0),(0,Al.default)(this,"onAsyncPropUpdated",void 0),(0,Al.default)(this,"asyncProps",void 0),(0,Al.default)(this,"oldProps",void 0),(0,Al.default)(this,"oldAsyncProps",void 0),this.component=r,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=null,this.oldAsyncProps=null}return(0,hV.default)(t,[{key:"finalize",value:function(){for(var e in this.asyncProps){var n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}},{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps||Rbe}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}},{key:"hasAsyncProp",value:function(e){return e in this.asyncProps}},{key:"getAsyncProp",value:function(e){var n=this.asyncProps[e];return n&&n.resolvedValue}},{key:"isAsyncPropLoading",value:function(e){if(e){var n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(var i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}},{key:"reloadAsyncProp",value:function(e,n){this._watchPromise(e,Promise.resolve(n))}},{key:"setAsyncProps",value:function(e){this.component=e[ll]||this.component;var n=e[Qn]||{},i=e[Pi]||e,a=e[ua]||{};for(var o in n){var s=n[o];this._createAsyncPropData(o,a[o]),this._updateAsyncProp(o,s),n[o]=this.getAsyncProp(o)}for(var u in i){var l=i[u];this._createAsyncPropData(u,a[u]),this._updateAsyncProp(u,l)}}},{key:"_fetch",value:function(e,n){return null}},{key:"_onResolve",value:function(e,n){}},{key:"_onError",value:function(e,n){}},{key:"_updateAsyncProp",value:function(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(ng(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}},{key:"_freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(var e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}},{key:"_didAsyncInputValueChange",value:function(e,n){var i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}},{key:"_setPropValue",value:function(e,n){this._freezeAsyncOldProps();var i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}},{key:"_setAsyncPropValue",value:function(e,n,i){var a=this.asyncProps[e];a&&i>=a.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),a.resolvedValue=n,a.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}},{key:"_watchPromise",value:function(e,n){var i=this,a=this.asyncProps[e];if(a){a.pendingLoadCount++;var o=a.pendingLoadCount;n.then(function(s){i.component&&(s=i._postProcessValue(a,s),i._setAsyncPropValue(e,s,o),i._onResolve(e,s))}).catch(function(s){i._onError(e,s)})}}},{key:"_resolveAsyncIterable",value:function(){var r=(0,cV.default)(cS.default.mark(function n(i,a){var o,s,u,l,f,c,p,d,v,m,g;return cS.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(i==="data"){_.next=3;break}return this._setPropValue(i,a),_.abrupt("return");case 3:if(o=this.asyncProps[i],o){_.next=6;break}return _.abrupt("return");case 6:o.pendingLoadCount++,s=o.pendingLoadCount,u=[],l=0,f=!1,c=!1,_.prev=12,d=(0,dV.default)(a);case 14:return _.next=16,d.next();case 16:if(!(f=!(v=_.sent).done)){_.next=28;break}if(m=v.value,this.component){_.next=20;break}return _.abrupt("return");case 20:g=this.component.props.dataTransform,g?u=g(m,u):u=u.concat(m),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:l,endRow:u.length}]}),l=u.length,this._setAsyncPropValue(i,u,s);case 25:f=!1,_.next=14;break;case 28:_.next=34;break;case 30:_.prev=30,_.t0=_.catch(12),c=!0,p=_.t0;case 34:if(_.prev=34,_.prev=35,!(f&&d.return!=null)){_.next=39;break}return _.next=39,d.return();case 39:if(_.prev=39,!c){_.next=42;break}throw p;case 42:return _.finish(39);case 43:return _.finish(34);case 44:this._onResolve(i,u);case 45:case"end":return _.stop()}},n,this,[[12,30,34,44],[35,,39,43]])}));function e(n,i){return r.apply(this,arguments)}return e}()},{key:"_postProcessValue",value:function(e,n){var i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}},{key:"_createAsyncPropData",value:function(e,n){var i=this.asyncProps[e];if(!i){var a=this.component&&this.component.props[Sn];this.asyncProps[e]={type:a&&a[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}]),t}();function Lbe(t){var r=kbe();return function(){var n=(0,mg.default)(t),i;if(r){var a=(0,mg.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,bV.default)(this,i)}}function kbe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xV=function(t){(0,_V.default)(e,t);var r=Lbe(e);function e(n){var i,a=n.attributeManager,o=n.layer;return(0,mV.default)(this,e),i=r.call(this,o),(0,ai.default)((0,ii.default)(i),"attributeManager",void 0),(0,ai.default)((0,ii.default)(i),"needsRedraw",void 0),(0,ai.default)((0,ii.default)(i),"needsUpdate",void 0),(0,ai.default)((0,ii.default)(i),"subLayers",void 0),(0,ai.default)((0,ii.default)(i),"usesPickingColorCache",void 0),(0,ai.default)((0,ii.default)(i),"hasPickingBuffer",void 0),(0,ai.default)((0,ii.default)(i),"changeFlags",void 0),(0,ai.default)((0,ii.default)(i),"viewport",void 0),(0,ai.default)((0,ii.default)(i),"uniformTransitions",void 0),(0,ai.default)((0,ii.default)(i),"propsInTransition",void 0),i.attributeManager=a,i.needsRedraw=!0,i.needsUpdate=!0,i.subLayers=null,i.usesPickingColorCache=!1,i}return(0,gV.default)(e,[{key:"layer",get:function(){return this.component}},{key:"_fetch",value:function(i,a){var o=this.layer,s=o?.props.fetch;return s?s(a,{propName:i,layer:o}):(0,yV.default)((0,mg.default)(e.prototype),"_fetch",this).call(this,i,a)}},{key:"_onResolve",value:function(i,a){var o=this.layer;if(o){var s=o.props.onDataLoad;i==="data"&&s&&s(a,{propName:i,layer:o})}}},{key:"_onError",value:function(i,a){var o=this.layer;o&&o.raiseError(a,"loading ".concat(i," of ").concat(this.layer))}}]),e}(vV);function oi(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Bbe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Bbe(t,r){if(t){if(typeof t=="string")return AV(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return AV(t,r)}}function AV(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Fbe(t){var r=Dbe();return function(){var n=(0,hS.default)(t),i;if(r){var a=(0,hS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,EV.default)(this,i)}}function Dbe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function TV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ap(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?TV(Object(e),!0).forEach(function(n){(0,va.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):TV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Nbe="layer.changeFlag",jbe="layer.initialize",Ube="layer.update",Gbe="layer.finalize",zbe="layer.matched",SV=Math.pow(2,24)-1,Vbe=Object.freeze([]),Hbe=Hr(function(t){var r=t.oldViewport,e=t.viewport;return r.equals(e)}),Ri=new Uint8ClampedArray(0),Wbe={data:{type:"data",value:Vbe,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:function(r){return r&&r.__diff},optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:function(r,e){var n=e.propName,i=e.layer,a=e.loaders,o=e.loadOptions,s=e.signal,u=i.context.resourceManager;if(o=o||i.getLoadOptions(),a=a||i.props.loaders,s){var l;o=Ap(Ap({},o),{},{fetch:Ap(Ap({},(l=o)===null||l===void 0?void 0:l.fetch),{},{signal:s})})}var f=u.contains(r);return!f&&!o&&(u.add({resourceId:r,data:qt(r,a),persistent:!1}),f=!0),f?u.subscribe({resourceId:r,onChange:function(p){var d;return(d=i.internalState)===null||d===void 0?void 0:d.reloadAsyncProp(n,p)},consumerId:i.id,requestId:n}):qt(r,a,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:se.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:function(r){var e=r.layerIndex;return[0,-e*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},Ve=function(t){(0,OV.default)(e,t);var r=Fbe(e);function e(){var n;(0,PV.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,va.default)((0,Tl.default)(n),"internalState",null),(0,va.default)((0,Tl.default)(n),"lifecycle",so.NO_STATE),(0,va.default)((0,Tl.default)(n),"context",void 0),(0,va.default)((0,Tl.default)(n),"state",void 0),(0,va.default)((0,Tl.default)(n),"parent",null),n}return(0,wV.default)(e,[{key:"root",get:function(){for(var i=this;i.parent;)i=i.parent;return i}},{key:"toString",value:function(){var i=this.constructor.layerName||this.constructor.name;return"".concat(i,"({id: '").concat(this.props.id,"'})")}},{key:"project",value:function(i){rt(this.internalState);var a=this.internalState.viewport||this.context.viewport,o=gT(i,{viewport:a,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),s=vs(o,a.pixelProjectionMatrix),u=(0,pS.default)(s,3),l=u[0],f=u[1],c=u[2];return i.length===2?[l,f]:[l,f,c]}},{key:"unproject",value:function(i){rt(this.internalState);var a=this.internalState.viewport||this.context.viewport;return a.unproject(i)}},{key:"projectPosition",value:function(i,a){rt(this.internalState);var o=this.internalState.viewport||this.context.viewport;return Lm(i,Ap({viewport:o,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem},a))}},{key:"isComposite",get:function(){return!1}},{key:"setState",value:function(i){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,i),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){this.internalState&&(this.internalState.needsRedraw=!0)}},{key:"setNeedsUpdate",value:function(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}},{key:"isLoaded",get:function(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}},{key:"wrapLongitude",get:function(){return this.props.wrapLongitude}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}},{key:"setModuleParameters",value:function(i){var a=oi(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.updateModuleSettings(i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getLoadOptions",value:function(){return this.props.loadOptions}},{key:"use64bitPositions",value:function(){var i=this.props.coordinateSystem;return i===se.DEFAULT||i===se.LNGLAT||i===se.CARTESIAN}},{key:"onHover",value:function(i,a){return this.props.onHover&&this.props.onHover(i,a)||!1}},{key:"onClick",value:function(i,a){return this.props.onClick&&this.props.onClick(i,a)||!1}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return a[0]=i+1&255,a[1]=i+1>>8&255,a[2]=i+1>>8>>8&255,a}},{key:"decodePickingColor",value:function(i){rt(i instanceof Uint8Array);var a=(0,pS.default)(i,3),o=a[0],s=a[1],u=a[2],l=o+s*256+u*65536-1;return l}},{key:"getNumInstances",value:function(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:hg(this.props.data)}},{key:"getStartIndices",value:function(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}},{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["positions","instancePositions"])}},{key:"getShaders",value:function(i){var a=oi(this.props.extensions),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;i=da(i,s.getShaders.call(this,s))}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"shouldUpdateState",value:function(i){return i.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(i){var a=this,o=this.getAttributeManager(),s=i.changeFlags.dataChanged;if(s&&o)if(Array.isArray(s)){var u=oi(s),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;o.invalidateAll(f)}}catch(_){u.e(_)}finally{u.f()}}else o.invalidateAll();if(o){var c=i.props,p=this.internalState.hasPickingBuffer,d=Number.isInteger(c.highlightedObjectIndex)||c.pickable||c.extensions.some(function(_){return _.getNeedsPickingBuffer.call(a,_)});if(p!==d){this.internalState.hasPickingBuffer=d;var v=o.attributes,m=v.pickingColors,g=v.instancePickingColors,y=m||g;y&&(d&&y.constant&&(y.constant=!1,o.invalidate(y.id)),!y.value&&!d&&(y.constant=!0,y.value=[0,0,0]))}}}},{key:"finalizeState",value:function(i){var a=oi(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.delete()}}catch(l){a.e(l)}finally{a.f()}var u=this.getAttributeManager();u&&u.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}},{key:"draw",value:function(i){var a=oi(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.draw(i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"getPickingInfo",value:function(i){var a=i.info,o=i.mode,s=i.sourceLayer,u=a.index;return u>=0&&Array.isArray(this.props.data)&&(a.object=this.props.data[u]),a}},{key:"raiseError",value:function(i,a){var o,s;if(a&&(i.message="".concat(a,": ").concat(i.message)),!((o=(s=this.props).onError)!==null&&o!==void 0&&o.call(s,i))){var u,l;(u=this.context)===null||u===void 0||(l=u.onError)===null||l===void 0||l.call(u,i,this)}}},{key:"getNeedsRedraw",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(i)}},{key:"needsUpdate",value:function(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}},{key:"hasUniformTransition",value:function(){var i;return((i=this.internalState)===null||i===void 0?void 0:i.uniformTransitions.active)||!1}},{key:"activateViewport",value:function(i){if(this.internalState){var a=this.internalState.viewport;this.internalState.viewport=i,(!a||!Hbe({oldViewport:a,viewport:i}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}}},{key:"invalidateAttribute",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all",a=this.getAttributeManager();a&&(i==="all"?a.invalidateAll():a.invalidate(i))}},{key:"updateAttributes",value:function(i){var a=oi(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;this._setModelAttributes(s,i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"_updateAttributes",value:function(){var i=this.getAttributeManager();if(i){var a=this.props,o=this.getNumInstances(),s=this.getStartIndices();i.update({data:a.data,numInstances:o,startIndices:s,props:a,transitions:a.transitions,buffers:a.data.attributes,context:this});var u=i.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}}},{key:"_updateAttributeTransition",value:function(){var i=this.getAttributeManager();i&&i.updateTransition()}},{key:"_updateUniformTransition",value:function(){var i=this.internalState.uniformTransitions;if(i.active){var a=i.update(),o=Object.create(this.props);for(var s in a)Object.defineProperty(o,s,{value:a[s]});return o}return this.props}},{key:"calculateInstancePickingColors",value:function(i,a){var o=a.numInstances;if(!i.constant){var s=Math.floor(Ri.length/3);if(this.internalState.usesPickingColorCache=!0,s<o){o>SV&&Z.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ri=Kn.allocate(Ri,o,{size:3,copy:!0,maxCount:Math.max(o,SV)});for(var u=Math.floor(Ri.length/3),l=[],f=s;f<u;f++)this.encodePickingColor(f,l),Ri[f*3+0]=l[0],Ri[f*3+1]=l[1],Ri[f*3+2]=l[2]}i.value=Ri.subarray(0,o*3)}}},{key:"_setModelAttributes",value:function(i,a){var o=this.getAttributeManager(),s=i.userData.excludeAttributes||{},u=o.getShaderAttributes(a,s);i.setAttributes(u)}},{key:"disablePickingIndex",value:function(i){var a=this.props.data;if(!("attributes"in a)){this._disablePickingIndex(i);return}var o=this.getAttributeManager().attributes,s=o.pickingColors,u=o.instancePickingColors,l=s||u,f=l&&a.attributes&&a.attributes[l.id];if(f&&f.value)for(var c=f.value,p=this.encodePickingColor(i),d=0;d<a.length;d++){var v=l.getVertexOffset(d);c[v]===p[0]&&c[v+1]===p[1]&&c[v+2]===p[2]&&this._disablePickingIndex(d)}else this._disablePickingIndex(i)}},{key:"_disablePickingIndex",value:function(i){var a=this.getAttributeManager().attributes,o=a.pickingColors,s=a.instancePickingColors,u=o||s;if(u){var l=u.getVertexOffset(i),f=u.getVertexOffset(i+1);u.buffer.subData({data:new Uint8Array(f-l),offset:l})}}},{key:"restorePickingColors",value:function(){var i=this.getAttributeManager().attributes,a=i.pickingColors,o=i.instancePickingColors,s=a||o;s&&(this.internalState.usesPickingColorCache&&s.value.buffer!==Ri.buffer&&(s.value=Ri.subarray(0,s.value.length)),s.updateSubBuffer({startOffset:0}))}},{key:"_initialize",value:function(){rt(!this.internalState),rt(Number.isFinite(this.props.coordinateSystem)),Ft(jbe,this);var i=this._getAttributeManager();i&&i.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new xV({attributeManager:i,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:function(){return Z.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),i}}),this.internalState.uniformTransitions=new Wz(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);var a=oi(this.props.extensions),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.initializeState.call(this,this.context,s)}}catch(u){a.e(u)}finally{a.f()}this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}},{key:"_transferState",value:function(i){Ft(zbe,this,this===i);var a=i.state,o=i.internalState;this!==i&&(this.internalState=o,this.state=a,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}},{key:"_update",value:function(){var i=this.needsUpdate();if(Ft(Ube,this,i),!!i){var a=this.props,o=this.context,s=this.internalState,u=o.viewport,l=this._updateUniformTransition();s.propsInTransition=l,o.viewport=s.viewport||u,this.props=l;try{var f=this._getUpdateParams(),c=this.getModels();if(o.gl)this.updateState(f);else try{this.updateState(f)}catch{}var p=oi(this.props.extensions),d;try{for(p.s();!(d=p.n()).done;){var v=d.value;v.updateState.call(this,f,v)}}catch(g){p.e(g)}finally{p.f()}var m=this.getModels()[0]!==c[0];this._postUpdate(f,m)}finally{o.viewport=u,this.props=a,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}}},{key:"_finalize",value:function(){Ft(Gbe,this),this.finalizeState(this.context);var i=oi(this.props.extensions),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.finalizeState.call(this,this.context,o)}}catch(s){i.e(s)}finally{i.f()}}},{key:"_drawLayer",value:function(i){var a=this,o=i.moduleParameters,s=o===void 0?null:o,u=i.uniforms,l=u===void 0?{}:u,f=i.parameters,c=f===void 0?{}:f;this._updateAttributeTransition();var p=this.props,d=this.context;this.props=this.internalState.propsInTransition||p;var v=this.props.opacity;l.opacity=Math.pow(v,1/2.2);try{s&&this.setModuleParameters(s);var m=this.props.getPolygonOffset,g=m&&m(l)||[0,0];Gt(d.gl,{polygonOffset:g}),Ie(d.gl,c,function(){var y={moduleParameters:s,uniforms:l,parameters:c,context:d},_=oi(a.props.extensions),b;try{for(_.s();!(b=_.n()).done;){var x=b.value;x.draw.call(a,y,x)}}catch(A){_.e(A)}finally{_.f()}a.draw(y)})}finally{this.props=p}}},{key:"getChangeFlags",value:function(){var i;return(i=this.internalState)===null||i===void 0?void 0:i.changeFlags}},{key:"setChangeFlags",value:function(i){if(this.internalState){var a=this.internalState.changeFlags;for(var o in i)if(i[o]){var s=!1;switch(o){case"dataChanged":var u=i[o],l=a[o];u&&Array.isArray(l)&&(a.dataChanged=Array.isArray(u)?l.concat(u):u,s=!0);default:a[o]||(a[o]=i[o],s=!0)}s&&Ft(Nbe,this,o,i)}var f=Boolean(a.dataChanged||a.updateTriggersChanged||a.propsChanged||a.extensionsChanged);a.propsOrDataChanged=f,a.somethingChanged=f||a.viewportChanged||a.stateChanged}}},{key:"_clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"_diffProps",value:function(i,a){var o=qz(i,a);if(o.updateTriggersChanged)for(var s in o.updateTriggersChanged)o.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(o.transitionsChanged)for(var u in o.transitionsChanged){var l;this.internalState.uniformTransitions.add(u,a[u],i[u],(l=i.transitions)===null||l===void 0?void 0:l[u])}return this.setChangeFlags(o)}},{key:"validateProps",value:function(){Xz(this.props)}},{key:"updateAutoHighlight",value:function(i){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(i)}},{key:"_updateAutoHighlight",value:function(i){var a={pickingSelectedColor:i.picked?i.color:null},o=this.props.highlightColor;i.picked&&typeof o=="function"&&(a.pickingHighlightColor=o(i)),this.setModuleParameters(a),this.setNeedsRedraw()}},{key:"_getAttributeManager",value:function(){var i=this.context;return new co(i.gl,{id:this.props.id,stats:i.stats,timeline:i.timeline})}},{key:"_postUpdate",value:function(i,a){var o=i.props,s=i.oldProps;this.setNeedsRedraw(),this._updateAttributes();var u=this.state.model;u?.setInstanceCount(this.getNumInstances());var l=o.autoHighlight,f=o.highlightedObjectIndex,c=o.highlightColor;if(a||s.autoHighlight!==l||s.highlightedObjectIndex!==f||s.highlightColor!==c){var p={};l||(p.pickingSelectedColor=null),Array.isArray(c)&&(p.pickingHighlightColor=c),(a||f!==s.highlightedObjectIndex)&&(p.pickingSelectedColor=Number.isFinite(f)&&f>=0?this.encodePickingColor(f):null),this.setModuleParameters(p)}}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(i){if(!this.internalState)return!1;var a=!1;a=a||this.internalState.needsRedraw&&this.id;var o=this.getAttributeManager(),s=o?o.getNeedsRedraw(i):!1;if(a=a||s,a){var u=oi(this.props.extensions),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;f.onNeedsRedraw.call(this,f)}}catch(c){u.e(c)}finally{u.f()}}return this.internalState.needsRedraw=this.internalState.needsRedraw&&!i.clearRedrawFlags,a}},{key:"_onAsyncPropUpdated",value:function(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}],[{key:"componentName",get:function(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}}]),e}(vg);(0,va.default)(Ve,"defaultProps",Wbe);(0,va.default)(Ve,"layerName","Layer");var RV=h(L()),LV=h(N()),vS=h(Oe()),kV=h(Y()),BV=h(K()),Tp=h(q()),mS=h(B());function dS(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=$be(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function $be(t,r){if(t){if(typeof t=="string")return CV(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return CV(t,r)}}function CV(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function MV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function IV(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?MV(Object(e),!0).forEach(function(n){(0,mS.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):MV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Xbe(t){var r=qbe();return function(){var n=(0,Tp.default)(t),i;if(r){var a=(0,Tp.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,BV.default)(this,i)}}function qbe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ybe="compositeLayer.renderLayers",St=function(t){(0,kV.default)(e,t);var r=Xbe(e);function e(){return(0,RV.default)(this,e),r.apply(this,arguments)}return(0,LV.default)(e,[{key:"isComposite",get:function(){return!0}},{key:"isLoaded",get:function(){return(0,vS.default)((0,Tp.default)(e.prototype),"isLoaded",this)&&this.getSubLayers().every(function(i){return i.isLoaded})}},{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(i){}},{key:"setState",value:function(i){(0,vS.default)((0,Tp.default)(e.prototype),"setState",this).call(this,i),this.setNeedsUpdate()}},{key:"getPickingInfo",value:function(i){var a=i.info,o=a.object,s=o&&o.__source&&o.__source.parent&&o.__source.parent.id===this.id;return s&&(a.object=o.__source.object,a.index=o.__source.index),a}},{key:"filterSubLayer",value:function(i){return!0}},{key:"shouldRenderSubLayer",value:function(i,a){return a&&a.length}},{key:"getSubLayerClass",value:function(i,a){var o=this.props._subLayerProps;return o&&o[i]&&o[i].type||a}},{key:"getSubLayerRow",value:function(i,a,o){return i.__source={parent:this,object:a,index:o},i}},{key:"getSubLayerAccessor",value:function(i){if(typeof i=="function"){var a={index:-1,data:this.props.data,target:[]};return function(o,s){return o&&o.__source?(a.index=o.__source.index,i(o.__source.object,a)):i(o,s)}}return i}},{key:"getSubLayerProps",value:function(){var i,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=this.props,s=o.opacity,u=o.pickable,l=o.visible,f=o.parameters,c=o.getPolygonOffset,p=o.highlightedObjectIndex,d=o.autoHighlight,v=o.highlightColor,m=o.coordinateSystem,g=o.coordinateOrigin,y=o.wrapLongitude,_=o.positionFormat,b=o.modelMatrix,x=o.extensions,A=o.fetch,T=o.operation,O=o._subLayerProps,w={id:"",updateTriggers:{},opacity:s,pickable:u,visible:l,parameters:f,getPolygonOffset:c,highlightedObjectIndex:p,autoHighlight:d,highlightColor:v,coordinateSystem:m,coordinateOrigin:g,wrapLongitude:y,positionFormat:_,modelMatrix:b,extensions:x,fetch:A,operation:T},E=O&&a.id&&O[a.id],S=E&&E.updateTriggers,I=a.id||"sublayer";if(E){var R=this.props[Sn],z=a.type?a.type._propTypes:{};for(var G in E){var k=z[G]||R[G];k&&k.type==="accessor"&&(E[G]=this.getSubLayerAccessor(E[G]))}}Object.assign(w,a,E),w.id="".concat(this.props.id,"-").concat(I),w.updateTriggers=IV(IV({all:(i=this.props.updateTriggers)===null||i===void 0?void 0:i.all},a.updateTriggers),S);var U=dS(x),j;try{for(U.s();!(j=U.n()).done;){var X=j.value,H=X.getSubLayerProps.call(this,X);H&&Object.assign(w,H,{updateTriggers:Object.assign(w.updateTriggers,H.updateTriggers)})}}catch(Q){U.e(Q)}finally{U.f()}return w}},{key:"_updateAutoHighlight",value:function(i){var a=dS(this.getSubLayers()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.updateAutoHighlight(i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"_getAttributeManager",value:function(){return null}},{key:"_postUpdate",value:function(i,a){var o=this.internalState.subLayers,s=!o||this.needsUpdate();if(s){var u=this.renderLayers();o=Br(u,Boolean),this.internalState.subLayers=o}Ft(Ybe,this,s,o);var l=dS(o),f;try{for(l.s();!(f=l.n()).done;){var c=f.value;c.parent=this}}catch(p){l.e(p)}finally{l.f()}}}]),e}(Ve);(0,mS.default)(St,"layerName","CompositeLayer");var Sp=h(ye()),jV=h(L()),UV=h(N()),yg=h(_e()),GV=h(Y()),zV=h(K()),yS=h(q()),Pp=h(B());function FV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function DV(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?FV(Object(e),!0).forEach(function(n){(0,Pp.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):FV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Kbe(t){var r=Jbe();return function(){var n=(0,yS.default)(t),i;if(r){var a=(0,yS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,zV.default)(this,i)}}function Jbe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gg=Math.PI/180,NV=180/Math.PI,_g=6370972,Sl=256;function Zbe(){var t=Sl/_g,r=Math.PI/180*Sl;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[r,r,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/r,1/r,1/t]}}var Pl=function(t){(0,GV.default)(e,t);var r=Kbe(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,jV.default)(this,e);var a=i.latitude,o=a===void 0?0:a,s=i.longitude,u=s===void 0?0:s,l=i.zoom,f=l===void 0?0:l,c=i.nearZMultiplier,p=c===void 0?.1:c,d=i.farZMultiplier,v=d===void 0?2:d,m=i.resolution,g=m===void 0?10:m,y=i.height,_=i.altitude,b=_===void 0?1.5:_;y=y||1,b=Math.max(.75,b);var x=new ce().lookAt({eye:[0,-b,0],up:[0,0,1]}),A=Math.pow(2,f);x.rotateX(o*gg),x.rotateZ(-u*gg),x.scale(A/y);var T=Math.atan(.5/b),O=Sl*2*A/y;return n=r.call(this,DV(DV({},i),{},{height:y,viewMatrix:x,longitude:u,latitude:o,zoom:f,distanceScales:Zbe(),fovyRadians:T*2,focalDistance:b,near:p,far:Math.min(2,1/O+1)*b*v})),(0,Pp.default)((0,yg.default)(n),"longitude",void 0),(0,Pp.default)((0,yg.default)(n),"latitude",void 0),(0,Pp.default)((0,yg.default)(n),"resolution",void 0),n.latitude=o,n.longitude=u,n.resolution=g,n}return(0,UV.default)(e,[{key:"projectionMode",get:function(){return _r.GLOBE}},{key:"getDistanceScales",value:function(){return this.distanceScales}},{key:"getBounds",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a={targetZ:i.z||0},o=this.unproject([0,this.height/2],a),s=this.unproject([this.width/2,0],a),u=this.unproject([this.width,this.height/2],a),l=this.unproject([this.width/2,this.height],a);return u[0]<this.longitude&&(u[0]+=360),o[0]>this.longitude&&(o[0]-=360),[Math.min(o[0],u[0],s[0],l[0]),Math.min(o[1],u[1],s[1],l[1]),Math.max(o[0],u[0],s[0],l[0]),Math.max(o[1],u[1],s[1],l[1])]}},{key:"unproject",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a.topLeft,s=o===void 0?!0:o,u=a.targetZ,l=(0,Sp.default)(i,3),f=l[0],c=l[1],p=l[2],d=s?c:this.height-c,v=this.pixelUnprojectionMatrix,m;if(Number.isFinite(p))m=gS(v,[f,d,p,1]);else{var g=gS(v,[f,d,-1,1]),y=gS(v,[f,d,1,1]),_=((u||0)/_g+1)*Sl,b=Im(Mm([],g,y)),x=Im(g),A=Im(y),T=(4*x*A-Math.pow(b-x-A,2))/16,O=4*T/b,w=Math.sqrt(x-O),E=Math.sqrt(Math.max(0,_*_-O)),S=(w-E)/Math.sqrt(b);m=a4([],g,y,S)}var I=this.unprojectPosition(m),R=(0,Sp.default)(I,3),z=R[0],G=R[1],k=R[2];return Number.isFinite(p)?[z,G,k]:Number.isFinite(u)?[z,G,u]:[z,G]}},{key:"projectPosition",value:function(i){var a=(0,Sp.default)(i,3),o=a[0],s=a[1],u=a[2],l=u===void 0?0:u,f=o*gg,c=s*gg,p=Math.cos(c),d=(l/_g+1)*Sl;return[Math.sin(f)*p*d,-Math.cos(f)*p*d,Math.sin(c)*d]}},{key:"unprojectPosition",value:function(i){var a=(0,Sp.default)(i,3),o=a[0],s=a[1],u=a[2],l=o4(i),f=Math.asin(u/l),c=Math.atan2(o,-s),p=c*NV,d=f*NV,v=(l/Sl-1)*_g;return[p,d,v]}},{key:"projectFlat",value:function(i){return i}},{key:"unprojectFlat",value:function(i){return i}},{key:"panByPosition",value:function(i,a){var o=this.unproject(a);return{longitude:i[0]-o[0]+this.longitude,latitude:i[1]-o[1]+this.latitude}}}]),e}(yr);function gS(t,r){var e=ps([],r,t);return _j(e,e,1/e[3]),e}var bS=h(ye()),WV=h(L()),$V=h(N()),XV=h(_e()),qV=h(Y()),YV=h(K()),xS=h(q()),AS=h(B());function VV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function HV(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?VV(Object(e),!0).forEach(function(n){(0,AS.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):VV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Qbe(t){var r=e1e();return function(){var n=(0,xS.default)(t),i;if(r){var a=(0,xS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,YV.default)(this,i)}}function e1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _S=Math.PI/180;function t1e(t){var r=t.height,e=t.focalDistance,n=t.orbitAxis,i=t.rotationX,a=t.rotationOrbit,o=t.zoom,s=n==="Z"?[0,0,1]:[0,1,0],u=n==="Z"?[0,-e,0]:[0,0,e],l=new ce().lookAt({eye:u,up:s});l.rotateX(i*_S),n==="Z"?l.rotateZ(a*_S):l.rotateY(a*_S);var f=Math.pow(2,o)/r;return l.scale(f),l}var bg=function(t){(0,qV.default)(e,t);var r=Qbe(e);function e(n){var i;(0,WV.default)(this,e);var a=n.height,o=n.projectionMatrix,s=n.fovy,u=s===void 0?50:s,l=n.orbitAxis,f=l===void 0?"Z":l,c=n.target,p=c===void 0?[0,0,0]:c,d=n.rotationX,v=d===void 0?0:d,m=n.rotationOrbit,g=m===void 0?0:m,y=n.zoom,_=y===void 0?0:y,b=o?o[5]/2:ao(u);return i=r.call(this,HV(HV({},n),{},{longitude:void 0,viewMatrix:t1e({height:a||1,focalDistance:b,orbitAxis:f,rotationX:v,rotationOrbit:g,zoom:_}),fovy:u,focalDistance:b,position:p,zoom:_})),(0,AS.default)((0,XV.default)(i),"projectedCenter",void 0),i.projectedCenter=i.project(i.center),i}return(0,$V.default)(e,[{key:"unproject",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a.topLeft,s=o===void 0?!0:o,u=(0,bS.default)(i,3),l=u[0],f=u[1],c=u[2],p=c===void 0?this.projectedCenter[2]:c,d=s?f:this.height-f,v=Wr([l,d,p],this.pixelUnprojectionMatrix),m=(0,bS.default)(v,3),g=m[0],y=m[1],_=m[2];return[g,y,_]}},{key:"panByPosition",value:function(i,a){var o=this.project(i),s=[this.width/2+o[0]-a[0],this.height/2+o[1]-a[1],this.projectedCenter[2]];return{target:this.unproject(s)}}}]),e}(yr);var TS=h(ye()),ZV=h(B()),QV=h(L()),e8=h(N()),t8=h(Y()),r8=h(K()),SS=h(q());function KV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function JV(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?KV(Object(e),!0).forEach(function(n){(0,ZV.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):KV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function r1e(t){var r=n1e();return function(){var n=(0,SS.default)(t),i;if(r){var a=(0,SS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,r8.default)(this,i)}}function n1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var i1e=new ce().lookAt({eye:[0,0,1]});function a1e(t){var r=t.width,e=t.height,n=t.near,i=t.far,a=t.padding,o=-r/2,s=r/2,u=-e/2,l=e/2;if(a){var f=a.left,c=f===void 0?0:f,p=a.right,d=p===void 0?0:p,v=a.top,m=v===void 0?0:v,g=a.bottom,y=g===void 0?0:g,_=He((c+r-d)/2,0,r)-r/2,b=He((m+e-y)/2,0,e)-e/2;o-=_,s-=_,u+=b,l+=b}return new ce().ortho({left:o,right:s,bottom:u,top:l,near:n,far:i})}var wl=function(t){(0,t8.default)(e,t);var r=r1e(e);function e(n){(0,QV.default)(this,e);var i=n.width,a=n.height,o=n.near,s=o===void 0?.1:o,u=n.far,l=u===void 0?1e3:u,f=n.zoom,c=f===void 0?0:f,p=n.target,d=p===void 0?[0,0,0]:p,v=n.padding,m=v===void 0?null:v,g=n.flipY,y=g===void 0?!0:g,_=Array.isArray(c)?c[0]:c,b=Array.isArray(c)?c[1]:c,x=Math.min(_,b),A=Math.pow(2,x),T;if(_!==b){var O=Math.pow(2,_),w=Math.pow(2,b);T={unitsPerMeter:[O/A,w/A,1],metersPerUnit:[A/O,A/w,1]}}return r.call(this,JV(JV({},n),{},{longitude:void 0,position:d,viewMatrix:i1e.clone().scale([A,A*(y?-1:1),A]),projectionMatrix:a1e({width:i||1,height:a||1,padding:m,near:s,far:l}),zoom:x,distanceScales:T}))}return(0,e8.default)(e,[{key:"projectFlat",value:function(i){var a=(0,TS.default)(i,2),o=a[0],s=a[1],u=this.distanceScales.unitsPerMeter;return[o*u[0],s*u[1]]}},{key:"unprojectFlat",value:function(i){var a=(0,TS.default)(i,2),o=a[0],s=a[1],u=this.distanceScales.metersPerUnit;return[o*u[0],s*u[1]]}},{key:"panByPosition",value:function(i,a){var o=Wr(a,this.pixelUnprojectionMatrix),s=this.projectFlat(i),u=sl([],s,Em([],o)),l=sl([],this.center,u);return{target:this.unprojectFlat(l)}}}]),e}(yr);var a8=h(L()),PS=h(_e()),o8=h(Y()),s8=h(K()),wS=h(q()),xg=h(B());function n8(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function i8(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?n8(Object(e),!0).forEach(function(n){(0,xg.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):n8(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function o1e(t){var r=s1e();return function(){var n=(0,wS.default)(t),i;if(r){var a=(0,wS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,s8.default)(this,i)}}function s1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ag=function(t){(0,o8.default)(e,t);var r=o1e(e);function e(n){var i;(0,a8.default)(this,e);var a=n.longitude,o=n.latitude,s=n.modelMatrix,u=n.bearing,l=u===void 0?0:u,f=n.pitch,c=f===void 0?0:f,p=n.up,d=p===void 0?[0,0,1]:p,v=new qc({bearing:l,pitch:c===-90?1e-4:90+c}),m=v.toVector3().normalize(),g=s?new ce(s).transformAsVector(m):m,y=Number.isFinite(o)?tp({latitude:o}):0,_=Math.pow(2,y),b=new ce().lookAt({eye:[0,0,0],center:g,up:d}).scale(_);return i=r.call(this,i8(i8({},n),{},{zoom:y,viewMatrix:b})),(0,xg.default)((0,PS.default)(i),"longitude",void 0),(0,xg.default)((0,PS.default)(i),"latitude",void 0),i.latitude=o,i.longitude=a,i}return e}(yr);var p8=h(L()),h8=h(N()),d8=h(Y()),v8=h(K()),IS=h(q()),m8=h(B());var OS=h(_e()),Sg=h(B()),CS=h(L()),l8=h(N()),MS=h(Y()),f8=h(K()),ES=h(q());function u8(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Tg(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?u8(Object(e),!0).forEach(function(n){(0,Sg.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):u8(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function c8(t){var r=u1e();return function(){var n=(0,ES.default)(t),i;if(r){var a=(0,ES.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,f8.default)(this,i)}}function u1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var wp=20,l1e=function(t){(0,MS.default)(e,t);var r=c8(e);function e(n){(0,CS.default)(this,e);var i=n.width,a=n.height,o=n.position,s=o===void 0?[0,0,0]:o,u=n.bearing,l=u===void 0?0:u,f=n.pitch,c=f===void 0?0:f,p=n.longitude,d=p===void 0?null:p,v=n.latitude,m=v===void 0?null:v,g=n.maxPitch,y=g===void 0?90:g,_=n.minPitch,b=_===void 0?-90:_,x=n.startRotatePos,A=n.startBearing,T=n.startPitch,O=n.startZoomPosition;return r.call(this,{width:i,height:a,position:s,bearing:l,pitch:c,longitude:d,latitude:m,maxPitch:y,minPitch:b},{startRotatePos:x,startBearing:A,startPitch:T,startZoomPosition:O})}return(0,l8.default)(e,[{key:"panStart",value:function(){return this}},{key:"pan",value:function(){return this}},{key:"panEnd",value:function(){return this}},{key:"rotateStart",value:function(i){var a=i.pos;return this._getUpdatedState({startRotatePos:a,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}},{key:"rotate",value:function(i){var a=i.pos,o=i.deltaAngleX,s=o===void 0?0:o,u=i.deltaAngleY,l=u===void 0?0:u,f=this.getState(),c=f.startRotatePos,p=f.startBearing,d=f.startPitch,v=this.getViewportProps(),m=v.width,g=v.height;if(!c||p===void 0||d===void 0)return this;var y;if(a){var _=(a[0]-c[0])/m,b=(a[1]-c[1])/g;y={bearing:p-_*180,pitch:d-b*90}}else y={bearing:p-s,pitch:d-l};return this._getUpdatedState(y)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}},{key:"zoom",value:function(i){var a=i.scale,o=this.getState(),s=o.startZoomPosition;s||(s=this.getViewportProps().position);var u=this.getDirection();return this._move(u,Math.log2(a)*wp,s)}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null})}},{key:"moveLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wp,a=this.getDirection(!0);return this._move(a.rotateZ({radians:Math.PI/2}),i)}},{key:"moveRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wp,a=this.getDirection(!0);return this._move(a.rotateZ({radians:-Math.PI/2}),i)}},{key:"moveUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wp,a=this.getDirection(!0);return this._move(a,i)}},{key:"moveDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wp,a=this.getDirection(!0);return this._move(a.negate(),i)}},{key:"rotateLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-i})}},{key:"rotateRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+i})}},{key:"rotateUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+i})}},{key:"rotateDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-i})}},{key:"zoomIn",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this.zoom({scale:i})}},{key:"zoomOut",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this.zoom({scale:1/i})}},{key:"shortestPathFrom",value:function(i){var a=i.getViewportProps(),o=Tg({},this.getViewportProps()),s=o.bearing,u=o.longitude;return Math.abs(s-a.bearing)>180&&(o.bearing=s<0?s+360:s-360),u!==null&&a.longitude!==null&&Math.abs(u-a.longitude)>180&&(o.longitude=u<0?u+360:u-360),o}},{key:"_move",value:function(i,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getViewportProps().position,s=i.scale(a);return this._getUpdatedState({position:new V(o).add(s)})}},{key:"getDirection",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=new qc({bearing:this.getViewportProps().bearing,pitch:i?90:90+this.getViewportProps().pitch}),o=a.toVector3().normalize();return o}},{key:"_getUpdatedState",value:function(i){return new e(Tg(Tg(Tg({},this.getViewportProps()),this.getState()),i))}},{key:"applyConstraints",value:function(i){var a=i.pitch,o=i.maxPitch,s=i.minPitch,u=i.longitude,l=i.bearing;return i.pitch=He(a,s,o),u!==null&&(u<-180||u>180)&&(i.longitude=ys(u+180,360)-180),(l<-180||l>180)&&(i.bearing=ys(l+180,360)-180),i}}]),e}(dl),Pg=function(t){(0,MS.default)(e,t);var r=c8(e);function e(){var n;(0,CS.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Sg.default)((0,OS.default)(n),"ControllerState",l1e),(0,Sg.default)((0,OS.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Xr(["position","pitch","bearing"])}),n}return e}(wn);function f1e(t){var r=c1e();return function(){var n=(0,IS.default)(t),i;if(r){var a=(0,IS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,v8.default)(this,i)}}function c1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var RS=function(t){(0,d8.default)(e,t);var r=f1e(e);function e(){return(0,p8.default)(this,e),r.apply(this,arguments)}return(0,h8.default)(e,[{key:"ViewportType",get:function(){return Ag}},{key:"ControllerType",get:function(){return Pg}}]),e}(Pn);(0,m8.default)(RS,"displayName","FirstPersonView");var x8=h(L()),A8=h(N()),T8=h(Y()),S8=h(K()),DS=h(q()),P8=h(B());var kS=h(L()),y8=h(N()),wg=h(_e()),BS=h(Y()),_8=h(K()),LS=h(q()),Op=h(B());function g8(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Os(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?g8(Object(e),!0).forEach(function(n){(0,Op.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):g8(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function b8(t){var r=p1e();return function(){var n=(0,LS.default)(t),i;if(r){var a=(0,LS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_8.default)(this,i)}}function p1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var FS=function(t){(0,BS.default)(e,t);var r=b8(e);function e(n){var i;(0,kS.default)(this,e);var a=n.width,o=n.height,s=n.rotationX,u=s===void 0?0:s,l=n.rotationOrbit,f=l===void 0?0:l,c=n.target,p=c===void 0?[0,0,0]:c,d=n.zoom,v=d===void 0?0:d,m=n.minRotationX,g=m===void 0?-90:m,y=n.maxRotationX,_=y===void 0?90:y,b=n.minZoom,x=b===void 0?-1/0:b,A=n.maxZoom,T=A===void 0?1/0:A,O=n.startPanPosition,w=n.startRotatePos,E=n.startRotationX,S=n.startRotationOrbit,I=n.startZoomPosition,R=n.startZoom;return i=r.call(this,{width:a,height:o,rotationX:u,rotationOrbit:f,target:p,zoom:v,minRotationX:g,maxRotationX:_,minZoom:x,maxZoom:T},{startPanPosition:O,startRotatePos:w,startRotationX:E,startRotationOrbit:S,startZoomPosition:I,startZoom:R}),(0,Op.default)((0,wg.default)(i),"makeViewport",void 0),i.makeViewport=n.makeViewport,i}return(0,y8.default)(e,[{key:"panStart",value:function(i){var a=i.pos;return this._getUpdatedState({startPanPosition:this._unproject(a)})}},{key:"pan",value:function(i){var a=i.pos,o=i.startPosition,s=this.getState().startPanPosition||o;if(!s)return this;var u=this.makeViewport(this.getViewportProps()),l=u.panByPosition(s,a);return this._getUpdatedState(l)}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null})}},{key:"rotateStart",value:function(i){var a=i.pos;return this._getUpdatedState({startRotatePos:a,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}},{key:"rotate",value:function(i){var a=i.pos,o=i.deltaAngleX,s=o===void 0?0:o,u=i.deltaAngleY,l=u===void 0?0:u,f=this.getState(),c=f.startRotatePos,p=f.startRotationX,d=f.startRotationOrbit,v=this.getViewportProps(),m=v.width,g=v.height;if(!c||p===void 0||d===void 0)return this;var y;if(a){var _=(a[0]-c[0])/m,b=(a[1]-c[1])/g;(p<-90||p>90)&&(_*=-1),y={rotationX:p+b*180,rotationOrbit:d+_*180}}else y={rotationX:p+l,rotationOrbit:d+s};return this._getUpdatedState(y)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}},{key:"shortestPathFrom",value:function(i){var a=i.getViewportProps(),o=Os({},this.getViewportProps()),s=o.rotationOrbit;return Math.abs(s-a.rotationOrbit)>180&&(o.rotationOrbit=s<0?s+360:s-360),o}},{key:"zoomStart",value:function(i){var a=i.pos;return this._getUpdatedState({startZoomPosition:this._unproject(a),startZoom:this.getViewportProps().zoom})}},{key:"zoom",value:function(i){var a=i.pos,o=i.startPos,s=i.scale,u=this.getState(),l=u.startZoom,f=u.startZoomPosition;if(f||(l=this.getViewportProps().zoom,f=this._unproject(o)||this._unproject(a)),!f)return this;var c=this._calculateNewZoom({scale:s,startZoom:l}),p=this.makeViewport(Os(Os({},this.getViewportProps()),{},{zoom:c}));return this._getUpdatedState(Os({zoom:c},p.panByPosition(f,a)))}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}},{key:"zoomIn",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:i})})}},{key:"zoomOut",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/i})})}},{key:"moveLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([-i,0])}},{key:"moveRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([i,0])}},{key:"moveUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([0,-i])}},{key:"moveDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([0,i])}},{key:"rotateLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-i})}},{key:"rotateRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+i})}},{key:"rotateUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-i})}},{key:"rotateDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+i})}},{key:"_unproject",value:function(i){var a=this.makeViewport(this.getViewportProps());return i&&a.unproject(i)}},{key:"_calculateNewZoom",value:function(i){var a=i.scale,o=i.startZoom,s=this.getViewportProps(),u=s.maxZoom,l=s.minZoom;o===void 0&&(o=this.getViewportProps().zoom);var f=o+Math.log2(a);return He(f,l,u)}},{key:"_panFromCenter",value:function(i){var a=this.getViewportProps(),o=a.width,s=a.height,u=a.target;return this.pan({startPosition:u,pos:[o/2+i[0],s/2+i[1]]})}},{key:"_getUpdatedState",value:function(i){return new this.constructor(Os(Os(Os({makeViewport:this.makeViewport},this.getViewportProps()),this.getState()),i))}},{key:"applyConstraints",value:function(i){var a=i.maxZoom,o=i.minZoom,s=i.zoom,u=i.maxRotationX,l=i.minRotationX,f=i.rotationOrbit;return i.zoom=Array.isArray(s)?[He(s[0],o,a),He(s[1],o,a)]:He(s,o,a),i.rotationX=He(i.rotationX,l,u),(f<-180||f>180)&&(i.rotationOrbit=ys(f+180,360)-180),i}}]),e}(dl),Og=function(t){(0,BS.default)(e,t);var r=b8(e);function e(){var n;(0,kS.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Op.default)((0,wg.default)(n),"ControllerState",FS),(0,Op.default)((0,wg.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Xr({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}),n}return e}(wn);function h1e(t){var r=d1e();return function(){var n=(0,DS.default)(t),i;if(r){var a=(0,DS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,S8.default)(this,i)}}function d1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var NS=function(t){(0,T8.default)(e,t);var r=h1e(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,x8.default)(this,e),n=r.call(this,i),n.props.orbitAxis=i.orbitAxis||"Z",n}return(0,A8.default)(e,[{key:"ViewportType",get:function(){return bg}},{key:"ControllerType",get:function(){return Og}}]),e}(Pn);(0,P8.default)(NS,"displayName","OrbitView");var C8=h(L()),M8=h(N()),I8=h(Y()),R8=h(K()),VS=h(q()),L8=h(B());var w8=h(ye()),US=h(L()),GS=h(N()),Ep=h(_e()),zS=h(Y()),O8=h(K()),jS=h(q()),Cp=h(B());function E8(t){var r=v1e();return function(){var n=(0,jS.default)(t),i;if(r){var a=(0,jS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,O8.default)(this,i)}}function v1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var m1e=function(t){(0,zS.default)(e,t);var r=E8(e);function e(n){var i;return(0,US.default)(this,e),i=r.call(this,n),(0,Cp.default)((0,Ep.default)(i),"zoomAxis",void 0),i.zoomAxis=n.zoomAxis||"all",i}return(0,GS.default)(e,[{key:"_calculateNewZoom",value:function(i){var a=i.scale,o=i.startZoom,s=this.getViewportProps(),u=s.maxZoom,l=s.minZoom;o===void 0&&(o=this.getViewportProps().zoom);var f=Math.log2(a);if(Array.isArray(o)){var c=o,p=(0,w8.default)(c,2),d=p[0],v=p[1];switch(this.zoomAxis){case"X":d=He(d+f,l,u);break;case"Y":v=He(v+f,l,u);break;default:var m=Math.min(d+f,v+f);m<l&&(f+=l-m),m=Math.max(d+f,v+f),m>u&&(f+=u-m),d+=f,v+=f}return[d,v]}return He(o+f,l,u)}}]),e}(FS),Eg=function(t){(0,zS.default)(e,t);var r=E8(e);function e(){var n;(0,US.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Cp.default)((0,Ep.default)(n),"ControllerState",m1e),(0,Cp.default)((0,Ep.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Xr(["target","zoom"])}),(0,Cp.default)((0,Ep.default)(n),"dragMode","pan"),n}return(0,GS.default)(e,[{key:"_onPanRotate",value:function(){return!1}}]),e}(wn);function g1e(t){var r=y1e();return function(){var n=(0,VS.default)(t),i;if(r){var a=(0,VS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,R8.default)(this,i)}}function y1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var HS=function(t){(0,I8.default)(e,t);var r=g1e(e);function e(){return(0,C8.default)(this,e),r.apply(this,arguments)}return(0,M8.default)(e,[{key:"ViewportType",get:function(){return wl}},{key:"ControllerType",get:function(){return Eg}}]),e}(Pn);(0,L8.default)(HS,"displayName","OrthographicView");var D8=h(L()),N8=h(N()),j8=h(Y()),U8=h(K()),qS=h(q()),G8=h(B());var Cg=h(_e()),k8=h(Oe()),Mg=h(B()),WS=h(L()),$S=h(N()),XS=h(Y()),B8=h(K()),Ig=h(q());function F8(t){var r=_1e();return function(){var n=(0,Ig.default)(t),i;if(r){var a=(0,Ig.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,B8.default)(this,i)}}function _1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var b1e=function(t){(0,XS.default)(e,t);var r=F8(e);function e(){return(0,WS.default)(this,e),r.apply(this,arguments)}return(0,$S.default)(e,[{key:"applyConstraints",value:function(i){var a=i.maxZoom,o=i.minZoom,s=i.zoom;i.zoom=He(s,o,a);var u=i.longitude,l=i.latitude;return(u<-180||u>180)&&(i.longitude=ys(u+180,360)-180),i.latitude=He(l,-89,89),i}}]),e}(IT),Rg=function(t){(0,XS.default)(e,t);var r=F8(e);function e(){var n;(0,WS.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Mg.default)((0,Cg.default)(n),"ControllerState",b1e),(0,Mg.default)((0,Cg.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Xr(["longitude","latitude","zoom"])}),(0,Mg.default)((0,Cg.default)(n),"dragMode","pan"),n}return(0,$S.default)(e,[{key:"setProps",value:function(i){(0,k8.default)((0,Ig.default)(e.prototype),"setProps",this).call(this,i),this.dragRotate=!1,this.touchRotate=!1}}]),e}(wn);function x1e(t){var r=A1e();return function(){var n=(0,qS.default)(t),i;if(r){var a=(0,qS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,U8.default)(this,i)}}function A1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var YS=function(t){(0,j8.default)(e,t);var r=x1e(e);function e(){return(0,D8.default)(this,e),r.apply(this,arguments)}return(0,N8.default)(e,[{key:"ViewportType",get:function(){return Pl}},{key:"ControllerType",get:function(){return Rg}}]),e}(Pn);(0,G8.default)(YS,"displayName","GlobeView");var z8=h(L()),V8=h(N()),Lg=h(B());var jt=function(){function t(r){(0,z8.default)(this,t),(0,Lg.default)(this,"opts",void 0),r&&(this.opts=r)}return(0,V8.default)(t,[{key:"equals",value:function(e){return this===e?!0:this.constructor===e.constructor&&It(this.opts,e.opts,1)}},{key:"getShaders",value:function(e){return null}},{key:"getSubLayerProps",value:function(e){var n=e.constructor,i=n.defaultProps,a={updateTriggers:{}};for(var o in i)if(o in this.props){var s=i[o],u=this.props[o];a[o]=u,s&&s.type==="accessor"&&(a.updateTriggers[o]=this.props.updateTriggers[o],typeof u=="function"&&(a[o]=this.getSubLayerAccessor(u)))}return a}},{key:"initializeState",value:function(e,n){}},{key:"updateState",value:function(e,n){}},{key:"onNeedsRedraw",value:function(e){}},{key:"getNeedsPickingBuffer",value:function(e){return!1}},{key:"draw",value:function(e,n){}},{key:"finalizeState",value:function(e,n){}}],[{key:"componentName",get:function(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}}]),t}();(0,Lg.default)(jt,"defaultProps",{});(0,Lg.default)(jt,"extensionName","LayerExtension");var X8=h(L()),q8=h(N()),Y8=h(_e()),K8=h(Y()),J8=h(K()),KS=h(q()),JS=h(B());function T1e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=S1e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function S1e(t,r){if(t){if(typeof t=="string")return H8(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return H8(t,r)}}function H8(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function W8(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function $8(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?W8(Object(e),!0).forEach(function(n){(0,JS.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):W8(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function P1e(t){var r=w1e();return function(){var n=(0,KS.default)(t),i;if(r){var a=(0,KS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,J8.default)(this,i)}}function w1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var O1e=["bearing","pitch"],E1e={speed:1.2,curve:1.414},Z8=function(t){(0,K8.default)(e,t);var r=P1e(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,X8.default)(this,e),n=r.call(this,{compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}),(0,JS.default)((0,Y8.default)(n),"opts",void 0),n.opts=$8($8({},E1e),i),n}return(0,q8.default)(e,[{key:"interpolateProps",value:function(i,a,o){var s=wm(i,a,o,this.opts),u=T1e(O1e),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;s[f]=nr(i[f]||0,a[f]||0,o)}}catch(c){u.e(c)}finally{u.f()}return s}},{key:"getDuration",value:function(i,a){var o=a.transitionDuration;return o==="auto"&&(o=hT(i,a,this.opts)),o}}]),e}(pl);var t5=h(L()),r5=h(N()),Nr=h(B());function Q8(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=C1e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function C1e(t,r){if(t){if(typeof t=="string")return e5(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return e5(t,r)}}function e5(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Ol=function(){function t(r){(0,t5.default)(this,t),(0,Nr.default)(this,"opts",void 0),(0,Nr.default)(this,"typedArrayManager",void 0),(0,Nr.default)(this,"indexStarts",[0]),(0,Nr.default)(this,"vertexStarts",[0]),(0,Nr.default)(this,"vertexCount",0),(0,Nr.default)(this,"instanceCount",0),(0,Nr.default)(this,"attributes",void 0),(0,Nr.default)(this,"_attributeDefs",void 0),(0,Nr.default)(this,"data",void 0),(0,Nr.default)(this,"getGeometry",void 0),(0,Nr.default)(this,"geometryBuffer",void 0),(0,Nr.default)(this,"buffers",void 0),(0,Nr.default)(this,"positionSize",void 0),(0,Nr.default)(this,"normalize",void 0);var e=r.attributes,n=e===void 0?{}:e;this.typedArrayManager=Kn,this.attributes={},this._attributeDefs=n,this.opts=r,this.updateGeometry(r)}return(0,r5.default)(t,[{key:"updateGeometry",value:function(e){Object.assign(this.opts,e);var n=this.opts,i=n.data,a=n.buffers,o=a===void 0?{}:a,s=n.getGeometry,u=n.geometryBuffer,l=n.positionFormat,f=n.dataChanged,c=n.normalize,p=c===void 0?!0:c;if(this.data=i,this.getGeometry=s,this.positionSize=u&&u.size||(l==="XY"?2:3),this.buffers=o,this.normalize=p,u&&(rt(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(u),p||(o.positions=u)),this.geometryBuffer=o.positions,Array.isArray(f)){var d=Q8(f),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;this._rebuildGeometry(m)}}catch(g){d.e(g)}finally{d.f()}}else this._rebuildGeometry()}},{key:"updatePartialGeometry",value:function(e){var n=e.startRow,i=e.endRow;this._rebuildGeometry({startRow:n,endRow:i})}},{key:"getGeometryFromBuffer",value:function(e){var n=e.value||e;return ArrayBuffer.isView(n)?ig(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}},{key:"_allocate",value:function(e,n){var i=this.attributes,a=this.buffers,o=this._attributeDefs,s=this.typedArrayManager;for(var u in o)if(u in a)s.release(i[u]),i[u]=null;else{var l=o[u];l.copy=n,i[u]=s.allocate(i[u],e,l)}}},{key:"_forEachGeometry",value:function(e,n,i){var a=this.data,o=this.getGeometry,s=Nt(a,n,i),u=s.iterable,l=s.objectInfo,f=Q8(u),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;l.index++;var d=o?o(p,l):null;e(d,l.index)}}catch(v){f.e(v)}finally{f.f()}}},{key:"_rebuildGeometry",value:function(e){var n=this;if(this.data){var i=this.indexStarts,a=this.vertexStarts,o=this.instanceCount,s=this.data,u=this.geometryBuffer,l=e||{},f=l.startRow,c=f===void 0?0:f,p=l.endRow,d=p===void 0?1/0:p,v={};if(e||(i=[0],a=[0]),this.normalize||!u)this._forEachGeometry(function(x,A){var T=x&&n.normalizeGeometry(x);v[A]=T,a[A+1]=a[A]+(T?n.getGeometrySize(T):0)},c,d),o=a[a.length-1];else if(a=s.startIndices,o=a[s.length]||0,ArrayBuffer.isView(u))o=o||u.length/this.positionSize;else if(u instanceof be){var m=u.accessor.stride||this.positionSize*4;o=o||u.byteLength/m}else if(u.buffer){var g=u.stride||this.positionSize*4;o=o||u.buffer.byteLength/g}else if(u.value){var y=u.value,_=u.stride/y.BYTES_PER_ELEMENT||this.positionSize;o=o||y.length/_}this._allocate(o,Boolean(e)),this.indexStarts=i,this.vertexStarts=a,this.instanceCount=o;var b={};this._forEachGeometry(function(x,A){var T=v[A]||x;b.vertexStart=a[A],b.indexStart=i[A];var O=A<a.length-1?a[A+1]:o;b.geometrySize=O-a[A],b.geometryIndex=A,n.updateGeometryAttributes(T,b)},c,d),this.vertexCount=i[i.length-1]}}}]),t}();var s5=h(L()),u5=h(N()),l5=h(_e()),ZS=h(Oe()),f5=h(Y()),c5=h(K()),Mp=h(q()),Ip=h(B());var n5=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);

    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));

  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(curr, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var i5=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function a5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function o5(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?a5(Object(e),!0).forEach(function(n){(0,Ip.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):a5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function M1e(t){var r=I1e();return function(){var n=(0,Mp.default)(t),i;if(r){var a=(0,Mp.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,c5.default)(this,i)}}function I1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kg=[0,0,0,255],R1e={getSourcePosition:{type:"accessor",value:function(r){return r.sourcePosition}},getTargetPosition:{type:"accessor",value:function(r){return r.targetPosition}},getSourceColor:{type:"accessor",value:kg},getTargetColor:{type:"accessor",value:kg},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},El=function(t){(0,f5.default)(e,t);var r=M1e(e);function e(){var n;(0,s5.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Ip.default)((0,l5.default)(n),"state",void 0),n}return(0,u5.default)(e,[{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["instanceSourcePositions","instanceTargetPositions"])}},{key:"getShaders",value:function(){return(0,ZS.default)((0,Mp.default)(e.prototype),"getShaders",this).call(this,{vs:n5,fs:i5,modules:[Ze,it]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:kg},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:kg},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}},{key:"updateState",value:function(i){if((0,ZS.default)((0,Mp.default)(e.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var a,o=this.context.gl;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.widthUnits,u=o.widthScale,l=o.widthMinPixels,f=o.widthMaxPixels,c=o.greatCircle,p=o.wrapLongitude;this.state.model.setUniforms(a).setUniforms({greatCircle:c,widthUnits:bt[s],widthScale:u,widthMinPixels:l,widthMaxPixels:f,useShortestPath:p}).draw()}},{key:"_getModel",value:function(i){for(var a=[],o=50,s=0;s<o;s++)a=a.concat([s,1,0,s,-1,0]);var u=new Ee(i,o5(o5({},this.getShaders()),{},{id:this.props.id,geometry:new Ce({drawMode:5,attributes:{positions:new Float32Array(a)}}),isInstanced:!0}));return u.setUniforms({numSegments:o}),u}}]),e}(Ve);(0,Ip.default)(El,"layerName","ArcLayer");(0,Ip.default)(El,"defaultProps",R1e);var m5=h(ye()),g5=h(L()),y5=h(N()),_5=h(_e()),eP=h(Oe()),b5=h(Y()),x5=h(K()),Lp=h(q()),kp=h(B());var L1e=new Uint16Array([0,2,1,0,3,2]),k1e=new Float32Array([0,1,0,0,1,0,1,1]);function QS(t,r){if(!r)return B1e(t);for(var e=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),n=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),i=Math.ceil(e/r)+1,a=Math.ceil(n/r)+1,o=(i-1)*(a-1)*6,s=new Uint32Array(o),u=new Float32Array(i*a*2),l=new Float64Array(i*a*3),f=0,c=0,p=0;p<i;p++)for(var d=p/(i-1),v=0;v<a;v++){var m=v/(a-1),g=F1e(t,d,m);l[f*3+0]=g[0],l[f*3+1]=g[1],l[f*3+2]=g[2]||0,u[f*2+0]=d,u[f*2+1]=1-m,p>0&&v>0&&(s[c++]=f-a,s[c++]=f-a-1,s[c++]=f-1,s[c++]=f-a,s[c++]=f-1,s[c++]=f),f++}return{vertexCount:o,positions:l,indices:s,texCoords:u}}function B1e(t){for(var r=new Float64Array(12),e=0;e<t.length;e++)r[e*3+0]=t[e][0],r[e*3+1]=t[e][1],r[e*3+2]=t[e][2]||0;return{vertexCount:6,positions:r,indices:L1e,texCoords:k1e}}function F1e(t,r,e){return nr(nr(t[0],t[1],e),nr(t[3],t[2],e),r)}var p5=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;var D1e=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,h5=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(D1e,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive && !picking_uAttribute) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`);function d5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Rp(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?d5(Object(e),!0).forEach(function(n){(0,kp.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):d5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function N1e(t){var r=j1e();return function(){var n=(0,Lp.default)(t),i;if(r){var a=(0,Lp.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,x5.default)(this,i)}}function j1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var U1e={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:se.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0}},Cl=function(t){(0,b5.default)(e,t);var r=N1e(e);function e(){var n;(0,g5.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,kp.default)((0,_5.default)(n),"state",void 0),n}return(0,y5.default)(e,[{key:"getShaders",value:function(){return(0,eP.default)((0,Lp.default)(e.prototype),"getShaders",this).call(this,{vs:p5,fs:h5,modules:[Ze,it]})}},{key:"initializeState",value:function(){var i=this,a=this.getAttributeManager();a.remove(["instancePickingColors"]);var o=!0;a.add({indices:{size:1,isIndexed:!0,update:function(u){return u.value=i.state.mesh.indices},noAlloc:o},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:function(u){return u.value=i.state.mesh.positions},noAlloc:o},texCoords:{size:2,update:function(u){return u.value=i.state.mesh.texCoords},noAlloc:o}})}},{key:"updateState",value:function(i){var a=i.props,o=i.oldProps,s=i.changeFlags,u=this.getAttributeManager();if(s.extensionsChanged){var l,f=this.context.gl;(l=this.state.model)===null||l===void 0||l.delete(),this.state.model=this._getModel(f),u.invalidateAll()}if(a.bounds!==o.bounds){var c=this.state.mesh,p=this._createMesh();this.state.model.setVertexCount(p.vertexCount);for(var d in p)c&&c[d]!==p[d]&&u.invalidate(d);this.setState(Rp({mesh:p},this._getCoordinateUniforms()))}else a._imageCoordinateSystem!==o._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}},{key:"getPickingInfo",value:function(i){var a=this.props.image,o=i.info;if(!o.color||!a)return o.bitmap=null,o;var s=a,u=s.width,l=s.height;o.index=0;var f=G1e(o.color),c=[Math.floor(f[0]*u),Math.floor(f[1]*l)];return o.bitmap={size:{width:u,height:l},uv:f,pixel:c},o}},{key:"disablePickingIndex",value:function(){this.setState({disablePicking:!0})}},{key:"restorePickingColors",value:function(){this.setState({disablePicking:!1})}},{key:"_updateAutoHighlight",value:function(i){(0,eP.default)((0,Lp.default)(e.prototype),"_updateAutoHighlight",this).call(this,Rp(Rp({},i),{},{color:this.encodePickingColor(0)}))}},{key:"_createMesh",value:function(){var i=this.props.bounds,a=i;return v5(i)&&(a=[[i[0],i[1]],[i[0],i[3]],[i[2],i[3]],[i[2],i[1]]]),QS(a,this.context.viewport.resolution)}},{key:"_getModel",value:function(i){return i?new Ee(i,Rp(Rp({},this.getShaders()),{},{id:this.props.id,geometry:new Ce({drawMode:4,vertexCount:6}),isInstanced:!1})):null}},{key:"draw",value:function(i){var a=i.uniforms,o=i.moduleParameters,s=this.state,u=s.model,l=s.coordinateConversion,f=s.bounds,c=s.disablePicking,p=this.props,d=p.image,v=p.desaturate,m=p.transparentColor,g=p.tintColor;o.pickingActive&&c||d&&u&&u.setUniforms(a).setUniforms({bitmapTexture:d,desaturate:v,transparentColor:m.map(function(y){return y/255}),tintColor:g.slice(0,3).map(function(y){return y/255}),coordinateConversion:l,bounds:f}).draw()}},{key:"_getCoordinateUniforms",value:function(){var i=se.LNGLAT,a=se.CARTESIAN,o=se.DEFAULT,s=this.props._imageCoordinateSystem;if(s!==o){var u=this.props.bounds;if(!v5(u))throw new Error("_imageCoordinateSystem only supports rectangular bounds");var l=this.context.viewport.resolution?i:a;if(s=s===i?i:a,s===i&&l===a)return{coordinateConversion:-1,bounds:u};if(s===a&&l===i){var f=At([u[0],u[1]]),c=At([u[2],u[3]]);return{coordinateConversion:1,bounds:[f[0],f[1],c[0],c[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}]),e}(Ve);(0,kp.default)(Cl,"layerName","BitmapLayer");(0,kp.default)(Cl,"defaultProps",U1e);function G1e(t){var r=(0,m5.default)(t,3),e=r[0],n=r[1],i=r[2],a=(i&240)/256,o=(i&15)/16;return[(e+o)/256,(n+a)/256]}function v5(t){return Number.isFinite(t[0])}var B5=h(L()),F5=h(N()),D5=h(_e()),Fp=h(Oe()),N5=h(Y()),j5=h(K()),Es=h(q()),Dp=h(B());var A5=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`;var T5=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var C5=h(L()),M5=h(N()),Lt=h(B());var Ml;function I5(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=z1e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function z1e(t,r){if(t){if(typeof t=="string")return S5(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return S5(t,r)}}function S5(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function P5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Bg(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?P5(Object(e),!0).forEach(function(n){(0,Lt.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):P5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var V1e=1024,H1e=4,w5=function(){},O5=(Ml={},(0,Lt.default)(Ml,10241,9987),(0,Lt.default)(Ml,10240,9729),(0,Lt.default)(Ml,10242,33071),(0,Lt.default)(Ml,10243,33071),Ml);function W1e(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function $1e(t,r,e,n){var i=Math.min(e/r.width,n/r.height),a=Math.floor(r.width*i),o=Math.floor(r.height*i);return i===1?{data:r,width:a,height:o}:(t.canvas.height=o,t.canvas.width=a,t.clearRect(0,0,a,o),t.drawImage(r,0,0,r.width,r.height,0,0,a,o),{data:t.canvas,width:a,height:o})}function Bp(t){return t&&(t.id||t.url)}function X1e(t,r,e,n){var i=t.width,a=t.height,o=new Se(t.gl,{width:r,height:e,parameters:n});return ku(t,o,{targetY:0,width:i,height:a}),t.delete(),o}function E5(t,r,e){for(var n=0;n<r.length;n++){var i=r[n],a=i.icon,o=i.xOffset,s=Bp(a);t[s]=Bg(Bg({},a),{},{x:o,y:e})}}function q1e(t){for(var r=t.icons,e=t.buffer,n=t.mapping,i=n===void 0?{}:n,a=t.xOffset,o=a===void 0?0:a,s=t.yOffset,u=s===void 0?0:s,l=t.rowHeight,f=l===void 0?0:l,c=t.canvasWidth,p=[],d=0;d<r.length;d++){var v=r[d],m=Bp(v);if(!i[m]){var g=v.height,y=v.width;o+y+e>c&&(E5(i,p,u),o=0,u=f+u+e,f=0,p=[]),p.push({icon:v,xOffset:o}),o=o+y+e,f=Math.max(f,g)}}return p.length>0&&E5(i,p,u),{mapping:i,rowHeight:f,xOffset:o,yOffset:u,canvasWidth:c,canvasHeight:W1e(f+u+e)}}function Y1e(t,r,e){if(!t||!r)return null;e=e||{};var n={},i=Nt(t),a=i.iterable,o=i.objectInfo,s=I5(a),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;o.index++;var f=r(l,o),c=Bp(f);if(!f)throw new Error("Icon is missing.");if(!f.url)throw new Error("Icon url is missing.");!n[c]&&(!e[c]||f.url!==e[c].url)&&(n[c]=Bg(Bg({},f),{},{source:l,sourceIndex:o.index}))}}catch(p){s.e(p)}finally{s.f()}return n}var R5=function(){function t(r,e){var n=e.onUpdate,i=n===void 0?w5:n,a=e.onError,o=a===void 0?w5:a;(0,C5.default)(this,t),(0,Lt.default)(this,"gl",void 0),(0,Lt.default)(this,"onUpdate",void 0),(0,Lt.default)(this,"onError",void 0),(0,Lt.default)(this,"_loadOptions",null),(0,Lt.default)(this,"_texture",null),(0,Lt.default)(this,"_externalTexture",null),(0,Lt.default)(this,"_mapping",{}),(0,Lt.default)(this,"_textureParameters",null),(0,Lt.default)(this,"_pendingCount",0),(0,Lt.default)(this,"_autoPacking",!1),(0,Lt.default)(this,"_xOffset",0),(0,Lt.default)(this,"_yOffset",0),(0,Lt.default)(this,"_rowHeight",0),(0,Lt.default)(this,"_buffer",H1e),(0,Lt.default)(this,"_canvasWidth",V1e),(0,Lt.default)(this,"_canvasHeight",0),(0,Lt.default)(this,"_canvas",null),this.gl=r,this.onUpdate=i,this.onError=o}return(0,M5.default)(t,[{key:"finalize",value:function(){var e;(e=this._texture)===null||e===void 0||e.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(e){var n=this._autoPacking?Bp(e):e;return this._mapping[n]||{}}},{key:"setProps",value:function(e){var n=e.loadOptions,i=e.autoPacking,a=e.iconAtlas,o=e.iconMapping,s=e.textureParameters;if(n&&(this._loadOptions=n),i!==void 0&&(this._autoPacking=i),o&&(this._mapping=o),a){var u;(u=this._texture)===null||u===void 0||u.delete(),this._texture=null,this._externalTexture=a}s&&(this._textureParameters=s)}},{key:"isLoaded",get:function(){return this._pendingCount===0}},{key:"packIcons",value:function(e,n){if(!(!this._autoPacking||typeof document>"u")){var i=Object.values(Y1e(e,n,this._mapping)||{});if(i.length>0){var a=q1e({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),o=a.mapping,s=a.xOffset,u=a.yOffset,l=a.rowHeight,f=a.canvasHeight;this._rowHeight=l,this._mapping=o,this._xOffset=s,this._yOffset=u,this._canvasHeight=f,this._texture||(this._texture=new Se(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||O5})),this._texture.height!==this._canvasHeight&&(this._texture=X1e(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||O5)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}}},{key:"_loadIcons",value:function(e){var n=this,i=this._canvas.getContext("2d",{willReadFrequently:!0}),a=I5(e),o;try{var s=function(){var l=o.value;n._pendingCount++,qt(l.url,n._loadOptions).then(function(f){var c=Bp(l),p=n._mapping[c],d=p.x,v=p.y,m=p.width,g=p.height,y=$1e(i,f,m,g),_=y.data,b=y.width,x=y.height;n._texture.setSubImageData({data:_,x:d+(m-b)/2,y:v+(g-x)/2,width:b,height:x}),p.width=b,p.height=x,n._texture.generateMipmap(),n.onUpdate()}).catch(function(f){n.onError({url:l.url,source:l.source,sourceIndex:l.sourceIndex,loadOptions:n._loadOptions,error:f})}).finally(function(){n._pendingCount--})};for(a.s();!(o=a.n()).done;)s()}catch(u){a.e(u)}finally{a.f()}}}]),t}();function L5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function k5(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?L5(Object(e),!0).forEach(function(n){(0,Dp.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):L5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function K1e(t){var r=J1e();return function(){var n=(0,Es.default)(t),i;if(r){var a=(0,Es.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,j5.default)(this,i)}}function J1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var U5=[0,0,0,255],Z1e={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:function(r){return r.position}},getIcon:{type:"accessor",value:function(r){return r.icon}},getColor:{type:"accessor",value:U5},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}},po=function(t){(0,N5.default)(e,t);var r=K1e(e);function e(){var n;(0,B5.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Dp.default)((0,D5.default)(n),"state",void 0),n}return(0,F5.default)(e,[{key:"getShaders",value:function(){return(0,Fp.default)((0,Es.default)(e.prototype),"getShaders",this).call(this,{vs:A5,fs:T5,modules:[Ze,it]})}},{key:"initializeState",value:function(){this.state={iconManager:new R5(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};var i=this.getAttributeManager();i.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:U5},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(i){(0,Fp.default)((0,Es.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.oldProps,s=i.changeFlags,u=this.getAttributeManager(),l=a.iconAtlas,f=a.iconMapping,c=a.data,p=a.getIcon,d=a.textureParameters,v=this.state.iconManager,m=l||this.internalState.isAsyncPropLoading("iconAtlas");if(v.setProps({loadOptions:a.loadOptions,autoPacking:!m,iconAtlas:l,iconMapping:m?f:null,textureParameters:d}),m?o.iconMapping!==a.iconMapping&&u.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&v.packIcons(c,p),s.extensionsChanged){var g,y=this.context.gl;(g=this.state.model)===null||g===void 0||g.delete(),this.state.model=this._getModel(y),u.invalidateAll()}}},{key:"isLoaded",get:function(){return(0,Fp.default)((0,Es.default)(e.prototype),"isLoaded",this)&&this.state.iconManager.isLoaded}},{key:"finalizeState",value:function(i){(0,Fp.default)((0,Es.default)(e.prototype),"finalizeState",this).call(this,i),this.state.iconManager.finalize()}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.sizeScale,u=o.sizeMinPixels,l=o.sizeMaxPixels,f=o.sizeUnits,c=o.billboard,p=o.alphaCutoff,d=this.state.iconManager,v=d.getTexture();v&&this.state.model.setUniforms(a).setUniforms({iconsTexture:v,iconsTextureDim:[v.width,v.height],sizeUnits:bt[f],sizeScale:s,sizeMinPixels:u,sizeMaxPixels:l,billboard:c,alphaCutoff:p}).draw()}},{key:"_getModel",value:function(i){var a=[-1,-1,-1,1,1,1,1,-1];return new Ee(i,k5(k5({},this.getShaders()),{},{id:this.props.id,geometry:new Ce({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(a)}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"_onError",value:function(i){var a,o=(a=this.getCurrentLayer())===null||a===void 0?void 0:a.props.onIconError;o?o(i):Z.error(i.error.message)()}},{key:"getInstanceOffset",value:function(i){var a=this.state.iconManager.getIconMapping(i),o=a.width,s=a.height,u=a.anchorX,l=u===void 0?o/2:u,f=a.anchorY,c=f===void 0?s/2:f;return[o/2-l,s/2-c]}},{key:"getInstanceColorMode",value:function(i){var a=this.state.iconManager.getIconMapping(i);return a.mask?1:0}},{key:"getInstanceIconFrame",value:function(i){var a=this.state.iconManager.getIconMapping(i),o=a.x,s=a.y,u=a.width,l=a.height;return[o,s,u,l]}}]),e}(Ve);(0,Dp.default)(po,"defaultProps",Z1e);(0,Dp.default)(po,"layerName","IconLayer");var W5=h(L()),$5=h(N()),tP=h(Oe()),X5=h(Y()),q5=h(K()),Np=h(q()),Fg=h(B());var G5=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      gl_Position = vec4(0.);
      return;
    }
  }
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(p, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var z5=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function V5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function H5(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?V5(Object(e),!0).forEach(function(n){(0,Fg.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):V5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Q1e(t){var r=exe();return function(){var n=(0,Np.default)(t),i;if(r){var a=(0,Np.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,q5.default)(this,i)}}function exe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var txe=[0,0,0,255],rxe={getSourcePosition:{type:"accessor",value:function(r){return r.sourcePosition}},getTargetPosition:{type:"accessor",value:function(r){return r.targetPosition}},getColor:{type:"accessor",value:txe},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},Il=function(t){(0,X5.default)(e,t);var r=Q1e(e);function e(){return(0,W5.default)(this,e),r.apply(this,arguments)}return(0,$5.default)(e,[{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["instanceSourcePositions","instanceTargetPositions"])}},{key:"getShaders",value:function(){return(0,tP.default)((0,Np.default)(e.prototype),"getShaders",this).call(this,{vs:G5,fs:z5,modules:[Ze,it]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}},{key:"updateState",value:function(i){if((0,tP.default)((0,Np.default)(e.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var a,o=this.context.gl;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.widthUnits,u=o.widthScale,l=o.widthMinPixels,f=o.widthMaxPixels,c=o.wrapLongitude;this.state.model.setUniforms(a).setUniforms({widthUnits:bt[s],widthScale:u,widthMinPixels:l,widthMaxPixels:f,useShortestPath:c?1:0}).draw(),c&&this.state.model.setUniforms({useShortestPath:-1}).draw()}},{key:"_getModel",value:function(i){var a=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Ee(i,H5(H5({},this.getShaders()),{},{id:this.props.id,geometry:new Ce({drawMode:5,attributes:{positions:new Float32Array(a)}}),isInstanced:!0}))}}]),e}(Ve);(0,Fg.default)(Il,"layerName","LineLayer");(0,Fg.default)(Il,"defaultProps",rxe);var Q5=h(L()),eH=h(N()),rP=h(Oe()),tH=h(Y()),rH=h(K()),jp=h(q()),Dg=h(B());var Y5=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var K5=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function J5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Z5(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?J5(Object(e),!0).forEach(function(n){(0,Dg.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):J5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function nxe(t){var r=ixe();return function(){var n=(0,jp.default)(t),i;if(r){var a=(0,jp.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rH.default)(this,i)}}function ixe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var nH=[0,0,0,255],iH=[0,0,1],axe={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:function(r){return r.position}},getNormal:{type:"accessor",value:iH},getColor:{type:"accessor",value:nH},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function oxe(t){var r=t.header,e=t.attributes;!r||!e||(t.length=r.vertexCount,e.POSITION&&(e.instancePositions=e.POSITION),e.NORMAL&&(e.instanceNormals=e.NORMAL),e.COLOR_0&&(e.instanceColors=e.COLOR_0))}var Rl=function(t){(0,tH.default)(e,t);var r=nxe(e);function e(){return(0,Q5.default)(this,e),r.apply(this,arguments)}return(0,eH.default)(e,[{key:"getShaders",value:function(){return(0,rP.default)((0,jp.default)(e.prototype),"getShaders",this).call(this,{vs:Y5,fs:K5,modules:[Ze,on,it]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:iH},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:nH}})}},{key:"updateState",value:function(i){var a=i.changeFlags,o=i.props;if((0,rP.default)((0,jp.default)(e.prototype),"updateState",this).call(this,i),a.extensionsChanged){var s,u=this.context.gl;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(u),this.getAttributeManager().invalidateAll()}a.dataChanged&&oxe(o.data)}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.pointSize,u=o.sizeUnits;this.state.model.setUniforms(a).setUniforms({sizeUnits:bt[u],radiusPixels:s}).draw()}},{key:"_getModel",value:function(i){for(var a=[],o=0;o<3;o++){var s=o/3*Math.PI*2;a.push(Math.cos(s)*2,Math.sin(s)*2,0)}return new Ee(i,Z5(Z5({},this.getShaders()),{},{id:this.props.id,geometry:new Ce({drawMode:4,attributes:{positions:new Float32Array(a)}}),isInstanced:!0}))}}]),e}(Ve);(0,Dg.default)(Rl,"layerName","PointCloudLayer");(0,Dg.default)(Rl,"defaultProps",axe);var fH=h(L()),cH=h(N()),nP=h(Oe()),pH=h(Y()),hH=h(K()),Up=h(q()),Ng=h(B());var aH=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;

  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var oH=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ?
    smoothedge(distToCenter, outerRadiusPixels) :
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ?
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function sH(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function uH(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?sH(Object(e),!0).forEach(function(n){(0,Ng.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):sH(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function sxe(t){var r=uxe();return function(){var n=(0,Up.default)(t),i;if(r){var a=(0,Up.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,hH.default)(this,i)}}function uxe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var lH=[0,0,0,255],lxe={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:function(r){return r.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:lH},getLineColor:{type:"accessor",value:lH},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Ll=function(t){(0,pH.default)(e,t);var r=sxe(e);function e(){return(0,fH.default)(this,e),r.apply(this,arguments)}return(0,cH.default)(e,[{key:"getShaders",value:function(){return(0,nP.default)((0,Up.default)(e.prototype),"getShaders",this).call(this,{vs:aH,fs:oH,modules:[Ze,it]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(i){if((0,nP.default)((0,Up.default)(e.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var a,o=this.context.gl;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.radiusUnits,u=o.radiusScale,l=o.radiusMinPixels,f=o.radiusMaxPixels,c=o.stroked,p=o.filled,d=o.billboard,v=o.antialiasing,m=o.lineWidthUnits,g=o.lineWidthScale,y=o.lineWidthMinPixels,_=o.lineWidthMaxPixels;this.state.model.setUniforms(a).setUniforms({stroked:c?1:0,filled:p,billboard:d,antialiasing:v,radiusUnits:bt[s],radiusScale:u,radiusMinPixels:l,radiusMaxPixels:f,lineWidthUnits:bt[m],lineWidthScale:g,lineWidthMinPixels:y,lineWidthMaxPixels:_}).draw()}},{key:"_getModel",value:function(i){var a=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Ee(i,uH(uH({},this.getShaders()),{},{id:this.props.id,geometry:new Ce({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(a)}}}),isInstanced:!0}))}}]),e}(Ve);(0,Ng.default)(Ll,"defaultProps",lxe);(0,Ng.default)(Ll,"layerName","ScatterplotLayer");var zH=h(L()),VH=h(N()),pP=h(Oe()),HH=h(Y()),WH=h(K()),qp=h(q()),Wg=h(B());var LH=h(B()),kH=h(L()),BH=h(Y()),FH=h(K()),cP=h(q());var gH=h(L()),yH=h(N());var kl={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function ho(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=dH(t,e);return n!==r?(fxe(t,e),!0):!1}function dH(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Math.sign(ma(t,r))}function ma(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.start,n=e===void 0?0:e,i=r.end,a=i===void 0?t.length:i,o=r.size||2,s=0,u=n,l=a-o;u<a;u+=o)s+=(t[u]-t[l])*(t[u+1]+t[l+1]),l=u;return s/2}function iP(t,r){for(var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=e.start,i=n===void 0?0:n,a=e.end,o=a===void 0?t.length:a,s=e.size,u=s===void 0?2:s,l=e.isClosed,f=(o-i)/u,c=0;c<f-1;++c)r(t[i+c*u],t[i+c*u+1],t[i+(c+1)*u],t[i+(c+1)*u+1],c,c+1);var p=i+(f-1)*u,d=l||tt(t[i],t[p])&&tt(t[i+1],t[p+1]);d||r(t[p],t[p+1],t[i],t[i+1],f-1,0)}function fxe(t,r){for(var e=r.start,n=e===void 0?0:e,i=r.end,a=i===void 0?t.length:i,o=r.size,s=o===void 0?2:o,u=(a-n)/s,l=Math.floor(u/2),f=0;f<l;++f)for(var c=n+f*s,p=n+(u-1-f)*s,d=0;d<s;++d){var v=t[c+d];t[c+d]=t[p+d],t[p+d]=v}}function vH(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=cxe(t,e);return n!==r?(t.reverse(),!0):!1}function cxe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Math.sign(aP(t,r))}function aP(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.start,n=e===void 0?0:e,i=r.end,a=i===void 0?t.length:i,o=0,s=n,u=a-1;s<a;++s)o+=(t[s][0]-t[u][0])*(t[s][1]+t[u][1]),u=s;return o/2}function mH(t,r){for(var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=e.start,i=n===void 0?0:n,a=e.end,o=a===void 0?t.length:a,s=e.isClosed,u=i;u<o-1;++u)r(t[u],t[u+1],u,u+1);var l=s||tt(t[o-1],t[0]);l||r(t[o-1],t[0],o-1,0)}var _H=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,gH.default)(this,t),C(this,"points",void 0),C(this,"isFlatArray",void 0),C(this,"options",void 0),this.points=r,this.isFlatArray=!Lr(r[0]),this.options={start:e.start||0,end:e.end||r.length,size:e.size||2,isClosed:e.isClosed},Object.freeze(this)}return(0,yH.default)(t,[{key:"getSignedArea",value:function(){return this.isFlatArray?ma(this.points,this.options):aP(this.points,this.options)}},{key:"getArea",value:function(){return Math.abs(this.getSignedArea())}},{key:"getWindingDirection",value:function(){return Math.sign(this.getSignedArea())}},{key:"forEachSegment",value:function(e){this.isFlatArray?iP(this.points,function(n,i,a,o,s,u){e([n,i],[a,o],s,u)},this.options):mH(this.points,e,this.options)}},{key:"modifyWindingDirection",value:function(e){return this.isFlatArray?ho(this.points,e,this.options):vH(this.points,e,this.options)}}]),t}();function uP(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:2,n=arguments.length>3?arguments[3]:void 0,i=r&&r.length,a=i?r[0]*e:t.length,o=xH(t,0,a,e,!0,n&&n[0]),s=[];if(!o||o.next===o.prev)return s;var u,l,f,c,p,d,v;if(i&&(o=mxe(t,r,o,e,n)),t.length>80*e){c=l=t[0],p=f=t[1];for(var m=e;m<a;m+=e)d=t[m],v=t[m+1],d<c&&(c=d),v<p&&(p=v),d>l&&(l=d),v>f&&(f=v);u=Math.max(l-c,f-p),u=u!==0?1/u:0}return Gp(o,s,e,c,p,u),s}function xH(t,r,e,n,i,a){var o,s;if(a===void 0&&(a=ma(t,{start:r,end:e,size:n})),i===a<0)for(o=r;o<e;o+=n)s=bH(o,t[o],t[o+1],s);else for(o=e-n;o>=r;o-=n)s=bH(o,t[o],t[o+1],s);return s&&Gg(s,s.next)&&(Vp(s),s=s.next),s}function vo(t,r){if(!t)return t;r||(r=t);var e=t,n;do if(n=!1,!e.steiner&&(Gg(e,e.next)||kt(e.prev,e,e.next)===0)){if(Vp(e),e=r=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==r);return r}function Gp(t,r,e,n,i,a,o){if(t){!o&&a&&xxe(t,n,i,a);for(var s=t,u,l;t.prev!==t.next;){if(u=t.prev,l=t.next,a?hxe(t,n,i,a):pxe(t)){r.push(u.i/e),r.push(t.i/e),r.push(l.i/e),Vp(t),t=l.next,s=l.next;continue}if(t=l,t===s){o?o===1?(t=dxe(vo(t),r,e),Gp(t,r,e,n,i,a,2)):o===2&&vxe(t,r,e,n,i,a):Gp(vo(t),r,e,n,i,a,1);break}}}}function pxe(t){var r=t.prev,e=t,n=t.next;if(kt(r,e,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Bl(r.x,r.y,e.x,e.y,n.x,n.y,i.x,i.y)&&kt(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function hxe(t,r,e,n){var i=t.prev,a=t,o=t.next;if(kt(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,u=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,l=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,f=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,c=oP(s,u,r,e,n),p=oP(l,f,r,e,n),d=t.prevZ,v=t.nextZ;d&&d.z>=c&&v&&v.z<=p;){if(d!==t.prev&&d!==t.next&&Bl(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&kt(d.prev,d,d.next)>=0||(d=d.prevZ,v!==t.prev&&v!==t.next&&Bl(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&kt(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&Bl(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&kt(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;v&&v.z<=p;){if(v!==t.prev&&v!==t.next&&Bl(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&kt(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function dxe(t,r,e){var n=t;do{var i=n.prev,a=n.next.next;!Gg(i,a)&&AH(i,n,n.next,a)&&zp(i,a)&&zp(a,i)&&(r.push(i.i/e),r.push(n.i/e),r.push(a.i/e),Vp(n),Vp(n.next),n=t=a),n=n.next}while(n!==t);return vo(n)}function vxe(t,r,e,n,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Sxe(o,s)){var u=TH(o,s);o=vo(o,o.next),u=vo(u,u.next),Gp(o,r,e,n,i,a),Gp(u,r,e,n,i,a);return}s=s.next}o=o.next}while(o!==t)}function mxe(t,r,e,n,i){var a=[],o,s,u,l,f;for(o=0,s=r.length;o<s;o++)u=r[o]*n,l=o<s-1?r[o+1]*n:t.length,f=xH(t,u,l,n,!1,i&&i[o+1]),f===f.next&&(f.steiner=!0),a.push(Txe(f));for(a.sort(gxe),o=0;o<a.length;o++)yxe(a[o],e),e=vo(e,e.next);return e}function gxe(t,r){return t.x-r.x}function yxe(t,r){if(r=_xe(t,r),r){var e=TH(r,t);vo(r,r.next),vo(e,e.next)}}function _xe(t,r){var e=r,n=t.x,i=t.y,a=-1/0,o;do{if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){var s=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(s<=n&&s>a){if(a=s,s===n){if(i===e.y)return e;if(i===e.next.y)return e.next}o=e.x<e.next.x?e:e.next}}e=e.next}while(e!==r);if(!o)return null;if(n===a)return o;var u=o,l=o.x,f=o.y,c=1/0,p;e=o;do n>=e.x&&e.x>=l&&n!==e.x&&Bl(i<f?n:a,i,l,f,i<f?a:n,i,e.x,e.y)&&(p=Math.abs(i-e.y)/(n-e.x),zp(e,t)&&(p<c||p===c&&(e.x>o.x||e.x===o.x&&bxe(o,e)))&&(o=e,c=p)),e=e.next;while(e!==u);return o}function bxe(t,r){return kt(t.prev,t,r.prev)<0&&kt(r.next,t,t.next)<0}function xxe(t,r,e,n){var i=t;do i.z===null&&(i.z=oP(i.x,i.y,r,e,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,Axe(i)}function Axe(t){var r,e,n=1,i,a,o,s,u,l;do{for(a=t,t=null,l=null,i=0;a;){for(i++,s=a,o=0,e=0;e<n&&(o++,s=s.nextZ,!!s);e++);for(u=n;o>0||u>0&&s;)o!==0&&(u===0||!s||a.z<=s.z)?(r=a,a=a.nextZ,o--):(r=s,s=s.nextZ,u--),l?l.nextZ=r:t=r,r.prevZ=l,l=r;a=s}l.nextZ=null,n*=2}while(i>1);return t}function oP(t,r,e,n,i){return t=32767*(t-e)*i,r=32767*(r-n)*i,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t|r<<1}function Txe(t){var r=t,e=t;do(r.x<e.x||r.x===e.x&&r.y<e.y)&&(e=r),r=r.next;while(r!==t);return e}function Bl(t,r,e,n,i,a,o,s){return(i-o)*(r-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(e-o)*(r-s)>=0&&(e-o)*(a-s)-(i-o)*(n-s)>=0}function Sxe(t,r){return t.next.i!==r.i&&t.prev.i!==r.i&&!Pxe(t,r)&&(zp(t,r)&&zp(r,t)&&wxe(t,r)&&(kt(t.prev,t,r.prev)||kt(t,r.prev,r))||Gg(t,r)&&kt(t.prev,t,t.next)>0&&kt(r.prev,r,r.next)>0)}function kt(t,r,e){return(r.y-t.y)*(e.x-r.x)-(r.x-t.x)*(e.y-r.y)}function Gg(t,r){return t.x===r.x&&t.y===r.y}function AH(t,r,e,n){var i=Ug(kt(t,r,e)),a=Ug(kt(t,r,n)),o=Ug(kt(e,n,t)),s=Ug(kt(e,n,r));return!!(i!==a&&o!==s||i===0&&jg(t,e,r)||a===0&&jg(t,n,r)||o===0&&jg(e,t,n)||s===0&&jg(e,r,n))}function jg(t,r,e){return r.x<=Math.max(t.x,e.x)&&r.x>=Math.min(t.x,e.x)&&r.y<=Math.max(t.y,e.y)&&r.y>=Math.min(t.y,e.y)}function Ug(t){return t>0?1:t<0?-1:0}function Pxe(t,r){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==r.i&&e.next.i!==r.i&&AH(e,e.next,t,r))return!0;e=e.next}while(e!==t);return!1}function zp(t,r){return kt(t.prev,t,t.next)<0?kt(t,r,t.next)>=0&&kt(t,t.prev,r)>=0:kt(t,r,t.prev)<0||kt(t,t.next,r)<0}function wxe(t,r){var e=t,n=!1,i=(t.x+r.x)/2,a=(t.y+r.y)/2;do e.y>a!=e.next.y>a&&e.next.y!==e.y&&i<(e.next.x-e.x)*(a-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==t);return n}function TH(t,r){var e=new sP(t.i,t.x,t.y),n=new sP(r.i,r.x,r.y),i=t.next,a=r.prev;return t.next=r,r.prev=t,e.next=i,i.prev=e,n.next=e,e.prev=n,a.next=n,n.prev=a,n}function bH(t,r,e,n){var i=new sP(t,r,e);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Vp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function sP(t,r,e){this.i=t,this.x=r,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qr(t,r){var e=r.length,n=t.length;if(n>0){for(var i=!0,a=0;a<e;a++)if(t[n-e+a]!==r[a]){i=!1;break}if(i)return!1}for(var o=0;o<e;o++)t[n+o]=r[o];return!0}function Hp(t,r){for(var e=r.length,n=0;n<e;n++)t[n]=r[n]}function mo(t,r,e,n){for(var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],a=n+r*e,o=0;o<e;o++)i[o]=t[a+o];return i}function zg(t,r,e,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],a,o;if(e&8)a=(n[3]-t[1])/(r[1]-t[1]),o=3;else if(e&4)a=(n[1]-t[1])/(r[1]-t[1]),o=1;else if(e&2)a=(n[2]-t[0])/(r[0]-t[0]),o=2;else if(e&1)a=(n[0]-t[0])/(r[0]-t[0]),o=0;else return null;for(var s=0;s<t.length;s++)i[s]=(o&1)===s?n[o]:a*(r[s]-t[s])+t[s];return i}function Wp(t,r){var e=0;return t[0]<r[0]?e|=1:t[0]>r[2]&&(e|=2),t[1]<r[1]?e|=4:t[1]>r[3]&&(e|=8),e}function $p(t,r){var e=r||{},n=e.size,i=n===void 0?2:n,a=e.broken,o=a===void 0?!1:a,s=e.gridResolution,u=s===void 0?10:s,l=e.gridOffset,f=l===void 0?[0,0]:l,c=e.startIndex,p=c===void 0?0:c,d=e.endIndex,v=d===void 0?t.length:d,m=(v-p)/i,g=[],y=[g],_=mo(t,0,i,p),b,x,A=wH(_,u,f,[]),T=[];qr(g,_);for(var O=1;O<m;O++){for(b=mo(t,O,i,p,b),x=Wp(b,A);x;){zg(_,b,x,A,T);var w=Wp(T,A);w&&(zg(_,T,w,A,T),x=w),qr(g,T),Hp(_,T),Exe(A,u,x),o&&g.length>i&&(g=[],y.push(g),qr(g,_)),x=Wp(b,A)}qr(g,b),Hp(_,b)}return o?y:y[0]}var SH=0,Oxe=1;function Vg(t,r){for(var e=0;e<r.length;e++)t.push(r[e]);return t}function Xp(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0;if(!t.length)return[];for(var n=e||{},i=n.size,a=i===void 0?2:i,o=n.gridResolution,s=o===void 0?10:o,u=n.gridOffset,l=u===void 0?[0,0]:u,f=n.edgeTypes,c=f===void 0?!1:f,p=[],d=[{pos:t,types:c?new Array(t.length/a).fill(Oxe):null,holes:r||[]}],v=[[],[]],m=[];d.length;){var g=d.shift(),y=g.pos,_=g.types,b=g.holes;Cxe(y,a,b[0]||y.length,v),m=wH(v[0],s,l,m);var x=Wp(v[1],m);if(x){var A=PH(y,_,a,0,b[0]||y.length,m,x),T={pos:A[0].pos,types:A[0].types,holes:[]},O={pos:A[1].pos,types:A[1].types,holes:[]};d.push(T,O);for(var w=0;w<b.length;w++)A=PH(y,_,a,b[w],b[w+1]||y.length,m,x),A[0]&&(T.holes.push(T.pos.length),T.pos=Vg(T.pos,A[0].pos),c&&(T.types=Vg(T.types,A[0].types))),A[1]&&(O.holes.push(O.pos.length),O.pos=Vg(O.pos,A[1].pos),c&&(O.types=Vg(O.types,A[1].types)))}else{var E={positions:y};c&&(E.edgeTypes=_),b.length&&(E.holeIndices=b),p.push(E)}}return p}function PH(t,r,e,n,i,a,o){for(var s=(i-n)/e,u=[],l=[],f=[],c=[],p=[],d,v,m,g=mo(t,s-1,e,n),y=Math.sign(o&8?g[1]-a[3]:g[0]-a[2]),_=r&&r[s-1],b=0,x=0,A=0;A<s;A++)d=mo(t,A,e,n,d),v=Math.sign(o&8?d[1]-a[3]:d[0]-a[2]),m=r&&r[n/e+A],v&&y&&y!==v&&(zg(g,d,o,a,p),qr(u,p)&&f.push(_),qr(l,p)&&c.push(_)),v<=0?(qr(u,d)&&f.push(m),b-=v):f.length&&(f[f.length-1]=SH),v>=0?(qr(l,d)&&c.push(m),x+=v):c.length&&(c[c.length-1]=SH),Hp(g,d),y=v,_=m;return[b?{pos:u,types:r&&f}:null,x?{pos:l,types:r&&c}:null]}function wH(t,r,e,n){var i=Math.floor((t[0]-e[0])/r)*r+e[0],a=Math.floor((t[1]-e[1])/r)*r+e[1];return n[0]=i,n[1]=a,n[2]=i+r,n[3]=a+r,n}function Exe(t,r,e){e&8?(t[1]+=r,t[3]+=r):e&4?(t[1]-=r,t[3]-=r):e&2?(t[0]+=r,t[2]+=r):e&1&&(t[0]-=r,t[2]-=r)}function Cxe(t,r,e,n){for(var i=1/0,a=-1/0,o=1/0,s=-1/0,u=0;u<e;u+=r){var l=t[u],f=t[u+1];i=l<i?l:i,a=l>a?l:a,o=f<o?f:o,s=f>s?f:s}return n[0][0]=i,n[0][1]=o,n[1][0]=a,n[1][1]=s,n}function EH(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Mxe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Mxe(t,r){if(t){if(typeof t=="string")return OH(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return OH(t,r)}}function OH(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Ixe=85.051129;function lP(t,r){var e=r||{},n=e.size,i=n===void 0?2:n,a=e.startIndex,o=a===void 0?0:a,s=e.endIndex,u=s===void 0?t.length:s,l=e.normalize,f=l===void 0?!0:l,c=t.slice(o,u);CH(c,i,0,u-o);var p=$p(c,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(f){var d=EH(p),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;MH(m,i)}}catch(g){d.e(g)}finally{d.f()}}return p}function fP(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,n=e||{},i=n.size,a=i===void 0?2:i,o=n.normalize,s=o===void 0?!0:o,u=n.edgeTypes,l=u===void 0?!1:u;r=r||[];for(var f=[],c=[],p=0,d=0,v=0;v<=r.length;v++){for(var m=r[v]||t.length,g=d,y=Rxe(t,a,p,m),_=y;_<m;_++)f[d++]=t[_];for(var b=p;b<y;b++)f[d++]=t[b];CH(f,a,g,d),Lxe(f,a,g,d,e?.maxLatitude),p=m,c[v]=d}c.pop();var x=Xp(f,c,{size:a,gridResolution:360,gridOffset:[-180,-180],edgeTypes:l});if(s){var A=EH(x),T;try{for(A.s();!(T=A.n()).done;){var O=T.value;MH(O.positions,a)}}catch(w){A.e(w)}finally{A.f()}}return x}function Rxe(t,r,e,n){for(var i=-1,a=-1,o=e+1;o<n;o+=r){var s=Math.abs(t[o]);s>i&&(i=s,a=o-1)}return a}function Lxe(t,r,e,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Ixe,a=t[e],o=t[n-r];if(Math.abs(a-o)>180){var s=mo(t,0,r,e);s[0]+=Math.round((o-a)/360)*360,qr(t,s),s[1]=Math.sign(s[1])*i,qr(t,s),s[0]=a,qr(t,s)}}function CH(t,r,e,n){for(var i=t[0],a,o=e;o<n;o+=r){a=t[o];var s=a-i;(s>180||s<-180)&&(a-=Math.round(s/360)*360),t[o]=i=a}}function MH(t,r){for(var e,n=t.length/r,i=0;i<n&&(e=t[i*r],(e+180)%360===0);i++);var a=-Math.round(e/360)*360;if(a!==0)for(var o=0;o<n;o++)t[o*r]+=a}function IH(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function RH(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?IH(Object(e),!0).forEach(function(n){(0,LH.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):IH(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function kxe(t){var r=Bxe();return function(){var n=(0,cP.default)(t),i;if(r){var a=(0,cP.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,FH.default)(this,i)}}function Bxe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var DH=function(t){(0,BH.default)(e,t);var r=kxe(e);function e(n){(0,kH.default)(this,e);var i=n.id,a=i===void 0?Xe("column-geometry"):i,o=Fxe(n),s=o.indices,u=o.attributes;return r.call(this,RH(RH({},n),{},{id:a,indices:s,attributes:u}))}return e}(Ce);function Fxe(t){var r=t.radius,e=t.height,n=e===void 0?1:e,i=t.nradial,a=i===void 0?10:i,o=t.vertices;o&&(Z.assert(o.length>=a),o=o.flatMap(function(z){return[z[0],z[1]]}),ho(o,kl.COUNTER_CLOCKWISE));var s=n>0,u=a+1,l=s?u*3+1:a,f=Math.PI*2/a,c=new Uint16Array(s?a*3*2:0),p=new Float32Array(l*3),d=new Float32Array(l*3),v=0;if(s){for(var m=0;m<u;m++)for(var g=m*f,y=m%a,_=Math.sin(g),b=Math.cos(g),x=0;x<2;x++)p[v+0]=o?o[y*2]:b*r,p[v+1]=o?o[y*2+1]:_*r,p[v+2]=(1/2-x)*n,d[v+0]=o?o[y*2]:b,d[v+1]=o?o[y*2+1]:_,v+=3;p[v+0]=p[v-3],p[v+1]=p[v-2],p[v+2]=p[v-1],v+=3}for(var A=s?0:1;A<u;A++){var T=Math.floor(A/2)*Math.sign(.5-A%2),O=T*f,w=(T+a)%a,E=Math.sin(O),S=Math.cos(O);p[v+0]=o?o[w*2]:S*r,p[v+1]=o?o[w*2+1]:E*r,p[v+2]=n/2,d[v+2]=1,v+=3}if(s)for(var I=0,R=0;R<a;R++)c[I++]=R*2+0,c[I++]=R*2+2,c[I++]=R*2+0,c[I++]=R*2+1,c[I++]=R*2+1,c[I++]=R*2+3;return{indices:c,attributes:{POSITION:{size:3,value:p},NORMAL:{size:3,value:d}}}}var NH=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
  float elevation = 0.0;
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var jH=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function UH(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function GH(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?UH(Object(e),!0).forEach(function(n){(0,Wg.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):UH(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Dxe(t){var r=Nxe();return function(){var n=(0,qp.default)(t),i;if(r){var a=(0,qp.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,WH.default)(this,i)}}function Nxe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Hg=[0,0,0,255],jxe={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(r){return r.position}},getFillColor:{type:"accessor",value:Hg},getLineColor:{type:"accessor",value:Hg},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Li=function(t){(0,HH.default)(e,t);var r=Dxe(e);function e(){return(0,zH.default)(this,e),r.apply(this,arguments)}return(0,VH.default)(e,[{key:"getShaders",value:function(){var i=this.context.gl,a=!fe(i),o={},s=this.props.flatShading&&$n(i,Ae.GLSL_DERIVATIVES);return s&&(o.FLAT_SHADING=1),(0,pP.default)((0,qp.default)(e.prototype),"getShaders",this).call(this,{vs:NH,fs:jH,defines:o,transpileToGLSL100:a,modules:[Ze,s?ia:on,it]})}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:Hg},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:Hg},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(i){(0,pP.default)((0,qp.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.oldProps,s=i.changeFlags,u=s.extensionsChanged||a.flatShading!==o.flatShading;if(u){var l,f=this.context.gl;(l=this.state.model)===null||l===void 0||l.delete(),this.state.model=this._getModel(f),this.getAttributeManager().invalidateAll()}(u||a.diskResolution!==o.diskResolution||a.vertices!==o.vertices||(a.extruded||a.stroked)!==(o.extruded||o.stroked))&&this._updateGeometry(a)}},{key:"getGeometry",value:function(i,a,o){var s=new DH({radius:1,height:o?2:0,vertices:a,nradial:i}),u=0;if(a)for(var l=0;l<i;l++){var f=a[l],c=Math.sqrt(f[0]*f[0]+f[1]*f[1]);u+=c/i}else u=1;return this.setState({edgeDistance:Math.cos(Math.PI/i)*u}),s}},{key:"_getModel",value:function(i){return new Ee(i,GH(GH({},this.getShaders()),{},{id:this.props.id,isInstanced:!0}))}},{key:"_updateGeometry",value:function(i){var a=i.diskResolution,o=i.vertices,s=i.extruded,u=i.stroked,l=this.getGeometry(a,o,s||u);this.setState({fillVertexCount:l.attributes.POSITION.value.length/3,wireframeVertexCount:l.indices.value.length}),this.state.model.setProps({geometry:l})}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.lineWidthUnits,u=o.lineWidthScale,l=o.lineWidthMinPixels,f=o.lineWidthMaxPixels,c=o.radiusUnits,p=o.elevationScale,d=o.extruded,v=o.filled,m=o.stroked,g=o.wireframe,y=o.offset,_=o.coverage,b=o.radius,x=o.angle,A=this.state,T=A.model,O=A.fillVertexCount,w=A.wireframeVertexCount,E=A.edgeDistance;T.setUniforms(a).setUniforms({radius:b,angle:x/180*Math.PI,offset:y,extruded:d,stroked:m,coverage:_,elevationScale:p,edgeDistance:E,radiusUnits:bt[c],widthUnits:bt[s],widthScale:u,widthMinPixels:l,widthMaxPixels:f}),d&&g&&(T.setProps({isIndexed:!0}),T.setVertexCount(w).setDrawMode(1).setUniforms({isStroke:!0}).draw()),v&&(T.setProps({isIndexed:!1}),T.setVertexCount(O).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!d&&m&&(T.setProps({isIndexed:!1}),T.setVertexCount(O*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}]),e}(Ve);(0,Wg.default)(Li,"layerName","ColumnLayer");(0,Wg.default)(Li,"defaultProps",jxe);var $H=h(L()),XH=h(N()),qH=h(Y()),YH=h(K()),hP=h(q()),dP=h(B());function Uxe(t){var r=Gxe();return function(){var n=(0,hP.default)(t),i;if(r){var a=(0,hP.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,YH.default)(this,i)}}function Gxe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zxe={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}},Fl=function(t){(0,qH.default)(e,t);var r=Uxe(e);function e(){return(0,$H.default)(this,e),r.apply(this,arguments)}return(0,XH.default)(e,[{key:"getGeometry",value:function(i){return new ro}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.elevationScale,u=o.extruded,l=o.offset,f=o.coverage,c=o.cellSize,p=o.angle,d=o.radiusUnits;this.state.model.setUniforms(a).setUniforms({radius:c/2,radiusUnits:bt[d],angle:p,offset:l,extruded:u,coverage:f,elevationScale:s,edgeDistance:1,isWireframe:!1}).draw()}}]),e}(Li);(0,dP.default)(Fl,"layerName","GridCellLayer");(0,dP.default)(Fl,"defaultProps",zxe);var h9=h(L()),d9=h(N()),v9=h(_e()),Yp=h(Oe()),m9=h(Y()),g9=h(K()),Cs=h(q()),Kp=h(B());var r9=h(B()),n9=h(L()),i9=h(N()),a9=h(Oe()),o9=h(Y()),s9=h(K()),$g=h(q());function KH(t,r,e,n){var i;if(Array.isArray(t[0])){var a=t.length*r;i=new Array(a);for(var o=0;o<t.length;o++)for(var s=0;s<r;s++)i[o*r+s]=t[o][s]||0}else i=t;return e?$p(i,{size:r,gridResolution:e}):n?lP(i,{size:r}):i}function JH(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Vxe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Vxe(t,r){if(t){if(typeof t=="string")return ZH(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return ZH(t,r)}}function ZH(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function QH(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function e9(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?QH(Object(e),!0).forEach(function(n){(0,r9.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):QH(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Hxe(t){var r=Wxe();return function(){var n=(0,$g.default)(t),i;if(r){var a=(0,$g.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,s9.default)(this,i)}}function Wxe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $xe=1,Xxe=2,vP=4,u9=function(t){(0,o9.default)(e,t);var r=Hxe(e);function e(n){return(0,n9.default)(this,e),r.call(this,e9(e9({},n),{},{attributes:{positions:{size:3,padding:18,initialize:!0,type:n.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}}))}return(0,i9.default)(e,[{key:"get",value:function(i){return this.attributes[i]}},{key:"getGeometryFromBuffer",value:function(i){return this.normalize?(0,a9.default)((0,$g.default)(e.prototype),"getGeometryFromBuffer",this).call(this,i):null}},{key:"normalizeGeometry",value:function(i){return this.normalize?KH(i,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):i}},{key:"getGeometrySize",value:function(i){if(t9(i)){var a=0,o=JH(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;a+=this.getGeometrySize(u)}}catch(f){o.e(f)}finally{o.f()}return a}var l=this.getPathLength(i);return l<2?0:this.isClosed(i)?l<3?0:l+2:l}},{key:"updateGeometryAttributes",value:function(i,a){if(a.geometrySize!==0)if(i&&t9(i)){var o=JH(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=this.getGeometrySize(u);a.geometrySize=l,this.updateGeometryAttributes(u,a),a.vertexStart+=l}}catch(f){o.e(f)}finally{o.f()}}else this._updateSegmentTypes(i,a),this._updatePositions(i,a)}},{key:"_updateSegmentTypes",value:function(i,a){var o=this.attributes.segmentTypes,s=i?this.isClosed(i):!1,u=a.vertexStart,l=a.geometrySize;o.fill(0,u,u+l),s?(o[u]=vP,o[u+l-2]=vP):(o[u]+=$xe,o[u+l-2]+=Xxe),o[u+l-1]=vP}},{key:"_updatePositions",value:function(i,a){var o=this.attributes.positions;if(!(!o||!i))for(var s=a.vertexStart,u=a.geometrySize,l=new Array(3),f=s,c=0;c<u;f++,c++)this.getPointOnPath(i,c,l),o[f*3]=l[0],o[f*3+1]=l[1],o[f*3+2]=l[2]}},{key:"getPathLength",value:function(i){return i.length/this.positionSize}},{key:"getPointOnPath",value:function(i,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=this.positionSize;a*s>=i.length&&(a+=1-i.length/s);var u=a*s;return o[0]=i[u],o[1]=i[u+1],o[2]=s===3&&i[u+2]||0,o}},{key:"isClosed",value:function(i){if(!this.normalize)return Boolean(this.opts.loop);var a=this.positionSize,o=i.length-a;return i[0]===i[o]&&i[1]===i[o+1]&&(a===2||i[2]===i[o+2])}}]),e}(Ol);function t9(t){return Array.isArray(t[0])}var l9=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var f9=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function c9(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function p9(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?c9(Object(e),!0).forEach(function(n){(0,Kp.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):c9(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function qxe(t){var r=Yxe();return function(){var n=(0,Cs.default)(t),i;if(r){var a=(0,Cs.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,g9.default)(this,i)}}function Yxe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var y9=[0,0,0,255],Kxe={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:function(r){return r.path}},getColor:{type:"accessor",value:y9},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},mP={enter:function(r,e){return e.length?e.subarray(e.length-r.length):r}},ki=function(t){(0,m9.default)(e,t);var r=qxe(e);function e(){var n;(0,h9.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Kp.default)((0,v9.default)(n),"state",void 0),n}return(0,d9.default)(e,[{key:"getShaders",value:function(){return(0,Yp.default)((0,Cs.default)(e.prototype),"getShaders",this).call(this,{vs:l9,fs:f9,modules:[Ze,it]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this,a=!0,o=this.getAttributeManager();o.addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:mP,accessor:"getPath",update:this.calculatePositions,noAlloc:a,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:a},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:mP,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:mP,defaultValue:y9},instancePickingColors:{size:3,type:5121,accessor:function(u,l){var f=l.index,c=l.target;return i.encodePickingColor(u&&u.__source?u.__source.index:f,c)}}}),this.setState({pathTesselator:new u9({fp64:this.use64bitPositions()})})}},{key:"updateState",value:function(i){(0,Yp.default)((0,Cs.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.changeFlags,s=this.getAttributeManager(),u=o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getPath);if(u){var l=this.state.pathTesselator,f=a.data.attributes||{};l.updateGeometry({data:a.data,geometryBuffer:f.getPath,buffers:f,normalize:!a._pathType,loop:a._pathType==="loop",getGeometry:a.getPath,positionFormat:a.positionFormat,wrapLongitude:a.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:o.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),o.dataChanged||s.invalidateAll()}if(o.extensionsChanged){var c,p=this.context.gl;(c=this.state.model)===null||c===void 0||c.delete(),this.state.model=this._getModel(p),s.invalidateAll()}}},{key:"getPickingInfo",value:function(i){var a=(0,Yp.default)((0,Cs.default)(e.prototype),"getPickingInfo",this).call(this,i),o=a.index,s=this.props.data;return s[0]&&s[0].__source&&(a.object=s.find(function(u){return u.__source.index===o})),a}},{key:"disablePickingIndex",value:function(i){var a=this.props.data;if(a[0]&&a[0].__source)for(var o=0;o<a.length;o++)a[o].__source.index===i&&this._disablePickingIndex(o);else(0,Yp.default)((0,Cs.default)(e.prototype),"disablePickingIndex",this).call(this,i)}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.jointRounded,u=o.capRounded,l=o.billboard,f=o.miterLimit,c=o.widthUnits,p=o.widthScale,d=o.widthMinPixels,v=o.widthMaxPixels;this.state.model.setUniforms(a).setUniforms({jointType:Number(s),capType:Number(u),billboard:l,widthUnits:bt[c],widthScale:p,miterLimit:f,widthMinPixels:d,widthMaxPixels:v}).draw()}},{key:"_getModel",value:function(i){var a=[0,1,2,1,4,2,1,3,4,3,5,4],o=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Ee(i,p9(p9({},this.getShaders()),{},{id:this.props.id,geometry:new Ce({drawMode:4,attributes:{indices:new Uint16Array(a),positions:{value:new Float32Array(o),size:2}}}),isInstanced:!0}))}},{key:"calculatePositions",value:function(i){var a=this.state.pathTesselator;i.startIndices=a.vertexStarts,i.value=a.get("positions")}},{key:"calculateSegmentTypes",value:function(i){var a=this.state.pathTesselator;i.startIndices=a.vertexStarts,i.value=a.get("segmentTypes")}}]),e}(Ve);(0,Kp.default)(ki,"defaultProps",Kxe);(0,Kp.default)(ki,"layerName","PathLayer");var eW=h(L()),tW=h(N()),rW=h(Y()),nW=h(K()),TP=h(q()),SP=h(B());var q9=h(L()),Y9=h(N()),K9=h(_e()),rh=h(Oe()),J9=h(Y()),Z9=h(K()),Is=h(q()),nh=h(B());var N9=h(B()),j9=h(L()),U9=h(N()),AP=h(Oe()),G9=h(Y()),z9=h(K()),th=h(q());var C9=h(ye()),M9=h(T9());function pAe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=hAe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function hAe(t,r){if(t){if(typeof t=="string")return S9(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return S9(t,r)}}function S9(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Jg=kl.CLOCKWISE,P9=kl.COUNTER_CLOCKWISE,go={isClosed:!0};function dAe(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Nl(t){return"positions"in t?t.positions:t}function eh(t){return"holeIndices"in t?t.holeIndices:null}function vAe(t){return Array.isArray(t[0])}function mAe(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function gAe(t){var r=t[0],e=t[t.length-1];return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}function yAe(t,r,e,n){for(var i=0;i<r;i++)if(t[e+i]!==t[n-r+i])return!1;return!0}function w9(t,r,e,n,i){for(var a=r,o=e.length,s=0;s<o;s++)for(var u=0;u<n;u++)t[a++]=e[s][u]||0;if(!gAe(e))for(var l=0;l<n;l++)t[a++]=e[0][l]||0;return go.start=r,go.end=a,go.size=n,ho(t,i,go),a}function O9(t,r,e,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;a=a||e.length;var s=a-i;if(s<=0)return r;for(var u=r,l=0;l<s;l++)t[u++]=e[i+l];if(!yAe(e,n,i,a))for(var f=0;f<n;f++)t[u++]=e[i+f];return go.start=r,go.end=u,go.size=n,ho(t,o,go),u}function Zg(t,r){dAe(t);var e=[],n=[];if("positions"in t){var i=t,a=i.positions,o=i.holeIndices;if(o){for(var s=0,u=0;u<=o.length;u++)s=O9(e,s,a,r,o[u-1],o[u],u===0?Jg:P9),n.push(s);return n.pop(),{positions:e,holeIndices:n}}t=a}if(!vAe(t))return O9(e,0,t,r,0,e.length,Jg),e;if(!mAe(t)){var l=0,f=pAe(t.entries()),c;try{for(f.s();!(c=f.n()).done;){var p=(0,C9.default)(c.value,2),d=p[0],v=p[1];l=w9(e,l,v,r,d===0?Jg:P9),n.push(l)}}catch(m){f.e(m)}finally{f.f()}return n.pop(),{positions:e,holeIndices:n}}return w9(e,0,t,r,Jg),e}function xP(t,r,e){for(var n=t.length/3,i=0,a=0;a<n;a++){var o=(a+1)%n;i+=t[a*3+r]*t[o*3+e],i-=t[o*3+r]*t[a*3+e]}return Math.abs(i/2)}function E9(t,r,e,n){for(var i=t.length/3,a=0;a<i;a++){var o=a*3,s=t[o+0],u=t[o+1],l=t[o+2];t[o+r]=s,t[o+e]=u,t[o+n]=l}}function I9(t,r,e,n){var i=eh(t);i&&(i=i.map(function(v){return v/r}));var a=Nl(t),o=n&&r===3;if(e){var s=a.length;a=a.slice();for(var u=[],l=0;l<s;l+=r){u[0]=a[l],u[1]=a[l+1],o&&(u[2]=a[l+2]);var f=e(u);a[l]=f[0],a[l+1]=f[1],o&&(a[l+2]=f[2])}}if(o){var c=xP(a,0,1),p=xP(a,0,2),d=xP(a,1,2);if(!c&&!p&&!d)return[];c>p&&c>d||(p>d?(e||(a=a.slice()),E9(a,0,2,1)):(e||(a=a.slice()),E9(a,1,2,0)))}return(0,M9.default)(a,i,r)}function L9(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=_Ae(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function _Ae(t,r){if(t){if(typeof t=="string")return k9(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return k9(t,r)}}function k9(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function B9(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function F9(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?B9(Object(e),!0).forEach(function(n){(0,N9.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):B9(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function bAe(t){var r=xAe();return function(){var n=(0,th.default)(t),i;if(r){var a=(0,th.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,z9.default)(this,i)}}function xAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var V9=function(t){(0,G9.default)(e,t);var r=bAe(e);function e(n){(0,j9.default)(this,e);var i=n.fp64,a=n.IndexType,o=a===void 0?Uint32Array:a;return r.call(this,F9(F9({},n),{},{attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:o,size:1}}}))}return(0,U9.default)(e,[{key:"get",value:function(i){var a=this.attributes;return i==="indices"?a.indices&&a.indices.subarray(0,this.vertexCount):a[i]}},{key:"updateGeometry",value:function(i){(0,AP.default)((0,th.default)(e.prototype),"updateGeometry",this).call(this,i);var a=this.buffers.indices;if(a)this.vertexCount=(a.value||a).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}},{key:"normalizeGeometry",value:function(i){if(this.normalize){var a=Zg(i,this.positionSize);return this.opts.resolution?Xp(Nl(a),eh(a),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?fP(Nl(a),eh(a),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):a}return i}},{key:"getGeometrySize",value:function(i){if(D9(i)){var a=0,o=L9(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;a+=this.getGeometrySize(u)}}catch(l){o.e(l)}finally{o.f()}return a}return Nl(i).length/this.positionSize}},{key:"getGeometryFromBuffer",value:function(i){return this.normalize||!this.buffers.indices?(0,AP.default)((0,th.default)(e.prototype),"getGeometryFromBuffer",this).call(this,i):null}},{key:"updateGeometryAttributes",value:function(i,a){if(i&&D9(i)){var o=L9(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=this.getGeometrySize(u);a.geometrySize=l,this.updateGeometryAttributes(u,a),a.vertexStart+=l,a.indexStart=this.indexStarts[a.geometryIndex+1]}}catch(f){o.e(f)}finally{o.f()}}else this._updateIndices(i,a),this._updatePositions(i,a),this._updateVertexValid(i,a)}},{key:"_updateIndices",value:function(i,a){var o=a.geometryIndex,s=a.vertexStart,u=a.indexStart,l=this.attributes,f=this.indexStarts,c=this.typedArrayManager,p=l.indices;if(!(!p||!i)){var d=u,v=I9(i,this.positionSize,this.opts.preproject,this.opts.full3d);p=c.allocate(p,u+v.length,{copy:!0});for(var m=0;m<v.length;m++)p[d++]=v[m]+s;f[o+1]=u+v.length,l.indices=p}}},{key:"_updatePositions",value:function(i,a){var o=a.vertexStart,s=a.geometrySize,u=this.attributes.positions,l=this.positionSize;if(!(!u||!i))for(var f=Nl(i),c=o,p=0;p<s;c++,p++){var d=f[p*l],v=f[p*l+1],m=l>2?f[p*l+2]:0;u[c*3]=d,u[c*3+1]=v,u[c*3+2]=m}}},{key:"_updateVertexValid",value:function(i,a){var o=a.vertexStart,s=a.geometrySize,u=this.positionSize,l=this.attributes.vertexValid,f=i&&eh(i);if(i&&i.edgeTypes?l.set(i.edgeTypes,o):l.fill(1,o,o+s),f)for(var c=0;c<f.length;c++)l[o+f[c]/u-1]=0;l[o+s-1]=0}}]),e}(Ol);function D9(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}var Qg=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var H9=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(Qg,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`);var W9=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(Qg,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`);var $9=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function X9(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function jl(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?X9(Object(e),!0).forEach(function(n){(0,nh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):X9(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function AAe(t){var r=TAe();return function(){var n=(0,Is.default)(t),i;if(r){var a=(0,Is.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Z9.default)(this,i)}}function TAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ty=[0,0,0,255],SAe={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(r){return r.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:ty},getLineColor:{type:"accessor",value:ty},material:!0},ey={enter:function(r,e){return e.length?e.subarray(e.length-r.length):r}},Bi=function(t){(0,J9.default)(e,t);var r=AAe(e);function e(){var n;(0,q9.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,nh.default)((0,K9.default)(n),"state",void 0),n}return(0,Y9.default)(e,[{key:"getShaders",value:function(i){return(0,rh.default)((0,Is.default)(e.prototype),"getShaders",this).call(this,{vs:i==="top"?H9:W9,fs:$9,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Ze,on,it]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this,a=this.context,o=a.gl,s=a.viewport,u=this.props.coordinateSystem,l=this.props._full3d;s.isGeospatial&&u===se.DEFAULT&&(u=se.LNGLAT);var f;u===se.LNGLAT&&(l?f=s.projectPosition.bind(s):f=s.projectFlat.bind(s)),this.setState({numInstances:0,polygonTesselator:new V9({preproject:f,fp64:this.use64bitPositions(),IndexType:!o||lr(o,Ae.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var c=this.getAttributeManager(),p=!0;c.remove(["instancePickingColors"]),c.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:p},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:ey,accessor:"getPolygon",update:this.calculatePositions,noAlloc:p,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:p},elevations:{size:1,transition:ey,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ey,accessor:"getFillColor",defaultValue:ty,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ey,accessor:"getLineColor",defaultValue:ty,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(v,m){var g=m.index,y=m.target;return i.encodePickingColor(v&&v.__source?v.__source.index:g,y)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"getPickingInfo",value:function(i){var a=(0,rh.default)((0,Is.default)(e.prototype),"getPickingInfo",this).call(this,i),o=a.index,s=this.props.data;return s[0]&&s[0].__source&&(a.object=s.find(function(u){return u.__source.index===o})),a}},{key:"disablePickingIndex",value:function(i){var a=this.props.data;if(a[0]&&a[0].__source)for(var o=0;o<a.length;o++)a[o].__source.index===i&&this._disablePickingIndex(o);else(0,rh.default)((0,Is.default)(e.prototype),"disablePickingIndex",this).call(this,i)}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.extruded,u=o.filled,l=o.wireframe,f=o.elevationScale,c=this.state,p=c.topModel,d=c.sideModel,v=c.polygonTesselator,m=jl(jl({},a),{},{extruded:Boolean(s),elevationScale:f});d&&(d.setInstanceCount(v.instanceCount-1),d.setUniforms(m),l&&(d.setDrawMode(3),d.setUniforms({isWireframe:!0}).draw()),u&&(d.setDrawMode(6),d.setUniforms({isWireframe:!1}).draw())),p&&(p.setVertexCount(v.vertexCount),p.setUniforms(m).draw())}},{key:"updateState",value:function(i){(0,rh.default)((0,Is.default)(e.prototype),"updateState",this).call(this,i),this.updateGeometry(i);var a=i.props,o=i.oldProps,s=i.changeFlags,u=this.getAttributeManager(),l=s.extensionsChanged||a.filled!==o.filled||a.extruded!==o.extruded;if(l){var f;(f=this.state.models)===null||f===void 0||f.forEach(function(c){return c.delete()}),this.setState(this._getModels(this.context.gl)),u.invalidateAll()}}},{key:"updateGeometry",value:function(i){var a=i.props,o=i.oldProps,s=i.changeFlags,u=s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPolygon);if(u){var l=this.state.polygonTesselator,f=a.data.attributes||{};l.updateGeometry({data:a.data,normalize:a._normalize,geometryBuffer:f.getPolygon,buffers:f,getGeometry:a.getPolygon,positionFormat:a.positionFormat,wrapLongitude:a.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:s.dataChanged,full3d:a._full3d}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),s.dataChanged||this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(i){var a=this.props,o=a.id,s=a.filled,u=a.extruded,l,f;if(s){var c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1,l=new Ee(i,jl(jl({},c),{},{id:"".concat(o,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0}))}return u&&(f=new Ee(i,jl(jl({},this.getShaders("side")),{},{id:"".concat(o,"-side"),geometry:new Ce({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1})),f.userData.excludeAttributes={indices:!0}),{models:[f,l].filter(Boolean),topModel:l,sideModel:f}}},{key:"calculateIndices",value:function(i){var a=this.state.polygonTesselator;i.startIndices=a.indexStarts,i.value=a.get("indices")}},{key:"calculatePositions",value:function(i){var a=this.state.polygonTesselator;i.startIndices=a.vertexStarts,i.value=a.get("positions")}},{key:"calculateVertexValid",value:function(i){i.value=this.state.polygonTesselator.get("vertexValid")}}]),e}(Ve);(0,nh.default)(Bi,"defaultProps",SAe);(0,nh.default)(Bi,"layerName","SolidPolygonLayer");function ry(t){for(var r=t.data,e=t.getIndex,n=t.dataRange,i=t.replace,a=n.startRow,o=a===void 0?0:a,s=n.endRow,u=s===void 0?1/0:s,l=r.length,f=l,c=l,p=0;p<l;p++){var d=e(r[p]);if(f>p&&d>=o&&(f=p),d>=u){c=p;break}}for(var v=f,m=c-f!==i.length,g=m?r.slice(c):void 0,y=0;y<i.length;y++)r[v++]=i[y];if(g){for(var _=0;_<g.length;_++)r[v++]=g[_];r.length=v}return{startRow:f,endRow:f+i.length}}function PAe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=wAe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function wAe(t,r){if(t){if(typeof t=="string")return Q9(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Q9(t,r)}}function Q9(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function OAe(t){var r=EAe();return function(){var n=(0,TP.default)(t),i;if(r){var a=(0,TP.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,nW.default)(this,i)}}function EAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var iW=[0,0,0,255],CAe=[0,0,0,255],MAe={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:function(r){return r.polygon}},getFillColor:{type:"accessor",value:CAe},getLineColor:{type:"accessor",value:iW},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},Fi=function(t){(0,rW.default)(e,t);var r=OAe(e);function e(){return(0,eW.default)(this,e),r.apply(this,arguments)}return(0,tW.default)(e,[{key:"initializeState",value:function(){this.state={paths:[]},this.props.getLineDashArray&&Z.removed("getLineDashArray","PathStyleExtension")()}},{key:"updateState",value:function(i){var a=this,o=i.changeFlags,s=o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getPolygon);if(s&&Array.isArray(o.dataChanged)){var u=this.state.paths.slice(),l=o.dataChanged.map(function(f){return ry({data:u,getIndex:function(p){return p.__source.index},dataRange:f,replace:a._getPaths(f)})});this.setState({paths:u,pathsDiff:l})}else s&&this.setState({paths:this._getPaths(),pathsDiff:null})}},{key:"_getPaths",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=this.props,o=a.data,s=a.getPolygon,u=a.positionFormat,l=a._normalize,f=[],c=u==="XY"?2:3,p=i.startRow,d=i.endRow,v=Nt(o,p,d),m=v.iterable,g=v.objectInfo,y=PAe(m),_;try{for(y.s();!(_=y.n()).done;){var b=_.value;g.index++;var x=s(b,g);l&&(x=Zg(x,c));var A=x,T=A.holeIndices,O=x.positions||x;if(T)for(var w=0;w<=T.length;w++){var E=O.slice(T[w-1]||0,T[w]||O.length);f.push(this.getSubLayerRow({path:E},b,g.index))}else f.push(this.getSubLayerRow({path:O},b,g.index))}}catch(S){y.e(S)}finally{y.f()}return f}},{key:"renderLayers",value:function(){var i=this.props,a=i.data,o=i._dataDiff,s=i.stroked,u=i.filled,l=i.extruded,f=i.wireframe,c=i._normalize,p=i._windingOrder,d=i.elevationScale,v=i.transitions,m=i.positionFormat,g=this.props,y=g.lineWidthUnits,_=g.lineWidthScale,b=g.lineWidthMinPixels,x=g.lineWidthMaxPixels,A=g.lineJointRounded,T=g.lineMiterLimit,O=g.lineDashJustified,w=this.props,E=w.getFillColor,S=w.getLineColor,I=w.getLineWidth,R=w.getLineDashArray,z=w.getElevation,G=w.getPolygon,k=w.updateTriggers,U=w.material,j=this.state,X=j.paths,H=j.pathsDiff,Q=this.getSubLayerClass("fill",Bi),ne=this.getSubLayerClass("stroke",ki),le=this.shouldRenderSubLayer("fill",X)&&new Q({_dataDiff:o,extruded:l,elevationScale:d,filled:u,wireframe:f,_normalize:c,_windingOrder:p,getElevation:z,getFillColor:E,getLineColor:l&&f?S:iW,material:U,transitions:v},this.getSubLayerProps({id:"fill",updateTriggers:k&&{getPolygon:k.getPolygon,getElevation:k.getElevation,getFillColor:k.getFillColor,lineColors:l&&f,getLineColor:k.getLineColor}}),{data:a,positionFormat:m,getPolygon:G}),xe=!l&&s&&this.shouldRenderSubLayer("stroke",X)&&new ne({_dataDiff:H&&function(){return H},widthUnits:y,widthScale:_,widthMinPixels:b,widthMaxPixels:x,jointRounded:A,miterLimit:T,dashJustified:O,_pathType:"loop",transitions:v&&{getWidth:v.getLineWidth,getColor:v.getLineColor,getPath:v.getPolygon},getColor:this.getSubLayerAccessor(S),getWidth:this.getSubLayerAccessor(I),getDashArray:this.getSubLayerAccessor(R)},this.getSubLayerProps({id:"stroke",updateTriggers:k&&{getWidth:k.getLineWidth,getColor:k.getLineColor,getDashArray:k.getLineDashArray}}),{data:X,positionFormat:m,getPath:function(ze){return ze.path}});return[!l&&le,xe,l&&le]}}]),e}(St);(0,SP.default)(Fi,"layerName","PolygonLayer");(0,SP.default)(Fi,"defaultProps",MAe);var m7=h(ny()),g7=h(L()),y7=h(N()),LP=h(Oe()),_7=h(Y()),b7=h(K()),ch=h(q()),py=h(B());var lW=h(B());function uW(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function kAe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?uW(Object(e),!0).forEach(function(n){(0,lW.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):uW(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function fW(t,r){if(!t)return null;var e="startIndices"in t?t.startIndices[r]:r,n=t.featureIds.value[e];return e!==-1?BAe(t,n,e):null}function BAe(t,r,e){var n={properties:kAe({},t.properties[r])};for(var i in t.numericProps)n.properties[i]=t.numericProps[i].value[e];return n}function cW(t,r){var e={points:null,lines:null,polygons:null};for(var n in e){var i=t[n].globalFeatureIds.value;e[n]=new Uint8ClampedArray(i.length*3);for(var a=[],o=0;o<i.length;o++)r(i[o],a),e[n][o*3+0]=a[0],e[n][o*3+1]=a[1],e[n][o*3+2]=a[2]}return e}var CP=h(ye()),n7=h(L()),i7=h(N()),uy=h(_e()),a7=h(Y()),o7=h(K()),MP=h(q()),ks=h(B());var vW=h(L()),mW=h(N()),gW=h(_e()),Rs=h(Oe()),yW=h(Y()),_W=h(K()),ga=h(q()),ih=h(B());var pW=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;

    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function hW(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function iy(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?hW(Object(e),!0).forEach(function(n){(0,ih.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):hW(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function FAe(t){var r=DAe();return function(){var n=(0,ga.default)(t),i;if(r){var a=(0,ga.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_W.default)(this,i)}}function DAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var PP=192/256,dW=[],NAe={getIconOffsets:{type:"accessor",value:function(r){return r.offsets}},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},Ul=function(t){(0,yW.default)(e,t);var r=FAe(e);function e(){var n;(0,vW.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,ih.default)((0,gW.default)(n),"state",void 0),n}return(0,mW.default)(e,[{key:"getShaders",value:function(){return iy(iy({},(0,Rs.default)((0,ga.default)(e.prototype),"getShaders",this).call(this)),{},{fs:pW})}},{key:"initializeState",value:function(){var i=this;(0,Rs.default)((0,ga.default)(e.prototype),"initializeState",this).call(this);var a=this.getAttributeManager();a.addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:function(s,u){var l=u.index,f=u.target;return i.encodePickingColor(l,f)}}})}},{key:"updateState",value:function(i){(0,Rs.default)((0,ga.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.oldProps,s=a.outlineColor;s!==o.outlineColor&&(s=s.map(function(u){return u/255}),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!a.sdf&&a.outlineWidth&&Z.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}},{key:"draw",value:function(i){var a=this.props,o=a.sdf,s=a.smoothing,u=a.outlineWidth,l=this.state.outlineColor,f=u?Math.max(s,PP*(1-u)):-1;if(i.uniforms=iy(iy({},i.uniforms),{},{sdfBuffer:PP,outlineBuffer:f,gamma:s,sdf:Boolean(o),outlineColor:l}),(0,Rs.default)((0,ga.default)(e.prototype),"draw",this).call(this,i),o&&u){var c=this.state.iconManager,p=c.getTexture();p&&this.state.model.draw({uniforms:{outlineBuffer:PP}})}}},{key:"getInstanceOffset",value:function(i){var a=this;return i?Array.from(i).flatMap(function(o){return(0,Rs.default)((0,ga.default)(e.prototype),"getInstanceOffset",a).call(a,o)}):dW}},{key:"getInstanceColorMode",value:function(i){return 1}},{key:"getInstanceIconFrame",value:function(i){var a=this;return i?Array.from(i).flatMap(function(o){return(0,Rs.default)((0,ga.default)(e.prototype),"getInstanceIconFrame",a).call(a,o)}):dW}}]),e}(po);(0,ih.default)(Ul,"defaultProps",NAe);(0,ih.default)(Ul,"layerName","MultiIconLayer");var jW=h(L()),UW=h(N()),oh=h(B());var ah=class{constructor({fontSize:r=24,buffer:e=3,radius:n=8,cutoff:i=.25,fontFamily:a="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=i,this.radius=n;let u=this.size=r+e*4,l=this._createCanvas(u),f=this.ctx=l.getContext("2d",{willReadFrequently:!0});f.font=`${s} ${o} ${r}px ${a}`,f.textBaseline="alphabetic",f.textAlign="left",f.fillStyle="black",this.gridOuter=new Float64Array(u*u),this.gridInner=new Float64Array(u*u),this.f=new Float64Array(u),this.z=new Float64Array(u+1),this.v=new Uint16Array(u)}_createCanvas(r){let e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:a,actualBoundingBoxRight:o}=this.ctx.measureText(r),s=Math.ceil(n),u=0,l=Math.min(this.size-this.buffer,Math.ceil(o-a)),f=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=l+2*this.buffer,p=f+2*this.buffer,d=Math.max(c*p,0),v=new Uint8ClampedArray(d),m={data:v,width:c,height:p,glyphWidth:l,glyphHeight:f,glyphTop:s,glyphLeft:u,glyphAdvance:e};if(l===0||f===0)return m;let{ctx:g,buffer:y,gridInner:_,gridOuter:b}=this;g.clearRect(y,y,l,f),g.fillText(r,y,y+s);let x=g.getImageData(y,y,l,f);b.fill(1e20,0,d),_.fill(0,0,d);for(let A=0;A<f;A++)for(let T=0;T<l;T++){let O=x.data[4*(A*l+T)+3]/255;if(O===0)continue;let w=(A+y)*c+T+y;if(O===1)b[w]=0,_[w]=1e20;else{let E=.5-O;b[w]=E>0?E*E:0,_[w]=E<0?E*E:0}}bW(b,0,0,c,p,c,this.f,this.v,this.z),bW(_,y,y,l,f,c,this.f,this.v,this.z);for(let A=0;A<d;A++){let T=Math.sqrt(b[A])-Math.sqrt(_[A]);v[A]=Math.round(255-255*(T/this.radius+this.cutoff))}return m}};function bW(t,r,e,n,i,a,o,s,u){for(let l=r;l<r+n;l++)xW(t,e*a+l,a,i,o,s,u);for(let l=e;l<e+i;l++)xW(t,l*a+r,1,n,o,s,u)}function xW(t,r,e,n,i,a,o){a[0]=0,o[0]=-1e20,o[1]=1e20,i[0]=t[r];for(let s=1,u=0,l=0;s<n;s++){i[s]=t[r+s*e];let f=s*s;do{let c=a[u];l=(i[s]-i[c]+f-c*c)/(s-c)/2}while(l<=o[u]&&--u>-1);u++,a[u]=s,o[u]=l,o[u+1]=1e20}for(let s=0,u=0;s<n;s++){for(;o[u+1]<s;)u++;let l=a[u],f=s-l;t[r+s*e]=i[l]+f*f}}function TW(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=jAe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function jAe(t,r){if(t){if(typeof t=="string")return AW(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return AW(t,r)}}function AW(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var UAe=32,GAe=[];function zAe(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function SW(t){var r=t.characterSet,e=t.getFontWidth,n=t.fontHeight,i=t.buffer,a=t.maxCanvasWidth,o=t.mapping,s=o===void 0?{}:o,u=t.xOffset,l=u===void 0?0:u,f=t.yOffset,c=f===void 0?0:f,p=0,d=l,v=n+i*2,m=TW(r),g;try{for(m.s();!(g=m.n()).done;){var y=g.value;if(!s[y]){var _=e(y);d+_+i*2>a&&(d=0,p++),s[y]={x:d+i,y:c+p*v+i,width:_,height:v,layoutWidth:_,layoutHeight:n},d+=_+i*2}}}catch(b){m.e(b)}finally{m.f()}return{mapping:s,xOffset:d,yOffset:c+p*v,canvasHeight:zAe(c+(p+1)*v)}}function PW(t,r,e,n){for(var i=0,a=r;a<e;a++){var o,s=t[a];i+=((o=n[s])===null||o===void 0?void 0:o.layoutWidth)||0}return i}function wW(t,r,e,n,i,a){for(var o=r,s=0,u=r;u<e;u++){var l=PW(t,u,u+1,i);s+l>n&&(o<u&&a.push(u),o=u,s=0),s+=l}return s}function VAe(t,r,e,n,i,a){for(var o=r,s=r,u=r,l=0,f=r;f<e;f++)if((t[f]===" "||t[f+1]===" "||f+1===e)&&(u=f+1),u>s){var c=PW(t,s,u,i);l+c>n&&(o<s&&(a.push(s),o=s,l=0),c>n&&(c=wW(t,s,u,n,i,a),o=a[a.length-1])),s=u,l+=c}return l}function HAe(t,r,e,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0;a===void 0&&(a=t.length);var o=[];return r==="break-all"?wW(t,i,a,e,n,o):VAe(t,i,a,e,n,o),o}function WAe(t,r,e,n,i,a){for(var o=0,s=0,u=r;u<e;u++){var l=t[u],f=n[l];f?(s||(s=f.layoutHeight),i[u]=o+f.layoutWidth/2,o+=f.layoutWidth):(Z.warn("Missing character: ".concat(l," (").concat(l.codePointAt(0),")"))(),i[u]=o,o+=UAe)}a[0]=o,a[1]=s}function OW(t,r,e,n,i){for(var a=Array.from(t),o=a.length,s=new Array(o),u=new Array(o),l=new Array(o),f=(e==="break-word"||e==="break-all")&&isFinite(n)&&n>0,c=[0,0],p=[0,0],d=0,v=0,m=0,g=0;g<=o;g++){var y=a[g];if((y===`
`||g===o)&&(m=g),m>v){for(var _=f?HAe(a,e,n,i,v,m):GAe,b=0;b<=_.length;b++){var x=b===0?v:_[b-1],A=b<_.length?_[b]:m;WAe(a,x,A,i,s,p);for(var T=x;T<A;T++){var O,w=a[T],E=((O=i[w])===null||O===void 0?void 0:O.layoutOffsetY)||0;u[T]=d+p[1]/2+E,l[T]=p[0]}d=d+p[1]*r,c[0]=Math.max(c[0],p[0])}v=m}y===`
`&&(s[v]=0,u[v]=0,l[v]=0,v++)}return c[1]=d,{x:s,y:u,rowWidth:l,size:c}}function EW(t){var r=t.value,e=t.length,n=t.stride,i=t.offset,a=t.startIndices,o=t.characterSet,s=r.BYTES_PER_ELEMENT,u=n?n/s:1,l=i?i/s:0,f=a[e]||Math.ceil((r.length-l)/u),c=o&&new Set,p=new Array(e),d=r;if(u>1||l>0){var v=r.constructor;d=new v(f);for(var m=0;m<f;m++)d[m]=r[m*u+l]}for(var g=0;g<e;g++){var y=a[g],_=a[g+1]||f,b=d.subarray(y,_);p[g]=String.fromCodePoint.apply(null,b),c&&b.forEach(c.add,c)}if(c){var x=TW(c),A;try{for(x.s();!(A=x.n()).done;){var T=A.value;o.add(String.fromCodePoint(T))}}catch(O){x.e(O)}finally{x.f()}}return{texts:p,characterCount:f}}var CW=h(L()),MW=h(N()),ay=h(B()),wP=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:5;(0,CW.default)(this,t),(0,ay.default)(this,"limit",void 0),(0,ay.default)(this,"_cache",{}),(0,ay.default)(this,"_order",[]),this.limit=r}return(0,MW.default)(t,[{key:"get",value:function(e){var n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}},{key:"set",value:function(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}},{key:"delete",value:function(e){var n=this._cache[e];n&&(delete this._cache[e],this._deleteOrder(e))}},{key:"_deleteOrder",value:function(e){var n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}},{key:"_appendOrder",value:function(e){this._order.push(e)}}]),t}();function IW(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=$Ae(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function $Ae(t,r){if(t){if(typeof t=="string")return RW(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return RW(t,r)}}function RW(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function LW(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function kW(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?LW(Object(e),!0).forEach(function(n){(0,oh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):LW(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function XAe(){for(var t=[],r=32;r<128;r++)t.push(String.fromCharCode(r));return t}var Ls={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:XAe(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},BW=1024,FW=.9,DW=1.2,GW=3,oy=new wP(GW);function qAe(t,r){var e;typeof r=="string"?e=new Set(Array.from(r)):e=new Set(r);var n=oy.get(t);if(!n)return e;for(var i in n.mapping)e.has(i)&&e.delete(i);return e}function YAe(t,r){for(var e=0;e<t.length;e++)r.data[4*e+3]=t[e]}function NW(t,r,e,n){t.font="".concat(n," ").concat(e,"px ").concat(r),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function zW(t){Z.assert(Number.isFinite(t)&&t>=GW,"Invalid cache limit"),oy=new wP(t)}var VW=function(){function t(){(0,jW.default)(this,t),(0,oh.default)(this,"props",kW({},Ls)),(0,oh.default)(this,"_key",void 0),(0,oh.default)(this,"_atlas",void 0)}return(0,UW.default)(t,[{key:"texture",get:function(){return this._atlas}},{key:"mapping",get:function(){return this._atlas&&this._atlas.mapping}},{key:"scale",get:function(){var e=this.props,n=e.fontSize,i=e.buffer;return(n*DW+i*2)/n}},{key:"setProps",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this.props,e),this._key=this._getKey();var n=qAe(this._key,this.props.characterSet),i=oy.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}var a=this._generateFontAtlas(n,i);this._atlas=a,oy.set(this._key,a)}},{key:"_generateFontAtlas",value:function(e,n){var i=this.props,a=i.fontFamily,o=i.fontWeight,s=i.fontSize,u=i.buffer,l=i.sdf,f=i.radius,c=i.cutoff,p=n&&n.data;p||(p=document.createElement("canvas"),p.width=BW);var d=p.getContext("2d",{willReadFrequently:!0});NW(d,a,s,o);var v=SW(kW({getFontWidth:function(X){return d.measureText(X).width},fontHeight:s*DW,buffer:u,characterSet:e,maxCanvasWidth:BW},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),m=v.mapping,g=v.canvasHeight,y=v.xOffset,_=v.yOffset;if(p.height!==g){var b=d.getImageData(0,0,p.width,p.height);p.height=g,d.putImageData(b,0,0)}if(NW(d,a,s,o),l){var x=new ah({fontSize:s,buffer:u,radius:f,cutoff:c,fontFamily:a,fontWeight:"".concat(o)}),A=IW(e),T;try{for(A.s();!(T=A.n()).done;){var O=T.value,w=x.draw(O),E=w.data,S=w.width,I=w.height,R=w.glyphTop;m[O].width=S,m[O].layoutOffsetY=s*FW-R;var z=d.createImageData(S,I);YAe(E,z),d.putImageData(z,m[O].x,m[O].y)}}catch(j){A.e(j)}finally{A.f()}}else{var G=IW(e),k;try{for(G.s();!(k=G.n()).done;){var U=k.value;d.fillText(U,m[U].x,m[U].y+u+s*FW)}}catch(j){G.e(j)}finally{G.f()}}return{xOffset:y,yOffset:_,mapping:m,data:p,width:p.width,height:p.height}}},{key:"_getKey",value:function(){var e=this.props,n=e.fontFamily,i=e.fontWeight,a=e.fontSize,o=e.buffer,s=e.sdf,u=e.radius,l=e.cutoff;return s?"".concat(n," ").concat(i," ").concat(a," ").concat(o," ").concat(u," ").concat(l):"".concat(n," ").concat(i," ").concat(a," ").concat(o)}}]),t}();var qW=h(L()),YW=h(N()),KW=h(_e()),OP=h(Oe()),JW=h(Y()),ZW=h(K()),sh=h(q()),uh=h(B());var HW=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var WW=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function $W(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function XW(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?$W(Object(e),!0).forEach(function(n){(0,uh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):$W(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function KAe(t){var r=JAe();return function(){var n=(0,sh.default)(t),i;if(r){var a=(0,sh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,ZW.default)(this,i)}}function JAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ZAe={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:function(r){return r.position}},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},Gl=function(t){(0,JW.default)(e,t);var r=KAe(e);function e(){var n;(0,qW.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,uh.default)((0,KW.default)(n),"state",void 0),n}return(0,YW.default)(e,[{key:"getShaders",value:function(){return(0,OP.default)((0,sh.default)(e.prototype),"getShaders",this).call(this,{vs:HW,fs:WW,modules:[Ze,it]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(i){(0,OP.default)((0,sh.default)(e.prototype),"updateState",this).call(this,i);var a=i.changeFlags;if(a.extensionsChanged){var o,s=this.context.gl;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.billboard,u=o.sizeScale,l=o.sizeUnits,f=o.sizeMinPixels,c=o.sizeMaxPixels,p=o.getLineWidth,d=this.props.padding;d.length<4&&(d=[d[0],d[1],d[0],d[1]]),this.state.model.setUniforms(a).setUniforms({billboard:s,stroked:Boolean(p),padding:d,sizeUnits:bt[l],sizeScale:u,sizeMinPixels:f,sizeMaxPixels:c}).draw()}},{key:"_getModel",value:function(i){var a=[0,0,1,0,1,1,0,1];return new Ee(i,XW(XW({},this.getShaders()),{},{id:this.props.id,geometry:new Ce({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(a)}}}),isInstanced:!0}))}}]),e}(Ve);(0,uh.default)(Gl,"defaultProps",ZAe);(0,uh.default)(Gl,"layerName","TextBackgroundLayer");function QAe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=eTe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function eTe(t,r){if(t){if(typeof t=="string")return QW(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return QW(t,r)}}function QW(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function e7(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function sy(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?e7(Object(e),!0).forEach(function(n){(0,ks.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):e7(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function tTe(t){var r=rTe();return function(){var n=(0,MP.default)(t),i;if(r){var a=(0,MP.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,o7.default)(this,i)}}function rTe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var t7={start:1,middle:0,end:-1},r7={top:1,center:0,bottom:-1},EP=[0,0,0,255],nTe=1,iTe={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:EP},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Ls.characterSet},fontFamily:Ls.fontFamily,fontWeight:Ls.fontWeight,lineHeight:nTe,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:EP},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:function(r){return r.text}},getPosition:{type:"accessor",value:function(r){return r.position}},getColor:{type:"accessor",value:EP},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},zl=function(t){(0,a7.default)(e,t);var r=tTe(e);function e(){var n;(0,n7.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,ks.default)((0,uy.default)(n),"state",void 0),(0,ks.default)((0,uy.default)(n),"getBoundingRect",function(s,u){var l=n.transformParagraph(s,u),f=(0,CP.default)(l.size,2),c=f[0],p=f[1],d=n.state.fontAtlasManager.props.fontSize;c/=d,p/=d;var v=n.props,m=v.getTextAnchor,g=v.getAlignmentBaseline,y=t7[typeof m=="function"?m(s,u):m],_=r7[typeof g=="function"?g(s,u):g];return[(y-1)*c/2,(_-1)*p/2,c,p]}),(0,ks.default)((0,uy.default)(n),"getIconOffsets",function(s,u){for(var l=n.props,f=l.getTextAnchor,c=l.getAlignmentBaseline,p=n.transformParagraph(s,u),d=p.x,v=p.y,m=p.rowWidth,g=(0,CP.default)(p.size,2),y=g[0],_=g[1],b=t7[typeof f=="function"?f(s,u):f],x=r7[typeof c=="function"?c(s,u):c],A=d.length,T=new Array(A*2),O=0,w=0;w<A;w++){var E=(1-b)*(y-m[w])/2;T[O++]=(b-1)*y/2+E+d[w],T[O++]=(x-1)*_/2+v[w]}return T}),n}return(0,i7.default)(e,[{key:"initializeState",value:function(){this.state={styleVersion:0,fontAtlasManager:new VW},this.props.maxWidth>0&&Z.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}},{key:"updateState",value:function(i){var a=i.props,o=i.oldProps,s=i.changeFlags,u=s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText);u&&this._updateText();var l=this._updateFontAtlas(),f=l||a.lineHeight!==o.lineHeight||a.wordBreak!==o.wordBreak||a.maxWidth!==o.maxWidth;f&&this.setState({styleVersion:this.state.styleVersion+1})}},{key:"getPickingInfo",value:function(i){var a=i.info;return a.object=a.index>=0?this.props.data[a.index]:null,a}},{key:"_updateFontAtlas",value:function(){var i=this.props,a=i.fontSettings,o=i.fontFamily,s=i.fontWeight,u=this.state,l=u.fontAtlasManager,f=u.characterSet,c=sy(sy({},a),{},{characterSet:f,fontFamily:o,fontWeight:s});if(!l.mapping)return l.setProps(c),!0;for(var p in c)if(c[p]!==l.props[p])return l.setProps(c),!0;return!1}},{key:"_updateText",value:function(){var i,a=this.props,o=a.data,s=a.characterSet,u=(i=o.attributes)===null||i===void 0?void 0:i.getText,l=this.props.getText,f=o.startIndices,c,p=s==="auto"&&new Set;if(u&&f){var d=EW(sy(sy({},ArrayBuffer.isView(u)?{value:u}:u),{},{length:o.length,startIndices:f,characterSet:p})),v=d.texts,m=d.characterCount;c=m,l=function(w,E){var S=E.index;return v[S]}}else{var g=Nt(o),y=g.iterable,_=g.objectInfo;f=[0],c=0;var b=QAe(y),x;try{for(b.s();!(x=b.n()).done;){var A=x.value;_.index++;var T=Array.from(l(A,_)||"");p&&T.forEach(p.add,p),c+=T.length,f.push(c)}}catch(O){b.e(O)}finally{b.f()}}this.setState({getText:l,startIndices:f,numInstances:c,characterSet:p||s})}},{key:"transformParagraph",value:function(i,a){var o=this.state.fontAtlasManager,s=o.mapping,u=this.state.getText,l=this.props,f=l.wordBreak,c=l.lineHeight,p=l.maxWidth,d=u(i,a)||"";return OW(d,c,f,p*o.props.fontSize,s)}},{key:"renderLayers",value:function(){var i=this.state,a=i.startIndices,o=i.numInstances,s=i.getText,u=i.fontAtlasManager,l=u.scale,f=u.texture,c=u.mapping,p=i.styleVersion,d=this.props,v=d.data,m=d._dataDiff,g=d.getPosition,y=d.getColor,_=d.getSize,b=d.getAngle,x=d.getPixelOffset,A=d.getBackgroundColor,T=d.getBorderColor,O=d.getBorderWidth,w=d.backgroundPadding,E=d.background,S=d.billboard,I=d.fontSettings,R=d.outlineWidth,z=d.outlineColor,G=d.sizeScale,k=d.sizeUnits,U=d.sizeMinPixels,j=d.sizeMaxPixels,X=d.transitions,H=d.updateTriggers,Q=this.getSubLayerClass("characters",Ul),ne=this.getSubLayerClass("background",Gl);return[E&&new ne({getFillColor:A,getLineColor:T,getLineWidth:O,padding:w,getPosition:g,getSize:_,getAngle:b,getPixelOffset:x,billboard:S,sizeScale:G,sizeUnits:k,sizeMinPixels:U,sizeMaxPixels:j,transitions:X&&{getPosition:X.getPosition,getAngle:X.getAngle,getSize:X.getSize,getFillColor:X.getBackgroundColor,getLineColor:X.getBorderColor,getLineWidth:X.getBorderWidth,getPixelOffset:X.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:H.getPosition,getAngle:H.getAngle,getSize:H.getSize,getFillColor:H.getBackgroundColor,getLineColor:H.getBorderColor,getLineWidth:H.getBorderWidth,getPixelOffset:H.getPixelOffset,getBoundingRect:{getText:H.getText,getTextAnchor:H.getTextAnchor,getAlignmentBaseline:H.getAlignmentBaseline,styleVersion:p}}}),{data:v.attributes&&v.attributes.background?{length:v.length,attributes:v.attributes.background}:v,_dataDiff:m,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Q({sdf:I.sdf,smoothing:Number.isFinite(I.smoothing)?I.smoothing:Ls.smoothing,outlineWidth:R/(I.radius||Ls.radius),outlineColor:z,iconAtlas:f,iconMapping:c,getPosition:g,getColor:y,getSize:_,getAngle:b,getPixelOffset:x,billboard:S,sizeScale:G*l,sizeUnits:k,sizeMinPixels:U*l,sizeMaxPixels:j*l,transitions:X&&{getPosition:X.getPosition,getAngle:X.getAngle,getColor:X.getColor,getSize:X.getSize,getPixelOffset:X.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:H.getText,getPosition:H.getPosition,getAngle:H.getAngle,getColor:H.getColor,getSize:H.getSize,getPixelOffset:H.getPixelOffset,getIconOffsets:{getTextAnchor:H.getTextAnchor,getAlignmentBaseline:H.getAlignmentBaseline,styleVersion:p}}}),{data:v,_dataDiff:m,startIndices:a,numInstances:o,getIconOffsets:this.getIconOffsets,getIcon:s})]}}],[{key:"fontAtlasCacheLimit",set:function(i){zW(i)}}]),e}(St);(0,ks.default)(zl,"defaultProps",iTe);(0,ks.default)(zl,"layerName","TextLayer");var lh={circle:{type:Ll,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:po,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:zl,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},fh={type:ki,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},ly={type:Bi,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Vl(t){var r=t.type,e=t.props,n={};for(var i in e)n[i]=r.defaultProps[e[i]];return n}function fy(t,r){var e=t.props,n=e.transitions,i=e.updateTriggers,a={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(var o in r){var s=r[o],u=t.props[o];o.startsWith("get")&&(u=t.getSubLayerAccessor(u),a.updateTriggers[s]=i[o],n&&(a.transitions[s]=n[o])),a[s]=u}return a}function u7(t){if(Array.isArray(t))return t;switch(Z.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Z.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function IP(t,r){for(var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},i=e.startRow,a=i===void 0?0:i,o=e.endRow,s=o===void 0?t.length:o,u=a;u<s;u++){var l=t[u],f=l.geometry;if(f)if(f.type==="GeometryCollection"){Z.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");for(var c=f.geometries,p=0;p<c.length;p++){var d=c[p];s7(d,n,r,l,u)}}else s7(f,n,r,l,u)}return n}function s7(t,r,e,n,i){var a=t.type,o=t.coordinates,s=r.pointFeatures,u=r.lineFeatures,l=r.polygonFeatures,f=r.polygonOutlineFeatures;if(!oTe(a,o)){Z.warn("".concat(a," coordinates are malformed"))();return}switch(a){case"Point":s.push(e({geometry:t},n,i));break;case"MultiPoint":o.forEach(function(c){s.push(e({geometry:{type:"Point",coordinates:c}},n,i))});break;case"LineString":u.push(e({geometry:t},n,i));break;case"MultiLineString":o.forEach(function(c){u.push(e({geometry:{type:"LineString",coordinates:c}},n,i))});break;case"Polygon":l.push(e({geometry:t},n,i)),o.forEach(function(c){f.push(e({geometry:{type:"LineString",coordinates:c}},n,i))});break;case"MultiPolygon":o.forEach(function(c){l.push(e({geometry:{type:"Polygon",coordinates:c}},n,i)),c.forEach(function(p){f.push(e({geometry:{type:"LineString",coordinates:p}},n,i))})});break;default:}}var aTe={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function oTe(t,r){var e=aTe[t];for(Z.assert(e,"Unknown GeoJSON type ".concat(t));r&&--e>0;)r=r[0];return r&&Number.isFinite(r[0])}var f7=h(B());function l7(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function yo(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?l7(Object(e),!0).forEach(function(n){(0,f7.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):l7(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function c7(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function cy(t){return t.geometry.coordinates}function p7(t,r){var e=c7(),n=t.pointFeatures,i=t.lineFeatures,a=t.polygonFeatures,o=t.polygonOutlineFeatures;return e.points.data=n,e.points._dataDiff=r.pointFeatures&&function(){return r.pointFeatures},e.points.getPosition=cy,e.lines.data=i,e.lines._dataDiff=r.lineFeatures&&function(){return r.lineFeatures},e.lines.getPath=cy,e.polygons.data=a,e.polygons._dataDiff=r.polygonFeatures&&function(){return r.polygonFeatures},e.polygons.getPolygon=cy,e.polygonsOutline.data=o,e.polygonsOutline._dataDiff=r.polygonOutlineFeatures&&function(){return r.polygonOutlineFeatures},e.polygonsOutline.getPath=cy,e}function h7(t,r){var e=c7(),n=t.points,i=t.lines,a=t.polygons,o=cW(t,r);return e.points.data={length:n.positions.value.length/n.positions.size,attributes:yo(yo({},n.attributes),{},{getPosition:n.positions,instancePickingColors:{size:3,value:o.points}}),properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},e.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:yo(yo({},i.attributes),{},{getPath:i.positions,instancePickingColors:{size:3,value:o.lines}}),properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},e.lines._pathType="open",e.polygons.data={length:a.polygonIndices.value.length-1,startIndices:a.polygonIndices.value,attributes:yo(yo({},a.attributes),{},{getPolygon:a.positions,pickingColors:{size:3,value:o.polygons}}),properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},e.polygons._normalize=!1,a.triangles&&(e.polygons.data.attributes.indices=a.triangles.value),e.polygonsOutline.data={length:a.primitivePolygonIndices.value.length-1,startIndices:a.primitivePolygonIndices.value,attributes:yo(yo({},a.attributes),{},{getPath:a.positions,instancePickingColors:{size:3,value:o.polygons}}),properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},e.polygonsOutline._pathType="open",e}var sTe=["instancePickingColors"];function RP(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=uTe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function uTe(t,r){if(t){if(typeof t=="string")return d7(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return d7(t,r)}}function d7(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function lTe(t){var r=fTe();return function(){var n=(0,ch.default)(t),i;if(r){var a=(0,ch.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,b7.default)(this,i)}}function fTe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function v7(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Di(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?v7(Object(e),!0).forEach(function(n){(0,py.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):v7(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var cTe=["points","linestrings","polygons"],pTe=Di(Di(Di(Di(Di(Di({},Vl(lh.circle)),Vl(lh.icon)),Vl(lh.text)),Vl(fh)),Vl(ly)),{},{stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:function(r){return r.properties.icon}},getText:{type:"accessor",value:function(r){return r.properties.text}},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}}),ya=function(t){(0,_7.default)(e,t);var r=lTe(e);function e(){return(0,g7.default)(this,e),r.apply(this,arguments)}return(0,y7.default)(e,[{key:"initializeState",value:function(){this.state={layerProps:{},features:{}}}},{key:"updateState",value:function(i){var a=i.props,o=i.changeFlags;if(o.dataChanged){var s=this.props.data,u=s&&"points"in s&&"polygons"in s&&"lines"in s;this.setState({binary:u}),u?this._updateStateBinary({props:a,changeFlags:o}):this._updateStateJSON({props:a,changeFlags:o})}}},{key:"_updateStateBinary",value:function(i){var a=i.props,o=i.changeFlags,s=h7(a.data,this.encodePickingColor);this.setState({layerProps:s})}},{key:"_updateStateJSON",value:function(i){var a=i.props,o=i.changeFlags,s=u7(a.data),u=this.getSubLayerRow.bind(this),l={},f={};if(Array.isArray(o.dataChanged)){var c=this.state.features;for(var p in c)l[p]=c[p].slice(),f[p]=[];var d=RP(o.dataChanged),v;try{for(d.s();!(v=d.n()).done;){var m=v.value,g=IP(s,u,m);for(var y in c)f[y].push(ry({data:l[y],getIndex:function(x){return x.__source.index},dataRange:m,replace:g[y]}))}}catch(b){d.e(b)}finally{d.f()}}else l=IP(s,u);var _=p7(l,f);this.setState({features:l,featuresDiff:f,layerProps:_})}},{key:"getPickingInfo",value:function(i){var a=this,o=(0,LP.default)((0,ch.default)(e.prototype),"getPickingInfo",this).call(this,i),s=o.index,u=o.sourceLayer;return o.featureType=cTe.find(function(l){return u.id.startsWith("".concat(a.id,"-").concat(l,"-"))}),s>=0&&u.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(o.index=this.props.data.points.globalFeatureIds.value[s]),o}},{key:"_updateAutoHighlight",value:function(i){var a="".concat(this.id,"-points-"),o=i.featureType==="points",s=RP(this.getSubLayers()),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;l.id.startsWith(a)===o&&l.updateAutoHighlight(i)}}catch(f){s.e(f)}finally{s.f()}}},{key:"_renderPolygonLayer",value:function(){var i=this.props,a=i.extruded,o=i.wireframe,s=this.state.layerProps,u="polygons-fill",l=this.shouldRenderSubLayer(u,s.polygons.data)&&this.getSubLayerClass(u,ly.type);if(l){var f=fy(this,ly.props),c=a&&o;return c||delete f.getLineColor,f.updateTriggers.lineColors=c,new l(f,this.getSubLayerProps({id:u,updateTriggers:f.updateTriggers}),s.polygons)}return null}},{key:"_renderLineLayers",value:function(){var i=this.props,a=i.extruded,o=i.stroked,s=this.state.layerProps,u="polygons-stroke",l="linestrings",f=!a&&o&&this.shouldRenderSubLayer(u,s.polygonsOutline.data)&&this.getSubLayerClass(u,fh.type),c=this.shouldRenderSubLayer(l,s.lines.data)&&this.getSubLayerClass(l,fh.type);if(f||c){var p=fy(this,fh.props);return[f&&new f(p,this.getSubLayerProps({id:u,updateTriggers:p.updateTriggers}),s.polygonsOutline),c&&new c(p,this.getSubLayerProps({id:l,updateTriggers:p.updateTriggers}),s.lines)]}return null}},{key:"_renderPointLayers",value:function(){var i=this.props.pointType,a=this.state,o=a.layerProps,s=a.binary,u=this.props.highlightedObjectIndex;!s&&Number.isFinite(u)&&(u=o.points.data.findIndex(function(T){return T.__source.index===u}));var l=new Set(i.split("+")),f=[],c=RP(l),p;try{for(c.s();!(p=c.n()).done;){var d=p.value,v="points-".concat(d),m=lh[d],g=m&&this.shouldRenderSubLayer(v,o.points.data)&&this.getSubLayerClass(v,m.type);if(g){var y=fy(this,m.props),_=o.points;if(d==="text"&&s){var b=_.data.attributes,x=b.instancePickingColors,A=(0,m7.default)(b,sTe);_=Di(Di({},_),{},{data:Di(Di({},_.data),{},{attributes:A})})}f.push(new g(y,this.getSubLayerProps({id:v,updateTriggers:y.updateTriggers,highlightedObjectIndex:u}),_))}}}catch(T){c.e(T)}finally{c.f()}return f}},{key:"renderLayers",value:function(){var i=this.props.extruded,a=this._renderPolygonLayer(),o=this._renderLineLayers(),s=this._renderPointLayers();return[!i&&a,o,s,i&&a]}},{key:"getSubLayerAccessor",value:function(i){var a=this.state.binary;return!a||typeof i!="function"?(0,LP.default)((0,ch.default)(e.prototype),"getSubLayerAccessor",this).call(this,i):function(o,s){var u=s.data,l=s.index,f=fW(u,l);return i(f,s)}}}]),e}(St);(0,py.default)(ya,"layerName","GeoJsonLayer");(0,py.default)(ya,"defaultProps",pTe);var v$=h(B()),m$=h(ge()),YP=h(de());var l$=h(ye());var s$=h(ge()),HP=h(de());var a$=h(B());var o$=h(n$());function i$(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function _Se(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?i$(Object(e),!0).forEach(function(n){(0,a$.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):i$(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function VP(t,r){var e=new o$.XMLParser(_Se({ignoreAttributes:!1,attributeNamePrefix:""},r?.xml)),n=e.parse(t);return n}var bSe="3.3.3",Fs={name:"XML",id:"xml",module:"xml",version:bSe,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:xSe,options:{xml:{}},parse:function(){var t=(0,s$.default)(HP.default.mark(function e(n,i){return HP.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",VP(new TextDecoder().decode(n),i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}(),parseTextSync:function(r,e){return VP(r,e)}};function xSe(t){return t.startsWith("<?xml")}function f$(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=ASe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function ASe(t,r){if(t){if(typeof t=="string")return u$(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return u$(t,r)}}function u$(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function WP(t,r){var e=Fs.parseTextSync(t,r),n=e.WMT_MS_Capabilities||e.WMS_Capabilities||e;return TSe(n)}function TSe(t){var r,e,n,i={name:((r=t.Service)===null||r===void 0?void 0:r.Name)||"unnamed",title:(e=t.Service)===null||e===void 0?void 0:e.Title,keywords:[],requests:{},layer:c$((n=t.Capability)===null||n===void 0?void 0:n.Layer),raw:t},a=f$(((u=t.Service)===null||u===void 0||(l=u.KeywordList)===null||l===void 0?void 0:l.Keyword)||[]),o;try{for(a.s();!(o=a.n()).done;){var s=o.value,u,l;i.keywords.push(s)}}catch(g){a.e(g)}finally{a.f()}for(var f=0,c=Object.entries(((m=t.Capability)===null||m===void 0?void 0:m.Request)||{});f<c.length;f++){var p=(0,l$.default)(c[f],2),d=p[0],v=p[1],m;i.requests[d]=SSe(d,v)}return i}function SSe(t,r){var e=r?.Format,n=Array.isArray(e)?e:[e];return{name:t,mimeTypes:n}}function c$(t){var r={name:t?.Name,title:t?.Title,srs:t?.SRS||[],layers:[]},e=PSe(t?.Layer),n=f$(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o;(o=r.layers)===null||o===void 0||o.push(c$(a))}}catch(s){n.e(s)}finally{n.f()}return r}function PSe(t){return Array.isArray(t)?t:t?[t]:[]}function $P(t,r){var e,n=Fs.parseTextSync(t,r),i=((e=n.FeatureInfoResponse)===null||e===void 0?void 0:e.FIELDS)||[],a=Array.isArray(i)?i:[i];return{features:a.map(function(o){return wSe(o)})}}function wSe(t){var r=t||{};return{attributes:r,type:"",bounds:{bottom:0,top:0,left:0,right:0}}}function XP(t,r){var e=Fs.parseTextSync(t,r);return e}function p$(t,r){var e,n,i,a=(e=Fs.parseTextSync)===null||e===void 0?void 0:e.call(Fs,t,r),o=(a==null||(n=a.ServiceExceptionReport)===null||n===void 0?void 0:n.ServiceException)||(a==null||(i=a["ogc:ServiceExceptionReport"])===null||i===void 0?void 0:i["ogc:ServiceException"]),s=typeof o=="string"?o:o["#text"]||o.code||"Unknown error";return s}function h$(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function d$(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?h$(Object(e),!0).forEach(function(n){(0,v$.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):h$(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var OSe="3.3.3",Hl={id:"wms-error",name:"WMS Error",module:"wms",version:OSe,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:ESe,options:{wms:{throwOnError:!1}},parse:function(){var t=(0,m$.default)(YP.default.mark(function e(n,i){return YP.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",qP(new TextDecoder().decode(n),i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}(),parseSync:function(r,e){return qP(new TextDecoder().decode(r),e)},parseTextSync:function(r,e){return qP(r,e)}};function ESe(t){return t.startsWith("<?xml")}function qP(t,r){var e=d$(d$({},Hl.options.wms),r?.wms),n=p$(t,e),i=e.minimalErrors?n:"WMS Service error: ".concat(n);if(e.throwOnError)throw new Error(i);return i}var g$=h(ge()),KP=h(de());var CSe="3.3.3",Ds={id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:CSe,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:MSe,options:{wms:{}},parse:function(){var t=(0,g$.default)(KP.default.mark(function e(n,i){return KP.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",WP(new TextDecoder().decode(n),i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}(),parseTextSync:function(r,e){return WP(r,e)}};function MSe(t){return t.startsWith("<?xml")}var y$=h(L()),ba=function t(){(0,y$.default)(this,t)};var b$=h(B()),JP=h(ye()),ZP=h(ge()),x$=h(L()),A$=h(N()),QP=h(_e()),T$=h(Y()),S$=h(K()),ew=h(q()),mh=h(de());function _$(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Wl(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?_$(Object(e),!0).forEach(function(n){(0,b$.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):_$(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function ISe(t){var r=RSe();return function(){var n=(0,ew.default)(t),i;if(r){var a=(0,ew.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,S$.default)(this,i)}}function RSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gh=function(t){(0,T$.default)(e,t);var r=ISe(e);function e(n){var i;return(0,x$.default)(this,e),i=r.call(this),C((0,QP.default)(i),"props",void 0),C((0,QP.default)(i),"fetch",void 0),i.props=yh(n),i.fetch=$l(n),i}return(0,A$.default)(e,[{key:"getMetadata",value:function(){var n=(0,ZP.default)(mh.default.mark(function a(){return mh.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:throw new Error("ImageSource.getMetadata not implemented");case 1:case"end":return s.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getImage",value:function(){var n=(0,ZP.default)(mh.default.mark(function a(o){var s,u,l,f;return mh.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return s=this.getGranularParameters(o),u=this.getURLFromTemplate(s),p.next=4,this.fetch(u);case 4:return l=p.sent,p.next=7,l.arrayBuffer();case 7:return f=p.sent,p.next=10,Vn.parse(f);case 10:return p.abrupt("return",p.sent);case 11:case"end":return p.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"getGranularParameters",value:function(i){var a=(0,JP.default)(i.bbox,4),o=a[0],s=a[1],u=a[2],l=a[3];return Wl(Wl({},i),{},{east:o,north:s,south:l,west:u})}},{key:"getURLFromTemplate",value:function(i){for(var a=this.props.url,o=0,s=Object.entries(i);o<s.length;o++){var u=(0,JP.default)(s[o],2),l=u[0],f=u[1];a=a.replace("${".concat(l,"}"),String(f)),a=a.replace("{".concat(l,"}"),String(f))}return a}}]),e}(ba);C(gh,"type","template");C(gh,"testURL",function(t){return t.toLowerCase().includes("{")});function $l(t){var r=t?.fetch;if(r&&typeof r=="function")return function(n,i){return r(n,i)};var e=t?.fetch;return e&&typeof e!="function"?function(n){return fetch(n,e)}:function(n){return fetch(n)}}function yh(t){return Wl(Wl({},t),{},{loadOptions:Wl(Wl({},t.loadOptions),{},{fetch:$l(t.loadOptions)})})}var k$=h(ye()),Ns=h(ge()),B$=h(B()),F$=h(L()),D$=h(N()),_h=h(_e()),N$=h(Y()),j$=h(K()),aw=h(q()),ln=h(de());var O$=h(ge()),E$=h(B()),tw=h(de());function P$(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function w$(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?P$(Object(e),!0).forEach(function(n){(0,E$.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):P$(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var rw=w$(w$({},Ds),{},{id:"wms-feature-info",name:"WMS FeatureInfo",parse:function(){var t=(0,O$.default)(tw.default.mark(function e(n,i){return tw.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",$P(new TextDecoder().decode(n),i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}(),parseTextSync:function(r,e){return $P(r,e)}});var I$=h(ge()),R$=h(B()),nw=h(de());function C$(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function M$(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?C$(Object(e),!0).forEach(function(n){(0,R$.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):C$(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var iw=M$(M$({},Ds),{},{id:"wms-layer-description",name:"WMS DescribeLayer",parse:function(){var t=(0,I$.default)(nw.default.mark(function e(n,i){return nw.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",XP(new TextDecoder().decode(n),i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}(),parseTextSync:function(r,e){return XP(r,e)}});function L$(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function xr(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?L$(Object(e),!0).forEach(function(n){(0,B$.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):L$(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function LSe(t){var r=kSe();return function(){var n=(0,aw.default)(t),i;if(r){var a=(0,aw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,j$.default)(this,i)}}function kSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var bh=function(t){(0,N$.default)(e,t);var r=LSe(e);function e(n){var i;(0,F$.default)(this,e);var a;return i=r.call(this),C((0,_h.default)(i),"props",void 0),C((0,_h.default)(i),"fetch",void 0),C((0,_h.default)(i),"capabilities",null),C((0,_h.default)(i),"loaders",[Vn,Hl,Ds,rw,iw]),i.props=yh(n),i.fetch=$l(i.props),i.props.loadOptions=xr(xr({},i.props.loadOptions),{},{wms:xr(xr({},(a=i.props.loadOptions)===null||a===void 0?void 0:a.wms),{},{throwOnError:!0})}),i}return(0,D$.default)(e,[{key:"getMetadata",value:function(){return this.getCapabilities()}},{key:"getImage",value:function(i){return this.getMap(i)}},{key:"getCapabilities",value:function(){var n=(0,Ns.default)(ln.default.mark(function a(o,s){var u,l,f,c;return ln.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return u=this.getCapabilitiesURL(o,s),d.next=3,this.fetch(u);case 3:return l=d.sent,d.next=6,l.arrayBuffer();case 6:return f=d.sent,this._checkResponse(l,f),d.next=10,Ds.parse(f,this.props.loadOptions);case 10:return c=d.sent,this.capabilities=c,d.abrupt("return",c);case 13:case"end":return d.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"getMap",value:function(){var n=(0,Ns.default)(ln.default.mark(function a(o,s){var u,l,f;return ln.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getMapURL(o,s),p.next=3,this.fetch(u);case 3:return l=p.sent,p.next=6,l.arrayBuffer();case 6:return f=p.sent,this._checkResponse(l,f),p.prev=8,p.next=11,Vn.parse(f,this.props.loadOptions);case 11:return p.abrupt("return",p.sent);case 14:throw p.prev=14,p.t0=p.catch(8),this._parseError(f);case 17:case"end":return p.stop()}},a,this,[[8,14]])}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"getFeatureInfo",value:function(){var n=(0,Ns.default)(ln.default.mark(function a(o,s){var u,l,f;return ln.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getFeatureInfoURL(o,s),p.next=3,this.fetch(u);case 3:return l=p.sent,p.next=6,l.arrayBuffer();case 6:return f=p.sent,this._checkResponse(l,f),p.next=10,rw.parse(f,this.props.loadOptions);case 10:return p.abrupt("return",p.sent);case 11:case"end":return p.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"getFeatureInfoText",value:function(){var n=(0,Ns.default)(ln.default.mark(function a(o,s){var u,l,f;return ln.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o=xr(xr({},o),{},{info_format:"text/plain"}),u=this.getFeatureInfoURL(o,s),p.next=4,this.fetch(u);case 4:return l=p.sent,p.next=7,l.arrayBuffer();case 7:return f=p.sent,this._checkResponse(l,f),p.abrupt("return",new TextDecoder().decode(f));case 10:case"end":return p.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"describeLayer",value:function(){var n=(0,Ns.default)(ln.default.mark(function a(o,s){var u,l,f;return ln.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.describeLayerURL(o,s),p.next=3,this.fetch(u);case 3:return l=p.sent,p.next=6,l.arrayBuffer();case 6:return f=p.sent,this._checkResponse(l,f),p.next=10,iw.parse(f,this.props.loadOptions);case 10:return p.abrupt("return",p.sent);case 11:case"end":return p.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"getLegendGraphic",value:function(){var n=(0,Ns.default)(ln.default.mark(function a(o,s){var u,l,f;return ln.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getLegendGraphicURL(o,s),p.next=3,this.fetch(u);case 3:return l=p.sent,p.next=6,l.arrayBuffer();case 6:return f=p.sent,this._checkResponse(l,f),p.prev=8,p.next=11,Vn.parse(f,this.props.loadOptions);case 11:return p.abrupt("return",p.sent);case 14:throw p.prev=14,p.t0=p.catch(8),this._parseError(f);case 17:case"end":return p.stop()}},a,this,[[8,14]])}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"getCapabilitiesURL",value:function(i,a){var o=xr(xr({service:"WMS",version:"1.1.1",request:"GetCapabilities"},i),a);return this._getWMSUrl(o,a)}},{key:"getMapURL",value:function(i,a){var o=xr(xr({service:"WMS",version:"1.1.1",request:"GetMap",styles:void 0,srs:"EPSG:4326",format:"image/png"},i),a);return this._getWMSUrl(o,a)}},{key:"getFeatureInfoURL",value:function(i,a){var o=xr(xr({service:"WMS",version:"1.1.1",request:"GetFeatureInfo",srs:"EPSG:4326",format:"image/png",info_format:"text/plain",styles:void 0},i),a);return this._getWMSUrl(o,a)}},{key:"describeLayerURL",value:function(i,a){var o=xr(xr({service:"WMS",version:"1.1.1",request:"DescribeLayer"},i),a);return this._getWMSUrl(o,a)}},{key:"getLegendGraphicURL",value:function(i,a){var o=xr(xr({service:"WMS",version:"1.1.1",request:"GetLegendGraphic"},i),a);return this._getWMSUrl(o,a)}},{key:"_getWMSUrl",value:function(i,a){for(var o=this.props.url,s=!0,u=0,l=Object.entries(i);u<l.length;u++){var f=(0,k$.default)(l[u],2),c=f[0],p=f[1];o+=s?"?":"&",s=!1,Array.isArray(p)?o+="".concat(c.toUpperCase(),"=").concat(p.join(",")):o+="".concat(c.toUpperCase(),"=").concat(p?String(p):"")}return encodeURI(o)}},{key:"_checkResponse",value:function(i,a){var o=i.headers["content-type"];if(!i.ok||Hl.mimeTypes.includes(o)){var s=Hl.parseSync(a,this.props.loadOptions);throw new Error(s)}}},{key:"_parseError",value:function(i){var a=Hl.parseSync(i,this.props.loadOptions);return new Error(a)}}]),e}(ba);C(bh,"type","wms");C(bh,"testURL",function(t){return t.toLowerCase().includes("wms")});var U$=h(ye()),xh=h(ge()),G$=h(L()),z$=h(N()),ow=h(_e()),V$=h(Y()),H$=h(K()),sw=h(q()),xa=h(de());function BSe(t){var r=FSe();return function(){var n=(0,sw.default)(t),i;if(r){var a=(0,sw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,H$.default)(this,i)}}function FSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hy=function(t){(0,V$.default)(e,t);var r=BSe(e);function e(n){var i;return(0,G$.default)(this,e),i=r.call(this),C((0,ow.default)(i),"props",void 0),C((0,ow.default)(i),"fetch",void 0),i.props=yh(n),i.fetch=$l(i.props),i}return(0,z$.default)(e,[{key:"getMetadata",value:function(){var n=(0,xh.default)(xa.default.mark(function a(){return xa.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.info();case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getImage",value:function(){var n=(0,xh.default)(xa.default.mark(function a(o){return xa.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:throw new Error("not implemented");case 1:case"end":return u.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"info",value:function(){var n=(0,xh.default)(xa.default.mark(function a(){return xa.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:throw new Error("not implemented");case 1:case"end":return s.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"exportImage",value:function(i){throw new Error("not implemented")}},{key:"infoURL",value:function(i){return this.props.url}},{key:"exportImageURL",value:function(i){return this.props.url}},{key:"getUrl",value:function(i,a){for(var o="".concat(this.props.url),s=!0,u=0,l=Object.entries(i);u<l.length;u++){var f=(0,U$.default)(l[u],2),c=f[0],p=f[1];o+=s?"?":"&",s=!1,Array.isArray(p)?o+="".concat(c.toUpperCase(),"=").concat(p.join(",")):o+="".concat(c.toUpperCase(),"=").concat(p?String(p):"")}return o}},{key:"checkResponse",value:function(){var n=(0,xh.default)(xa.default.mark(function a(o){return xa.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(o.ok){u.next=2;break}throw new Error("error");case 2:case"end":return u.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()}]),e}(ba);C(hy,"type","arcgis-image-server");C(hy,"testURL",function(t){return t.toLowerCase().includes("ImageServer")});function DSe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=NSe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function NSe(t,r){if(t){if(typeof t=="string")return W$(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return W$(t,r)}}function W$(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var jSe=[bh,hy,gh];function uw(t){var r=t.type,e=r===void 0?"auto":r,n=e==="auto"?USe(t.url):e;switch(n){case"template":return new gh(t);case"wms":return new bh(t);default:throw new Error("Not a valid image source type")}}function USe(t){var r=DSe(jSe),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.testURL&&n.testURL(t))return n.type}}catch(i){r.e(i)}finally{r.f()}return"wms"}var $$=6378137*Math.PI;function lw(t){var r=At(t);return r[0]=(r[0]/256-1)*$$,r[1]=(r[1]/256-1)*$$,r}function X$(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function dy(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?X$(Object(e),!0).forEach(function(n){(0,Ah.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):X$(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function GSe(t){var r=zSe();return function(){var n=(0,my.default)(t),i;if(r){var a=(0,my.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Q$.default)(this,i)}}function zSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VSe={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:function(){}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:function(){}},onImageLoad:{type:"function",value:function(){}},onImageLoadError:{type:"function",compare:!1,value:function(r,e){return console.error(e,r)}}},gy=function(t){(0,Z$.default)(e,t);var r=GSe(e);function e(){var n;(0,q$.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Ah.default)((0,K$.default)(n),"state",void 0),n}return(0,Y$.default)(e,[{key:"isLoaded",get:function(){return Boolean(this.state)&&this.state.loadCounter===0&&(0,J$.default)((0,my.default)(e.prototype),"isLoaded",this)}},{key:"shouldUpdateState",value:function(){return!0}},{key:"initializeState",value:function(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}},{key:"updateState",value:function(i){var a=this,o=i.changeFlags,s=i.props,u=i.oldProps,l=this.context.viewport;o.dataChanged||s.serviceType!==u.serviceType?(this.state.imageSource=this._createImageSource(s),this._loadMetadata(),this.debounce(function(){return a.loadImage(l,"image source changed")},0)):It(s.layers,u.layers,1)?o.viewportChanged&&this.debounce(function(){return a.loadImage(l,"viewport changed")}):this.debounce(function(){return a.loadImage(l,"layers changed")},0)}},{key:"finalizeState",value:function(){}},{key:"renderLayers",value:function(){var i=this.state,a=i.bounds,o=i.image,s=i.lastRequestParameters;return o&&new Cl(dy(dy({},this.getSubLayerProps({id:"bitmap"})),{},{_imageCoordinateSystem:s.srs==="EPSG:4326"?se.LNGLAT:se.CARTESIAN,bounds:a,image:o}))}},{key:"getFeatureInfoText",value:function(){var n=(0,vy.default)(js.default.mark(function a(o,s){var u,l,f,c;return js.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(u=this.state.lastRequestParameters,!u){d.next=6;break}return d.next=4,(l=(f=this.state.imageSource).getFeatureInfoText)===null||l===void 0?void 0:l.call(f,dy(dy({},u),{},{query_layers:u.layers,x:o,y:s,info_format:"application/vnd.ogc.gml"}));case 4:return c=d.sent,d.abrupt("return",c);case 6:return d.abrupt("return","");case 7:case"end":return d.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"_createImageSource",value:function(i){if(i.data instanceof ba)return i.data;if(typeof i.data=="string")return uw({url:i.data,loadOptions:i.loadOptions,type:i.serviceType});throw new Error("invalid image source in props.data")}},{key:"_loadMetadata",value:function(){var n=(0,vy.default)(js.default.mark(function a(){var o,s,u,l;return js.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.state.imageSource,c.prev=1,this.state.loadCounter++,c.next=5,o.getMetadata();case 5:s=c.sent,this.state.imageSource===o&&((u=this.getCurrentLayer())===null||u===void 0||u.props.onMetadataLoad(s)),c.next=12;break;case 9:c.prev=9,c.t0=c.catch(1),(l=this.getCurrentLayer())===null||l===void 0||l.props.onMetadataLoadError(c.t0);case 12:return c.prev=12,this.state.loadCounter--,c.finish(12);case 15:case"end":return c.stop()}},a,this,[[1,9,12,15]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"loadImage",value:function(){var n=(0,vy.default)(js.default.mark(function a(o,s){var u,l,f,c,p,d,v,m,g,y,_,b,x,A,T,O,w,E,S,I;return js.default.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(u=this.props,l=u.layers,f=u.serviceType,!(f==="wms"&&l.length===0)){z.next=3;break}return z.abrupt("return");case 3:return c=o.getBounds(),p=o.width,d=o.height,v=this.getRequestId(),m=this.props.srs,m==="auto"&&(m=o.resolution?"EPSG:4326":"EPSG:3857"),g={width:p,height:d,bbox:c,layers:l,srs:m},m==="EPSG:3857"&&(y=lw([c[0],c[1]]),_=(0,fw.default)(y,2),b=_[0],x=_[1],A=lw([c[2],c[3]]),T=(0,fw.default)(A,2),O=T[0],w=T[1],g.bbox=[b,x,O,w]),z.prev=10,this.state.loadCounter++,this.props.onImageLoadStart(v),z.next=15,this.state.imageSource.getImage(g);case 15:E=z.sent,this.state.lastRequestId<v&&((S=this.getCurrentLayer())===null||S===void 0||S.props.onImageLoad(v),this.setState({image:E,bounds:c,lastRequestParameters:g,lastRequestId:v})),z.next=23;break;case 19:z.prev=19,z.t0=z.catch(10),this.raiseError(z.t0,"Load image"),(I=this.getCurrentLayer())===null||I===void 0||I.props.onImageLoadError(v,z.t0);case 23:return z.prev=23,this.state.loadCounter--,z.finish(23);case 26:case"end":return z.stop()}},a,this,[[10,19,23,26]])}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"getRequestId",value:function(){return this.state._nextRequestId++}},{key:"debounce",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:500;clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(function(){return i()},a)}}]),e}(St);(0,Ah.default)(gy,"layerName","WMSLayer");(0,Ah.default)(gy,"defaultProps",VSe);var eX=h(L()),tX=h(Y()),rX=h(K()),cw=h(q()),pw=h(B());function HSe(t){var r=WSe();return function(){var n=(0,cw.default)(t),i;if(r){var a=(0,cw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rX.default)(this,i)}}function WSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $Se={getHeight:{type:"accessor",value:0},greatCircle:!0},yy=function(t){(0,tX.default)(e,t);var r=HSe(e);function e(){return(0,eX.default)(this,e),r.apply(this,arguments)}return e}(El);(0,pw.default)(yy,"layerName","GreatCircleLayer");(0,pw.default)(yy,"defaultProps",$Se);var _X=h(L()),bX=h(N()),xX=h(Y()),AX=h(K()),mw=h(q()),gw=h(B());var iX=h(L()),aX=h(N()),oX=h(Y()),sX=h(K()),hw=h(q()),_y=h(B());function XSe(t){var r=qSe();return function(){var n=(0,hw.default)(t),i;if(r){var a=(0,hw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,sX.default)(this,i)}}function qSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function nX(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function YSe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?nX(Object(e),!0).forEach(function(n){(0,_y.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):nX(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var KSe=YSe({},Fi.defaultProps),Cn=function(t){(0,oX.default)(e,t);var r=XSe(e);function e(){return(0,iX.default)(this,e),r.apply(this,arguments)}return(0,aX.default)(e,[{key:"indexToBounds",value:function(){return null}},{key:"renderLayers",value:function(){var i=this.props,a=i.elevationScale,o=i.extruded,s=i.wireframe,u=i.filled,l=i.stroked,f=i.lineWidthUnits,c=i.lineWidthScale,p=i.lineWidthMinPixels,d=i.lineWidthMaxPixels,v=i.lineJointRounded,m=i.lineMiterLimit,g=i.lineDashJustified,y=i.getElevation,_=i.getFillColor,b=i.getLineColor,x=i.getLineWidth,A=this.props,T=A.updateTriggers,O=A.material,w=A.transitions,E=this.getSubLayerClass("cell",Fi);return new E({filled:u,wireframe:s,extruded:o,elevationScale:a,stroked:l,lineWidthUnits:f,lineWidthScale:c,lineWidthMinPixels:p,lineWidthMaxPixels:d,lineJointRounded:v,lineMiterLimit:m,lineDashJustified:g,material:O,transitions:w,getElevation:y,getFillColor:_,getLineColor:b,getLineWidth:x},this.getSubLayerProps({id:"cell",updateTriggers:T&&{getElevation:T.getElevation,getFillColor:T.getFillColor,getLineColor:T.getLineColor,getLineWidth:T.getLineWidth}}),this.indexToBounds())}}]),e}(St);(0,_y.default)(Cn,"layerName","GeoCellLayer");(0,_y.default)(Cn,"defaultProps",KSe);var vw=h(ye()),by=h(dw()),JSe=3,ZSe=30,QSe=2*ZSe+1,lX=180/Math.PI;function cX(t,r,e){var n=1<<r;return[(t[0]+e[0])/n,(t[1]+e[1])/n]}function fX(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function pX(t){return[fX(t[0]),fX(t[1])]}function hX(t,r){var e=(0,vw.default)(r,2),n=e[0],i=e[1];switch(t){case 0:return[1,n,i];case 1:return[-n,1,i];case 2:return[-n,-i,1];case 3:return[-1,-i,-n];case 4:return[i,-1,-n];case 5:return[i,n,-1];default:throw new Error("Invalid face")}}function dX(t){var r=(0,vw.default)(t,3),e=r[0],n=r[1],i=r[2],a=Math.atan2(i,Math.sqrt(e*e+n*n)),o=Math.atan2(n,e);return[o*lX,a*lX]}function vX(t){for(var r=by.default.fromString(t,!0,10).toString(2);r.length<JSe+QSe;)r="0"+r;for(var e=r.lastIndexOf("1"),n=r.substring(0,3),i=r.substring(3,e),a=i.length/2,o=by.default.fromString(n,!0,2).toString(10),s=by.default.fromString(i,!0,2).toString(4);s.length<a;)s="0"+s;return"".concat(o,"/").concat(s)}function ePe(t,r,e,n){if(n===0){e===1&&(r[0]=t-1-r[0],r[1]=t-1-r[1]);var i=r[0];r[0]=r[1],r[1]=i}}function mX(t){for(var r=t.split("/"),e=parseInt(r[0],10),n=r[1],i=n.length,a=[0,0],o,s=i-1;s>=0;s--){o=i-s;var u=n[s],l=0,f=0;u==="1"?f=1:u==="2"?(l=1,f=1):u==="3"&&(l=1);var c=Math.pow(2,o-1);ePe(c,a,l,f),a[0]+=c*l,a[1]+=c*f}if(e%2===1){var p=a[0];a[0]=a[1],a[1]=p}return{face:e,ij:a,level:o}}var gX=h(dw());function tPe(t){var r=t.padEnd(16,"0");return gX.default.fromString(r,16)}var rPe=100;function nPe(t){for(var r=t.face,e=t.ij,n=t.level,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],a=Math.max(1,Math.ceil(rPe*Math.pow(2,-n))),o=new Float64Array(4*a*2+2),s=0,u=0,l=0;l<4;l++)for(var f=i[l].slice(0),c=i[l+1],p=(c[0]-f[0])/a,d=(c[1]-f[1])/a,v=0;v<a;v++){f[0]+=p,f[1]+=d;var m=cX(e,n,f),g=pX(m),y=hX(r,g),_=dX(y);Math.abs(_[1])>89.999&&(_[0]=u);var b=_[0]-u;_[0]+=b>180?-360:b<-180?360:0,o[s++]=_[0],o[s++]=_[1],u=_[0]}return o[s++]=o[0],o[s++]=o[1],o}function iPe(t){if(typeof t=="string"){if(t.indexOf("/")>0)return t;t=tPe(t)}return vX(t.toString())}function yX(t){var r=iPe(t),e=mX(r);return nPe(e)}function aPe(t){var r=oPe();return function(){var n=(0,mw.default)(t),i;if(r){var a=(0,mw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,AX.default)(this,i)}}function oPe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sPe={getS2Token:{type:"accessor",value:function(r){return r.token}}},xy=function(t){(0,xX.default)(e,t);var r=aPe(e);function e(){return(0,_X.default)(this,e),r.apply(this,arguments)}return(0,bX.default)(e,[{key:"indexToBounds",value:function(){var i=this.props,a=i.data,o=i.getS2Token;return{data:a,_normalize:!1,positionFormat:"XY",getPolygon:function(u,l){return yX(o(u,l))}}}}]),e}(Cn);(0,gw.default)(xy,"layerName","S2Layer");(0,gw.default)(xy,"defaultProps",sPe);var SX=h(L()),PX=h(N()),wX=h(Y()),OX=h(K()),_w=h(q()),bw=h(B());var Ay=h(ye());var yw=512;function uPe(t){for(var r=0,e=0,n=1<<t.length,i=n/yw,a=0;a<t.length;a++){n>>=1;var o=parseInt(t[a]);o%2&&(r|=n),o>1&&(e|=n)}return[[r/i,yw-e/i],[(r+.99)/i,yw-(e+.99)/i]]}function TX(t){var r=uPe(t),e=(0,Ay.default)(r,2),n=e[0],i=e[1],a=Kt(n),o=(0,Ay.default)(a,2),s=o[0],u=o[1],l=Kt(i),f=(0,Ay.default)(l,2),c=f[0],p=f[1];return[c,u,c,p,s,p,s,u,c,u]}function lPe(t){var r=fPe();return function(){var n=(0,_w.default)(t),i;if(r){var a=(0,_w.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,OX.default)(this,i)}}function fPe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cPe={getQuadkey:{type:"accessor",value:function(r){return r.quadkey}}},Ty=function(t){(0,wX.default)(e,t);var r=lPe(e);function e(){return(0,SX.default)(this,e),r.apply(this,arguments)}return(0,PX.default)(e,[{key:"indexToBounds",value:function(){var i=this.props,a=i.data,o=i.getQuadkey;return{data:a,_normalize:!1,positionFormat:"XY",getPolygon:function(u,l){return TX(o(u,l))}}}}]),e}(Cn);(0,bw.default)(Ty,"layerName","QuadkeyLayer");(0,bw.default)(Ty,"defaultProps",cPe);var uq=h(L()),lq=h(N()),fq=h(Y()),cq=h(K()),zw=h(q()),Ry=h(B());var jw=h(ye()),nq=h(L()),iq=h(N()),Xt=h(B());var EX=h(ge()),CX=h(L()),MX=h(N()),Zt=h(B()),xw=h(de()),Sh=function(){function t(r){(0,CX.default)(this,t),(0,Zt.default)(this,"index",void 0),(0,Zt.default)(this,"isVisible",void 0),(0,Zt.default)(this,"isSelected",void 0),(0,Zt.default)(this,"parent",void 0),(0,Zt.default)(this,"children",void 0),(0,Zt.default)(this,"content",void 0),(0,Zt.default)(this,"state",void 0),(0,Zt.default)(this,"layers",void 0),(0,Zt.default)(this,"id",void 0),(0,Zt.default)(this,"zoom",void 0),(0,Zt.default)(this,"userData",void 0),(0,Zt.default)(this,"boundingBox",void 0),(0,Zt.default)(this,"_abortController",void 0),(0,Zt.default)(this,"_loader",void 0),(0,Zt.default)(this,"_loaderId",void 0),(0,Zt.default)(this,"_isLoaded",void 0),(0,Zt.default)(this,"_isCancelled",void 0),(0,Zt.default)(this,"_needsReload",void 0),(0,Zt.default)(this,"_bbox",void 0),this.index=r,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}return(0,MX.default)(t,[{key:"bbox",get:function(){return this._bbox},set:function(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}},{key:"data",get:function(){var e=this;return this.isLoading&&this._loader?this._loader.then(function(){return e.data}):this.content}},{key:"isLoaded",get:function(){return this._isLoaded&&!this._needsReload}},{key:"isLoading",get:function(){return Boolean(this._loader)&&!this._isCancelled}},{key:"needsReload",get:function(){return this._needsReload||this._isCancelled}},{key:"byteLength",get:function(){var e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}},{key:"_loadData",value:function(){var r=(0,EX.default)(xw.default.mark(function n(i){var a,o,s,u,l,f,c,p,d,v,m,g,y,_;return xw.default.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return a=i.getData,o=i.requestScheduler,s=i.onLoad,u=i.onError,l=this.index,f=this.id,c=this.bbox,p=this.userData,d=this.zoom,v=this._loaderId,this._abortController=new AbortController,m=this._abortController.signal,x.next=7,o.scheduleRequest(this,function(A){return A.isSelected?1:-1});case 7:if(g=x.sent,g){x.next=11;break}return this._isCancelled=!0,x.abrupt("return");case 11:if(!this._isCancelled){x.next=14;break}return g.done(),x.abrupt("return");case 14:return y=null,x.prev=15,x.next=18,a({index:l,id:f,bbox:c,userData:p,zoom:d,signal:m});case 18:y=x.sent,x.next=24;break;case 21:x.prev=21,x.t0=x.catch(15),_=x.t0||!0;case 24:return x.prev=24,g.done(),x.finish(24);case 27:if(v===this._loaderId){x.next=29;break}return x.abrupt("return");case 29:if(this._loader=void 0,this.content=y,!(this._isCancelled&&!y)){x.next=34;break}return this._isLoaded=!1,x.abrupt("return");case 34:this._isLoaded=!0,this._isCancelled=!1,_?u(_,this):s(this);case 37:case"end":return x.stop()}},n,this,[[15,21,24,27]])}));function e(n){return r.apply(this,arguments)}return e}()},{key:"loadData",value:function(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}},{key:"setNeedsReload",value:function(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}},{key:"abort",value:function(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)===null||e===void 0||e.abort())}}]),t}();var zs=h(ye()),wh=h(dr());var Rw=h(ye()),HX=h(L()),WX=h(N()),Gs=h(B());var Wt={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};function jr(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function IX(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ur(t,r,e){return r&&IX(t.prototype,r),e&&IX(t,e),t}function Pe(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var RX=new V,pPe=new V,Sy=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2?arguments[2]:void 0;jr(this,t),Pe(this,"center",void 0),Pe(this,"halfDiagonal",void 0),Pe(this,"minimum",void 0),Pe(this,"maximum",void 0),n=n||RX.copy(r).add(e).scale(.5),this.center=new V(n),this.halfDiagonal=new V(e).subtract(this.center),this.minimum=new V(r),this.maximum=new V(e)}return Ur(t,[{key:"clone",value:function(){return new t(this.minimum,this.maximum,this.center)}},{key:"equals",value:function(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}},{key:"transform",value:function(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}},{key:"intersectPlane",value:function(e){var n=this.halfDiagonal,i=pPe.from(e.normal),a=n.x*Math.abs(i.x)+n.y*Math.abs(i.y)+n.z*Math.abs(i.z),o=this.center.dot(i)+e.distance;return o-a>0?Wt.INSIDE:o+a<0?Wt.OUTSIDE:Wt.INTERSECTING}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceSquaredTo(e))}},{key:"distanceSquaredTo",value:function(e){var n=RX.from(e).subtract(this.center),i=this.halfDiagonal,a=0,o;return o=Math.abs(n.x)-i.x,o>0&&(a+=o*o),o=Math.abs(n.y)-i.y,o>0&&(a+=o*o),o=Math.abs(n.z)-i.z,o>0&&(a+=o*o),a}}]),t}();var Ph=new V,LX=new V,bo=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;jr(this,t),Pe(this,"center",void 0),Pe(this,"radius",void 0),this.radius=-0,this.center=new V,this.fromCenterRadius(r,e)}return Ur(t,[{key:"fromCenterRadius",value:function(e,n){return this.center.from(e),this.radius=n,this}},{key:"fromCornerPoints",value:function(e,n){return n=Ph.from(n),this.center=new V().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}},{key:"equals",value:function(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}},{key:"clone",value:function(){return new t(this.center,this.radius)}},{key:"union",value:function(e){var n=this.center,i=this.radius,a=e.center,o=e.radius,s=Ph.copy(a).subtract(n),u=s.magnitude();if(i>=u+o)return this.clone();if(o>=u+i)return e.clone();var l=(i+u+o)*.5;return LX.copy(s).scale((-i+l)/u).add(n),this.center.copy(LX),this.radius=l,this}},{key:"expand",value:function(e){var n=Ph.from(e),i=n.subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}},{key:"transform",value:function(e){this.center.transform(e);var n=GF(Ph,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(e){var n=this.distanceTo(e);return n*n}},{key:"distanceTo",value:function(e){var n=Ph.from(e),i=n.subtract(this.center);return Math.max(0,i.len()-this.radius)}},{key:"intersectPlane",value:function(e){var n=this.center,i=this.radius,a=e.normal,o=a.dot(n)+e.distance;return o<-i?Wt.OUTSIDE:o<i?Wt.INTERSECTING:Wt.INSIDE}}]),t}();function Xl(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Aw(t){if(Array.isArray(t))return Xl(t)}function Tw(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Sw(t,r){if(t){if(typeof t=="string")return Xl(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Xl(t,r)}}function Pw(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xo(t){return Aw(t)||Tw(t)||Sw(t)||Pw()}var hPe=new V,dPe=new V,Py=new V,wy=new V,Oy=new V,vPe=new V,mPe=new V,Aa={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8},Us=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];jr(this,t),Pe(this,"center",void 0),Pe(this,"halfAxes",void 0),this.center=new V().from(r),this.halfAxes=new lt(e)}return Ur(t,[{key:"halfSize",get:function(){var e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new V(e).len(),new V(n).len(),new V(i).len()]}},{key:"quaternion",get:function(){var e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),a=new V(e).normalize(),o=new V(n).normalize(),s=new V(i).normalize();return new Ti().fromMatrix3(new lt([].concat(xo(a),xo(o),xo(s))))}},{key:"fromCenterHalfSizeQuaternion",value:function(e,n,i){var a=new Ti(i),o=new lt().fromQuaternion(a);return o[0]=o[0]*n[0],o[1]=o[1]*n[0],o[2]=o[2]*n[0],o[3]=o[3]*n[1],o[4]=o[4]*n[1],o[5]=o[5]*n[1],o[6]=o[6]*n[2],o[7]=o[7]*n[2],o[8]=o[8]*n[2],this.center=new V().from(e),this.halfAxes=o,this}},{key:"clone",value:function(){return new t(this.center,this.halfAxes)}},{key:"equals",value:function(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}},{key:"getBoundingSphere",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new bo,n=this.halfAxes,i=n.getColumn(0,Py),a=n.getColumn(1,wy),o=n.getColumn(2,Oy),s=hPe.copy(i).add(a).add(o);return e.center.copy(this.center),e.radius=s.magnitude(),e}},{key:"intersectPlane",value:function(e){var n=this.center,i=e.normal,a=this.halfAxes,o=i.x,s=i.y,u=i.z,l=Math.abs(o*a[Aa.COLUMN0ROW0]+s*a[Aa.COLUMN0ROW1]+u*a[Aa.COLUMN0ROW2])+Math.abs(o*a[Aa.COLUMN1ROW0]+s*a[Aa.COLUMN1ROW1]+u*a[Aa.COLUMN1ROW2])+Math.abs(o*a[Aa.COLUMN2ROW0]+s*a[Aa.COLUMN2ROW1]+u*a[Aa.COLUMN2ROW2]),f=i.dot(n)+e.distance;return f<=-l?Wt.OUTSIDE:f>=l?Wt.INSIDE:Wt.INTERSECTING}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceSquaredTo(e))}},{key:"distanceSquaredTo",value:function(e){var n=dPe.from(e).subtract(this.center),i=this.halfAxes,a=i.getColumn(0,Py),o=i.getColumn(1,wy),s=i.getColumn(2,Oy),u=a.magnitude(),l=o.magnitude(),f=s.magnitude();a.normalize(),o.normalize(),s.normalize();var c=0,p;return p=Math.abs(n.dot(a))-u,p>0&&(c+=p*p),p=Math.abs(n.dot(o))-l,p>0&&(c+=p*p),p=Math.abs(n.dot(s))-f,p>0&&(c+=p*p),c}},{key:"computePlaneDistances",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],a=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,s=this.center,u=this.halfAxes,l=u.getColumn(0,Py),f=u.getColumn(1,wy),c=u.getColumn(2,Oy),p=vPe.copy(l).add(f).add(c).add(s),d=mPe.copy(p).subtract(e),v=n.dot(d);return a=Math.min(v,a),o=Math.max(v,o),p.copy(s).add(l).add(f).subtract(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),p.copy(s).add(l).subtract(f).add(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),p.copy(s).add(l).subtract(f).subtract(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),s.copy(p).subtract(l).add(f).add(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),s.copy(p).subtract(l).add(f).subtract(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),s.copy(p).subtract(l).subtract(f).add(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),s.copy(p).subtract(l).subtract(f).subtract(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),i[0]=a,i[1]=o,i}},{key:"transform",value:function(e){this.center.transformAsPoint(e);var n=this.halfAxes.getColumn(0,Py);n.transformAsPoint(e);var i=this.halfAxes.getColumn(1,wy);i.transformAsPoint(e);var a=this.halfAxes.getColumn(2,Oy);return a.transformAsPoint(e),this.halfAxes=new lt([].concat(xo(n),xo(i),xo(a))),this}},{key:"getTransform",value:function(){throw new Error("not implemented")}}]),t}();var kX=new V,BX=new V,$t=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;jr(this,t),Pe(this,"normal",void 0),Pe(this,"distance",void 0),this.normal=new V,this.distance=-0,this.fromNormalDistance(r,e)}return Ur(t,[{key:"fromNormalDistance",value:function(e,n){return qe(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}},{key:"fromPointNormal",value:function(e,n){e=kX.from(e),this.normal.from(n).normalize();var i=-this.normal.dot(e);return this.distance=i,this}},{key:"fromCoefficients",value:function(e,n,i,a){return this.normal.set(e,n,i),qe(tt(this.normal.len(),1)),this.distance=a,this}},{key:"clone",value:function(){return new t(this.normal,this.distance)}},{key:"equals",value:function(e){return tt(this.distance,e.distance)&&tt(this.normal,e.normal)}},{key:"getPointDistance",value:function(e){return this.normal.dot(e)+this.distance}},{key:"transform",value:function(e){var n=BX.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,n)}},{key:"projectPointOntoPlane",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];e=kX.from(e);var i=this.getPointDistance(e),a=BX.copy(this.normal).scale(i);return e.subtract(a).to(n)}}]),t}();function FX(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=gPe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function gPe(t,r){if(t){if(typeof t=="string")return DX(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return DX(t,r)}}function DX(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var NX=[new V([1,0,0]),new V([0,1,0]),new V([0,0,1])],jX=new V,yPe=new V,Mat=new $t(new V(1,0,0),0),Kr=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];jr(this,t),Pe(this,"planes",void 0),this.planes=r}return Ur(t,[{key:"fromBoundingSphere",value:function(e){this.planes.length=2*NX.length;var n=e.center,i=e.radius,a=0,o=FX(NX),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=this.planes[a],f=this.planes[a+1];l||(l=this.planes[a]=new $t),f||(f=this.planes[a+1]=new $t);var c=jX.copy(u).scale(-i).add(n),p=-u.dot(c);l.fromPointNormal(c,u);var d=jX.copy(u).scale(i).add(n),v=yPe.copy(u).negate(),m=-v.dot(d);f.fromPointNormal(d,v),a+=2}}catch(g){o.e(g)}finally{o.f()}return this}},{key:"computeVisibility",value:function(e){var n=Wt.INSIDE,i=FX(this.planes),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=e.intersectPlane(o);switch(s){case Wt.OUTSIDE:return Wt.OUTSIDE;case Wt.INTERSECTING:n=Wt.INTERSECTING;break;default:}}}catch(u){i.e(u)}finally{i.f()}return n}},{key:"computeVisibilityWithPlaneMask",value:function(e,n){if(qe(Number.isFinite(n),"parentPlaneMask is required."),n===t.MASK_OUTSIDE||n===t.MASK_INSIDE)return n;for(var i=t.MASK_INSIDE,a=this.planes,o=0;o<this.planes.length;++o){var s=o<31?1<<o:0;if(!(o<31&&!(n&s))){var u=a[o],l=e.intersectPlane(u);if(l===Wt.OUTSIDE)return t.MASK_OUTSIDE;l===Wt.INTERSECTING&&(i|=s)}}return i}}]),t}();Pe(Kr,"MASK_OUTSIDE",4294967295);Pe(Kr,"MASK_INSIDE",0);Pe(Kr,"MASK_INDETERMINATE",2147483647);var _Pe=new V,bPe=new V,xPe=new V,APe=new V,TPe=new V,ww=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};jr(this,t),Pe(this,"left",void 0),Pe(this,"_left",void 0),Pe(this,"right",void 0),Pe(this,"_right",void 0),Pe(this,"top",void 0),Pe(this,"_top",void 0),Pe(this,"bottom",void 0),Pe(this,"_bottom",void 0),Pe(this,"near",void 0),Pe(this,"_near",void 0),Pe(this,"far",void 0),Pe(this,"_far",void 0),Pe(this,"_cullingVolume",new Kr([new $t,new $t,new $t,new $t,new $t,new $t])),Pe(this,"_perspectiveMatrix",new ce),Pe(this,"_infinitePerspective",new ce);var e=r.near,n=e===void 0?1:e,i=r.far,a=i===void 0?5e8:i;this.left=r.left,this._left=void 0,this.right=r.right,this._right=void 0,this.top=r.top,this._top=void 0,this.bottom=r.bottom,this._bottom=void 0,this.near=n,this._near=n,this.far=a,this._far=a}return Ur(t,[{key:"clone",value:function(){return new t({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}},{key:"equals",value:function(e){return e&&e instanceof t&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}},{key:"projectionMatrix",get:function(){return this._update(),this._perspectiveMatrix}},{key:"infiniteProjectionMatrix",get:function(){return this._update(),this._infinitePerspective}},{key:"computeCullingVolume",value:function(e,n,i){qe(e,"position is required."),qe(n,"direction is required."),qe(i,"up is required.");var a=this._cullingVolume.planes;i=_Pe.copy(i).normalize();var o=bPe.copy(n).cross(i).normalize(),s=xPe.copy(n).multiplyByScalar(this.near).add(e),u=APe.copy(n).multiplyByScalar(this.far).add(e),l=TPe;return l.copy(o).multiplyByScalar(this.left).add(s).subtract(e).cross(i),a[0].fromPointNormal(e,l),l.copy(o).multiplyByScalar(this.right).add(s).subtract(e).cross(i).negate(),a[1].fromPointNormal(e,l),l.copy(i).multiplyByScalar(this.bottom).add(s).subtract(e).cross(o).negate(),a[2].fromPointNormal(e,l),l.copy(i).multiplyByScalar(this.top).add(s).subtract(e).cross(o),a[3].fromPointNormal(e,l),l=new V().copy(n),a[4].fromPointNormal(s,l),l.negate(),a[5].fromPointNormal(u,l),this._cullingVolume}},{key:"getPixelDimensions",value:function(e,n,i,a){this._update(),qe(Number.isFinite(e)&&Number.isFinite(n)),qe(e>0),qe(n>0),qe(i>0),qe(a);var o=1/this.near,s=this.top*o,u=2*i*s/n;s=this.right*o;var l=2*i*s/e;return a.x=l,a.y=u,a}},{key:"_update",value:function(){qe(Number.isFinite(this.right)&&Number.isFinite(this.left)&&Number.isFinite(this.top)&&Number.isFinite(this.bottom)&&Number.isFinite(this.near)&&Number.isFinite(this.far));var e=this.top,n=this.bottom,i=this.right,a=this.left,o=this.near,s=this.far;(e!==this._top||n!==this._bottom||a!==this._left||i!==this._right||o!==this._near||s!==this._far)&&(qe(this.near>0&&this.near<this.far,"near must be greater than zero and less than far."),this._left=a,this._right=i,this._top=e,this._bottom=n,this._near=o,this._far=s,this._perspectiveMatrix=new ce().frustum({left:a,right:i,bottom:n,top:e,near:o,far:s}),this._infinitePerspective=new ce().frustum({left:a,right:i,bottom:n,top:e,near:o,far:1/0}))}}]),t}();var SPe=function(r){return r!==null&&typeof r<"u"},PPe=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};jr(this,t),Pe(this,"_offCenterFrustum",new ww),Pe(this,"fov",void 0),Pe(this,"_fov",void 0),Pe(this,"_fovy",void 0),Pe(this,"_sseDenominator",void 0),Pe(this,"aspectRatio",void 0),Pe(this,"_aspectRatio",void 0),Pe(this,"near",void 0),Pe(this,"_near",void 0),Pe(this,"far",void 0),Pe(this,"_far",void 0),Pe(this,"xOffset",void 0),Pe(this,"_xOffset",void 0),Pe(this,"yOffset",void 0),Pe(this,"_yOffset",void 0);var e=r.fov,n=r.aspectRatio,i=r.near,a=i===void 0?1:i,o=r.far,s=o===void 0?5e8:o,u=r.xOffset,l=u===void 0?0:u,f=r.yOffset,c=f===void 0?0:f;this.fov=e,this.aspectRatio=n,this.near=a,this.far=s,this.xOffset=l,this.yOffset=c}return Ur(t,[{key:"clone",value:function(){return new t({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}},{key:"equals",value:function(e){return!SPe(e)||!(e instanceof t)?!1:(this._update(),e._update(),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))}},{key:"projectionMatrix",get:function(){return this._update(),this._offCenterFrustum.projectionMatrix}},{key:"infiniteProjectionMatrix",get:function(){return this._update(),this._offCenterFrustum.infiniteProjectionMatrix}},{key:"fovy",get:function(){return this._update(),this._fovy}},{key:"sseDenominator",get:function(){return this._update(),this._sseDenominator}},{key:"computeCullingVolume",value:function(e,n,i){return this._update(),this._offCenterFrustum.computeCullingVolume(e,n,i)}},{key:"getPixelDimensions",value:function(e,n,i,a){return this._update(),this._offCenterFrustum.getPixelDimensions(e,n,i,a||new Xn)}},{key:"_update",value:function(){qe(Number.isFinite(this.fov)&&Number.isFinite(this.aspectRatio)&&Number.isFinite(this.near)&&Number.isFinite(this.far));var e=this._offCenterFrustum;(this.fov!==this._fov||this.aspectRatio!==this._aspectRatio||this.near!==this._near||this.far!==this._far||this.xOffset!==this._xOffset||this.yOffset!==this._yOffset)&&(qe(this.fov>=0&&this.fov<Math.PI),qe(this.aspectRatio>0),qe(this.near>=0&&this.near<this.far),this._aspectRatio=this.aspectRatio,this._fov=this.fov,this._fovy=this.aspectRatio<=1?this.fov:Math.atan(Math.tan(this.fov*.5)/this.aspectRatio)*2,this._near=this.near,this._far=this.far,this._sseDenominator=2*Math.tan(.5*this._fovy),this._xOffset=this.xOffset,this._yOffset=this.yOffset,e.top=this.near*Math.tan(.5*this._fovy),e.bottom=-e.top,e.right=this.aspectRatio*e.top,e.left=-e.right,e.near=this.near,e.far=this.far,e.right+=this.xOffset,e.left+=this.xOffset,e.top+=this.yOffset,e.bottom+=this.yOffset)}}]),t}();var Xat=new V,qat=new V,Yat=new V,Kat=new V,Jat=new V,Zat=new V,Qat=new V,eot=new V,tot=new V,rot=new V,not=new V,iot=new V,aot=4/3*Math.PI;var Ni=new lt,wPe=new lt,OPe=new lt,Ey=new lt,UX=new lt;function Cy(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=Si.EPSILON20,n=10,i=0,a=0,o=wPe,s=OPe;o.identity(),s.copy(t);for(var u=e*EPe(s);a<n&&CPe(s)>u;)MPe(s,Ey),UX.copy(Ey).transpose(),s.multiplyRight(Ey),s.multiplyLeft(UX),o.multiplyRight(Ey),++i>2&&(++a,i=0);return r.unitary=o.toTarget(r.unitary),r.diagonal=s.toTarget(r.diagonal),r}function EPe(t){for(var r=0,e=0;e<9;++e){var n=t[e];r+=n*n}return Math.sqrt(r)}var Ow=[1,0,0],Ew=[2,2,1];function CPe(t){for(var r=0,e=0;e<3;++e){var n=t[Ni.getElementIndex(Ew[e],Ow[e])];r+=2*n*n}return Math.sqrt(r)}function MPe(t,r){for(var e=Si.EPSILON15,n=0,i=1,a=0;a<3;++a){var o=Math.abs(t[Ni.getElementIndex(Ew[a],Ow[a])]);o>n&&(i=a,n=o)}var s=Ow[i],u=Ew[i],l=1,f=0;if(Math.abs(t[Ni.getElementIndex(u,s)])>e){var c=t[Ni.getElementIndex(u,u)],p=t[Ni.getElementIndex(s,s)],d=t[Ni.getElementIndex(u,s)],v=(c-p)/2/d,m;v<0?m=-1/(-v+Math.sqrt(1+v*v)):m=1/(v+Math.sqrt(1+v*v)),l=1/Math.sqrt(1+m*m),f=m*l}return lt.IDENTITY.to(r),r[Ni.getElementIndex(s,s)]=r[Ni.getElementIndex(u,u)]=l,r[Ni.getElementIndex(u,s)]=f,r[Ni.getElementIndex(s,u)]=-f,r}function Cw(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=IPe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function IPe(t,r){if(t){if(typeof t=="string")return GX(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return GX(t,r)}}function GX(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Ao=new V,RPe=new V,LPe=new V,kPe=new V,BPe=new V,FPe=new lt,DPe={diagonal:new lt,unitary:new lt};function Mw(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Us;if(!t||t.length===0)return r.halfAxes=new lt([0,0,0,0,0,0,0,0,0]),r.center=new V,r;var e=t.length,n=new V(0,0,0),i=Cw(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n.add(o)}}catch(Q){i.e(Q)}finally{i.f()}var s=1/e;n.multiplyByScalar(s);var u=0,l=0,f=0,c=0,p=0,d=0,v=Cw(t),m;try{for(v.s();!(m=v.n()).done;){var g=m.value,y=Ao.copy(g).subtract(n);u+=y.x*y.x,l+=y.x*y.y,f+=y.x*y.z,c+=y.y*y.y,p+=y.y*y.z,d+=y.z*y.z}}catch(Q){v.e(Q)}finally{v.f()}u*=s,l*=s,f*=s,c*=s,p*=s,d*=s;var _=FPe;_[0]=u,_[1]=l,_[2]=f,_[3]=l,_[4]=c,_[5]=p,_[6]=f,_[7]=p,_[8]=d;var b=Cy(_,DPe),x=b.unitary,A=r.halfAxes.copy(x),T=A.getColumn(0,LPe),O=A.getColumn(1,kPe),w=A.getColumn(2,BPe),E=-Number.MAX_VALUE,S=-Number.MAX_VALUE,I=-Number.MAX_VALUE,R=Number.MAX_VALUE,z=Number.MAX_VALUE,G=Number.MAX_VALUE,k=Cw(t),U;try{for(k.s();!(U=k.n()).done;){var j=U.value;Ao.copy(j),E=Math.max(Ao.dot(T),E),S=Math.max(Ao.dot(O),S),I=Math.max(Ao.dot(w),I),R=Math.min(Ao.dot(T),R),z=Math.min(Ao.dot(O),z),G=Math.min(Ao.dot(w),G)}}catch(Q){k.e(Q)}finally{k.f()}T=T.multiplyByScalar(.5*(R+E)),O=O.multiplyByScalar(.5*(z+S)),w=w.multiplyByScalar(.5*(G+I)),r.center.copy(T).add(O).add(w);var X=RPe.set(E-R,S-z,I-G).multiplyByScalar(.5),H=new lt([X[0],0,0,0,X[1],0,0,0,X[2]]);return r.halfAxes.multiplyRight(H),r}function Iw(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=NPe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function NPe(t,r){if(t){if(typeof t=="string")return zX(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return zX(t,r)}}function zX(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var ql=512,VX=3,$X=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],XX=$X.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),jPe=XX.concat([[.25,.5],[.75,.5]]),UPe=function(){function t(r,e,n){(0,HX.default)(this,t),(0,Gs.default)(this,"x",void 0),(0,Gs.default)(this,"y",void 0),(0,Gs.default)(this,"z",void 0),(0,Gs.default)(this,"childVisible",void 0),(0,Gs.default)(this,"selected",void 0),(0,Gs.default)(this,"_children",void 0),this.x=r,this.y=e,this.z=n}return(0,WX.default)(t,[{key:"children",get:function(){if(!this._children){var e=this.x*2,n=this.y*2,i=this.z+1;this._children=[new t(e,n,i),new t(e,n+1,i),new t(e+1,n,i),new t(e+1,n+1,i)]}return this._children}},{key:"update",value:function(e){var n=e.viewport,i=e.cullingVolume,a=e.elevationBounds,o=e.minZ,s=e.maxZ,u=e.bounds,l=e.offset,f=e.project,c=this.getBoundingVolume(a,l,f);if(u&&!this.insideBounds(u))return!1;var p=i.computeVisibility(c);if(p<0)return!1;if(!this.childVisible){var d=this.z;if(d<s&&d>=o){var v=c.distanceTo(n.cameraPosition)*n.scale/n.height;d+=Math.floor(Math.log2(v))}if(d>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;var m=Iw(this.children),g;try{for(m.s();!(g=m.n()).done;){var y=g.value;y.update(e)}}catch(_){m.e(_)}finally{m.f()}return!0}},{key:"getSelected",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(this.selected&&e.push(this),this._children){var n=Iw(this._children),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.getSelected(e)}}catch(o){n.e(o)}finally{n.f()}}return e}},{key:"insideBounds",value:function(e){var n=(0,Rw.default)(e,4),i=n[0],a=n[1],o=n[2],s=n[3],u=Math.pow(2,this.z),l=ql/u;return this.x*l<o&&this.y*l<s&&(this.x+1)*l>i&&(this.y+1)*l>a}},{key:"getBoundingVolume",value:function(e,n,i){if(i){var a=this.z<1?jPe:this.z<2?XX:$X,o=[],s=Iw(a),u;try{for(s.s();!(u=s.n()).done;){var l=u.value,f=My(this.x+l[0],this.y+l[1],this.z);f[2]=e[0],o.push(i(f)),e[0]!==e[1]&&(f[2]=e[1],o.push(i(f)))}}catch(m){s.e(m)}finally{s.f()}return Mw(o)}var c=Math.pow(2,this.z),p=ql/c,d=this.x*p+n*ql,v=ql-(this.y+1)*p;return new Sy([d,v,e[0]],[d+p,v+p,e[1]])}}]),t}();function qX(t,r,e,n){var i=t instanceof Pl&&t.resolution?t.projectPosition:null,a=Object.values(t.getFrustumPlanes()).map(function(A){var T=A.normal,O=A.distance;return new $t(T.clone().negate(),O)}),o=new Kr(a),s=t.distanceScales.unitsPerMeter[2],u=e&&e[0]*s||0,l=e&&e[1]*s||0,f=t instanceof $r&&t.pitch<=60?r:0;if(n){var c=n,p=(0,Rw.default)(c,4),d=p[0],v=p[1],m=p[2],g=p[3],y=At([d,g]),_=At([m,v]);n=[y[0],ql-y[1],_[0],ql-_[1]]}var b=new UPe(0,0,0),x={viewport:t,project:i,cullingVolume:o,elevationBounds:[u,l],minZ:f,maxZ:r,bounds:n,offset:0};if(b.update(x),t instanceof $r&&t.subViewports&&t.subViewports.length>1){for(x.offset=-1;b.update(x)&&!(--x.offset<-VX););for(x.offset=1;b.update(x)&&!(++x.offset>VX););}return b.getSelected()}var Ta=512,GPe=[-1/0,-1/0,1/0,1/0],To={type:"object",value:null,validate:function(r,e){return e.optional&&r===null||typeof r=="string"||Array.isArray(r)&&r.every(function(n){return typeof n=="string"})},equal:function(r,e){if(r===e)return!0;if(!Array.isArray(r)||!Array.isArray(e))return!1;var n=r.length;if(n!==e.length)return!1;for(var i=0;i<n;i++)if(r[i]!==e[i])return!1;return!0}};function KX(t,r){var e=[r.transformAsPoint([t[0],t[1]]),r.transformAsPoint([t[2],t[1]]),r.transformAsPoint([t[0],t[3]]),r.transformAsPoint([t[2],t[3]])],n=[Math.min.apply(Math,(0,wh.default)(e.map(function(i){return i[0]}))),Math.min.apply(Math,(0,wh.default)(e.map(function(i){return i[1]}))),Math.max.apply(Math,(0,wh.default)(e.map(function(i){return i[0]}))),Math.max.apply(Math,(0,wh.default)(e.map(function(i){return i[1]})))];return n}function zPe(t){return Math.abs(t.split("").reduce(function(r,e){return(r<<5)-r+e.charCodeAt(0)|0},0))}function ji(t,r){if(!t||!t.length)return null;var e=r.index,n=r.id;if(Array.isArray(t)){var i=zPe(n)%t.length;t=t[i]}for(var a=t,o=0,s=Object.keys(e);o<s.length;o++){var u=s[o],l=new RegExp("{".concat(u,"}"),"g");a=a.replace(l,String(e[u]))}return Number.isInteger(e.y)&&Number.isInteger(e.z)&&(a=a.replace(/\{-y\}/g,String(Math.pow(2,e.z)-e.y-1))),a}function VPe(t,r,e){var n;if(r&&r.length===2){var i=(0,zs.default)(r,2),a=i[0],o=i[1],s=t.getBounds({z:a}),u=t.getBounds({z:o});n=[Math.min(s[0],u[0]),Math.min(s[1],u[1]),Math.max(s[2],u[2]),Math.max(s[3],u[3])]}else n=t.getBounds();return t.isGeospatial?[Math.max(n[0],e[0]),Math.max(n[1],e[1]),Math.min(n[2],e[2]),Math.min(n[3],e[3])]:[Math.max(Math.min(n[0],e[2]),e[0]),Math.max(Math.min(n[1],e[3]),e[1]),Math.min(Math.max(n[2],e[0]),e[2]),Math.min(Math.max(n[3],e[1]),e[3])]}function JX(t){var r=t.viewport,e=t.z,n=e===void 0?0:e,i=t.cullRect,a=r.subViewports||[r];return a.map(function(o){return Lw(o,n,i)})}function Lw(t,r,e){if(!Array.isArray(r)){var n=e.x-t.x,i=e.y-t.y,a=e.width,o=e.height,s={targetZ:r},u=t.unproject([n,i],s),l=t.unproject([n+a,i],s),f=t.unproject([n,i+o],s),c=t.unproject([n+a,i+o],s);return[Math.min(u[0],l[0],f[0],c[0]),Math.min(u[1],l[1],f[1],c[1]),Math.max(u[0],l[0],f[0],c[0]),Math.max(u[1],l[1],f[1],c[1])]}var p=Lw(t,r[0],e),d=Lw(t,r[1],e);return[Math.min(p[0],d[0]),Math.min(p[1],d[1]),Math.max(p[2],d[2]),Math.max(p[3],d[3])]}function HPe(t,r,e){if(e){var n=KX(t,e).map(function(i){return i*r/Ta});return n}return t.map(function(i){return i*r/Ta})}function kw(t,r){return Math.pow(2,t)*Ta/r}function My(t,r,e){var n=kw(e,Ta),i=t/n*360-180,a=Math.PI-2*Math.PI*r/n,o=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[i,o]}function YX(t,r,e,n){var i=kw(e,n);return[t/i*Ta,r/i*Ta]}function Bw(t,r,e,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Ta;if(t.isGeospatial){var a=My(r,e,n),o=(0,zs.default)(a,2),s=o[0],u=o[1],l=My(r+1,e+1,n),f=(0,zs.default)(l,2),c=f[0],p=f[1];return{west:s,north:u,east:c,south:p}}var d=YX(r,e,n,i),v=(0,zs.default)(d,2),m=v[0],g=v[1],y=YX(r+1,e+1,n,i),_=(0,zs.default)(y,2),b=_[0],x=_[1];return{left:m,top:g,right:b,bottom:x}}function WPe(t,r,e,n,i){for(var a=VPe(t,null,n),o=kw(r,e),s=HPe(a,o,i),u=(0,zs.default)(s,4),l=u[0],f=u[1],c=u[2],p=u[3],d=[],v=Math.floor(l);v<c;v++)for(var m=Math.floor(f);m<p;m++)d.push({x:v,y:m,z:r});return d}function Fw(t){var r=t.viewport,e=t.maxZoom,n=t.minZoom,i=t.zRange,a=t.extent,o=t.tileSize,s=o===void 0?Ta:o,u=t.modelMatrix,l=t.modelMatrixInverse,f=t.zoomOffset,c=f===void 0?0:f,p=r.isGeospatial?Math.round(r.zoom+Math.log2(Ta/s))+c:Math.ceil(r.zoom)+c;if(typeof n=="number"&&Number.isFinite(n)&&p<n){if(!a)return[];p=n}typeof e=="number"&&Number.isFinite(e)&&p>e&&(p=e);var d=a;return u&&l&&a&&!r.isGeospatial&&(d=KX(a,u)),r.isGeospatial?qX(r,p,i,a):WPe(r,p,s,d||GPe,l)}function Dw(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function Nw(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}function ZX(t){var r={},e;return function(n){for(var i in n)if(!$Pe(n[i],r[i])){e=t(n),r=n;break}return e}}function $Pe(t,r){if(t===r)return!0;if(Array.isArray(t)){var e=t.length;if(!r||r.length!==e)return!1;for(var n=0;n<e;n++)if(t[n]!==r[n])return!1;return!0}return!1}var Oh;function pr(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=XPe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function XPe(t,r){if(t){if(typeof t=="string")return QX(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return QX(t,r)}}function QX(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function eq(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function tq(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?eq(Object(e),!0).forEach(function(n){(0,Xt.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):eq(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var rq=1,Iy=2,qPe="never",YPe="no-overlap",Eh="best-available",KPe=5,JPe=(Oh={},(0,Xt.default)(Oh,Eh,QPe),(0,Xt.default)(Oh,YPe,ewe),(0,Xt.default)(Oh,qPe,function(){}),Oh),ZPe={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,zoomOffset:0,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(){}},Ch=function(){function t(r){var e=this;(0,nq.default)(this,t),(0,Xt.default)(this,"opts",void 0),(0,Xt.default)(this,"_requestScheduler",void 0),(0,Xt.default)(this,"_cache",void 0),(0,Xt.default)(this,"_dirty",void 0),(0,Xt.default)(this,"_tiles",void 0),(0,Xt.default)(this,"_cacheByteSize",void 0),(0,Xt.default)(this,"_viewport",void 0),(0,Xt.default)(this,"_zRange",void 0),(0,Xt.default)(this,"_selectedTiles",void 0),(0,Xt.default)(this,"_frameNumber",void 0),(0,Xt.default)(this,"_modelMatrix",void 0),(0,Xt.default)(this,"_modelMatrixInverse",void 0),(0,Xt.default)(this,"_maxZoom",void 0),(0,Xt.default)(this,"_minZoom",void 0),(0,Xt.default)(this,"onTileLoad",void 0),(0,Xt.default)(this,"_getCullBounds",ZX(JX)),this.opts=tq(tq({},ZPe),r),this.onTileLoad=function(n){var i,a;(i=(a=e.opts).onTileLoad)===null||i===void 0||i.call(a,n),e.opts.maxCacheByteSize&&(e._cacheByteSize+=n.byteLength,e._resizeCache())},this._requestScheduler=new lc({maxRequests:r.maxRequests,throttleRequests:Boolean(r.maxRequests&&r.maxRequests>0)}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new ce,this._modelMatrixInverse=new ce,this.setOptions(r)}return(0,iq.default)(t,[{key:"tiles",get:function(){return this._tiles}},{key:"selectedTiles",get:function(){return this._selectedTiles}},{key:"isLoaded",get:function(){return this._selectedTiles!==null&&this._selectedTiles.every(function(e){return e.isLoaded})}},{key:"needsReload",get:function(){return this._selectedTiles!==null&&this._selectedTiles.some(function(e){return e.needsReload})}},{key:"setOptions",value:function(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}},{key:"finalize",value:function(){var e=pr(this._cache.values()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.isLoading&&i.abort()}}catch(a){e.e(a)}finally{e.f()}this._cache.clear(),this._tiles=[],this._selectedTiles=null}},{key:"reloadAll",value:function(){var e=pr(this._cache.keys()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value,a=this._cache.get(i);!this._selectedTiles||!this._selectedTiles.includes(a)?this._cache.delete(i):a.setNeedsReload()}}catch(o){e.e(o)}finally{e.f()}}},{key:"update",value:function(e){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.zRange,o=i.modelMatrix,s=new ce(o),u=!s.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!tt(this._zRange,a)||u){u&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=e,this._zRange=a;var l=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:a,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=l.map(function(c){return n._getTile(c,!0)}),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(function(c){return n._getTile(c.index,!0)}));var f=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),f&&this._frameNumber++,this._frameNumber}},{key:"isTileVisible",value:function(e,n){if(!e.isVisible)return!1;if(n&&this._viewport){var i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:n}),a=e.bbox,o=pr(i),s;try{for(o.s();!(s=o.n()).done;){var u=(0,jw.default)(s.value,4),l=u[0],f=u[1],c=u[2],p=u[3],d=void 0;if("west"in a)d=a.west<c&&a.east>l&&a.south<p&&a.north>f;else{var v=Math.min(a.top,a.bottom),m=Math.max(a.top,a.bottom);d=a.left<c&&a.right>l&&v<p&&m>f}if(d)return!0}}catch(g){o.e(g)}finally{o.f()}return!1}return!0}},{key:"getTileIndices",value:function(e){var n=e.viewport,i=e.maxZoom,a=e.minZoom,o=e.zRange,s=e.modelMatrix,u=e.modelMatrixInverse,l=this.opts,f=l.tileSize,c=l.extent,p=l.zoomOffset;return Fw({viewport:n,maxZoom:i,minZoom:a,zRange:o,tileSize:f,extent:c,modelMatrix:s,modelMatrixInverse:u,zoomOffset:p})}},{key:"getTileId",value:function(e){return"".concat(e.x,"-").concat(e.y,"-").concat(e.z)}},{key:"getTileZoom",value:function(e){return e.z}},{key:"getTileMetadata",value:function(e){var n=this.opts.tileSize;return{bbox:Bw(this._viewport,e.x,e.y,e.z,n)}}},{key:"getParentIndex",value:function(e){var n=Math.floor(e.x/2),i=Math.floor(e.y/2),a=e.z-1;return{x:n,y:i,z:a}}},{key:"updateTileStates",value:function(){var e=this.opts.refinementStrategy||Eh,n=new Array(this._cache.size),i=0,a=pr(this._cache.values()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n[i++]=s.isVisible,s.isSelected=!1,s.isVisible=!1}}catch(v){a.e(v)}finally{a.f()}var u=pr(this._selectedTiles),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;f.isSelected=!0,f.isVisible=!0}}catch(v){u.e(v)}finally{u.f()}(typeof e=="function"?e:JPe[e])(Array.from(this._cache.values())),i=0;var c=pr(this._cache.values()),p;try{for(c.s();!(p=c.n()).done;){var d=p.value;if(n[i++]!==d.isVisible)return!0}}catch(v){c.e(v)}finally{c.f()}return!1}},{key:"_pruneRequests",value:function(){var e=this.opts.maxRequests,n=e===void 0?0:e,i=[],a=0,o=pr(this._cache.values()),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;u.isLoading&&(a++,!u.isSelected&&!u.isVisible&&i.push(u))}}catch(f){o.e(f)}finally{o.f()}for(;n>0&&a>n&&i.length>0;){var l=i.shift();l.abort(),a--}}},{key:"_rebuildTree",value:function(){var e=this._cache,n=pr(e.values()),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.parent=null,a.children&&(a.children.length=0)}}catch(f){n.e(f)}finally{n.f()}var o=pr(e.values()),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=this._getNearestAncestor(u);u.parent=l,l!=null&&l.children&&l.children.push(u)}}catch(f){o.e(f)}finally{o.f()}}},{key:"_resizeCache",value:function(){var e=this._cache,n=this.opts,i=n.maxCacheSize||(n.maxCacheByteSize?1/0:KPe*this.selectedTiles.length),a=n.maxCacheByteSize||1/0,o=e.size>i||this._cacheByteSize>a;if(o){var s=pr(e),u;try{for(s.s();!(u=s.n()).done;){var l=(0,jw.default)(u.value,2),f=l[0],c=l[1];if(!c.isVisible&&!c.isSelected){var p,d;this._cacheByteSize-=n.maxCacheByteSize?c.byteLength:0,e.delete(f),(p=(d=this.opts).onTileUnload)===null||p===void 0||p.call(d,c)}if(e.size<=i&&this._cacheByteSize<=a)break}}catch(v){s.e(v)}finally{s.f()}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort(function(v,m){return v.zoom-m.zoom}),this._dirty=!1)}},{key:"_getTile",value:function(e,n){var i=this.getTileId(e),a=this._cache.get(i),o=!1;return!a&&n?(a=new Sh(e),Object.assign(a,this.getTileMetadata(a.index)),Object.assign(a,{id:i,zoom:this.getTileZoom(a.index)}),o=!0,this._cache.set(i,a),this._dirty=!0):a&&a.needsReload&&(o=!0),a&&o&&a.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),a}},{key:"_getNearestAncestor",value:function(e){for(var n=this._minZoom,i=n===void 0?0:n,a=e.index;this.getTileZoom(a)>i;){a=this.getParentIndex(a);var o=this._getTile(a);if(o)return o}return null}}]),t}();function QPe(t){var r=pr(t),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;n.state=0}}catch(f){r.e(f)}finally{r.f()}var i=pr(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.isSelected&&!aq(o)&&Uw(o)}}catch(f){i.e(f)}finally{i.f()}var s=pr(t),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;l.isVisible=Boolean(l.state&Iy)}}catch(f){s.e(f)}finally{s.f()}}function ewe(t){var r=pr(t),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;n.state=0}}catch(v){r.e(v)}finally{r.f()}var i=pr(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.isSelected&&aq(o)}}catch(v){i.e(v)}finally{i.f()}var s=Array.from(t).sort(function(v,m){return v.zoom-m.zoom}),u=pr(s),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;if(f.isVisible=Boolean(f.state&Iy),f.children&&(f.isVisible||f.state&rq)){var c=pr(f.children),p;try{for(c.s();!(p=c.n()).done;){var d=p.value;d.state=rq}}catch(v){c.e(v)}finally{c.f()}}else f.isSelected&&Uw(f)}}catch(v){u.e(v)}finally{u.f()}}function aq(t){for(var r=t;r;){if(r.isLoaded||r.content)return r.state|=Iy,!0;r=r.parent}return!1}function Uw(t){var r=pr(t.children),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;n.isLoaded||n.content?n.state|=Iy:Uw(n)}}catch(i){r.e(i)}finally{r.f()}}function oq(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Gw(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?oq(Object(e),!0).forEach(function(n){(0,Ry.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):oq(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function twe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=rwe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function rwe(t,r){if(t){if(typeof t=="string")return sq(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return sq(t,r)}}function sq(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function nwe(t){var r=iwe();return function(){var n=(0,zw.default)(t),i;if(r){var a=(0,zw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cq.default)(this,i)}}function iwe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var awe={TilesetClass:Ch,data:{type:"data",value:[]},dataComparator:To.equal,renderSubLayers:{type:"function",value:function(r){return new ya(r)}},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:function(r){}},onTileUnload:{type:"function",value:function(r){}},onTileError:{type:"function",value:function(r){return console.error(r)}},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Eh,zRange:null,maxRequests:6,zoomOffset:0},Sa=function(t){(0,fq.default)(e,t);var r=nwe(e);function e(){return(0,uq.default)(this,e),r.apply(this,arguments)}return(0,lq.default)(e,[{key:"initializeState",value:function(){this.state={tileset:null,isLoaded:!1}}},{key:"finalizeState",value:function(){var i,a;(i=this.state)===null||i===void 0||(a=i.tileset)===null||a===void 0||a.finalize()}},{key:"isLoaded",get:function(){var i,a;return(i=this.state)===null||i===void 0||(a=i.tileset)===null||a===void 0?void 0:a.selectedTiles.every(function(o){return o.isLoaded&&o.layers&&o.layers.every(function(s){return s.isLoaded})})}},{key:"shouldUpdateState",value:function(i){var a=i.changeFlags;return a.somethingChanged}},{key:"updateState",value:function(i){var a=i.changeFlags,o=this.state.tileset,s=a.propsOrDataChanged||a.updateTriggersChanged,u=a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getTileData);o?s&&(o.setOptions(this._getTilesetOptions()),u?o.reloadAll():this.state.tileset.tiles.forEach(function(l){l.layers=null})):(o=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:o})),this._updateTileset()}},{key:"_getTilesetOptions",value:function(){var i=this.props,a=i.tileSize,o=i.maxCacheSize,s=i.maxCacheByteSize,u=i.refinementStrategy,l=i.extent,f=i.maxZoom,c=i.minZoom,p=i.maxRequests,d=i.zoomOffset;return{maxCacheSize:o,maxCacheByteSize:s,maxZoom:f,minZoom:c,tileSize:a,refinementStrategy:u,extent:l,maxRequests:p,zoomOffset:d,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}},{key:"_updateTileset",value:function(){var i=this.state.tileset,a=this.props,o=a.zRange,s=a.modelMatrix,u=i.update(this.context.viewport,{zRange:o,modelMatrix:s}),l=i.isLoaded,f=this.state.isLoaded!==l,c=this.state.frameNumber!==u;l&&(f||c)&&this._onViewportLoad(),c&&this.setState({frameNumber:u}),this.state.isLoaded=l}},{key:"_onViewportLoad",value:function(){var i=this.state.tileset,a=this.props.onViewportLoad;a&&a(i.selectedTiles)}},{key:"_onTileLoad",value:function(i){this.props.onTileLoad(i),i.layers=null,this.setNeedsUpdate()}},{key:"_onTileError",value:function(i,a){this.props.onTileError(i),a.layers=null,this.setNeedsUpdate()}},{key:"_onTileUnload",value:function(i){this.props.onTileUnload(i)}},{key:"getTileData",value:function(i){var a=this.props,o=a.data,s=a.getTileData,u=a.fetch,l=i.signal;return i.url=typeof o=="string"||Array.isArray(o)?ji(o,i):null,s?s(i):u&&i.url?u(i.url,{propName:"data",layer:this,signal:l}):null}},{key:"renderSubLayers",value:function(i){return this.props.renderSubLayers(i)}},{key:"getSubLayerPropsByTile",value:function(i){return null}},{key:"getPickingInfo",value:function(i){var a=i.info,o=i.sourceLayer,s=o.props.tile;return a.picked&&(a.tile=s),a.sourceTile=s,a}},{key:"_updateAutoHighlight",value:function(i){var a=i.sourceTile;if(a&&a.layers){var o=twe(a.layers),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;u.updateAutoHighlight(i)}}catch(l){o.e(l)}finally{o.f()}}}},{key:"renderLayers",value:function(){var i=this;return this.state.tileset.tiles.map(function(a){var o=i.getSubLayerPropsByTile(a);if(!(!a.isLoaded&&!a.content))if(a.layers)o&&a.layers[0]&&Object.keys(o).some(function(u){return a.layers[0].props[u]!==o[u]})&&(a.layers=a.layers.map(function(u){return u.clone(o)}));else{var s=i.renderSubLayers(Gw(Gw({},i.props),{},{id:"".concat(i.id,"-").concat(a.id),data:a.content,_offset:0,tile:a}));a.layers=Br(s,Boolean).map(function(u){return u.clone(Gw({tile:a},o))})}return a.layers})}},{key:"filterSubLayer",value:function(i){var a=i.layer,o=i.cullRect,s=a.props.tile;return this.state.tileset.isTileVisible(s,o)}}]),e}(St);(0,Ry.default)(Sa,"defaultProps",awe);(0,Ry.default)(Sa,"layerName","TileLayer");var dq=h(L()),vq=h(N()),Ly=h(Oe()),mq=h(Y()),gq=h(K()),Yl=h(q()),ky=h(B());function pq(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function hq(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?pq(Object(e),!0).forEach(function(n){(0,ky.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):pq(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function owe(t){var r=swe();return function(){var n=(0,Yl.default)(t),i;if(r){var a=(0,Yl.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gq.default)(this,i)}}function swe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var uwe={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:function(r){return r.timestamps}}},By=function(t){(0,mq.default)(e,t);var r=owe(e);function e(){return(0,dq.default)(this,e),r.apply(this,arguments)}return(0,vq.default)(e,[{key:"getShaders",value:function(){var i=(0,Ly.default)((0,Yl.default)(e.prototype),"getShaders",this).call(this);return i.inject={"vs:#decl":`uniform float trailLength;
attribute float instanceTimestamps;
attribute float instanceNextTimestamps;
varying float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
varying float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},i}},{key:"initializeState",value:function(){(0,Ly.default)((0,Yl.default)(e.prototype),"initializeState",this).call(this);var i=this.getAttributeManager();i.addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}},{key:"draw",value:function(i){var a=this.props,o=a.fadeTrail,s=a.trailLength,u=a.currentTime;i.uniforms=hq(hq({},i.uniforms),{},{fadeTrail:o,trailLength:s,currentTime:u}),(0,Ly.default)((0,Yl.default)(e.prototype),"draw",this).call(this,i)}}]),e}(ki);(0,ky.default)(By,"layerName","TripsLayer");(0,ky.default)(By,"defaultProps",uwe);var Iq=h(L()),Rq=h(N()),Lq=h(Y()),kq=h(K()),Ww=h(q()),$w=h(B()),Bq=h(Fy());var Aq=h(L()),Tq=h(N()),Sq=h(_e()),Pq=h(Y()),wq=h(K()),Vw=h(q()),Kl=h(B()),Oq=h(Je()),Mh=h(ye()),Ar=h(Fy());function lwe(t){var r=fwe();return function(){var n=(0,Vw.default)(t),i;if(r){var a=(0,Vw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,wq.default)(this,i)}}function fwe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _q(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Dy(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?_q(Object(e),!0).forEach(function(n){(0,Kl.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):_q(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Hw(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=cwe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function cwe(t,r){if(t){if(typeof t=="string")return bq(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return bq(t,r)}}function bq(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var pwe=10;function Eq(t,r){r=r===void 0?t[0][0]:r;var e=Hw(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value,a=i[0]-r;a>180?i[0]-=360:a<-180&&(i[0]+=360)}}catch(o){e.e(o)}finally{e.f()}}function hwe(t,r,e){var n=(0,Ar.h3ToGeo)(t),i=(0,Mh.default)(n,2),a=i[0],o=i[1],s=r.length;Eq(r,o);for(var u=r[0]===r[s-1]?s-1:s,l=0;l<u;l++)r[l][0]=nr(o,r[l][0],e),r[l][1]=nr(a,r[l][1],e)}function dwe(t,r,e){var n=t(r,e),i=(0,Ar.h3ToGeo)(n),a=(0,Mh.default)(i,2),o=a[0],s=a[1];return[s,o]}function xq(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=(0,Ar.h3ToGeoBoundary)(t,!0);return r!==1?hwe(t,e,r):Eq(e),e}function vwe(t){var r=new Float64Array(t.length*2),e=0,n=Hw(t),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;r[e++]=a[0],r[e++]=a[1]}}catch(o){n.e(o)}finally{n.f()}return r}function mwe(t,r){var e;return t==null?e=r:(0,Oq.default)(t)==="object"?e=Dy(Dy({},t),{},{coverage:r}):e={getHexagon:t,coverage:r},e}var gwe=Dy(Dy({},Fi.defaultProps),{},{highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:function(r){return r.hexagon}},extruded:!0}),Pa=function(t){(0,Pq.default)(e,t);var r=lwe(e);function e(){var n;(0,Aq.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Kl.default)((0,Sq.default)(n),"state",void 0),n}return(0,Tq.default)(e,[{key:"initializeState",value:function(){e._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}},{key:"shouldUpdateState",value:function(i){var a=i.changeFlags;return this._shouldUseHighPrecision()?a.propsOrDataChanged:a.somethingChanged}},{key:"updateState",value:function(i){var a=i.props,o=i.changeFlags;if(a.highPrecision!==!0&&(o.dataChanged||o.updateTriggersChanged&&o.updateTriggersChanged.getHexagon)){var s=this._calculateH3DataProps();this.setState(s)}this._updateVertices(this.context.viewport)}},{key:"_calculateH3DataProps",value:function(){var i=-1,a=!1,o=!1,s=Nt(this.props.data),u=s.iterable,l=s.objectInfo,f=Hw(u),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;l.index++;var d=this.props.getHexagon(p,l),v=(0,Ar.h3GetResolution)(d);if(i<0){if(i=v,!this.props.highPrecision)break}else if(i!==v){o=!0;break}if((0,Ar.h3IsPentagon)(d)){a=!0;break}}}catch(m){f.e(m)}finally{f.f()}return{resolution:i,edgeLengthKM:i>=0?(0,Ar.edgeLength)(i,"km"):0,hasMultipleRes:o,hasPentagon:a}}},{key:"_shouldUseHighPrecision",value:function(){if(this.props.highPrecision==="auto"){var i=this.state,a=i.resolution,o=i.hasPentagon,s=i.hasMultipleRes,u=this.context.viewport;return Boolean(u?.resolution)||s||o||a>=0&&a<=5}return this.props.highPrecision}},{key:"_updateVertices",value:function(i){if(!this._shouldUseHighPrecision()){var a=this.state,o=a.resolution,s=a.edgeLengthKM,u=a.centerHex;if(!(o<0)){var l=this.props.centerHexagon||(0,Ar.geoToH3)(i.latitude,i.longitude,o);if(u!==l){if(u){var f=(0,Ar.h3Distance)(u,l);if(f>=0&&f*s<pwe)return}var c=i.distanceScales.unitsPerMeter,p=xq(l),d=(0,Ar.h3ToGeo)(l),v=(0,Mh.default)(d,2),m=v[0],g=v[1],y=i.projectFlat([g,m]),_=(0,Mh.default)(y,2),b=_[0],x=_[1];p=p.map(function(A){var T=i.projectFlat(A);return[(T[0]-b)/c[0],(T[1]-x)/c[1]]}),this.setState({centerHex:l,vertices:p})}}}}},{key:"renderLayers",value:function(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}},{key:"_getForwardProps",value:function(){var i=this.props,a=i.elevationScale,o=i.material,s=i.coverage,u=i.extruded,l=i.wireframe,f=i.stroked,c=i.filled,p=i.lineWidthUnits,d=i.lineWidthScale,v=i.lineWidthMinPixels,m=i.lineWidthMaxPixels,g=i.getFillColor,y=i.getElevation,_=i.getLineColor,b=i.getLineWidth,x=i.transitions,A=i.updateTriggers;return{elevationScale:a,extruded:u,coverage:s,wireframe:l,stroked:f,filled:c,lineWidthUnits:p,lineWidthScale:d,lineWidthMinPixels:v,lineWidthMaxPixels:m,material:o,getElevation:y,getFillColor:g,getLineColor:_,getLineWidth:b,transitions:x,updateTriggers:{getFillColor:A.getFillColor,getElevation:A.getElevation,getLineColor:A.getLineColor,getLineWidth:A.getLineWidth}}}},{key:"_renderPolygonLayer",value:function(){var i=this.props,a=i.data,o=i.getHexagon,s=i.updateTriggers,u=i.coverage,l=this.getSubLayerClass("hexagon-cell-hifi",Fi),f=this._getForwardProps();return f.updateTriggers.getPolygon=mwe(s.getHexagon,u),new l(f,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:f.updateTriggers}),{data:a,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:function(p,d){var v=o(p,d);return vwe(xq(v,u))}})}},{key:"_renderColumnLayer",value:function(){var i=this.props,a=i.data,o=i.getHexagon,s=i.updateTriggers,u=this.getSubLayerClass("hexagon-cell",Li),l=this._getForwardProps();return l.updateTriggers.getPosition=s.getHexagon,new u(l,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:l.updateTriggers}),{data:a,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:dwe.bind(null,o)})}}]),e}(St);(0,Kl.default)(Pa,"defaultProps",gwe);(0,Kl.default)(Pa,"layerName","H3HexagonLayer");(0,Kl.default)(Pa,"_checkH3Lib",function(){});function Cq(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=ywe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function ywe(t,r){if(t){if(typeof t=="string")return Mq(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Mq(t,r)}}function Mq(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function _we(t){var r=bwe();return function(){var n=(0,Ww.default)(t),i;if(r){var a=(0,Ww.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,kq.default)(this,i)}}function bwe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xwe={getHexagons:{type:"accessor",value:function(r){return r.hexagons}}},Ny=function(t){(0,Lq.default)(e,t);var r=_we(e);function e(){return(0,Iq.default)(this,e),r.apply(this,arguments)}return(0,Rq.default)(e,[{key:"initializeState",value:function(){Pa._checkH3Lib()}},{key:"updateState",value:function(i){var a=i.props,o=i.changeFlags;if(o.dataChanged||o.updateTriggersChanged&&o.updateTriggersChanged.getHexagons){var s=a.data,u=a.getHexagons,l=[],f=Nt(s),c=f.iterable,p=f.objectInfo,d=Cq(c),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;p.index++;var g=u(m,p),y=(0,Bq.h3SetToMultiPolygon)(g,!0),_=Cq(y),b;try{for(_.s();!(b=_.n()).done;){var x=b.value;l.push(this.getSubLayerRow({polygon:x},m,p.index))}}catch(A){_.e(A)}finally{_.f()}}}catch(A){d.e(A)}finally{d.f()}this.setState({polygons:l})}}},{key:"indexToBounds",value:function(){var i=this.props,a=i.getElevation,o=i.getFillColor,s=i.getLineColor,u=i.getLineWidth;return{data:this.state.polygons,getPolygon:function(f){return f.polygon},getElevation:this.getSubLayerAccessor(a),getFillColor:this.getSubLayerAccessor(o),getLineColor:this.getSubLayerAccessor(s),getLineWidth:this.getSubLayerAccessor(u)}}}]),e}(Cn);(0,$w.default)(Ny,"layerName","H3ClusterLayer");(0,$w.default)(Ny,"defaultProps",xwe);var Dee=h(ge()),Nee=h(L()),jee=h(N()),Uee=h(_e()),Gee=h(Y()),zee=h(K()),WC=h(q()),Qh=h(B()),$C=h(de());var EY=h(L()),CY=h(N()),MY=h(_e()),kh=h(Oe()),IY=h(Y()),RY=h(K()),Vs=h(q()),Bh=h(B());function Awe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Twe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Twe(t,r){if(t){if(typeof t=="string")return Fq(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Fq(t,r)}}function Fq(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Xw=Math.PI/180,jy=new Float32Array(16),Dq=new Float32Array(12);function Nq(t,r,e){var n=r[0]*Xw,i=r[1]*Xw,a=r[2]*Xw,o=Math.sin(a),s=Math.sin(n),u=Math.sin(i),l=Math.cos(a),f=Math.cos(n),c=Math.cos(i),p=e[0],d=e[1],v=e[2];t[0]=p*c*f,t[1]=p*u*f,t[2]=p*-s,t[3]=d*(-u*l+c*s*o),t[4]=d*(c*l+u*s*o),t[5]=d*f*o,t[6]=v*(u*o+c*s*l),t[7]=v*(-c*o+u*s*l),t[8]=v*f*l}function jq(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}var Uy={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update:function(r,e){var n=e.startRow,i=e.endRow,a=this.props,o=a.data,s=a.getOrientation,u=a.getScale,l=a.getTranslation,f=a.getTransformMatrix,c=Array.isArray(f),p=c&&f.length===16,d=Array.isArray(u),v=Array.isArray(s),m=Array.isArray(l),g=p||!c&&Boolean(f(o[0]));g?r.constant=p:r.constant=v&&d&&m;var y=r.value;if(r.constant){var _;if(g)jy.set(f),_=jq(jy);else{_=Dq;var b=s,x=u;Nq(_,b,x),_.set(l,9)}r.value=new Float32Array(_)}else{var A=n*r.size,T=Nt(o,n,i),O=T.iterable,w=T.objectInfo,E=Awe(O),S;try{for(E.s();!(S=E.n()).done;){var I=S.value;w.index++;var R=void 0;if(g)jy.set(p?f:f(I,w)),R=jq(jy);else{R=Dq;var z=v?s:s(I,w),G=d?u:u(I,w);Nq(R,z,G),R.set(m?l:l(I,w),9)}y[A++]=R[0],y[A++]=R[1],y[A++]=R[2],y[A++]=R[3],y[A++]=R[4],y[A++]=R[5],y[A++]=R[6],y[A++]=R[7],y[A++]=R[8],y[A++]=R[9],y[A++]=R[10],y[A++]=R[11]}}catch(k){E.e(k)}finally{E.f()}}}};function Gy(t,r){return r===se.CARTESIAN||r===se.METER_OFFSETS||r===se.DEFAULT&&!t.isGeospatial}var Uq=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Gq=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function wa(t){for(var r=1/0,e=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=t.POSITION?t.POSITION.value:[],u=s&&s.length,l=0;l<u;l+=3){var f=s[l],c=s[l+1],p=s[l+2];r=f<r?f:r,e=c<e?c:e,n=p<n?p:n,i=f>i?f:i,a=c>a?c:a,o=p>o?p:o}return[[r,e,n],[i,a,o]]}var qw=h(dr()),Wq=h(L()),$q=h(N());function zq(t,r){if(!t)throw new Error(r||"loader assertion failed.")}function Yw(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Swe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Swe(t,r){if(t){if(typeof t=="string")return Vq(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Vq(t,r)}}function Vq(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Ih=function(){function t(r,e){(0,Wq.default)(this,t),C(this,"fields",void 0),C(this,"metadata",void 0),zq(Array.isArray(r)),Pwe(r),this.fields=r,this.metadata=e||new Map}return(0,$q.default)(t,[{key:"compareTo",value:function(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(var n=0;n<this.fields.length;++n)if(!this.fields[n].compareTo(e.fields[n]))return!1;return!0}},{key:"select",value:function(){for(var e=Object.create(null),n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];for(var o=0,s=i;o<s.length;o++){var u=s[o];e[u]=!0}var l=this.fields.filter(function(f){return e[f.name]});return new t(l,this.metadata)}},{key:"selectAt",value:function(){for(var e=this,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];var o=i.map(function(s){return e.fields[s]}).filter(Boolean);return new t(o,this.metadata)}},{key:"assign",value:function(e){var n,i=this.metadata;if(e instanceof t){var a=e;n=a.fields,i=Hq(Hq(new Map,this.metadata),a.metadata)}else n=e;var o=Object.create(null),s=Yw(this.fields),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;o[l.name]=l}}catch(v){s.e(v)}finally{s.f()}var f=Yw(n),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;o[p.name]=p}}catch(v){f.e(v)}finally{f.f()}var d=Object.values(o);return new t(d,i)}}]),t}();function Pwe(t){var r={},e=Yw(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;r[i.name]&&console.warn("Schema: duplicated field name",i.name,i),r[i.name]=!0}}catch(a){e.e(a)}finally{e.f()}}function Hq(t,r){return new Map([].concat((0,qw.default)(t||new Map),(0,qw.default)(r||new Map)))}var Xq=h(L()),qq=h(N());var Rh=function(){function t(r,e){(0,Xq.default)(this,t);var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;C(this,"name",void 0),C(this,"type",void 0),C(this,"nullable",void 0),C(this,"metadata",void 0),this.name=r,this.type=e,this.nullable=n,this.metadata=i}return(0,qq.default)(t,[{key:"typeId",get:function(){return this.type&&this.type.typeId}},{key:"clone",value:function(){return new t(this.name,this.type,this.nullable,this.metadata)}},{key:"compareTo",value:function(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}},{key:"toString",value:function(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}]),t}();var fn=h(_e()),Ke=h(Y()),Yq=h(K()),Kw=h(q()),We=h(L()),Jr=h(N());var Ye;(function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth"})(Ye||(Ye={}));function Qe(t){var r=wwe();return function(){var n=(0,Kw.default)(t),i;if(r){var a=(0,Kw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Yq.default)(this,i)}}function wwe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Kq,Jq,Zq,Qq,eY,tY,rY,nY,Zr=function(){function t(){(0,We.default)(this,t)}return(0,Jr.default)(t,[{key:"typeId",get:function(){return Ye.NONE}},{key:"compareTo",value:function(e){return this===e}}],[{key:"isNull",value:function(e){return e&&e.typeId===Ye.Null}},{key:"isInt",value:function(e){return e&&e.typeId===Ye.Int}},{key:"isFloat",value:function(e){return e&&e.typeId===Ye.Float}},{key:"isBinary",value:function(e){return e&&e.typeId===Ye.Binary}},{key:"isUtf8",value:function(e){return e&&e.typeId===Ye.Utf8}},{key:"isBool",value:function(e){return e&&e.typeId===Ye.Bool}},{key:"isDecimal",value:function(e){return e&&e.typeId===Ye.Decimal}},{key:"isDate",value:function(e){return e&&e.typeId===Ye.Date}},{key:"isTime",value:function(e){return e&&e.typeId===Ye.Time}},{key:"isTimestamp",value:function(e){return e&&e.typeId===Ye.Timestamp}},{key:"isInterval",value:function(e){return e&&e.typeId===Ye.Interval}},{key:"isList",value:function(e){return e&&e.typeId===Ye.List}},{key:"isStruct",value:function(e){return e&&e.typeId===Ye.Struct}},{key:"isUnion",value:function(e){return e&&e.typeId===Ye.Union}},{key:"isFixedSizeBinary",value:function(e){return e&&e.typeId===Ye.FixedSizeBinary}},{key:"isFixedSizeList",value:function(e){return e&&e.typeId===Ye.FixedSizeList}},{key:"isMap",value:function(e){return e&&e.typeId===Ye.Map}},{key:"isDictionary",value:function(e){return e&&e.typeId===Ye.Dictionary}}]),t}(),iY=function(t,r){(0,Ke.default)(n,t);var e=Qe(n);function n(){return(0,We.default)(this,n),e.apply(this,arguments)}return(0,Jr.default)(n,[{key:"typeId",get:function(){return Ye.Null}},{key:r,get:function(){return"Null"}},{key:"toString",value:function(){return"Null"}}]),n}(Zr,Symbol.toStringTag),aY=function(t,r){(0,Ke.default)(n,t);var e=Qe(n);function n(){return(0,We.default)(this,n),e.apply(this,arguments)}return(0,Jr.default)(n,[{key:"typeId",get:function(){return Ye.Bool}},{key:r,get:function(){return"Bool"}},{key:"toString",value:function(){return"Bool"}}]),n}(Zr,Symbol.toStringTag);Kq=Symbol.toStringTag;var Ui=function(t,r){(0,Ke.default)(n,t);var e=Qe(n);function n(i,a){var o;return(0,We.default)(this,n),o=e.call(this),C((0,fn.default)(o),"isSigned",void 0),C((0,fn.default)(o),"bitWidth",void 0),o.isSigned=i,o.bitWidth=a,o}return(0,Jr.default)(n,[{key:"typeId",get:function(){return Ye.Int}},{key:r,get:function(){return"Int"}},{key:"toString",value:function(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}]),n}(Zr,Kq),zy=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,!0,8)}return e}(Ui),Vy=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,!0,16)}return e}(Ui),Hy=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,!0,32)}return e}(Ui),oY=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,!0,64)}return e}(Ui),Wy=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,!1,8)}return e}(Ui),$y=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,!1,16)}return e}(Ui),Xy=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,!1,32)}return e}(Ui),sY=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,!1,64)}return e}(Ui),Jw={HALF:16,SINGLE:32,DOUBLE:64};Jq=Symbol.toStringTag;var Lh=function(t,r){(0,Ke.default)(n,t);var e=Qe(n);function n(i){var a;return(0,We.default)(this,n),a=e.call(this),C((0,fn.default)(a),"precision",void 0),a.precision=i,a}return(0,Jr.default)(n,[{key:"typeId",get:function(){return Ye.Float}},{key:r,get:function(){return"Float"}},{key:"toString",value:function(){return"Float".concat(this.precision)}}]),n}(Zr,Jq),uY=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,Jw.HALF)}return e}(Lh),qy=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,Jw.SINGLE)}return e}(Lh),Yy=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,Jw.DOUBLE)}return e}(Lh),lY=function(t,r){(0,Ke.default)(n,t);var e=Qe(n);function n(){return(0,We.default)(this,n),e.call(this)}return(0,Jr.default)(n,[{key:"typeId",get:function(){return Ye.Binary}},{key:"toString",value:function(){return"Binary"}},{key:r,get:function(){return"Binary"}}]),n}(Zr,Symbol.toStringTag),fY=function(t,r){(0,Ke.default)(n,t);var e=Qe(n);function n(){return(0,We.default)(this,n),e.apply(this,arguments)}return(0,Jr.default)(n,[{key:"typeId",get:function(){return Ye.Utf8}},{key:r,get:function(){return"Utf8"}},{key:"toString",value:function(){return"Utf8"}}]),n}(Zr,Symbol.toStringTag),Zw={DAY:0,MILLISECOND:1};Zq=Symbol.toStringTag;var Ky=function(t,r){(0,Ke.default)(n,t);var e=Qe(n);function n(i){var a;return(0,We.default)(this,n),a=e.call(this),C((0,fn.default)(a),"unit",void 0),a.unit=i,a}return(0,Jr.default)(n,[{key:"typeId",get:function(){return Ye.Date}},{key:r,get:function(){return"Date"}},{key:"toString",value:function(){return"Date".concat((this.unit+1)*32,"<").concat(Zw[this.unit],">")}}]),n}(Zr,Zq),cY=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,Zw.DAY)}return e}(Ky),pY=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,Zw.MILLISECOND)}return e}(Ky),So={SECOND:1,MILLISECOND:1e3,MICROSECOND:1e6,NANOSECOND:1e9};Qq=Symbol.toStringTag;var Jy=function(t,r){(0,Ke.default)(n,t);var e=Qe(n);function n(i,a){var o;return(0,We.default)(this,n),o=e.call(this),C((0,fn.default)(o),"unit",void 0),C((0,fn.default)(o),"bitWidth",void 0),o.unit=i,o.bitWidth=a,o}return(0,Jr.default)(n,[{key:"typeId",get:function(){return Ye.Time}},{key:"toString",value:function(){return"Time".concat(this.bitWidth,"<").concat(So[this.unit],">")}},{key:r,get:function(){return"Time"}}]),n}(Zr,Qq),hY=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,So.SECOND,32)}return e}(Jy),dY=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,So.MILLISECOND,32)}return e}(Jy);eY=Symbol.toStringTag;var Jl=function(t,r){(0,Ke.default)(n,t);var e=Qe(n);function n(i){var a;(0,We.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return a=e.call(this),C((0,fn.default)(a),"unit",void 0),C((0,fn.default)(a),"timezone",void 0),a.unit=i,a.timezone=o,a}return(0,Jr.default)(n,[{key:"typeId",get:function(){return Ye.Timestamp}},{key:r,get:function(){return"Timestamp"}},{key:"toString",value:function(){return"Timestamp<".concat(So[this.unit]).concat(this.timezone?", ".concat(this.timezone):"",">")}}]),n}(Zr,eY),vY=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){(0,We.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return r.call(this,So.SECOND,n)}return e}(Jl),mY=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){(0,We.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return r.call(this,So.MILLISECOND,n)}return e}(Jl),gY=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){(0,We.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return r.call(this,So.MICROSECOND,n)}return e}(Jl),yY=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){(0,We.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return r.call(this,So.NANOSECOND,n)}return e}(Jl),Qw={DAY_TIME:0,YEAR_MONTH:1};tY=Symbol.toStringTag;var Zy=function(t,r){(0,Ke.default)(n,t);var e=Qe(n);function n(i){var a;return(0,We.default)(this,n),a=e.call(this),C((0,fn.default)(a),"unit",void 0),a.unit=i,a}return(0,Jr.default)(n,[{key:"typeId",get:function(){return Ye.Interval}},{key:r,get:function(){return"Interval"}},{key:"toString",value:function(){return"Interval<".concat(Qw[this.unit],">")}}]),n}(Zr,tY),_Y=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,Qw.DAY_TIME)}return e}(Zy),bY=function(t){(0,Ke.default)(e,t);var r=Qe(e);function e(){return(0,We.default)(this,e),r.call(this,Qw.YEAR_MONTH)}return e}(Zy);rY=Symbol.toStringTag;var Qy=function(t,r){(0,Ke.default)(n,t);var e=Qe(n);function n(i,a){var o;return(0,We.default)(this,n),o=e.call(this),C((0,fn.default)(o),"listSize",void 0),C((0,fn.default)(o),"children",void 0),o.listSize=i,o.children=[a],o}return(0,Jr.default)(n,[{key:"typeId",get:function(){return Ye.FixedSizeList}},{key:"valueType",get:function(){return this.children[0].type}},{key:"valueField",get:function(){return this.children[0]}},{key:r,get:function(){return"FixedSizeList"}},{key:"toString",value:function(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}]),n}(Zr,rY);nY=Symbol.toStringTag;var xY=function(t,r){(0,Ke.default)(n,t);var e=Qe(n);function n(i){var a;return(0,We.default)(this,n),a=e.call(this),C((0,fn.default)(a),"children",void 0),a.children=i,a}return(0,Jr.default)(n,[{key:"typeId",get:function(){return Ye.Struct}},{key:"toString",value:function(){return"Struct<{".concat(this.children.map(function(a){return"".concat(a.name,":").concat(a.type)}).join(", "),"}>")}},{key:r,get:function(){return"Struct"}}]),n}(Zr,nY);function AY(t){switch(t.constructor){case Int8Array:return new zy;case Uint8Array:return new Wy;case Int16Array:return new Vy;case Uint16Array:return new $y;case Int32Array:return new Hy;case Uint32Array:return new Xy;case Float32Array:return new qy;case Float64Array:return new Yy;default:throw new Error("array type not supported")}}function eO(t,r,e){var n=AY(r.value),i=e||TY(r),a=new Rh(t,new Qy(r.size,new Rh("value",n)),!1,i);return a}function TY(t){var r=new Map;return"byteOffset"in t&&r.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&r.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&r.set("normalized",t.normalized.toString()),r}function SY(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function PY(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?SY(Object(e),!0).forEach(function(n){(0,Bh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):SY(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Owe(t){var r=Ewe();return function(){var n=(0,Vs.default)(t),i;if(r){var a=(0,Vs.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,RY.default)(this,i)}}function Ewe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function wY(t,r){var e=t.COLOR_0||t.colors,n=e&&r;n||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),Z.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function OY(t,r){if(t.attributes)return wY(t.attributes,r),t instanceof Ce?t:new Ce(t);if(t.positions||t.POSITION)return wY(t,r),new Ce({attributes:t});throw Error("Invalid mesh")}var Cwe=[0,0,0,255],Mwe={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:function(r){return r.position}},getColor:{type:"accessor",value:Cwe},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}},Oa=function(t){(0,IY.default)(e,t);var r=Owe(e);function e(){var n;(0,EY.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Bh.default)((0,MY.default)(n),"state",void 0),n}return(0,CY.default)(e,[{key:"getShaders",value:function(){var i=!fe(this.context.gl),a={};return $n(this.context.gl,Ae.GLSL_DERIVATIVES)&&(a.DERIVATIVES_AVAILABLE=1),(0,kh.default)((0,Vs.default)(e.prototype),"getShaders",this).call(this,{vs:Uq,fs:Gq,modules:[Ze,ia,it],transpileToGLSL100:i,defines:a})}},{key:"getBounds",value:function(){var i;if(this.props._instanced)return(0,kh.default)((0,Vs.default)(e.prototype),"getBounds",this).call(this);var a=this.state.positionBounds;if(a)return a;var o=this.props.mesh;if(!o)return null;if(a=(i=o.header)===null||i===void 0?void 0:i.boundingBox,!a){var s=OY(o,this.props._useMeshColors),u=s.attributes;u.POSITION=u.POSITION||u.positions,a=wa(u)}return this.state.positionBounds=a,a}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:Uy}),this.setState({emptyTexture:new Se(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}},{key:"updateState",value:function(i){(0,kh.default)((0,Vs.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.oldProps,s=i.changeFlags;if(a.mesh!==o.mesh||s.extensionsChanged){var u;if(this.state.positionBounds=null,(u=this.state.model)===null||u===void 0||u.delete(),a.mesh){this.state.model=this.getModel(a.mesh);var l=a.mesh.attributes||a.mesh;this.setState({hasNormals:Boolean(l.NORMAL||l.normals)})}this.getAttributeManager().invalidateAll()}a.texture!==o.texture&&this.setTexture(a.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}},{key:"finalizeState",value:function(i){(0,kh.default)((0,Vs.default)(e.prototype),"finalizeState",this).call(this,i),this.state.emptyTexture.delete()}},{key:"draw",value:function(i){var a=i.uniforms;if(this.state.model){var o=this.context.viewport,s=this.props,u=s.sizeScale,l=s.coordinateSystem,f=s._instanced;this.state.model.setUniforms(a).setUniforms({sizeScale:u,composeModelMatrix:!f||Gy(o,l),flatShading:!this.state.hasNormals}).draw()}}},{key:"getModel",value:function(i){var a=new Ee(this.context.gl,PY(PY({},this.getShaders()),{},{id:this.props.id,geometry:OY(i,this.props._useMeshColors),isInstanced:!0})),o=this.props.texture,s=this.state.emptyTexture;return a.setUniforms({sampler:o||s,hasTexture:Boolean(o)}),a}},{key:"setTexture",value:function(i){var a=this.state,o=a.emptyTexture,s=a.model;s&&s.setUniforms({sampler:i||o,hasTexture:Boolean(i)})}}]),e}(Ve);(0,Bh.default)(Oa,"defaultProps",Mwe);(0,Bh.default)(Oa,"layerName","SimpleMeshLayer");var sZ=h(L()),uZ=h(N()),lZ=h(_e()),OE=h(Oe()),fZ=h(Y()),cZ=h(K()),Yh=h(q()),Kh=h(B()),pZ=h(Je());var eK=h(L()),tK=h(N());var FY=h(dr()),DY=h(L()),NY=h(N()),jY=h(Oe()),UY=h(Y()),GY=h(K()),e0=h(q());var LY=h(L()),kY=h(N());var Gi=function(){function t(){(0,LY.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.id;this.id=e||Xe(this.constructor.name),this.display=!0,this.position=new V,this.rotation=new V,this.scale=new V(1,1,1),this.matrix=new ce,this.userData={},this.props={},this._setScenegraphNodeProps(r)}return(0,kY.default)(t,[{key:"delete",value:function(){}},{key:"setProps",value:function(e){return this._setScenegraphNodeProps(e),this}},{key:"toString",value:function(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}},{key:"setPosition",value:function(e){return J(e.length===3,"setPosition requires vector argument"),this.position=e,this}},{key:"setRotation",value:function(e){return J(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}},{key:"setScale",value:function(e){return J(e.length===3,"setScale requires vector argument"),this.scale=e,this}},{key:"setMatrix",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;n?this.matrix.copy(e):this.matrix=e}},{key:"setMatrixComponents",value:function(e){var n=e.position,i=e.rotation,a=e.scale,o=e.update,s=o===void 0?!0:o;return n&&this.setPosition(n),i&&this.setRotation(i),a&&this.setScale(a),s&&this.updateMatrix(),this}},{key:"updateMatrix",value:function(){var e=this.position,n=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(n),this.matrix.scale(i),this}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.position,i=e.rotation,a=e.scale;return n&&this.setPosition(n),i&&this.setRotation(i),a&&this.setScale(a),this.updateMatrix(),this}},{key:"getCoordinateUniforms",value:function(e,n){J(e),n=n||this.matrix;var i=new ce(e).multiplyRight(n),a=i.invert(),o=a.transpose();return{viewMatrix:e,modelMatrix:n,objectMatrix:n,worldMatrix:i,worldInverseMatrix:a,worldInverseTransposeMatrix:o}}},{key:"_setScenegraphNodeProps",value:function(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}]),t}();function Iwe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Rwe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Rwe(t,r){if(t){if(typeof t=="string")return BY(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return BY(t,r)}}function BY(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Lwe(t){var r=kwe();return function(){var n=(0,e0.default)(t),i;if(r){var a=(0,e0.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,GY.default)(this,i)}}function kwe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var t0=function(t){(0,UY.default)(e,t);var r=Lwe(e);function e(){var n;(0,DY.default)(this,e);var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};i=Array.isArray(i)?{children:i}:i;var a=i,o=a.children,s=o===void 0?[]:o;return re.assert(s.every(function(u){return u instanceof Gi}),"every child must an instance of ScenegraphNode"),n=r.call(this,i),n.children=s,n}return(0,NY.default)(e,[{key:"add",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++){var l=u[s];Array.isArray(l)?this.add.apply(this,(0,FY.default)(l)):this.children.push(l)}return this}},{key:"remove",value:function(i){var a=this.children,o=a.indexOf(i);return o>-1&&a.splice(o,1),this}},{key:"removeAll",value:function(){return this.children=[],this}},{key:"delete",value:function(){this.children.forEach(function(i){return i.delete()}),this.removeAll(),(0,jY.default)((0,e0.default)(e.prototype),"delete",this).call(this)}},{key:"traverse",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a.worldMatrix,s=o===void 0?new ce:o,u=new ce(s).multiplyRight(this.matrix),l=Iwe(this.children),f;try{for(l.s();!(f=l.n()).done;){var c=f.value;c instanceof e?c.traverse(i,{worldMatrix:u}):i(c,{worldMatrix:u})}}catch(p){l.e(p)}finally{l.f()}}}]),e}(Gi);var rO=h(L()),nO=h(N());var Bwe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Fwe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function zY(t){if(!t._animation){var r=Fwe[t.componentType],e=Bwe[t.type],n=e*t.count,i=t.bufferView.data,a=i.buffer,o=i.byteOffset,s=new r(a,o+(t.byteOffset||0),n);if(e===1)t._animation=Array.from(s);else{for(var u=[],l=0;l<s.length;l+=e)u.push(Array.from(s.slice(l,l+e)));t._animation=u}}return t._animation}var Dwe=new ce;function Nwe(t,r){if(r.matrix.identity(),t.translation&&r.matrix.translate(t.translation),t.rotation){var e=Dwe.fromQuaternion(t.rotation);r.matrix.multiplyRight(e)}t.scale&&r.matrix.scale(t.scale)}var tO=new Ti;function jwe(t,r,e,n,i){if(r==="rotation"){tO.slerp({start:e,target:n,ratio:i});for(var a=0;a<tO.length;a++)t[r][a]=tO[a]}else for(var o=0;o<e.length;o++)t[r][o]=i*n[o]+(1-i)*e[o]}function Uwe(t,r,e){for(var n=e.p0,i=e.outTangent0,a=e.inTangent1,o=e.p1,s=e.tDiff,u=e.ratio,l=0;l<t[r].length;l++){var f=i[l]*s,c=a[l]*s;t[r][l]=(2*Math.pow(u,3)-3*Math.pow(u,2)+1)*n[l]+(Math.pow(u,3)-2*Math.pow(u,2)+u)*f+(-2*Math.pow(u,3)+3*Math.pow(u,2))*o[l]+(Math.pow(u,3)-Math.pow(u,2))*c}}function Gwe(t,r,e){for(var n=0;n<e.length;n++)t[r][n]=e[n]}function zwe(t,r,e,n){var i=r.input,a=r.interpolation,o=r.output,s=i[i.length-1],u=t%s,l=i.findIndex(function(x){return x>=u}),f=Math.max(0,l-1);if(!Array.isArray(e[n]))switch(n){case"translation":e[n]=[0,0,0];break;case"rotation":e[n]=[0,0,0,1];break;case"scale":e[n]=[1,1,1];break;default:re.warn("Bad animation path ".concat(n))()}J(e[n].length===o[f].length);var c=i[f],p=i[l];switch(a){case"STEP":Gwe(e,n,o[f]);break;case"LINEAR":if(p>c){var d=(u-c)/(p-c);jwe(e,n,o[f],o[l],d)}break;case"CUBICSPLINE":if(p>c){var v=(u-c)/(p-c),m=p-c,g=o[3*f+1],y=o[3*f+2],_=o[3*l+0],b=o[3*l+1];Uwe(e,n,{p0:g,outTangent0:y,inTangent1:_,p1:b,tDiff:m,ratio:v})}break;default:re.warn("Interpolation ".concat(a," not supported"))();break}}var Vwe=function(){function t(r){(0,rO.default)(this,t),this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,r)}return(0,nO.default)(t,[{key:"animate",value:function(e){if(this.playing){var n=e/1e3,i=(n-this.startTime)*this.speed;this.channels.forEach(function(a){var o=a.sampler,s=a.target,u=a.path;zwe(i,o,s,u),Nwe(s,s._node)})}}}]),t}(),VY=function(){function t(r){(0,rO.default)(this,t),this.animations=r.animations.map(function(e,n){var i=e.name||"Animation-".concat(n),a=e.samplers.map(function(s){var u=s.input,l=s.interpolation,f=l===void 0?"LINEAR":l,c=s.output;return{input:zY(r.accessors[u]),interpolation:f,output:zY(r.accessors[c])}}),o=e.channels.map(function(s){var u=s.sampler,l=s.target;return{sampler:a[u],target:r.nodes[l.node],path:l.path}});return new Vwe({name:i,channels:o})})}return(0,nO.default)(t,[{key:"animate",value:function(e){this.setTime(e)}},{key:"setTime",value:function(e){this.animations.forEach(function(n){return n.animate(e)})}},{key:"getAnimations",value:function(){return this.animations}}]),t}();var aO=h(dr());var HY=h(L()),WY=h(N()),$Y=h(Oe()),XY=h(Y()),qY=h(K()),r0=h(q());function Hwe(t){var r=Wwe();return function(){var n=(0,r0.default)(t),i;if(r){var a=(0,r0.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,qY.default)(this,i)}}function Wwe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var YY=function(t){(0,XY.default)(e,t);var r=Hwe(e);function e(n){var i;(0,HY.default)(this,e);var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=r.call(this,a),i.onBeforeRender=null,i.AfterRender=null,n instanceof Ee?(i.model=n,i._setModelNodeProps(a)):i.model=new Ee(n,a),i.managedResources=a.managedResources||[],i}return(0,WY.default)(e,[{key:"setProps",value:function(i){return(0,$Y.default)((0,r0.default)(e.prototype),"setProps",this).call(this,i),this._setModelNodeProps(i),this}},{key:"delete",value:function(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(function(i){return i.delete()}),this.managedResources=[]}},{key:"draw",value:function(){var i;return(i=this.model).draw.apply(i,arguments)}},{key:"setUniforms",value:function(){var i;return(i=this.model).setUniforms.apply(i,arguments),this}},{key:"setAttributes",value:function(){var i;return(i=this.model).setAttributes.apply(i,arguments),this}},{key:"updateModuleSettings",value:function(){var i;return(i=this.model).updateModuleSettings.apply(i,arguments),this}},{key:"_setModelNodeProps",value:function(i){this.model.setProps(i)}}]),e}(Gi);var n0=h(B()),JY=h(L()),ZY=h(N());function KY(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function iO(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?KY(Object(e),!0).forEach(function(n){(0,n0.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):KY(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Fh=function(){function t(r,e){(0,JY.default)(this,t);var n=e.attributes,i=e.material,a=e.pbrDebug,o=e.imageBasedLightingEnvironment,s=e.lights,u=e.useTangents;this.gl=r,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},$n(r,Ae.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],o&&(this.uniforms.u_DiffuseEnvSampler=o.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=o.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=o.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),a&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(n.NORMAL,"HAS_NORMALS"),this.defineIfPresent(n.TANGENT&&u,"HAS_TANGENTS"),this.defineIfPresent(n.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(o,"USE_IBL"),this.defineIfPresent(s,"USE_LIGHTS"),this.defineIfPresent(a,"PBR_DEBUG"),i&&this.parseMaterial(i)}return(0,ZY.default)(t,[{key:"defineIfPresent",value:function(e,n){e&&(this.defines[n]=1)}},{key:"parseTexture",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},o=e.texture.source.image,s,u={};o.compressed?(s=o,u=(0,n0.default)({},this.gl.TEXTURE_MIN_FILTER,o.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR)):s={data:o};var l=new Se(this.gl,iO({id:e.name||e.id,parameters:iO(iO({},a),u),pixelStore:(0,n0.default)({},this.gl.UNPACK_FLIP_Y_WEBGL,!1)},s));this.uniforms[n]=l,this.defineIfPresent(i,i),this.generatedTextures.push(l)}},{key:"parsePbrMetallicRoughness",value:function(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");var n=e.metallicFactor,i=n===void 0?1:n,a=e.roughnessFactor,o=a===void 0?1:a;this.uniforms.u_MetallicRoughnessValues=[i,o]}},{key:"parseMaterial",value:function(e){if(this.uniforms.pbr_uUnlit=Boolean(e.unlit),e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");var n=e.normalTexture.scale,i=n===void 0?1:n;this.uniforms.u_NormalScale=i}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");var a=e.occlusionTexture.strength,o=a===void 0?1:a;this.uniforms.u_OcclusionStrength=o}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){var s=e.alphaCutoff,u=s===void 0?.5:s;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=u}else e.alphaMode==="BLEND"&&(re.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}},{key:"delete",value:function(){this.generatedTextures.forEach(function(e){return e.delete()})}}]),t}();var $we=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,Xwe=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function QY(t,r){return fe(t)?`#version 300 es
`.concat(r):r}function oO(t,r){var e=r.id,n=r.drawMode,i=r.vertexCount,a=r.attributes,o=r.modelOptions,s=new Fh(t,r);re.info(4,"createGLTFModel defines: ",s.defines)();var u=[];u.push.apply(u,(0,aO.default)(s.generatedTextures)),u.push.apply(u,(0,aO.default)(Object.values(a).map(function(f){return f.buffer})));var l=new YY(t,Object.assign({id:e,drawMode:n,vertexCount:i,modules:[eo],defines:s.defines,parameters:s.parameters,vs:QY(t,$we),fs:QY(t,Xwe),managedResources:u},o));return l.setProps({attributes:a}),l.setUniforms(s.uniforms),l}var qwe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ywe={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1},rK=function(){function t(r){(0,eK.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.options=Object.assign({},Ywe,e)}return(0,tK.default)(t,[{key:"instantiate",value:function(e){var n=this;this.gltf=e;var i=(e.scenes||[]).map(function(a){return n.createScene(a)});return i}},{key:"createAnimator",value:function(){return Array.isArray(this.gltf.animations)?new VY(this.gltf):null}},{key:"createScene",value:function(e){var n=this,i=e.nodes||[],a=i.map(function(s){return n.createNode(s)}),o=new t0({id:e.name||e.id,children:a});return o}},{key:"createNode",value:function(e){var n=this;if(!e._node){var i=e.children||[],a=i.map(function(u){return n.createNode(u)});e.mesh&&a.push(this.createMesh(e.mesh));var o=new t0({id:e.name||e.id,children:a});if(e.matrix)o.setMatrix(e.matrix);else{if(o.matrix.identity(),e.translation&&o.matrix.translate(e.translation),e.rotation){var s=new ce().fromQuaternion(e.rotation);o.matrix.multiplyRight(s)}e.scale&&o.matrix.scale(e.scale)}e._node=o}return e._node}},{key:"createMesh",value:function(e){var n=this;if(!e._mesh){var i=e.primitives||[],a=i.map(function(s,u){return n.createPrimitive(s,u,e)}),o=new t0({id:e.name||e.id,children:a});e._mesh=o}return e._mesh}},{key:"getVertexCount",value:function(e){re.warn("getVertexCount() not found")()}},{key:"createPrimitive",value:function(e,n,i){return oO(this.gl,Object.assign({id:e.name||"".concat(i.name||i.id,"-primitive-").concat(n),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options))}},{key:"createAttributes",value:function(e,n){var i=this,a={};return Object.keys(e).forEach(function(o){a[o]=i.createAccessor(e[o],i.createBuffer(e[o],i.gl.ARRAY_BUFFER))}),n&&(a.indices=this.createAccessor(n,this.createBuffer(n,this.gl.ELEMENT_ARRAY_BUFFER))),re.info(4,"glTF Attributes",{attributes:e,indices:n,generated:a})(),a}},{key:"createBuffer",value:function(e,n){e.bufferView||(e.bufferView={});var i=e.bufferView;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[n]||(i.lumaBuffers[n]=new be(this.gl,{id:"from-".concat(i.id),data:i.data||e.value,target:n})),i.lumaBuffers[n]}},{key:"createAccessor",value:function(e,n){return new Mr({buffer:n,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:qwe[e.type]})}},{key:"createSampler",value:function(e){return e}},{key:"needsPOT",value:function(){return!1}}]),t}();function i0(t,r,e){var n=new rK(t,e),i=n.instantiate(r),a=n.createAnimator();return{scenes:i,animator:a}}var eZ=h(B()),tZ=h(ge()),AE=h(de());var nK="3.3.3";var Xh=h(ge()),Ma=h(de());var iK="3.3.3";var SK=h(B());var _K=h(Je()),bK=h(ge()),gO=h(de());var hO=h(ye()),Dh=h(ge()),Ea=h(de());var aK="3.3.3",Kwe="https://unpkg.com/@loaders.gl/textures@".concat(aK,"/dist/libs/basis_encoder.wasm"),Jwe="https://unpkg.com/@loaders.gl/textures@".concat(aK,"/dist/libs/basis_encoder.js"),sO;function dO(t){return lO.apply(this,arguments)}function lO(){return lO=(0,Dh.default)(Ea.default.mark(function t(r){var e;return Ea.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e=r.modules||{},!e.basis){i.next=3;break}return i.abrupt("return",e.basis);case 3:return sO=sO||Zwe(r),i.next=6,sO;case 6:return i.abrupt("return",i.sent);case 7:case"end":return i.stop()}},t)})),lO.apply(this,arguments)}function Zwe(t){return fO.apply(this,arguments)}function fO(){return fO=(0,Dh.default)(Ea.default.mark(function t(r){var e,n,i,a;return Ea.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return e=null,n=null,s.t0=Promise,s.next=5,gi("basis_transcoder.js","textures",r);case 5:return s.t1=s.sent,s.next=8,gi("basis_transcoder.wasm","textures",r);case 8:return s.t2=s.sent,s.t3=[s.t1,s.t2],s.next=12,s.t0.all.call(s.t0,s.t3);case 12:return i=s.sent,a=(0,hO.default)(i,2),e=a[0],n=a[1],e=e||globalThis.BASIS,s.next=19,Qwe(e,n);case 19:return s.abrupt("return",s.sent);case 20:case"end":return s.stop()}},t)})),fO.apply(this,arguments)}function Qwe(t,r){var e={};return r&&(e.wasmBinary=r),new Promise(function(n){t(e).then(function(i){var a=i.BasisFile,o=i.initializeBasis;o(),n({BasisFile:a})})})}var uO;function vO(t){return cO.apply(this,arguments)}function cO(){return cO=(0,Dh.default)(Ea.default.mark(function t(r){var e;return Ea.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e=r.modules||{},!e.basisEncoder){i.next=3;break}return i.abrupt("return",e.basisEncoder);case 3:return uO=uO||eOe(r),i.next=6,uO;case 6:return i.abrupt("return",i.sent);case 7:case"end":return i.stop()}},t)})),cO.apply(this,arguments)}function eOe(t){return pO.apply(this,arguments)}function pO(){return pO=(0,Dh.default)(Ea.default.mark(function t(r){var e,n,i,a;return Ea.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return e=null,n=null,s.t0=Promise,s.next=5,gi(Jwe,"textures",r);case 5:return s.t1=s.sent,s.next=8,gi(Kwe,"textures",r);case 8:return s.t2=s.sent,s.t3=[s.t1,s.t2],s.next=12,s.t0.all.call(s.t0,s.t3);case 12:return i=s.sent,a=(0,hO.default)(i,2),e=a[0],n=a[1],e=e||globalThis.BASIS,s.next=19,tOe(e,n);case 19:return s.abrupt("return",s.sent);case 20:case"end":return s.stop()}},t)})),pO.apply(this,arguments)}function tOe(t,r){var e={};return r&&(e.wasmBinary=r),new Promise(function(n){t(e).then(function(i){var a=i.BasisFile,o=i.KTX2File,s=i.initializeBasis,u=i.BasisEncoder;s(),n({BasisFile:a,KTX2File:o,BasisEncoder:u})})})}var Hs={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919};function rOe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=nOe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function nOe(t,r){if(t){if(typeof t=="string")return oK(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return oK(t,r)}}function oK(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var iOe=["","WEBKIT_","MOZ_"],sK={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},a0=null;function uK(t){if(!a0){t=t||aOe()||void 0,a0=new Set;var r=rOe(iOe),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;for(var i in sK)if(t&&t.getExtension("".concat(n).concat(i))){var a=sK[i];a0.add(a)}}}catch(o){r.e(o)}finally{r.f()}}return a0}function aOe(){try{var t=document.createElement("canvas");return t.getContext("webgl")}catch{return null}}var Iut=new Uint8Array([0]);var lK,fK,cK,pK,hK,dK,vK,mK;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(lK||(lK={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(fK||(fK={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(cK||(cK={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(pK||(pK={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(hK||(hK={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(dK||(dK={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(vK||(vK={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(mK||(mK={}));var cn=[171,75,84,88,32,50,48,187,13,10,26,10];function gK(t){var r=new Uint8Array(t),e=r.byteLength<cn.length||r[0]!==cn[0]||r[1]!==cn[1]||r[2]!==cn[2]||r[3]!==cn[3]||r[4]!==cn[4]||r[5]!==cn[5]||r[6]!==cn[6]||r[7]!==cn[7]||r[8]!==cn[8]||r[9]!==cn[9]||r[10]!==cn[10]||r[11]!==cn[11];return!e}var oOe={etc1:{basisFormat:0,compressed:!0,format:Hs.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Hs.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Hs.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Hs.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Hs.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Hs.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function _O(t,r){return yO.apply(this,arguments)}function yO(){return yO=(0,bK.default)(gO.default.mark(function t(r,e){var n,i,a,o,s,u;return gO.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(e.basis.containerFormat!=="auto"){f.next=11;break}if(!gK(r)){f.next=6;break}return f.next=4,vO(e);case 4:return n=f.sent,f.abrupt("return",yK(n.KTX2File,r,e));case 6:return f.next=8,dO(e);case 8:return i=f.sent,a=i.BasisFile,f.abrupt("return",mO(a,r,e));case 11:f.t0=e.basis.module,f.next=f.t0==="encoder"?14:(f.t0==="transcoder",22);break;case 14:return f.next=16,vO(e);case 16:o=f.sent,f.t1=e.basis.containerFormat,f.next=f.t1==="ktx2"?20:(f.t1==="basis",21);break;case 20:return f.abrupt("return",yK(o.KTX2File,r,e));case 21:return f.abrupt("return",mO(o.BasisFile,r,e));case 22:return f.next=24,dO(e);case 24:return s=f.sent,u=s.BasisFile,f.abrupt("return",mO(u,r,e));case 27:case"end":return f.stop()}},t)})),yO.apply(this,arguments)}function mO(t,r,e){var n=new t(new Uint8Array(r));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");for(var i=n.getNumImages(),a=[],o=0;o<i;o++){for(var s=n.getNumLevels(o),u=[],l=0;l<s;l++)u.push(sOe(n,o,l,e));a.push(u)}return a}finally{n.close(),n.delete()}}function sOe(t,r,e,n){var i=t.getImageWidth(r,e),a=t.getImageHeight(r,e),o=t.getHasAlpha(),s=xK(n,o),u=s.compressed,l=s.format,f=s.basisFormat,c=t.getImageTranscodedSizeInBytes(r,e,f),p=new Uint8Array(c);if(!t.transcodeImage(p,r,e,f,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:a,data:p,compressed:u,format:l,hasAlpha:o}}function yK(t,r,e){var n=new t(new Uint8Array(r));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");for(var i=n.getLevels(),a=[],o=0;o<i;o++){a.push(uOe(n,o,e));break}return[a]}finally{n.close(),n.delete()}}function uOe(t,r,e){var n=t.getImageLevelInfo(r,0,0),i=n.alphaFlag,a=n.height,o=n.width,s=xK(e,i),u=s.compressed,l=s.format,f=s.basisFormat,c=t.getImageTranscodedSizeInBytes(r,0,0,f),p=new Uint8Array(c);if(!t.transcodeImage(p,r,0,0,f,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:a,data:p,compressed:u,levelSize:c,hasAlpha:i,format:l}}function xK(t,r){var e=t&&t.basis&&t.basis.format;return e==="auto"&&(e=o0()),(0,_K.default)(e)==="object"&&(e=r?e.alpha:e.noAlpha),e=e.toLowerCase(),oOe[e]}function o0(){var t=uK();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}function AK(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function TK(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?AK(Object(e),!0).forEach(function(n){(0,SK.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):AK(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var PK={name:"Basis",id:Cr?"basis":"basis-nodejs",module:"textures",version:iK,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},bO=TK(TK({},PK),{},{parse:_O});function ir(t,r){if(!t)throw new Error(r||"assert failed: gltf")}function xO(t,r){var e=t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:");if(e)return t;var n=r.baseUri||r.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return n.substr(0,n.lastIndexOf("/")+1)+t}function wK(t,r,e){var n=t.bufferViews[e];ir(n);var i=n.buffer,a=r[i];ir(a);var o=(n.byteOffset||0)+a.byteOffset;return new Uint8Array(a.arrayBuffer,o,n.byteLength)}var MJ=h(ge()),cE=h(de());var MO={};tn(MO,{decode:()=>MOe,name:()=>COe});var EO=h(ge()),Nh=h(de());var IK=h(Je()),RK=h(B()),LK=h(L()),kK=h(N());var OK=["SCALAR","VEC2","VEC3","VEC4"],lOe=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],fOe=new Map(lOe),cOe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pOe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},hOe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function s0(t){var r=OK[t-1];return r||OK[0]}function u0(t){var r=fOe.get(t.constructor);if(!r)throw new Error("Illegal typed array");return r}function Zl(t,r){var e=hOe[t.componentType],n=cOe[t.type],i=pOe[t.componentType],a=t.count*n,o=t.count*n*i;return ir(o>=0&&o<=r.byteLength),{ArrayType:e,length:a,byteLength:o}}function EK(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=dOe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function dOe(t,r){if(t){if(typeof t=="string")return CK(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return CK(t,r)}}function CK(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function MK(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function vOe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?MK(Object(e),!0).forEach(function(n){(0,RK.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):MK(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var mOe={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]},Ct=function(){function t(r){(0,LK.default)(this,t),C(this,"gltf",void 0),C(this,"sourceBuffers",void 0),C(this,"byteLength",void 0),this.gltf=r||{json:vOe({},mOe),buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}return(0,kK.default)(t,[{key:"json",get:function(){return this.gltf.json}},{key:"getApplicationData",value:function(e){var n=this.json[e];return n}},{key:"getExtraData",value:function(e){var n=this.json.extras||{};return n[e]}},{key:"getExtension",value:function(e){var n=this.getUsedExtensions().find(function(a){return a===e}),i=this.json.extensions||{};return n?i[e]||!0:null}},{key:"getRequiredExtension",value:function(e){var n=this.getRequiredExtensions().find(function(i){return i===e});return n?this.getExtension(e):null}},{key:"getRequiredExtensions",value:function(){return this.json.extensionsRequired||[]}},{key:"getUsedExtensions",value:function(){return this.json.extensionsUsed||[]}},{key:"getRemovedExtensions",value:function(){return this.json.extensionsRemoved||[]}},{key:"getObjectExtension",value:function(e,n){var i=e.extensions||{};return i[n]}},{key:"getScene",value:function(e){return this.getObject("scenes",e)}},{key:"getNode",value:function(e){return this.getObject("nodes",e)}},{key:"getSkin",value:function(e){return this.getObject("skins",e)}},{key:"getMesh",value:function(e){return this.getObject("meshes",e)}},{key:"getMaterial",value:function(e){return this.getObject("materials",e)}},{key:"getAccessor",value:function(e){return this.getObject("accessors",e)}},{key:"getTexture",value:function(e){return this.getObject("textures",e)}},{key:"getSampler",value:function(e){return this.getObject("samplers",e)}},{key:"getImage",value:function(e){return this.getObject("images",e)}},{key:"getBufferView",value:function(e){return this.getObject("bufferViews",e)}},{key:"getBuffer",value:function(e){return this.getObject("buffers",e)}},{key:"getObject",value:function(e,n){if((0,IK.default)(n)==="object")return n;var i=this.json[e]&&this.json[e][n];if(!i)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(n,"]"));return i}},{key:"getTypedArrayForBufferView",value:function(e){e=this.getBufferView(e);var n=e.buffer,i=this.gltf.buffers[n];ir(i);var a=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,a,e.byteLength)}},{key:"getTypedArrayForAccessor",value:function(e){e=this.getAccessor(e);var n=this.getBufferView(e.bufferView),i=this.getBuffer(n.buffer),a=i.data,o=Zl(e,n),s=o.ArrayType,u=o.length,l=n.byteOffset+e.byteOffset;return new s(a,l,u)}},{key:"getTypedArrayForImageData",value:function(e){e=this.getAccessor(e);var n=this.getBufferView(e.bufferView),i=this.getBuffer(n.buffer),a=i.data,o=n.byteOffset||0;return new Uint8Array(a,o,n.byteLength)}},{key:"addApplicationData",value:function(e,n){return this.json[e]=n,this}},{key:"addExtraData",value:function(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}},{key:"addObjectExtension",value:function(e,n,i){return e.extensions=e.extensions||{},e.extensions[n]=i,this.registerUsedExtension(n),this}},{key:"setObjectExtension",value:function(e,n,i){var a=e.extensions||{};a[n]=i}},{key:"removeObjectExtension",value:function(e,n){var i=e.extensions||{},a=i[n];return delete i[n],a}},{key:"addExtension",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ir(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}},{key:"addRequiredExtension",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ir(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}},{key:"registerUsedExtension",value:function(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(function(n){return n===e})||this.json.extensionsUsed.push(e)}},{key:"registerRequiredExtension",value:function(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(function(n){return n===e})||this.json.extensionsRequired.push(e)}},{key:"removeExtension",value:function(e){if(this.getExtension(e)){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);var n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}}},{key:"setDefaultScene",value:function(e){this.json.scene=e}},{key:"addScene",value:function(e){var n=e.nodeIndices;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}},{key:"addNode",value:function(e){var n=e.meshIndex,i=e.matrix;this.json.nodes=this.json.nodes||[];var a={mesh:n};return i&&(a.matrix=i),this.json.nodes.push(a),this.json.nodes.length-1}},{key:"addMesh",value:function(e){var n=e.attributes,i=e.indices,a=e.material,o=e.mode,s=o===void 0?4:o,u=this._addAttributes(n),l={primitives:[{attributes:u,mode:s}]};if(i){var f=this._addIndices(i);l.primitives[0].indices=f}return Number.isFinite(a)&&(l.primitives[0].material=a),this.json.meshes=this.json.meshes||[],this.json.meshes.push(l),this.json.meshes.length-1}},{key:"addPointCloud",value:function(e){var n=this._addAttributes(e),i={primitives:[{attributes:n,mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}},{key:"addImage",value:function(e,n){var i=Ko(e),a=n||i?.mimeType,o=this.addBufferView(e),s={bufferView:o,mimeType:a};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}},{key:"addBufferView",value:function(e){var n=e.byteLength;ir(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);var i={buffer:0,byteOffset:this.byteLength,byteLength:n};return this.byteLength+=Va(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}},{key:"addAccessor",value:function(e,n){var i={bufferView:e,type:s0(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}},{key:"addBinaryBuffer",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3},i=this.addBufferView(e),a={min:n.min,max:n.max};(!a.min||!a.max)&&(a=this._getAccessorMinMax(e,n.size));var o={size:n.size,componentType:u0(e),count:Math.round(e.length/n.size),min:a.min,max:a.max};return this.addAccessor(i,Object.assign(o,n))}},{key:"addTexture",value:function(e){var n=e.imageIndex,i={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}},{key:"addMaterial",value:function(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}},{key:"createBinaryChunk",value:function(){var e,n;this.gltf.buffers=[];var i=this.byteLength,a=new ArrayBuffer(i),o=new Uint8Array(a),s=0,u=EK(this.sourceBuffers||[]),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;s=Hb(f,o,s)}}catch(c){u.e(c)}finally{u.f()}(e=this.json)!==null&&e!==void 0&&(n=e.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=a,this.sourceBuffers=[a]}},{key:"_removeStringFromArray",value:function(e,n){for(var i=!0;i;){var a=e.indexOf(n);a>-1?e.splice(a,1):i=!1}}},{key:"_addAttributes",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n={};for(var i in e){var a=e[i],o=this._getGltfAttributeName(i),s=this.addBinaryBuffer(a.value,a);n[o]=s}return n}},{key:"_addIndices",value:function(e){return this.addBinaryBuffer(e,{size:1})}},{key:"_getGltfAttributeName",value:function(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}},{key:"_getAccessorMinMax",value:function(e,n){var i={min:null,max:null};if(e.length<n)return i;i.min=[],i.max=[];var a=e.subarray(0,n),o=EK(a),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;i.min.push(u),i.max.push(u)}}catch(c){o.e(c)}finally{o.f()}for(var l=n;l<e.length;l+=n)for(var f=0;f<n;f++)i.min[0+f]=Math.min(i.min[0+f],e[l+f]),i.max[0+f]=Math.max(i.max[0+f],e[l+f]);return i}}]),t}();var l0=h(ge()),BK=h(Je()),Ws=h(de()),olt=(typeof WebAssembly>"u"?"undefined":(0,BK.default)(WebAssembly))!=="object",gOe="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",yOe="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",_Oe=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),bOe=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),xOe={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},AOe={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};function FK(t,r,e,n,i){return TO.apply(this,arguments)}function TO(){return TO=(0,l0.default)(Ws.default.mark(function t(r,e,n,i,a){var o,s,u=arguments;return Ws.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=u.length>5&&u[5]!==void 0?u[5]:"NONE",f.next=3,TOe();case 3:s=f.sent,wOe(s,s.exports[AOe[a]],r,e,n,i,s.exports[xOe[o||"NONE"]]);case 5:case"end":return f.stop()}},t)})),TO.apply(this,arguments)}var AO;function TOe(){return SO.apply(this,arguments)}function SO(){return SO=(0,l0.default)(Ws.default.mark(function t(){return Ws.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return AO||(AO=SOe()),e.abrupt("return",AO);case 2:case"end":return e.stop()}},t)})),SO.apply(this,arguments)}function SOe(){return PO.apply(this,arguments)}function PO(){return PO=(0,l0.default)(Ws.default.mark(function t(){var r,e;return Ws.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return r=gOe,WebAssembly.validate(_Oe)&&(r=yOe,console.log("Warning: meshopt_decoder is using experimental SIMD support")),i.next=4,WebAssembly.instantiate(POe(r),{});case 4:return e=i.sent,i.next=7,e.instance.exports.__wasm_call_ctors();case 7:return i.abrupt("return",e.instance);case 8:case"end":return i.stop()}},t)})),PO.apply(this,arguments)}function POe(t){for(var r=new Uint8Array(t.length),e=0;e<t.length;++e){var n=t.charCodeAt(e);r[e]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}for(var i=0,a=0;a<t.length;++a)r[i++]=r[a]<60?bOe[r[a]]:(r[a]-60)*64+r[++a];return r.buffer.slice(0,i)}function wOe(t,r,e,n,i,a,o){var s=t.exports.sbrk,u=n+3&-4,l=s(u*i),f=s(a.length),c=new Uint8Array(t.exports.memory.buffer);c.set(a,f);var p=r(l,n,i,f,a.length);if(p===0&&o&&o(l,u,i),e.set(c.subarray(l,l+n*i)),s(l-s(0)),p!==0)throw new Error("Malformed buffer data: ".concat(p))}function OOe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=EOe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function EOe(t,r){if(t){if(typeof t=="string")return DK(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return DK(t,r)}}function DK(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var CO="EXT_meshopt_compression",COe=CO;function MOe(t,r){return wO.apply(this,arguments)}function wO(){return wO=(0,EO.default)(Nh.default.mark(function t(r,e){var n,i,a,o,s,u;return Nh.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(i=new Ct(r),e!=null&&(n=e.gltf)!==null&&n!==void 0&&n.decompressMeshes){f.next=3;break}return f.abrupt("return");case 3:a=[],o=OOe(r.json.bufferViews||[]);try{for(o.s();!(s=o.n()).done;)u=s.value,a.push(IOe(i,u))}catch(c){o.e(c)}finally{o.f()}return f.next=8,Promise.all(a);case 8:i.removeExtension(CO);case 9:case"end":return f.stop()}},t)})),wO.apply(this,arguments)}function IOe(t,r){return OO.apply(this,arguments)}function OO(){return OO=(0,EO.default)(Nh.default.mark(function t(r,e){var n,i,a,o,s,u,l,f,c,p,d,v,m,g;return Nh.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(n=r.getObjectExtension(e,CO),!n){_.next=9;break}return i=n.byteOffset,a=i===void 0?0:i,o=n.byteLength,s=o===void 0?0:o,u=n.byteStride,l=n.count,f=n.mode,c=n.filter,p=c===void 0?"NONE":c,d=n.buffer,v=r.gltf.buffers[d],m=new Uint8Array(v.arrayBuffer,v.byteOffset+a,s),g=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength),_.next=8,FK(g,l,u,m,f,p);case 8:return _.abrupt("return",g);case 9:return _.abrupt("return",null);case 10:case"end":return _.stop()}},t)})),OO.apply(this,arguments)}var IO={};tn(IO,{name:()=>kOe,preprocess:()=>BOe});function ROe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=LOe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function LOe(t,r){if(t){if(typeof t=="string")return NK(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return NK(t,r)}}function NK(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Ql="EXT_texture_webp",kOe=Ql;function BOe(t,r){var e=new Ct(t);if(!rx("image/webp")){if(e.getRequiredExtensions().includes(Ql))throw new Error("gltf: Required extension ".concat(Ql," not supported by browser"));return}var n=e.json,i=ROe(n.textures||[]),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=e.getObjectExtension(o,Ql);s&&(o.source=s.source),e.removeObjectExtension(o,Ql)}}catch(u){i.e(u)}finally{i.f()}e.removeExtension(Ql)}var RO={};tn(RO,{name:()=>NOe,preprocess:()=>jOe});function FOe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=DOe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function DOe(t,r){if(t){if(typeof t=="string")return jK(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return jK(t,r)}}function jK(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var f0="KHR_texture_basisu",NOe=f0;function jOe(t,r){var e=new Ct(t),n=e.json,i=FOe(n.textures||[]),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=e.getObjectExtension(o,f0);s&&(o.source=s.source),e.removeObjectExtension(o,f0)}}catch(u){i.e(u)}finally{i.f()}e.removeExtension(f0)}var $O={};tn($O,{decode:()=>fEe,encode:()=>cEe,name:()=>uEe,preprocess:()=>lEe});var hJ=h(ye()),VO=h(B()),HO=h(ge()),$s=h(de());var uJ=h(ge()),lJ=h(B()),NO=h(de());var GK=h(Je());var UK="3.3.3";var UOe={draco:{decoderType:(typeof WebAssembly>"u"?"undefined":(0,GK.default)(WebAssembly))==="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},zK={name:"Draco",id:Cr?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:UK,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:UOe};var LO=h(dr()),KK=h(ye()),JK=h(B()),ZK=h(L()),QK=h(N());function HK(t,r,e){var n=WK(r.metadata),i=[],a=GOe(r.attributes);for(var o in t){var s=t[o],u=VK(o,s,a[o]);i.push(u)}if(e){var l=VK("indices",e);i.push(l)}return new Ih(i,n)}function GOe(t){var r={};for(var e in t){var n=t[e];r[n.name||"undefined"]=n}return r}function VK(t,r,e){var n=e?WK(e.metadata):void 0,i=eO(t,r,n);return i}function WK(t){var r=new Map;for(var e in t)r.set("".concat(e,".string"),JSON.stringify(t[e]));return r}function zOe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=VOe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function VOe(t,r){if(t){if(typeof t=="string")return $K(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return $K(t,r)}}function $K(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function XK(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function qK(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?XK(Object(e),!0).forEach(function(n){(0,JK.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):XK(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var YK={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},HOe={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},WOe=4,eJ=function(){function t(r){(0,ZK.default)(this,t),C(this,"draco",void 0),C(this,"decoder",void 0),C(this,"metadataQuerier",void 0),this.draco=r,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}return(0,QK.default)(t,[{key:"destroy",value:function(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}},{key:"parseSync",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);var a=this.decoder.GetEncodedGeometryType(i),o=a===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{var s;switch(a){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(i,o);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(i,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!o.ptr){var u="DRACO decompression failed: ".concat(s.error_msg());throw new Error(u)}var l=this._getDracoLoaderData(o,a,n),f=this._getMeshData(o,l,n),c=wa(f.attributes),p=HK(f.attributes,l,f.indices),d=qK(qK({loader:"draco",loaderData:l,header:{vertexCount:o.num_points(),boundingBox:c}},f),{},{schema:p});return d}finally{this.draco.destroy(i),o&&this.draco.destroy(o)}}},{key:"_getDracoLoaderData",value:function(e,n,i){var a=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,i);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:a,attributes:o}}},{key:"_getDracoAttributes",value:function(e,n){for(var i={},a=0;a<e.num_attributes();a++){var o=this.decoder.GetAttribute(e,a),s=this._getAttributeMetadata(e,a);i[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:a,metadata:s};var u=this._getQuantizationTransform(o,n);u&&(i[o.unique_id()].quantization_transform=u);var l=this._getOctahedronTransform(o,n);l&&(i[o.unique_id()].octahedron_transform=l)}return i}},{key:"_getMeshData",value:function(e,n,i){var a=this._getMeshAttributes(n,e,i),o=a.POSITION;if(!o)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:a,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:a,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:a}}},{key:"_getMeshAttributes",value:function(e,n,i){for(var a={},o=0,s=Object.values(e.attributes);o<s.length;o++){var u=s[o],l=this._deduceAttributeName(u,i);u.name=l;var f=this._getAttributeValues(n,u),c=f.value,p=f.size;a[l]={value:c,size:p,byteOffset:u.byte_offset,byteStride:u.byte_stride,normalized:u.normalized}}return a}},{key:"_getTriangleListIndices",value:function(e){var n=e.num_faces(),i=n*3,a=i*WOe,o=this.draco._malloc(a);try{return this.decoder.GetTrianglesUInt32Array(e,a,o),new Uint32Array(this.draco.HEAPF32.buffer,o,i).slice()}finally{this.draco._free(o)}}},{key:"_getTriangleStripIndices",value:function(e){var n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),qOe(n)}finally{this.draco.destroy(n)}}},{key:"_getAttributeValues",value:function(e,n){var i=HOe[n.data_type],a=n.num_components,o=e.num_points(),s=o*a,u=s*i.BYTES_PER_ELEMENT,l=$Oe(this.draco,i),f,c=this.draco._malloc(u);try{var p=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,p,l,u,c),f=new i(this.draco.HEAPF32.buffer,c,s).slice()}finally{this.draco._free(c)}return{value:f,size:a}}},{key:"_deduceAttributeName",value:function(e,n){for(var i=e.unique_id,a=0,o=Object.entries(n.extraAttributes||{});a<o.length;a++){var s=(0,KK.default)(o[a],2),u=s[0],l=s[1];if(l===i)return u}var f=e.attribute_type;for(var c in YK){var p=this.draco[c];if(p===f)return YK[c]}var d=n.attributeNameEntry||"name";return e.metadata[d]?e.metadata[d].string:"CUSTOM_ATTRIBUTE_".concat(i)}},{key:"_getTopLevelMetadata",value:function(e){var n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}},{key:"_getAttributeMetadata",value:function(e,n){var i=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(i)}},{key:"_getDracoMetadata",value:function(e){if(!e||!e.ptr)return{};for(var n={},i=this.metadataQuerier.NumEntries(e),a=0;a<i;a++){var o=this.metadataQuerier.GetEntryName(e,a);n[o]=this._getDracoMetadataField(e,o)}return n}},{key:"_getDracoMetadataField",value:function(e,n){var i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,i);var a=XOe(i);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:a}}finally{this.draco.destroy(i)}}},{key:"_disableAttributeTransforms",value:function(e){var n=e.quantizedAttributes,i=n===void 0?[]:n,a=e.octahedronAttributes,o=a===void 0?[]:a,s=[].concat((0,LO.default)(i),(0,LO.default)(o)),u=zOe(s),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;this.decoder.SkipAttributeTransform(this.draco[f])}}catch(c){u.e(c)}finally{u.f()}}},{key:"_getQuantizationTransform",value:function(e,n){var i=this,a=n.quantizedAttributes,o=a===void 0?[]:a,s=e.attribute_type(),u=o.map(function(f){return i.decoder[f]}).includes(s);if(u){var l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits(),range:l.range(),min_values:new Float32Array([1,2,3]).map(function(f){return l.min_value(f)})}}finally{this.draco.destroy(l)}}return null}},{key:"_getOctahedronTransform",value:function(e,n){var i=this,a=n.octahedronAttributes,o=a===void 0?[]:a,s=e.attribute_type(),u=o.map(function(f){return i.decoder[f]}).includes(s);if(u){var l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits()}}finally{this.draco.destroy(l)}}return null}}]),t}();function $Oe(t,r){switch(r){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function XOe(t){for(var r=t.size(),e=new Int32Array(r),n=0;n<r;n++)e[n]=t.GetValue(n);return e}function qOe(t){for(var r=t.size(),e=new Int32Array(r),n=0;n<r;n++)e[n]=t.GetValue(n);return e}var nJ=h(ye()),iJ=h(B()),FO=h(ge()),Uh=h(de());function tJ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function rJ(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?tJ(Object(e),!0).forEach(function(n){(0,iJ.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):tJ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var YOe="1.5.5",KOe="1.4.1",DO="https://www.gstatic.com/draco/versioned/decoders/".concat(YOe),JOe="".concat(DO,"/draco_decoder.js"),ZOe="".concat(DO,"/draco_wasm_wrapper.js"),QOe="".concat(DO,"/draco_decoder.wasm"),Plt="https://raw.githubusercontent.com/google/draco/".concat(KOe,"/javascript/draco_encoder.js"),jh;function aJ(t){return kO.apply(this,arguments)}function kO(){return kO=(0,FO.default)(Uh.default.mark(function t(r){var e;return Uh.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return e=r.modules||{},e.draco3d?jh=jh||e.draco3d.createDecoderModule({}).then(function(a){return{draco:a}}):jh=jh||eEe(r),i.next=4,jh;case 4:return i.abrupt("return",i.sent);case 5:case"end":return i.stop()}},t)})),kO.apply(this,arguments)}function eEe(t){return BO.apply(this,arguments)}function BO(){return BO=(0,FO.default)(Uh.default.mark(function t(r){var e,n,i,a;return Uh.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:s.t0=r.draco&&r.draco.decoderType,s.next=s.t0==="js"?3:(s.t0==="wasm",7);break;case 3:return s.next=5,gi(JOe,"draco",r);case 5:return e=s.sent,s.abrupt("break",21);case 7:return s.t1=Promise,s.next=10,gi(ZOe,"draco",r);case 10:return s.t2=s.sent,s.next=13,gi(QOe,"draco",r);case 13:return s.t3=s.sent,s.t4=[s.t2,s.t3],s.next=17,s.t1.all.call(s.t1,s.t4);case 17:i=s.sent,a=(0,nJ.default)(i,2),e=a[0],n=a[1];case 21:return e=e||globalThis.DracoDecoderModule,s.next=24,tEe(e,n);case 24:return s.abrupt("return",s.sent);case 25:case"end":return s.stop()}},t)})),BO.apply(this,arguments)}function tEe(t,r){var e={};return r&&(e.wasmBinary=r),new Promise(function(n){t(rJ(rJ({},e),{},{onModuleLoaded:function(a){return n({draco:a})}}))})}function oJ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function sJ(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?oJ(Object(e),!0).forEach(function(n){(0,lJ.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):oJ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var c0=sJ(sJ({},zK),{},{parse:rEe});function rEe(t,r){return jO.apply(this,arguments)}function jO(){return jO=(0,uJ.default)(NO.default.mark(function t(r,e){var n,i,a;return NO.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,aJ(e);case 2:return n=s.sent,i=n.draco,a=new eJ(i),s.prev=5,s.abrupt("return",a.parseSync(r,e?.draco));case 7:return s.prev=7,a.destroy(),s.finish(7);case 10:case"end":return s.stop()}},t,null,[[5,,7,10]])})),jO.apply(this,arguments)}function fJ(t){var r={};for(var e in t){var n=t[e];if(e!=="indices"){var i=UO(n);r[e]=i}}return r}function UO(t){var r=nEe(t),e=r.buffer,n=r.size,i=r.count,a={value:e,size:n,byteOffset:0,count:i,type:s0(n),componentType:u0(e)};return a}function nEe(t){var r=t,e=1,n=0;return t&&t.value&&(r=t.value,e=t.size||1),r&&(ArrayBuffer.isView(r)||(r=iEe(r,Float32Array)),n=r.length/e),{buffer:r,size:e,count:n}}function iEe(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?Array.isArray(t)?new r(t):e&&!(t instanceof r)?new r(t):t:null}function cJ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function aEe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?cJ(Object(e),!0).forEach(function(n){(0,VO.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):cJ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var oEe=$s.default.mark(WO);function Gh(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=sEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function sEe(t,r){if(t){if(typeof t=="string")return pJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return pJ(t,r)}}function pJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Xs="KHR_draco_mesh_compression",uEe=Xs;function lEe(t,r,e){var n=new Ct(t),i=Gh(WO(n)),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n.getObjectExtension(o,Xs)}}catch(s){i.e(s)}finally{i.f()}}function fEe(t,r,e){return GO.apply(this,arguments)}function GO(){return GO=(0,HO.default)($s.default.mark(function t(r,e,n){var i,a,o,s,u,l;return $s.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(e!=null&&(i=e.gltf)!==null&&i!==void 0&&i.decompressMeshes){c.next=2;break}return c.abrupt("return");case 2:a=new Ct(r),o=[],s=Gh(WO(a));try{for(s.s();!(u=s.n()).done;)l=u.value,a.getObjectExtension(l,Xs)&&o.push(pEe(a,l,e,n))}catch(p){s.e(p)}finally{s.f()}return c.next=8,Promise.all(o);case 8:a.removeExtension(Xs);case 9:case"end":return c.stop()}},t)})),GO.apply(this,arguments)}function cEe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=new Ct(t),n=Gh(e.json.meshes||[]),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;hEe(a,r),e.addRequiredExtension(Xs)}}catch(o){n.e(o)}finally{n.f()}}function pEe(t,r,e,n){return zO.apply(this,arguments)}function zO(){return zO=(0,HO.default)($s.default.mark(function t(r,e,n,i){var a,o,s,u,l,f,c,p,d,v,m,g,y,_;return $s.default.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(a=r.getObjectExtension(e,Xs),a){x.next=3;break}return x.abrupt("return");case 3:return o=r.getTypedArrayForBufferView(a.bufferView),s=Wo(o.buffer,o.byteOffset),u=i.parse,l=aEe({},n),delete l["3d-tiles"],x.next=10,u(s,c0,l,i);case 10:for(f=x.sent,c=fJ(f.attributes),p=0,d=Object.entries(c);p<d.length;p++)v=(0,hJ.default)(d[p],2),m=v[0],g=v[1],m in e.attributes&&(y=e.attributes[m],_=r.getAccessor(y),_!=null&&_.min&&_!==null&&_!==void 0&&_.max&&(g.min=_.min,g.max=_.max));e.attributes=c,f.indices&&(e.indices=UO(f.indices)),dEe(e);case 16:case"end":return x.stop()}},t)})),zO.apply(this,arguments)}function hEe(t,r){var e,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");var o=i.DracoWriter.encodeSync({attributes:t}),s=a==null||(e=a.parseSync)===null||e===void 0?void 0:e.call(a,{attributes:t}),u=i._addFauxAttributes(s.attributes),l=i.addBufferView(o),f={primitives:[{attributes:u,mode:n,extensions:(0,VO.default)({},Xs,{bufferView:l,attributes:u})}]};return f}function dEe(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function WO(t){var r,e,n,i,a,o;return $s.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:r=Gh(t.json.meshes||[]),u.prev=1,r.s();case 3:if((e=r.n()).done){u.next=24;break}n=e.value,i=Gh(n.primitives),u.prev=6,i.s();case 8:if((a=i.n()).done){u.next=14;break}return o=a.value,u.next=12,o;case 12:u.next=8;break;case 14:u.next=19;break;case 16:u.prev=16,u.t0=u.catch(6),i.e(u.t0);case 19:return u.prev=19,i.f(),u.finish(19);case 22:u.next=3;break;case 24:u.next=29;break;case 26:u.prev=26,u.t1=u.catch(1),r.e(u.t1);case 29:return u.prev=29,r.f(),u.finish(29);case 32:case"end":return u.stop()}},oEe,null,[[1,26,29,32],[6,16,19,22]])}var KO={};tn(KO,{decode:()=>_Ee,name:()=>mEe});var yJ=h(ye()),_J=h(ge()),XO=h(de());var dJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};function mJ(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=vEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function vEe(t,r){if(t){if(typeof t=="string")return gJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return gJ(t,r)}}function gJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var YO="KHR_texture_transform",mEe=YO,p0=new V,gEe=new lt,yEe=new lt;function _Ee(t,r){return qO.apply(this,arguments)}function qO(){return qO=(0,_J.default)(XO.default.mark(function t(r,e){var n,i,a,o;return XO.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(n=new Ct(r),i=n.getExtension(YO),i){u.next=4;break}return u.abrupt("return");case 4:for(a=r.json.materials||[],o=0;o<a.length;o++)bEe(o,r);case 6:case"end":return u.stop()}},t)})),qO.apply(this,arguments)}function bEe(t,r){var e,n,i,a=[],o=(e=r.json.materials)===null||e===void 0?void 0:e[t],s=o==null||(n=o.pbrMetallicRoughness)===null||n===void 0?void 0:n.baseColorTexture;s&&zh(r,t,s,a);var u=o?.emissiveTexture;u&&zh(r,t,u,a);var l=o?.normalTexture;l&&zh(r,t,l,a);var f=o?.occlusionTexture;f&&zh(r,t,f,a);var c=o==null||(i=o.pbrMetallicRoughness)===null||i===void 0?void 0:i.metallicRoughnessTexture;c&&zh(r,t,c,a)}function zh(t,r,e,n){var i=xEe(e,n);if(i){var a=t.json.meshes||[],o=mJ(a),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=mJ(u.primitives),f;try{for(l.s();!(f=l.n()).done;){var c=f.value,p=c.material;Number.isFinite(p)&&r===p&&AEe(t,c,i)}}catch(d){l.e(d)}finally{l.f()}}}catch(d){o.e(d)}finally{o.f()}}}function xEe(t,r){var e,n=(e=t.extensions)===null||e===void 0?void 0:e[YO],i=t.texCoord,a=i===void 0?0:i,o=n.texCoord,s=o===void 0?a:o,u=r.findIndex(function(f){var c=(0,yJ.default)(f,2),p=c[0],d=c[1];return p===a&&d===s})!==-1;if(!u){var l=PEe(n);return a!==s&&(t.texCoord=s),r.push([a,s]),{originalTexCoord:a,texCoord:s,matrix:l}}return null}function AEe(t,r,e){var n=e.originalTexCoord,i=e.texCoord,a=e.matrix,o=r.attributes["TEXCOORD_".concat(n)];if(Number.isFinite(o)){var s,u=(s=t.json.accessors)===null||s===void 0?void 0:s[o];if(u&&u.bufferView){var l,f=(l=t.json.bufferViews)===null||l===void 0?void 0:l[u.bufferView];if(f){for(var c=t.buffers[f.buffer],p=c.arrayBuffer,d=c.byteOffset,v=(d||0)+(u.byteOffset||0)+(f.byteOffset||0),m=Zl(u,f),g=m.ArrayType,y=m.length,_=vJ[u.componentType],b=dJ[u.type],x=f.byteStride||_*b,A=new Float32Array(y),T=0;T<u.count;T++){var O=new g(p,v+T*x,2);p0.set(O[0],O[1],1),p0.transformByMatrix3(a),A.set([p0[0],p0[1]],T*b)}n===i?TEe(u,f,t.buffers,A):SEe(i,u,r,t,A)}}}}function TEe(t,r,e,n){t.componentType=5126,e.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),r.buffer=e.length-1,r.byteLength=n.buffer.byteLength,r.byteOffset=0,delete r.byteStride}function SEe(t,r,e,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});var a=n.json.bufferViews;if(a){a.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});var o=n.json.accessors;o&&(o.push({bufferView:a?.length-1,byteOffset:0,componentType:5126,count:r.count,type:"VEC2"}),e.attributes["TEXCOORD_".concat(t)]=o.length-1)}}function PEe(t){var r=t.offset,e=r===void 0?[0,0]:r,n=t.rotation,i=n===void 0?0:n,a=t.scale,o=a===void 0?[1,1]:a,s=new lt().set(1,0,0,0,1,0,e[0],e[1],1),u=gEe.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),l=yEe.set(o[0],0,0,0,o[1],0,0,0,1);return s.multiplyRight(u).multiplyRight(l)}var eE={};tn(eE,{decode:()=>EEe,encode:()=>CEe,name:()=>OEe});var QO=h(ge()),Vh=h(de());function xJ(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=wEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function wEe(t,r){if(t){if(typeof t=="string")return bJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return bJ(t,r)}}function bJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var qs="KHR_lights_punctual",OEe=qs;function EEe(t){return JO.apply(this,arguments)}function JO(){return JO=(0,QO.default)(Vh.default.mark(function t(r){var e,n,i,a,o,s,u;return Vh.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:e=new Ct(r),n=e.json,i=e.getExtension(qs),i&&(e.json.lights=i.lights,e.removeExtension(qs)),a=xJ(n.nodes||[]);try{for(a.s();!(o=a.n()).done;)s=o.value,u=e.getObjectExtension(s,qs),u&&(s.light=u.light),e.removeObjectExtension(s,qs)}catch(c){a.e(c)}finally{a.f()}case 6:case"end":return f.stop()}},t)})),JO.apply(this,arguments)}function CEe(t){return ZO.apply(this,arguments)}function ZO(){return ZO=(0,QO.default)(Vh.default.mark(function t(r){var e,n,i,a,o,s,u;return Vh.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(e=new Ct(r),n=e.json,n.lights&&(i=e.addExtension(qs),ir(!i.lights),i.lights=n.lights,delete n.lights),e.json.lights){a=xJ(e.json.lights);try{for(a.s();!(o=a.n()).done;)s=o.value,u=s.node,e.addObjectExtension(u,qs,s)}catch(c){a.e(c)}finally{a.f()}delete e.json.lights}case 4:case"end":return f.stop()}},t)})),ZO.apply(this,arguments)}var nE={};tn(nE,{decode:()=>REe,encode:()=>LEe,name:()=>IEe});var TJ=h(ge()),tE=h(de());function SJ(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=MEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function MEe(t,r){if(t){if(typeof t=="string")return AJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return AJ(t,r)}}function AJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Hh="KHR_materials_unlit",IEe=Hh;function REe(t){return rE.apply(this,arguments)}function rE(){return rE=(0,TJ.default)(tE.default.mark(function t(r){var e,n,i,a,o,s;return tE.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:e=new Ct(r),n=e.json,i=SJ(n.materials||[]);try{for(i.s();!(a=i.n()).done;)o=a.value,s=o.extensions&&o.extensions.KHR_materials_unlit,s&&(o.unlit=!0),e.removeObjectExtension(o,Hh)}catch(f){i.e(f)}finally{i.f()}e.removeExtension(Hh);case 5:case"end":return l.stop()}},t)})),rE.apply(this,arguments)}function LEe(t){var r=new Ct(t),e=r.json;if(r.materials){var n=SJ(e.materials||[]),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.unlit&&(delete a.unlit,r.addObjectExtension(a,Hh,{}),r.addExtension(Hh))}}catch(o){n.e(o)}finally{n.f()}}}var sE={};tn(sE,{decode:()=>DEe,encode:()=>NEe,name:()=>FEe});var wJ=h(Je()),oE=h(ge()),$h=h(de());function kEe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=BEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function BEe(t,r){if(t){if(typeof t=="string")return PJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return PJ(t,r)}}function PJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Wh="KHR_techniques_webgl",FEe=Wh;function DEe(t){return iE.apply(this,arguments)}function iE(){return iE=(0,oE.default)($h.default.mark(function t(r){var e,n,i,a,o,s,u,l;return $h.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(e=new Ct(r),n=e.json,i=e.getExtension(Wh),i){a=jEe(i,e),o=kEe(n.materials||[]);try{for(o.s();!(s=o.n()).done;)u=s.value,l=e.getObjectExtension(u,Wh),l&&(u.technique=Object.assign({},l,a[l.technique]),u.technique.values=UEe(u.technique,e)),e.removeObjectExtension(u,Wh)}catch(p){o.e(p)}finally{o.f()}e.removeExtension(Wh)}case 4:case"end":return c.stop()}},t)})),iE.apply(this,arguments)}function NEe(t,r){return aE.apply(this,arguments)}function aE(){return aE=(0,oE.default)($h.default.mark(function t(r,e){return $h.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:case"end":return i.stop()}},t)})),aE.apply(this,arguments)}function jEe(t,r){var e=t.programs,n=e===void 0?[]:e,i=t.shaders,a=i===void 0?[]:i,o=t.techniques,s=o===void 0?[]:o,u=new TextDecoder;return a.forEach(function(l){if(Number.isFinite(l.bufferView))l.code=u.decode(r.getTypedArrayForBufferView(l.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(function(l){l.fragmentShader=a[l.fragmentShader],l.vertexShader=a[l.vertexShader]}),s.forEach(function(l){l.program=n[l.program]}),s}function UEe(t,r){var e=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(function(n){t.uniforms[n].value&&!(n in e)&&(e[n]=t.uniforms[n].value)}),Object.keys(e).forEach(function(n){(0,wJ.default)(e[n])==="object"&&e[n].index!==void 0&&(e[n].texture=r.getTexture(e[n].index))}),e}var fE={};tn(fE,{decode:()=>zEe,name:()=>GEe});var OJ=h(ge()),uE=h(de());var EJ="EXT_feature_metadata",GEe=EJ;function zEe(t){return lE.apply(this,arguments)}function lE(){return lE=(0,OJ.default)(uE.default.mark(function t(r){var e;return uE.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=new Ct(r),VEe(e);case 2:case"end":return i.stop()}},t)})),lE.apply(this,arguments)}function VEe(t){var r,e=t.getExtension(EJ),n=e==null||(r=e.schema)===null||r===void 0?void 0:r.classes,i=e?.featureTables,a=e?.featureTextures;if(a&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),n&&i)for(var o in n){var s=n[o],u=$Ee(i,o);u&&HEe(t,u,s)}}function HEe(t,r,e){for(var n in e.properties){var i,a=e.properties[n],o=r==null||(i=r.properties)===null||i===void 0?void 0:i[n],s=r.count;if(o){var u=WEe(t,a,s,o);o.data=u}}}function WEe(t,r,e,n){var i=n.bufferView,a=t.getTypedArrayForBufferView(i);switch(r.type){case"STRING":{var o=n.stringOffsetBufferView,s=t.getTypedArrayForBufferView(o);a=XEe(a,s,e);break}default:}return a}function $Ee(t,r){for(var e in t){var n=t[e];if(n.class===r)return n}return null}function XEe(t,r,e){for(var n=[],i=new TextDecoder("utf8"),a=0,o=4,s=0;s<e;s++){var u=r[(s+1)*o]-r[s*o],l=t.subarray(a,u+a),f=i.decode(l);n.push(f),a+=u}return n}function IJ(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=qEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function qEe(t,r){if(t){if(typeof t=="string")return CJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return CJ(t,r)}}function CJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var RJ=[MO,IO,RO,$O,eE,nE,sE,KO,fE];function LJ(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0,n=RJ.filter(function(u){return BJ(u.name,r)}),i=IJ(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s;(s=o.preprocess)===null||s===void 0||s.call(o,t,r,e)}}catch(u){i.e(u)}finally{i.f()}}function kJ(t){return pE.apply(this,arguments)}function pE(){return pE=(0,MJ.default)(cE.default.mark(function t(r){var e,n,i,a,o,s,u,l=arguments;return cE.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=l.length>1&&l[1]!==void 0?l[1]:{},n=l.length>2?l[2]:void 0,i=RJ.filter(function(p){return BJ(p.name,e)}),a=IJ(i),c.prev=4,a.s();case 6:if((o=a.n()).done){c.next=12;break}return s=o.value,c.next=10,(u=s.decode)===null||u===void 0?void 0:u.call(s,r,e,n);case 10:c.next=6;break;case 12:c.next=17;break;case 14:c.prev=14,c.t0=c.catch(4),a.e(c.t0);case 17:return c.prev=17,a.f(),c.finish(17);case 20:case"end":return c.stop()}},t,null,[[4,14,17,20]])})),pE.apply(this,arguments)}function BJ(t,r){var e,n=(r==null||(e=r.gltf)===null||e===void 0?void 0:e.excludeExtensions)||{},i=t in n&&!n[t];return!i}var UJ=h(L()),GJ=h(N());function YEe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=KEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function KEe(t,r){if(t){if(typeof t=="string")return FJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return FJ(t,r)}}function FJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var hE="KHR_binary_glTF";function DJ(t){var r=new Ct(t),e=r.json,n=YEe(e.images||[]),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=r.getObjectExtension(a,hE);o&&Object.assign(a,o),r.removeObjectExtension(a,hE)}}catch(s){n.e(s)}finally{n.f()}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,r.removeExtension(hE)}function Po(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=ZEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function ZEe(t,r){if(t){if(typeof t=="string")return NJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return NJ(t,r)}}function NJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var jJ={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},QEe={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},eCe=function(){function t(){(0,UJ.default)(this,t),C(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),C(this,"json",void 0)}return(0,GJ.default)(t,[{key:"normalize",value:function(e,n){this.json=e.json;var i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(i.asset.version));return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),DJ(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}},{key:"_addAsset",value:function(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}},{key:"_convertTopLevelObjectsToArrays",value:function(e){for(var n in jJ)this._convertTopLevelObjectToArray(e,n)}},{key:"_convertTopLevelObjectToArray",value:function(e,n){var i=e[n];if(!(!i||Array.isArray(i))){e[n]=[];for(var a in i){var o=i[a];o.id=o.id||a;var s=e[n].length;e[n].push(o),this.idToIndexMap[n][a]=s}}}},{key:"_convertObjectIdsToArrayIndices",value:function(e){for(var n in jJ)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));var i=Po(e.textures),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;this._convertTextureIds(o)}}catch(g){i.e(g)}finally{i.f()}var s=Po(e.meshes),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;this._convertMeshIds(l)}}catch(g){s.e(g)}finally{s.f()}var f=Po(e.nodes),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;this._convertNodeIds(p)}}catch(g){f.e(g)}finally{f.f()}var d=Po(e.scenes),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;this._convertSceneIds(m)}}catch(g){d.e(g)}finally{d.f()}}},{key:"_convertTextureIds",value:function(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}},{key:"_convertMeshIds",value:function(e){var n=Po(e.primitives),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.attributes,s=a.indices,u=a.material;for(var l in o)o[l]=this._convertIdToIndex(o[l],"accessor");s&&(a.indices=this._convertIdToIndex(s,"accessor")),u&&(a.material=this._convertIdToIndex(u,"material"))}}catch(f){n.e(f)}finally{n.f()}}},{key:"_convertNodeIds",value:function(e){var n=this;e.children&&(e.children=e.children.map(function(i){return n._convertIdToIndex(i,"node")})),e.meshes&&(e.meshes=e.meshes.map(function(i){return n._convertIdToIndex(i,"mesh")}))}},{key:"_convertSceneIds",value:function(e){var n=this;e.nodes&&(e.nodes=e.nodes.map(function(i){return n._convertIdToIndex(i,"node")}))}},{key:"_convertIdsToIndices",value:function(e,n){e[n]||(console.warn("gltf v1: json doesn't contain attribute ".concat(n)),e[n]=[]);var i=Po(e[n]),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;for(var s in o){var u=o[s],l=this._convertIdToIndex(u,s);o[s]=l}}}catch(f){i.e(f)}finally{i.f()}}},{key:"_convertIdToIndex",value:function(e,n){var i=QEe[n];if(i in this.idToIndexMap){var a=this.idToIndexMap[i][e];if(!Number.isFinite(a))throw new Error("gltf v1: failed to resolve ".concat(n," with id ").concat(e));return a}return e}},{key:"_updateObjects",value:function(e){var n=Po(this.json.buffers),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;delete a.type}}catch(o){n.e(o)}finally{n.f()}}},{key:"_updateMaterial",value:function(e){var n=Po(e.materials),i;try{var a=function(){var f=i.value;f.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};var c=((o=f.values)===null||o===void 0?void 0:o.tex)||((s=f.values)===null||s===void 0?void 0:s.texture2d_0)||((u=f.values)===null||u===void 0?void 0:u.diffuseTex),p=e.textures.findIndex(function(d){return d.id===c});p!==-1&&(f.pbrMetallicRoughness.baseColorTexture={index:p})};for(n.s();!(i=n.n()).done;){var o,s,u;a()}}catch(l){n.e(l)}finally{n.f()}}}]),t}();function zJ(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new eCe().normalize(t,r)}var HJ=h(Je()),WJ=h(L()),$J=h(N()),tf=h(B());var ef;function VJ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ca(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?VJ(Object(e),!0).forEach(function(n){(0,tf.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):VJ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var tCe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rCe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Mn={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},nCe={magFilter:Mn.TEXTURE_MAG_FILTER,minFilter:Mn.TEXTURE_MIN_FILTER,wrapS:Mn.TEXTURE_WRAP_S,wrapT:Mn.TEXTURE_WRAP_T},iCe=(ef={},(0,tf.default)(ef,Mn.TEXTURE_MAG_FILTER,Mn.LINEAR),(0,tf.default)(ef,Mn.TEXTURE_MIN_FILTER,Mn.NEAREST_MIPMAP_LINEAR),(0,tf.default)(ef,Mn.TEXTURE_WRAP_S,Mn.REPEAT),(0,tf.default)(ef,Mn.TEXTURE_WRAP_T,Mn.REPEAT),ef);function aCe(t){return rCe[t]}function oCe(t){return tCe[t]}var sCe=function(){function t(){(0,WJ.default)(this,t),C(this,"baseUri",""),C(this,"json",{}),C(this,"buffers",[]),C(this,"images",[])}return(0,$J.default)(t,[{key:"postProcess",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=e.json,a=e.buffers,o=a===void 0?[]:a,s=e.images,u=s===void 0?[]:s,l=e.baseUri,f=l===void 0?"":l;return ir(i),this.baseUri=f,this.json=i,this.buffers=o,this.images=u,this._resolveTree(this.json,n),this.json}},{key:"_resolveTree",value:function(e){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.bufferViews&&(e.bufferViews=e.bufferViews.map(function(a,o){return n._resolveBufferView(a,o)})),e.images&&(e.images=e.images.map(function(a,o){return n._resolveImage(a,o)})),e.samplers&&(e.samplers=e.samplers.map(function(a,o){return n._resolveSampler(a,o)})),e.textures&&(e.textures=e.textures.map(function(a,o){return n._resolveTexture(a,o)})),e.accessors&&(e.accessors=e.accessors.map(function(a,o){return n._resolveAccessor(a,o)})),e.materials&&(e.materials=e.materials.map(function(a,o){return n._resolveMaterial(a,o)})),e.meshes&&(e.meshes=e.meshes.map(function(a,o){return n._resolveMesh(a,o)})),e.nodes&&(e.nodes=e.nodes.map(function(a,o){return n._resolveNode(a,o)})),e.skins&&(e.skins=e.skins.map(function(a,o){return n._resolveSkin(a,o)})),e.scenes&&(e.scenes=e.scenes.map(function(a,o){return n._resolveScene(a,o)})),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}},{key:"getScene",value:function(e){return this._get("scenes",e)}},{key:"getNode",value:function(e){return this._get("nodes",e)}},{key:"getSkin",value:function(e){return this._get("skins",e)}},{key:"getMesh",value:function(e){return this._get("meshes",e)}},{key:"getMaterial",value:function(e){return this._get("materials",e)}},{key:"getAccessor",value:function(e){return this._get("accessors",e)}},{key:"getCamera",value:function(e){return null}},{key:"getTexture",value:function(e){return this._get("textures",e)}},{key:"getSampler",value:function(e){return this._get("samplers",e)}},{key:"getImage",value:function(e){return this._get("images",e)}},{key:"getBufferView",value:function(e){return this._get("bufferViews",e)}},{key:"getBuffer",value:function(e){return this._get("buffers",e)}},{key:"_get",value:function(e,n){if((0,HJ.default)(n)==="object")return n;var i=this.json[e]&&this.json[e][n];return i||console.warn("glTF file error: Could not find ".concat(e,"[").concat(n,"]")),i}},{key:"_resolveScene",value:function(e,n){var i=this;return e.id=e.id||"scene-".concat(n),e.nodes=(e.nodes||[]).map(function(a){return i.getNode(a)}),e}},{key:"_resolveNode",value:function(e,n){var i=this;return e.id=e.id||"node-".concat(n),e.children&&(e.children=e.children.map(function(a){return i.getNode(a)})),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce(function(a,o){var s=i.getMesh(o);return a.id=s.id,a.primitives=a.primitives.concat(s.primitives),a},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}},{key:"_resolveSkin",value:function(e,n){return e.id=e.id||"skin-".concat(n),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}},{key:"_resolveMesh",value:function(e,n){var i=this;return e.id=e.id||"mesh-".concat(n),e.primitives&&(e.primitives=e.primitives.map(function(a){a=Ca({},a);var o=a.attributes;a.attributes={};for(var s in o)a.attributes[s]=i.getAccessor(o[s]);return a.indices!==void 0&&(a.indices=i.getAccessor(a.indices)),a.material!==void 0&&(a.material=i.getMaterial(a.material)),a})),e}},{key:"_resolveMaterial",value:function(e,n){if(e.id=e.id||"material-".concat(n),e.normalTexture&&(e.normalTexture=Ca({},e.normalTexture),e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture=Ca({},e.occlustionTexture),e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture=Ca({},e.emmisiveTexture),e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness=Ca({},e.pbrMetallicRoughness);var i=e.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture=Ca({},i.baseColorTexture),i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture=Ca({},i.metallicRoughnessTexture),i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return e}},{key:"_resolveAccessor",value:function(e,n){if(e.id=e.id||"accessor-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=aCe(e.componentType),e.components=oCe(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){var i=e.bufferView.buffer,a=Zl(e,e.bufferView),o=a.ArrayType,s=a.byteLength,u=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+i.byteOffset,l=i.arrayBuffer.slice(u,u+s);e.bufferView.byteStride&&(l=this._getValueFromInterleavedBuffer(i,u,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new o(l)}return e}},{key:"_getValueFromInterleavedBuffer",value:function(e,n,i,a,o){for(var s=new Uint8Array(o*a),u=0;u<o;u++){var l=n+u*i;s.set(new Uint8Array(e.arrayBuffer.slice(l,l+a)),u*a)}return s.buffer}},{key:"_resolveTexture",value:function(e,n){return e.id=e.id||"texture-".concat(n),e.sampler="sampler"in e?this.getSampler(e.sampler):iCe,e.source=this.getImage(e.source),e}},{key:"_resolveSampler",value:function(e,n){e.id=e.id||"sampler-".concat(n),e.parameters={};for(var i in e){var a=this._enumSamplerParameter(i);a!==void 0&&(e.parameters[a]=e[i])}return e}},{key:"_enumSamplerParameter",value:function(e){return nCe[e]}},{key:"_resolveImage",value:function(e,n){e.id=e.id||"image-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));var i=this.images[n];return i&&(e.image=i),e}},{key:"_resolveBufferView",value:function(e,n){var i=e.buffer,a=Ca(Ca({id:"bufferView-".concat(n)},e),{},{buffer:this.buffers[i]}),o=this.buffers[i].arrayBuffer,s=this.buffers[i].byteOffset||0;return"byteOffset"in e&&(s+=e.byteOffset),a.data=new Uint8Array(o,s,e.byteLength),a}},{key:"_resolveCamera",value:function(e,n){return e.id=e.id||"camera-".concat(n),e.perspective,e.orthographic,e}}]),t}();function XJ(t,r){return new sCe().postProcess(t,r)}var qJ=1735152710,mE=12,h0=8,uCe=1313821514,lCe=5130562,fCe=0,cCe=1,pCe=0,rf=!0;function hCe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(t.getUint8(r+0))).concat(String.fromCharCode(t.getUint8(r+1))).concat(String.fromCharCode(t.getUint8(r+2))).concat(String.fromCharCode(t.getUint8(r+3)))}function YJ(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=new DataView(t),i=e.magic,a=i===void 0?qJ:i,o=n.getUint32(r,!1);return o===a||o===qJ}function gE(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},i=new DataView(r),a=hCe(i,e+0),o=i.getUint32(e+4,rf),s=i.getUint32(e+8,rf);switch(Object.assign(t,{header:{byteOffset:e,byteLength:s,hasBinChunk:!1},type:a,version:o,json:{},binChunks:[]}),e+=mE,t.version){case 1:return dCe(t,i,e);case 2:return vCe(t,i,e,n={});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function dCe(t,r,e){Fe(t.header.byteLength>mE+h0);var n=r.getUint32(e+0,rf),i=r.getUint32(e+4,rf);return e+=h0,Fe(i===pCe),dE(t,r,e,n),e+=n,e+=vE(t,r,e,t.header.byteLength),e}function vCe(t,r,e,n){return Fe(t.header.byteLength>mE+h0),mCe(t,r,e,n),e+t.header.byteLength}function mCe(t,r,e,n){for(;e+8<=t.header.byteLength;){var i=r.getUint32(e+0,rf),a=r.getUint32(e+4,rf);switch(e+=h0,a){case uCe:dE(t,r,e,i);break;case lCe:vE(t,r,e,i);break;case fCe:n.strict||dE(t,r,e,i);break;case cCe:n.strict||vE(t,r,e,i);break;default:break}e+=Va(i,4)}return e}function dE(t,r,e,n){var i=new Uint8Array(r.buffer,e,n),a=new TextDecoder("utf8"),o=a.decode(i);return t.json=JSON.parse(o),Va(n,4)}function vE(t,r,e,n){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:e,byteLength:n,arrayBuffer:r.buffer}),Va(n,4)}function JJ(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=gCe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function gCe(t,r){if(t){if(typeof t=="string")return KJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return KJ(t,r)}}function KJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function ZJ(t,r){return yE.apply(this,arguments)}function yE(){return yE=(0,Xh.default)(Ma.default.mark(function t(r,e){var n,i,a,o,s,u,l,f,c,p,d=arguments;return Ma.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(s=d.length>2&&d[2]!==void 0?d[2]:0,u=d.length>3?d[3]:void 0,l=d.length>4?d[4]:void 0,yCe(r,e,s,u),zJ(r,{normalize:u==null||(n=u.gltf)===null||n===void 0?void 0:n.normalize}),LJ(r,u,l),f=[],!(u!=null&&(i=u.gltf)!==null&&i!==void 0&&i.loadBuffers&&r.json.buffers)){m.next=10;break}return m.next=10,_Ce(r,u,l);case 10:return u!=null&&(a=u.gltf)!==null&&a!==void 0&&a.loadImages&&(c=bCe(r,u,l),f.push(c)),p=kJ(r,u,l),f.push(p),m.next=15,Promise.all(f);case 15:return m.abrupt("return",u!=null&&(o=u.gltf)!==null&&o!==void 0&&o.postProcess?XJ(r,u):r);case 16:case"end":return m.stop()}},t)})),yE.apply(this,arguments)}function yCe(t,r,e,n){if(n.uri&&(t.baseUri=n.uri),r instanceof ArrayBuffer&&!YJ(r,e,n)){var i=new TextDecoder;r=i.decode(r)}if(typeof r=="string")t.json=Gb(r);else if(r instanceof ArrayBuffer){var a={};e=gE(a,r,e,n.glb),ir(a.type==="glTF","Invalid GLB magic string ".concat(a.type)),t._glb=a,t.json=a.json}else ir(!1,"GLTF: must be ArrayBuffer or string");var o=t.json.buffers||[];if(t.buffers=new Array(o.length).fill(null),t._glb&&t._glb.header.hasBinChunk){var s=t._glb.binChunks;t.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}var u=t.json.images||[];t.images=new Array(u.length).fill({})}function _Ce(t,r,e){return _E.apply(this,arguments)}function _E(){return _E=(0,Xh.default)(Ma.default.mark(function t(r,e,n){var i,a,o,s,u,l,f,c,p;return Ma.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:i=r.json.buffers||[],a=0;case 2:if(!(a<i.length)){v.next=22;break}if(o=i[a],!o.uri){v.next=18;break}return l=n.fetch,ir(l),f=xO(o.uri,e),v.next=10,n==null||(s=n.fetch)===null||s===void 0?void 0:s.call(n,f);case 10:return c=v.sent,v.next=13,c==null||(u=c.arrayBuffer)===null||u===void 0?void 0:u.call(c);case 13:p=v.sent,r.buffers[a]={arrayBuffer:p,byteOffset:0,byteLength:p.byteLength},delete o.uri,v.next=19;break;case 18:r.buffers[a]===null&&(r.buffers[a]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength});case 19:++a,v.next=2;break;case 22:case"end":return v.stop()}},t)})),_E.apply(this,arguments)}function bCe(t,r,e){return bE.apply(this,arguments)}function bE(){return bE=(0,Xh.default)(Ma.default.mark(function t(r,e,n){var i,a,o,s,u,l;return Ma.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i=xCe(r),a=r.json.images||[],o=[],s=JJ(i);try{for(s.s();!(u=s.n()).done;)l=u.value,o.push(ACe(r,a[l],l,e,n))}catch(p){s.e(p)}finally{s.f()}return c.next=7,Promise.all(o);case 7:return c.abrupt("return",c.sent);case 8:case"end":return c.stop()}},t)})),bE.apply(this,arguments)}function xCe(t){var r=new Set,e=t.json.textures||[],n=JJ(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.source!==void 0&&r.add(a.source)}}catch(o){n.e(o)}finally{n.f()}return Array.from(r).sort()}function ACe(t,r,e,n,i){return xE.apply(this,arguments)}function xE(){return xE=(0,Xh.default)(Ma.default.mark(function t(r,e,n,i,a){var o,s,u,l,f,c,p;return Ma.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(o=a.fetch,s=a.parse,!(e.uri&&!e.hasOwnProperty("bufferView"))){v.next=10;break}return l=xO(e.uri,i),v.next=5,o(l);case 5:return f=v.sent,v.next=8,f.arrayBuffer();case 8:u=v.sent,e.bufferView={data:u};case 10:return Number.isFinite(e.bufferView)&&(c=wK(r.json,r.buffers,e.bufferView),u=Wo(c.buffer,c.byteOffset,c.byteLength)),ir(u,"glTF image has no data"),v.next=14,s(u,[Vn,bO],{mimeType:e.mimeType,basis:i.basis||{format:o0()}},a);case 14:p=v.sent,p&&p[0]&&(p={compressed:!0,mipmaps:!1,width:p[0].width,height:p[0].height,data:p[0]}),r.images=r.images||[],r.images[n]=p;case 18:case"end":return v.stop()}},t)})),xE.apply(this,arguments)}function QJ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function d0(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?QJ(Object(e),!0).forEach(function(n){(0,eZ.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):QJ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Ia={name:"glTF",id:"gltf",module:"gltf",version:nK,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:TCe,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};function TCe(t){return TE.apply(this,arguments)}function TE(){return TE=(0,tZ.default)(AE.default.mark(function t(r){var e,n,i,a,o,s,u=arguments;return AE.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return e=u.length>1&&u[1]!==void 0?u[1]:{},n=u.length>2?u[2]:void 0,e=d0(d0({},Ia.options),e),e.gltf=d0(d0({},Ia.options.gltf),e.gltf),i=e,a=i.byteOffset,o=a===void 0?0:a,s={},f.next=8,ZJ(s,r,o,e,n);case 8:return f.abrupt("return",f.sent);case 9:case"end":return f.stop()}},t)})),TE.apply(this,arguments)}var wE=h(ge()),qh=h(de());function rZ(t){return SE.apply(this,arguments)}function SE(){return SE=(0,wE.default)(qh.default.mark(function t(r){var e;return qh.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return e=[],r.scenes.forEach(function(a){a.traverse(function(o){Object.values(o.model.getUniforms()).forEach(function(s){s.loaded===!1&&e.push(s)})})}),i.next=4,SCe(function(){return e.some(function(a){return!a.loaded})});case 4:return i.abrupt("return",i.sent);case 5:case"end":return i.stop()}},t)})),SE.apply(this,arguments)}function SCe(t){return PE.apply(this,arguments)}function PE(){return PE=(0,wE.default)(qh.default.mark(function t(r){return qh.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!r()){n.next=5;break}return n.next=3,new Promise(function(i){return requestAnimationFrame(i)});case 3:n.next=0;break;case 5:case"end":return n.stop()}},t)})),PE.apply(this,arguments)}var nZ=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var iZ=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`;function aZ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function oZ(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?aZ(Object(e),!0).forEach(function(n){(0,Kh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):aZ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function PCe(t){var r=wCe();return function(){var n=(0,Yh.default)(t),i;if(r){var a=(0,Yh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cZ.default)(this,i)}}function wCe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hZ=[255,255,255,255],OCe={scenegraph:{type:"object",value:null,async:!0},getScene:function(r){return r&&r.scenes?(0,pZ.default)(r.scene)==="object"?r.scene:r.scenes[r.scene||0]:r},getAnimator:function(r){return r&&r.animator},_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:function(r){return r.position}},getColor:{type:"accessor",value:hZ},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Ia]},nf=function(t){(0,fZ.default)(e,t);var r=PCe(e);function e(){var n;(0,sZ.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Kh.default)((0,lZ.default)(n),"state",void 0),n}return(0,uZ.default)(e,[{key:"getShaders",value:function(){var i=[Ze,it];return this.props._lighting==="pbr"&&i.push(eo),{vs:nZ,fs:iZ,modules:i}}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:hZ,transition:!0},instanceModelMatrix:Uy})}},{key:"updateState",value:function(i){(0,OE.default)((0,Yh.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.oldProps;a.scenegraph!==o.scenegraph?this._updateScenegraph():a._animations!==o._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,a._animations)}},{key:"finalizeState",value:function(i){(0,OE.default)((0,Yh.default)(e.prototype),"finalizeState",this).call(this,i),this._deleteScenegraph()}},{key:"_updateScenegraph",value:function(){var i=this,a=this.props,o=this.context.gl,s=null;if(a.scenegraph instanceof Gi)s={scenes:[a.scenegraph]};else if(a.scenegraph&&!a.scenegraph.gltf){var u=a.scenegraph,l=i0(o,u,this._getModelOptions());s=oZ({gltf:u},l),rZ(l).then(function(){return i.setNeedsRedraw()})}else a.scenegraph&&(Z.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),s=a.scenegraph);var f={layer:this,gl:o},c=a.getScene(s,f),p=a.getAnimator(s,f);c instanceof Gi?(this._deleteScenegraph(),this._applyAllAttributes(c),this._applyAnimationsProp(c,p,a._animations),this.setState({scenegraph:c,animator:p})):c!==null&&Z.warn("invalid scenegraph:",c)()}},{key:"_applyAllAttributes",value:function(i){var a=this;if(this.state.attributesAvailable){var o=this.getAttributeManager().getAttributes();i.traverse(function(s){a._setModelAttributes(s.model,o)})}}},{key:"_applyAnimationsProp",value:function(i,a,o){if(!(!i||!a||!o)){var s=a.getAnimations();Object.keys(o).sort().forEach(function(u){var l=o[u];if(u==="*")s.forEach(function(p){Object.assign(p,l)});else if(Number.isFinite(Number(u))){var f=Number(u);f>=0&&f<s.length?Object.assign(s[f],l):Z.warn("animation ".concat(u," not found"))()}else{var c=s.find(function(p){var d=p.name;return d===u});c?Object.assign(c,l):Z.warn("animation ".concat(u," not found"))()}})}}},{key:"_deleteScenegraph",value:function(){var i=this.state.scenegraph;i instanceof Gi&&i.delete()}},{key:"_getModelOptions",value:function(){var i=this.props._imageBasedLightingEnvironment,a=null;return i&&(typeof i=="function"?a=i({gl:this.context.gl,layer:this}):a=i),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:a,modelOptions:oZ({isInstanced:!0,transpileToGLSL100:!fe(this.context.gl)},this.getShaders()),useTangents:!1}}},{key:"updateAttributes",value:function(i){var a=this;this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(function(o){a._setModelAttributes(o.model,i)})}},{key:"draw",value:function(i){var a=i.moduleParameters,o=a===void 0?null:a,s=i.parameters,u=s===void 0?{}:s,l=i.context;if(this.state.scenegraph){this.props._animations&&this.state.animator&&(this.state.animator.animate(l.timeline.getTime()),this.setNeedsRedraw());var f=this.context.viewport,c=this.props,p=c.sizeScale,d=c.sizeMinPixels,v=c.sizeMaxPixels,m=c.opacity,g=c.coordinateSystem,y=this.getNumInstances();this.state.scenegraph.traverse(function(_,b){var x=b.worldMatrix;_.model.setInstanceCount(y),_.updateModuleSettings(o),_.draw({parameters:u,uniforms:{sizeScale:p,opacity:m,sizeMinPixels:d,sizeMaxPixels:v,composeModelMatrix:Gy(f,g),sceneModelMatrix:x,u_Camera:_.model.getUniforms().project_uCameraPosition}})})}}}]),e}(Ve);(0,Kh.default)(nf,"defaultProps",OCe);(0,Kh.default)(nf,"layerName","ScenegraphLayer");var gZ=h(L()),yZ=h(N()),af=h(Oe()),_Z=h(Y()),bZ=h(K()),Oo=h(q()),v0=h(B());var dZ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var vZ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {

#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function mZ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function wo(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?mZ(Object(e),!0).forEach(function(n){(0,v0.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):mZ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function ECe(t){var r=CCe();return function(){var n=(0,Oo.default)(t),i;if(r){var a=(0,Oo.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,bZ.default)(this,i)}}function CCe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function MCe(t){var r=t.COLOR_0||t.colors;r||(t.colors={constant:!0,value:new Float32Array([1,1,1])})}var ICe={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}},m0=function(t){(0,_Z.default)(e,t);var r=ECe(e);function e(){return(0,gZ.default)(this,e),r.apply(this,arguments)}return(0,yZ.default)(e,[{key:"getShaders",value:function(){var i=(0,af.default)((0,Oo.default)(e.prototype),"getShaders",this).call(this),a=i.modules;return a.push(eo),wo(wo({},i),{},{vs:dZ,fs:vZ})}},{key:"initializeState",value:function(){var i=this.props.featureIds;(0,af.default)((0,Oo.default)(e.prototype),"initializeState",this).call(this);var a=this.getAttributeManager();i&&a.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}},{key:"updateState",value:function(i){(0,af.default)((0,Oo.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.oldProps;a.pbrMaterial!==o.pbrMaterial&&this.updatePbrMaterialUniforms(a.pbrMaterial)}},{key:"draw",value:function(i){var a=this.props.featureIds;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:Boolean(a)}),(0,af.default)((0,Oo.default)(e.prototype),"draw",this).call(this,i))}},{key:"getModel",value:function(i){var a=this.props,o=a.id,s=a.pbrMaterial,u=this.parseMaterial(s,i);this.setState({materialParser:u});var l=this.getShaders();MCe(i.attributes);var f=new Ee(this.context.gl,wo(wo({},this.getShaders()),{},{id:o,geometry:i,defines:wo(wo(wo({},l.defines),u?.defines),{},{HAS_UV_REGIONS:i.attributes.uvRegions}),parameters:u?.parameters,isInstanced:!0}));return f}},{key:"updatePbrMaterialUniforms",value:function(i){var a=this.state.model;if(a){var o=this.props.mesh,s=this.parseMaterial(i,o);this.setState({materialParser:s}),a.setUniforms(s.uniforms)}}},{key:"parseMaterial",value:function(i,a){var o,s=Boolean(i.pbrMetallicRoughness&&i.pbrMetallicRoughness.baseColorTexture);return(o=this.state.materialParser)===null||o===void 0||o.delete(),new Fh(this.context.gl,{attributes:{NORMAL:a.attributes.normals,TEXCOORD_0:a.attributes.texCoords},material:wo({unlit:s},i),pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}},{key:"calculateFeatureIdsPickingColors",value:function(i){for(var a=this.props.featureIds,o=new Uint8ClampedArray(a.length*i.size),s=[],u=0;u<a.length;u++)this.encodePickingColor(a[u],s),o[u*3]=s[0],o[u*3+1]=s[1],o[u*3+2]=s[2];i.value=o}},{key:"finalizeState",value:function(i){var a;(0,af.default)((0,Oo.default)(e.prototype),"finalizeState",this).call(this,i),(a=this.state.materialParser)===null||a===void 0||a.delete(),this.setState({materialParser:null})}}]),e}(Oa);(0,v0.default)(m0,"layerName","MeshLayer");(0,v0.default)(m0,"defaultProps",ICe);var rC=h(ye()),M0=h(ge()),$Q=h(B()),XQ=h(L()),qQ=h(N()),Js=h(de());function EE(t){if(Array.isArray(t))return t}function CE(t,r){var e=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(e!=null){var n=[],i=!0,a=!1,o,s;try{for(e=e.call(t);!(i=(o=e.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(u){a=!0,s=u}finally{try{!i&&e.return!=null&&e.return()}finally{if(a)throw s}}return n}}function g0(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function ME(t,r){if(t){if(typeof t=="string")return g0(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return g0(t,r)}}function IE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RE(t,r){return EE(t)||CE(t,r)||ME(t,r)||IE()}function LE(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function xZ(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function kE(t,r,e){return r&&xZ(t.prototype,r),e&&xZ(t,e),t}function In(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var Ra=6378137,La=6378137,ka=6356752314245179e-9,RCe={radii:[Ra,La,ka],radiiSquared:[Ra*Ra,La*La,ka*ka],oneOverRadii:[1/Ra,1/La,1/ka],oneOverRadiiSquared:[1/(Ra*Ra),1/(La*La),1/(ka*ka)],maximumRadius:Math.max(Ra,La,ka),centerToleranceSquared:.1};function y0(t){return t}var oct=new V;function LCe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:y0;return"longitude"in t?(r[0]=e(t.longitude),r[1]=e(t.latitude),r[2]=t.height):"x"in t?(r[0]=e(t.x),r[1]=e(t.y),r[2]=t.z):(r[0]=e(t[0]),r[1]=e(t[1]),r[2]=t[2]),r}function AZ(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return LCe(t,r,ut._cartographicRadians?y0:hA)}function kCe(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:y0;return"longitude"in r?(r.longitude=e(t[0]),r.latitude=e(t[1]),r.height=t[2]):"x"in r?(r.x=e(t[0]),r.y=e(t[1]),r.z=t[2]):(r[0]=e(t[0]),r[1]=e(t[1]),r[2]=t[2]),r}function TZ(t,r){return kCe(t,r,ut._cartographicRadians?y0:dA)}var of=new V,BCe=new V,FCe=new V;function BE(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=r.oneOverRadii,i=r.oneOverRadiiSquared,a=r.centerToleranceSquared;of.from(t);var o=of.x,s=of.y,u=of.z,l=n.x,f=n.y,c=n.z,p=o*o*l*l,d=s*s*f*f,v=u*u*c*c,m=p+d+v,g=Math.sqrt(1/m);if(Number.isFinite(g)){var y=BCe;if(y.copy(t).scale(g),m<a)return y.to(e);var _=i.x,b=i.y,x=i.z,A=FCe;A.set(y.x*_*2,y.y*b*2,y.z*x*2);var T=(1-g)*of.len()/(.5*A.len()),O=0,w,E,S,I;do{T-=O,w=1/(1+T*_),E=1/(1+T*b),S=1/(1+T*x);var R=w*w,z=E*E,G=S*S,k=R*w,U=z*E,j=G*S;I=p*R+d*z+v*G-1;var X=p*k*_+d*U*b+v*j*x,H=-2*X;O=I/H}while(Math.abs(I)>Si.EPSILON12);return of.scale([w,E,S]).to(e)}}var SZ=1e-14,DCe=new V,PZ={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},FE={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ba={east:new V,north:new V,up:new V,west:new V,south:new V,down:new V},NCe=new V,jCe=new V,UCe=new V;function _0(t,r,e,n,i,a){var o=PZ[r]&&PZ[r][e];qe(o&&(!n||n===o));var s,u,l,f=DCe.copy(i),c=tt(f.x,0,SZ)&&tt(f.y,0,SZ);if(c){var p=Math.sign(f.z);s=NCe.fromArray(FE[r]),r!=="east"&&r!=="west"&&s.scale(p),u=jCe.fromArray(FE[e]),e!=="east"&&e!=="west"&&u.scale(p),l=UCe.fromArray(FE[n]),n!=="east"&&n!=="west"&&l.scale(p)}else{var d=Ba.up,v=Ba.east,m=Ba.north;v.set(-f.y,f.x,0).normalize(),t.geodeticSurfaceNormal(f,d),m.copy(d).cross(v);var g=Ba.down,y=Ba.west,_=Ba.south;g.copy(d).scale(-1),y.copy(v).scale(-1),_.copy(m).scale(-1),s=Ba[r],u=Ba[e],l=Ba[n]}return a[0]=s.x,a[1]=s.y,a[2]=s.z,a[3]=0,a[4]=u.x,a[5]=u.y,a[6]=u.z,a[7]=0,a[8]=l.x,a[9]=l.y,a[10]=l.z,a[11]=0,a[12]=f.x,a[13]=f.y,a[14]=f.z,a[15]=1,a}var b0=new V,wZ=new V,GCe=new V,si=new V,zCe=new V,x0=new V;var st=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;LE(this,t),In(this,"radii",void 0),In(this,"radiiSquared",void 0),In(this,"radiiToTheFourth",void 0),In(this,"oneOverRadii",void 0),In(this,"oneOverRadiiSquared",void 0),In(this,"minimumRadius",void 0),In(this,"maximumRadius",void 0),In(this,"centerToleranceSquared",Si.EPSILON1),In(this,"squaredXOverSquaredZ",void 0),qe(r>=0),qe(e>=0),qe(n>=0),this.radii=new V(r,e,n),this.radiiSquared=new V(r*r,e*e,n*n),this.radiiToTheFourth=new V(r*r*r*r,e*e*e*e,n*n*n*n),this.oneOverRadii=new V(r===0?0:1/r,e===0?0:1/e,n===0?0:1/n),this.oneOverRadiiSquared=new V(r===0?0:1/(r*r),e===0?0:1/(e*e),n===0?0:1/(n*n)),this.minimumRadius=Math.min(r,e,n),this.maximumRadius=Math.max(r,e,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return kE(t,[{key:"equals",value:function(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],i=wZ,a=GCe,o=RE(e,3),s=o[2];this.geodeticSurfaceNormalCartographic(e,i),a.copy(this.radiiSquared).scale(i);var u=Math.sqrt(i.dot(a));return a.scale(1/u),i.scale(s),a.add(i),a.to(n)}},{key:"cartesianToCartographic",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];x0.from(e);var i=this.scaleToGeodeticSurface(x0,si);if(i){var a=this.geodeticSurfaceNormal(i,wZ),o=zCe;o.copy(x0).subtract(i);var s=Math.atan2(a.y,a.x),u=Math.asin(a.z),l=Math.sign($c(o,x0))*Wc(o);return TZ([s,u,l],n)}}},{key:"eastNorthUpToFixedFrame",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new ce;return _0(this,"east","north","up",e,n)}},{key:"localFrameToFixedFrame",value:function(e,n,i,a){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new ce;return _0(this,e,n,i,a,o)}},{key:"geocentricSurfaceNormal",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return b0.from(e).normalize().to(n)}},{key:"geodeticSurfaceNormalCartographic",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],i=AZ(e),a=i[0],o=i[1],s=Math.cos(o);return b0.set(s*Math.cos(a),s*Math.sin(a),Math.sin(o)).normalize(),b0.to(n)}},{key:"geodeticSurfaceNormal",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return b0.from(e).scale(this.oneOverRadiiSquared).normalize().to(n)}},{key:"scaleToGeodeticSurface",value:function(e,n){return BE(e,this,n)}},{key:"scaleToGeocentricSurface",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];si.from(e);var i=si.x,a=si.y,o=si.z,s=this.oneOverRadiiSquared,u=1/Math.sqrt(i*i*s.x+a*a*s.y+o*o*s.z);return si.multiplyScalar(u).to(n)}},{key:"transformPositionToScaledSpace",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return si.from(e).scale(this.oneOverRadii).to(n)}},{key:"transformPositionFromScaledSpace",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return si.from(e).scale(this.radii).to(n)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];qe(tt(this.radii.x,this.radii.y,Si.EPSILON15)),qe(this.radii.z>0),si.from(e);var a=si.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(a)>=this.radii.z-n))return si.set(0,0,a).to(i)}}]),t}();In(st,"WGS84",new st(Ra,La,ka));var RZ=h(L()),LZ=h(N());var CZ=h(L()),MZ=h(N());var OZ=h(L());var EZ=function t(r,e,n){(0,OZ.default)(this,t),C(this,"item",void 0),C(this,"previous",void 0),C(this,"next",void 0),this.item=r,this.previous=e,this.next=n};var IZ=function(){function t(){(0,CZ.default)(this,t),C(this,"head",null),C(this,"tail",null),C(this,"_length",0)}return(0,MZ.default)(t,[{key:"length",get:function(){return this._length}},{key:"add",value:function(e){var n=new EZ(e,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}},{key:"remove",value:function(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}},{key:"splice",value:function(e,n){e!==n&&(this.remove(n),this._insert(e,n))}},{key:"_insert",value:function(e,n){var i=e.next;e.next=n,this.tail===e?this.tail=n:i.previous=n,n.next=i,n.previous=e,++this._length}}]),t}();function DE(t){return t!=null}var kZ=function(){function t(){(0,RZ.default)(this,t),C(this,"_list",void 0),C(this,"_sentinel",void 0),C(this,"_trimTiles",void 0),this._list=new IZ,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}return(0,LZ.default)(t,[{key:"reset",value:function(){this._list.splice(this._list.tail,this._sentinel)}},{key:"touch",value:function(e){var n=e._cacheNode;DE(n)&&this._list.splice(this._sentinel,n)}},{key:"add",value:function(e,n,i){DE(n._cacheNode)||(n._cacheNode=this._list.add(n),i&&i(e,n))}},{key:"unloadTile",value:function(e,n,i){var a=n._cacheNode;DE(a)&&(this._list.remove(a),n._cacheNode=void 0,i&&i(e,n))}},{key:"unloadTiles",value:function(e,n){var i=this._trimTiles;this._trimTiles=!1;for(var a=this._list,o=e.maximumMemoryUsage*1024*1024,s=this._sentinel,u=a.head;u!==s&&(e.gpuMemoryUsageInBytes>o||i);){var l=u.item;u=u.next,this.unloadTile(e,l,n)}}},{key:"trim",value:function(){this._trimTiles=!0}}]),t}();function BZ(t,r){Fe(t),Fe(r);var e=r.rtcCenter,n=r.gltfUpAxis,i=t.computedTransform,a=t.boundingVolume.center,o=new ce(i);switch(e&&o.translate(e),n){case"Z":break;case"Y":var s=new ce().rotateX(Math.PI/2);o=o.multiplyRight(s);break;case"X":var u=new ce().rotateY(-Math.PI/2);o=o.multiplyRight(u);break;default:break}r.isQuantized&&o.translate(r.quantizedVolumeOffset).scale(r.quantizedVolumeScale);var l=new V(a);r.cartesianModelMatrix=o,r.cartesianOrigin=l;var f=st.WGS84.cartesianToCartographic(l,new V),c=st.WGS84.eastNorthUpToFixedFrame(l),p=c.invert();r.cartographicModelMatrix=p.multiplyRight(o),r.cartographicOrigin=f,r.coordinateSystem||(r.modelMatrix=r.cartographicModelMatrix)}var jE=h(ye());function VCe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=HCe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function HCe(t,r){if(t){if(typeof t=="string")return FZ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return FZ(t,r)}}function FZ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var DZ=new V,NE=new V,UE=new Kr([new $t,new $t,new $t,new $t,new $t,new $t]);function jZ(t,r){var e=t.cameraDirection,n=t.cameraUp,i=t.height,a=t.distanceScales.metersPerUnit,o=A0(t,t.center),s=st.WGS84.eastNorthUpToFixedFrame(o),u=t.unprojectPosition(t.cameraPosition),l=st.WGS84.cartographicToCartesian(u,new V),f=new V(s.transformAsVector(new V(e).scale(a))).normalize(),c=new V(s.transformAsVector(new V(n).scale(a))).normalize();WCe(t);var p=t.constructor,d=t.longitude,v=t.latitude,m=t.width,g=t.bearing,y=t.zoom,_=new p({longitude:d,latitude:v,height:i,width:m,bearing:g,zoom:y,pitch:0});return{camera:{position:l,direction:f,up:c},viewport:t,topDownViewport:_,height:i,cullingVolume:UE,frameNumber:r,sseDenominator:1.15}}function UZ(t,r,e){if(e===0||t.length<=e)return[t,[]];var n=[],i=r.viewport,a=i.longitude,o=i.latitude,s=VCe(t.entries()),u;try{for(s.s();!(u=s.n()).done;){var l=(0,jE.default)(u.value,2),f=l[0],c=l[1],p=(0,jE.default)(c.header.mbs,2),d=p[0],v=p[1],m=Math.abs(a-d),g=Math.abs(o-v),y=Math.sqrt(g*g+m*m);n.push([f,y])}}catch(O){s.e(O)}finally{s.f()}for(var _=n.sort(function(O,w){return O[1]-w[1]}),b=[],x=0;x<e;x++)b.push(t[_[x][0]]);for(var A=[],T=e;T<_.length;T++)A.push(t[_[T][0]]);return[b,A]}function WCe(t){var r=t.getFrustumPlanes(),e=NZ(r.near,t.cameraPosition),n=A0(t,e),i=A0(t,t.cameraPosition,NE),a=0;UE.planes[a++].fromPointNormal(n,DZ.copy(n).subtract(i));for(var o in r)if(o!=="near"){var s=r[o],u=NZ(s,e,NE),l=A0(t,u,NE);UE.planes[a++].fromPointNormal(l,DZ.copy(n).subtract(l))}}function NZ(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new V,n=t.normal.dot(r);return e.copy(t.normal).scale(t.distance-n).add(r),e}function A0(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new V,n=t.unprojectPosition(r);return st.WGS84.cartographicToCartesian(n,e)}var zZ=h(ye());var $Ce=6378137,XCe=6378137,GE=6356752314245179e-9,GZ=new V;function VZ(t,r){if(t instanceof Us){var e=t.halfAxes,n=qCe(e);return Math.log2(GE/(n+r[2]))}else if(t instanceof bo){var i=t.radius;return Math.log2(GE/(i+r[2]))}else if(t.width&&t.height){var a=t.width,o=t.height,s=Math.log2($Ce/a),u=Math.log2(XCe/o);return(s+u)/2}return 1}function zE(t,r,e){var n=st.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],new V),i=Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)+Math.pow(n[2]-e[2],2));return Math.log2(GE/(i+r[2]))}function HZ(t,r,e){var n=(0,zZ.default)(t,4),i=n[0],a=n[1],o=n[2],s=n[3];return zE({xmin:i,xmax:o,ymin:a,ymax:s,zmin:0,zmax:0},r,e)}function qCe(t){t.getColumn(0,GZ);var r=t.getColumn(1),e=t.getColumn(2),n=GZ.add(r).add(e),i=n.len();return i}var YE=h(B()),hQ=h(ge()),dQ=h(L()),vQ=h(N()),qE=h(de());var Gr={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Qr={ADD:1,REPLACE:2},Fa={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Tr={I3S:"I3S",TILES3D:"TILES3D"},Ys={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},WZ={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};var Ks=h(dr()),VE=h(ye());function XZ(t){return t!=null}var Sr=new V,T0=new V,YCe=new V,KCe=new V;function S0(t,r,e){if(Fe(t,"3D Tile: boundingVolume must be defined"),t.box)return JCe(t.box,r,e);if(t.region){var n=(0,VE.default)(t.region,6),i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],l=n[5],f=st.WGS84.cartographicToCartesian([fr(i),fr(s),u],YCe),c=st.WGS84.cartographicToCartesian([fr(o),fr(a),l],KCe),p=new V().addVectors(f,c).multiplyScalar(.5),d=new V().subVectors(f,c).len()/2;return $Z([p[0],p[1],p[2],d],new ce)}if(t.sphere)return $Z(t.sphere,r,e);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function qZ(t,r){if(t.box)return ZCe(r);if(t.region){var e=(0,VE.default)(t.region,6),n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5];return[[fr(n),fr(i),s],[fr(a),fr(o),u]]}if(t.sphere)return QCe(r);throw new Error("Unkown boundingVolume type")}function JCe(t,r,e){var n=new V(t[0],t[1],t[2]);r.transform(n,n);var i=[];if(t.length===10){var a=t.slice(3,6),o=new Ti;o.fromArray(t,6);var s=new V([1,0,0]),u=new V([0,1,0]),l=new V([0,0,1]);s.transformByQuaternion(o),s.scale(a[0]),u.transformByQuaternion(o),u.scale(a[1]),l.transformByQuaternion(o),l.scale(a[2]),i=[].concat((0,Ks.default)(s.toArray()),(0,Ks.default)(u.toArray()),(0,Ks.default)(l.toArray()))}else i=[].concat((0,Ks.default)(t.slice(3,6)),(0,Ks.default)(t.slice(6,9)),(0,Ks.default)(t.slice(9,12)));var f=r.transformAsVector(i.slice(0,3)),c=r.transformAsVector(i.slice(3,6)),p=r.transformAsVector(i.slice(6,9)),d=new lt([f[0],f[1],f[2],c[0],c[1],c[2],p[0],p[1],p[2]]);return XZ(e)?(e.center=n,e.halfAxes=d,e):new Us(n,d)}function $Z(t,r,e){var n=new V(t[0],t[1],t[2]);r.transform(n,n);var i=r.getScale(T0),a=Math.max(Math.max(i[0],i[1]),i[2]),o=t[3]*a;return XZ(e)?(e.center=n,e.radius=o,e):new bo(n,o)}function ZCe(t){for(var r=YZ(),e=t.halfAxes,n=new V(e.getColumn(0)),i=new V(e.getColumn(1)),a=new V(e.getColumn(2)),o=0;o<2;o++){for(var s=0;s<2;s++){for(var u=0;u<2;u++)Sr.copy(t.center),Sr.add(n),Sr.add(i),Sr.add(a),KZ(r,Sr),a.negate();i.negate()}n.negate()}return r}function QCe(t){var r=YZ(),e=t.center,n=t.radius,i=st.WGS84.scaleToGeodeticSurface(e,Sr),a;i?a=st.WGS84.geodeticSurfaceNormal(i):a=new V(0,0,1);var o=new V(a[2],-a[1],0);o.len()>0?o.normalize():o=new V(0,1,0);for(var s=o.clone().cross(a),u=0,l=[o,s,a];u<l.length;u++){var f=l[u];T0.copy(f).scale(n);for(var c=0;c<2;c++)Sr.copy(e),Sr.add(T0),KZ(r,Sr),T0.negate()}return r}function YZ(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function KZ(t,r){st.WGS84.cartesianToCartographic(r,Sr),t[0][0]=Math.min(t[0][0],Sr[0]),t[0][1]=Math.min(t[0][1],Sr[1]),t[0][2]=Math.min(t[0][2],Sr[2]),t[1][0]=Math.max(t[1][0],Sr[0]),t[1][1]=Math.max(t[1][1],Sr[1]),t[1][2]=Math.max(t[1][2],Sr[2])}var Qct=new V,ept=new V,tpt=new ce,rpt=new V,npt=new V,ipt=new V;function eMe(t,r){var e=t*r;return 1-Math.exp(-(e*e))}function tMe(t,r){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){var e=t.dynamicScreenSpaceErrorComputedDensity,n=t.dynamicScreenSpaceErrorFactor,i=eMe(r,e)*n;return i}return 0}function JZ(t,r,e){var n=t.tileset,i=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,a=e?i:t.lodMetricValue;if(a===0)return 0;var o=Math.max(t._distanceToCamera,1e-7),s=r.height,u=r.sseDenominator,l=n.options.viewDistanceScale,f=a*s*(l||1)/(o*u);return f-=tMe(n,o),f}var tQ=h(dr());var HE=new V,ZZ=new V,Eo=new V,QZ=new V,rMe=new V,WE=new ce,eQ=new ce;function rQ(t,r){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";var e=2*$E(t,r);return e<2?"OUT":!t.header.children||e<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function $E(t,r){var e=r.topDownViewport,n=t.header.mbs[1],i=t.header.mbs[0],a=t.header.mbs[2],o=t.header.mbs[3],s=(0,tQ.default)(t.boundingVolume.center),u=e.unprojectPosition(e.cameraPosition);st.WGS84.cartographicToCartesian(u,HE),ZZ.copy(HE).subtract(s).normalize(),st.WGS84.eastNorthUpToFixedFrame(s,WE),eQ.copy(WE).invert(),Eo.copy(HE).transform(eQ);var l=Math.sqrt(Eo[0]*Eo[0]+Eo[1]*Eo[1]),f=l*l/Eo[2];QZ.copy([Eo[0],Eo[1],f]);var c=QZ.transform(WE),p=c.subtract(s).normalize(),d=ZZ.cross(p).normalize().scale(o),v=d.add(s),m=st.WGS84.cartesianToCartographic(v),g=e.project([i,n,a]),y=e.project(m),_=rMe.copy(g).subtract(y).magnitude();return _}function nQ(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}var uQ=h(B()),lQ=h(L()),fQ=h(N());var iQ=h(L()),aQ=h(N());var XE=function(){function t(){(0,iQ.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;C(this,"_map",new Map),C(this,"_array",void 0),C(this,"_length",void 0),this._array=new Array(r),this._length=r}return(0,aQ.default)(t,[{key:"length",get:function(){return this._length},set:function(e){this._length=e,e>this._array.length&&(this._array.length=e)}},{key:"values",get:function(){return this._array}},{key:"get",value:function(e){return Fe(e<this._array.length),this._array[e]}},{key:"set",value:function(e,n){Fe(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=n,this._map.set(n,e)}},{key:"delete",value:function(e){var n=this._map.get(e);n>=0&&(this._array.splice(n,1),this._map.delete(e),this.length--)}},{key:"peek",value:function(){return this._array[this._length-1]}},{key:"push",value:function(e){if(!this._map.has(e)){var n=this.length++;this._array[n]=e,this._map.set(e,n)}}},{key:"pop",value:function(){var e=this._array[--this.length];return this._map.delete(e),e}},{key:"reserve",value:function(e){Fe(e>=0),e>this._array.length&&(this._array.length=e)}},{key:"resize",value:function(e){Fe(e>=0),this.length=e}},{key:"trim",value:function(e){e==null&&(e=this.length),this._array.length=e}},{key:"reset",value:function(){this._array=[],this._map=new Map,this._length=0}},{key:"find",value:function(e){return this._map.has(e)}}]),t}();function P0(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=nMe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function nMe(t,r){if(t){if(typeof t=="string")return oQ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return oQ(t,r)}}function oQ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function sQ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function w0(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?sQ(Object(e),!0).forEach(function(n){(0,uQ.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):sQ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var iMe={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:function(){},viewportTraversersMap:{},basePath:""},Co=function(){function t(r){(0,lQ.default)(this,t),C(this,"options",void 0),C(this,"root",void 0),C(this,"requestedTiles",void 0),C(this,"selectedTiles",void 0),C(this,"emptyTiles",void 0),C(this,"lastUpdate",new Date().getTime()),C(this,"updateDebounceTime",1e3),C(this,"_traversalStack",void 0),C(this,"_emptyTraversalStack",void 0),C(this,"_frameNumber",void 0),this.options=w0(w0({},iMe),r),this._traversalStack=new XE,this._emptyTraversalStack=new XE,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}return(0,fQ.default)(t,[{key:"traversalFinished",value:function(e){return!0}},{key:"traverse",value:function(e,n,i){this.root=e,this.options=w0(w0({},this.options),i),this.reset(),this.updateTile(e,n),this._frameNumber=n.frameNumber,this.executeTraversal(e,n)}},{key:"reset",value:function(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}},{key:"executeTraversal",value:function(e,n){var i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){var a=i.pop(),o=!1;this.canTraverse(a,n)&&(this.updateChildTiles(a,n),o=this.updateAndPushChildren(a,n,i,a.hasRenderContent?a._selectionDepth+1:a._selectionDepth));var s=a.parent,u=Boolean(!s||s._shouldRefine),l=!o;a.hasRenderContent?a.refine===Qr.ADD?(this.loadTile(a,n),this.selectTile(a,n)):a.refine===Qr.REPLACE&&(this.loadTile(a,n),l&&this.selectTile(a,n)):(this.emptyTiles[a.id]=a,this.loadTile(a,n),l&&this.selectTile(a,n)),this.touchTile(a,n),a._shouldRefine=o&&u}var f=new Date().getTime();(this.traversalFinished(n)||f-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=f,this.options.onTraversalEnd(n))}},{key:"updateChildTiles",value:function(e,n){var i=e.children,a=P0(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;this.updateTile(s,n)}}catch(u){a.e(u)}finally{a.f()}return!0}},{key:"updateAndPushChildren",value:function(e,n,i,a){var o=this.options,s=o.loadSiblings,u=o.skipLevelOfDetail,l=e.children;l.sort(this.compareDistanceToCamera.bind(this));var f=e.refine===Qr.REPLACE&&e.hasRenderContent&&!u,c=!1,p=!0,d=P0(l),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;if(m._selectionDepth=a,m.isVisibleAndInRequestVolume?(i.find(m)&&i.delete(m),i.push(m),c=!0):(f||s)&&(this.loadTile(m,n),this.touchTile(m,n)),f){var g=void 0;if(m._inRequestVolume?m.hasRenderContent?g=m.contentAvailable:g=this.executeEmptyTraversal(m,n):g=!1,p=p&&g,!p)return!1}}}catch(y){d.e(y)}finally{d.f()}return c||(p=!1),p}},{key:"updateTile",value:function(e,n){this.updateTileVisibility(e,n)}},{key:"selectTile",value:function(e,n){this.shouldSelectTile(e)&&(e._selectedFrame=n.frameNumber,this.selectedTiles[e.id]=e)}},{key:"loadTile",value:function(e,n){this.shouldLoadTile(e)&&(e._requestedFrame=n.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}},{key:"touchTile",value:function(e,n){e.tileset._cache.touch(e),e._touchedFrame=n.frameNumber}},{key:"canTraverse",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!a&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,n,i):!1}},{key:"shouldLoadTile",value:function(e){return e.hasUnloadedContent||e.contentExpired}},{key:"shouldSelectTile",value:function(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}},{key:"shouldRefine",value:function(e,n,i){var a=e._screenSpaceError;return i&&(a=e.getScreenSpaceError(n,!0)),a>this.options.maximumScreenSpaceError}},{key:"updateTileVisibility",value:function(e,n){var i=[];if(this.options.viewportTraversersMap)for(var a in this.options.viewportTraversersMap){var o=this.options.viewportTraversersMap[a];o===n.viewport.id&&i.push(a)}else i.push(n.viewport.id);e.updateVisibility(n,i)}},{key:"compareDistanceToCamera",value:function(e,n){return e._distanceToCamera-n._distanceToCamera}},{key:"anyChildrenVisible",value:function(e,n){var i=!1,a=P0(e.children),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.updateVisibility(n),i=i||s.isVisibleAndInRequestVolume}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"executeEmptyTraversal",value:function(e,n){var i=!0,a=this._emptyTraversalStack;for(a.push(e);a.length>0&&i;){var o=a.pop();this.updateTile(o,n),o.isVisibleAndInRequestVolume||this.loadTile(o,n),this.touchTile(o,n);var s=!o.hasRenderContent&&this.canTraverse(o,n,!1,!0);if(s){var u=o.children,l=P0(u),f;try{for(l.s();!(f=l.n()).done;){var c=f.value;a.find(c)&&a.delete(c),a.push(c)}}catch(p){l.e(p)}finally{l.f()}}else o.contentAvailable||(i=!1)}return i}}]),t}();function cQ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function sf(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?cQ(Object(e),!0).forEach(function(n){(0,YE.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):cQ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var pQ=new V;function aMe(t){return t!=null}var Jh=function(){function t(r,e,n){(0,dQ.default)(this,t);var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";C(this,"tileset",void 0),C(this,"header",void 0),C(this,"id",void 0),C(this,"url",void 0),C(this,"parent",void 0),C(this,"refine",void 0),C(this,"type",void 0),C(this,"contentUrl",void 0),C(this,"lodMetricType",void 0),C(this,"lodMetricValue",void 0),C(this,"boundingVolume",void 0),C(this,"content",void 0),C(this,"contentState",void 0),C(this,"gpuMemoryUsageInBytes",void 0),C(this,"children",void 0),C(this,"depth",void 0),C(this,"viewportIds",void 0),C(this,"transform",void 0),C(this,"extensions",void 0),C(this,"implicitTiling",void 0),C(this,"userData",void 0),C(this,"computedTransform",void 0),C(this,"hasEmptyContent",void 0),C(this,"hasTilesetContent",void 0),C(this,"traverser",void 0),C(this,"_cacheNode",void 0),C(this,"_frameNumber",void 0),C(this,"_lodJudge",void 0),C(this,"_expireDate",void 0),C(this,"_expiredContent",void 0),C(this,"_shouldRefine",void 0),C(this,"_boundingBox",void 0),C(this,"_distanceToCamera",void 0),C(this,"_centerZDepth",void 0),C(this,"_screenSpaceError",void 0),C(this,"_visibilityPlaneMask",void 0),C(this,"_visible",void 0),C(this,"_inRequestVolume",void 0),C(this,"_stackLength",void 0),C(this,"_selectionDepth",void 0),C(this,"_touchedFrame",void 0),C(this,"_visitedFrame",void 0),C(this,"_selectedFrame",void 0),C(this,"_requestedFrame",void 0),C(this,"_priority",void 0),C(this,"_contentBoundingVolume",void 0),C(this,"_viewerRequestVolume",void 0),C(this,"_initialTransform",void 0),this.header=e,this.tileset=r,this.id=i||e.id,this.url=e.url,this.parent=n,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=Gr.UNLOADED,this.gpuMemoryUsageInBytes=0,this.children=[],this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.depth=0,this.viewportIds=[],this.userData={},this.extensions=null,this._priority=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._screenSpaceError=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this.traverser=new Co({}),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._initialTransform=new ce,this.transform=new ce,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,this.implicitTiling=null,Object.seal(this)}return(0,vQ.default)(t,[{key:"destroy",value:function(){this.header=null}},{key:"isDestroyed",value:function(){return this.header===null}},{key:"selected",get:function(){return this._selectedFrame===this.tileset._frameNumber}},{key:"isVisible",get:function(){return this._visible}},{key:"isVisibleAndInRequestVolume",get:function(){return this._visible&&this._inRequestVolume}},{key:"hasRenderContent",get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent}},{key:"hasChildren",get:function(){return this.children.length>0||this.header.children&&this.header.children.length>0}},{key:"contentReady",get:function(){return this.contentState===Gr.READY||this.hasEmptyContent}},{key:"contentAvailable",get:function(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}},{key:"hasUnloadedContent",get:function(){return this.hasRenderContent&&this.contentUnloaded}},{key:"contentUnloaded",get:function(){return this.contentState===Gr.UNLOADED}},{key:"contentExpired",get:function(){return this.contentState===Gr.EXPIRED}},{key:"contentFailed",get:function(){return this.contentState===Gr.FAILED}},{key:"distanceToCamera",get:function(){return this._distanceToCamera}},{key:"screenSpaceError",get:function(){return this._screenSpaceError}},{key:"boundingBox",get:function(){return this._boundingBox||(this._boundingBox=qZ(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}},{key:"getScreenSpaceError",value:function(e,n){switch(this.tileset.type){case Tr.I3S:return $E(this,e);case Tr.TILES3D:return JZ(this,e,n);default:throw new Error("Unsupported tileset type")}}},{key:"unselect",value:function(){this._selectedFrame=0}},{key:"_getPriority",value:function(){var e=this.tileset._traverser,n=e.options.skipLevelOfDetail,i=this.refine===Qr.ADD||n;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Gr.UNLOADED)return-1;var a=this.parent,o=a&&(!i||this._screenSpaceError===0||a.hasTilesetContent),s=o?a._screenSpaceError:this._screenSpaceError,u=e.root?e.root._screenSpaceError:0;return Math.max(u-s,0)}},{key:"loadContent",value:function(){var r=(0,hQ.default)(qE.default.mark(function n(){var i,a,o,s,u;return qE.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!this.hasEmptyContent){f.next=2;break}return f.abrupt("return",!1);case 2:if(!this.content){f.next=4;break}return f.abrupt("return",!0);case 4:return i=this.contentExpired,i&&(this._expireDate=null),this.contentState=Gr.LOADING,f.next=9,this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));case 9:if(a=f.sent,a){f.next=13;break}return this.contentState=Gr.UNLOADED,f.abrupt("return",!1);case 13:return f.prev=13,o=this.tileset.getTileUrl(this.contentUrl),s=this.tileset.loader,u=sf(sf({},this.tileset.loadOptions),{},(0,YE.default)({},s.id,sf(sf({},this.tileset.loadOptions[s.id]),{},{isTileset:this.type==="json"},this._getLoaderSpecificOptions(s.id)))),f.next=19,qt(o,s,u);case 19:if(this.content=f.sent,!this.tileset.options.contentLoader){f.next=23;break}return f.next=23,this.tileset.options.contentLoader(this);case 23:return this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Gr.READY,this._onContentLoaded(),f.abrupt("return",!0);case 29:throw f.prev=29,f.t0=f.catch(13),this.contentState=Gr.FAILED,f.t0;case 33:return f.prev=33,a.done(),f.finish(33);case 36:case"end":return f.stop()}},n,this,[[13,29,33,36]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"unloadContent",value:function(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Gr.UNLOADED,!0}},{key:"updateVisibility",value:function(e,n){if(this._frameNumber!==e.frameNumber){var i=this.parent,a=i?i._visibilityPlaneMask:Kr.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){var o=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,a),this._visible=this._visibilityPlaneMask!==Kr.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=n}}},{key:"visibility",value:function(e,n){var i=e.cullingVolume,a=this.boundingVolume;return i.computeVisibilityWithPlaneMask(a,n)}},{key:"contentVisibility",value:function(){return!0}},{key:"distanceToTile",value:function(e){var n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(e.camera.position),0))}},{key:"cameraSpaceZDepth",value:function(e){var n=e.camera,i=this.boundingVolume;return pQ.subVectors(i.center,n.position),n.direction.dot(pQ)}},{key:"insideViewerRequestVolume",value:function(e){var n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(e.camera.position)<=0}},{key:"updateExpiration",value:function(){if(aMe(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){var e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Gr.EXPIRED,this._expiredContent=this.content)}}},{key:"extras",get:function(){return this.header.extras}},{key:"_initializeLodMetric",value:function(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}},{key:"_initializeTransforms",value:function(e){this.transform=e.transform?new ce(e.transform):new ce;var n=this.parent,i=this.tileset,a=n&&n.computedTransform?n.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new ce(a).multiplyRight(this.transform);var o=n&&n._initialTransform?n._initialTransform.clone():new ce;this._initialTransform=new ce(o).multiplyRight(this.transform)}},{key:"_initializeBoundingVolumes",value:function(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}},{key:"_initializeContent",value:function(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Gr.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}},{key:"_initializeRenderingState",value:function(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Kr.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}},{key:"_getRefine",value:function(e){return e||this.parent&&this.parent.refine||Qr.REPLACE}},{key:"_isTileset",value:function(){return this.contentUrl.indexOf(".json")!==-1}},{key:"_onContentLoaded",value:function(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break;default:}this._isTileset()&&(this.hasTilesetContent=!0)}},{key:"_updateBoundingVolume",value:function(e){this.boundingVolume=S0(e.boundingVolume,this.computedTransform,this.boundingVolume);var n=e.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=S0(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=S0(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new ce,n=e.clone().multiplyRight(this.transform),i=!n.equals(this.computedTransform);i&&(this.computedTransform=n,this._updateBoundingVolume(this.header))}},{key:"_getLoaderSpecificOptions",value:function(e){switch(e){case"i3s":return sf(sf({},this.tileset.options.i3s),{},{_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1});case"3d-tiles":case"cesium-ion":default:return nQ(this.tileset.tileset)}}}]),t}();var mQ=h(L()),gQ=h(N()),yQ=h(Oe()),_Q=h(Y()),bQ=h(K()),O0=h(q());function oMe(t){var r=sMe();return function(){var n=(0,O0.default)(t),i;if(r){var a=(0,O0.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,bQ.default)(this,i)}}function sMe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xQ=function(t){(0,_Q.default)(e,t);var r=oMe(e);function e(){return(0,mQ.default)(this,e),r.apply(this,arguments)}return(0,gQ.default)(e,[{key:"compareDistanceToCamera",value:function(i,a){return a._distanceToCamera===0&&i._distanceToCamera===0?a._centerZDepth-i._centerZDepth:a._distanceToCamera-i._distanceToCamera}},{key:"updateTileVisibility",value:function(i,a){if((0,yQ.default)((0,O0.default)(e.prototype),"updateTileVisibility",this).call(this,i,a),!!i.isVisibleAndInRequestVolume){var o=i.children.length>0;if(i.hasTilesetContent&&o){var s=i.children[0];this.updateTileVisibility(s,a),i._visible=s._visible;return}if(this.meetsScreenSpaceErrorEarly(i,a)){i._visible=!1;return}var u=i.refine===Qr.REPLACE,l=i._optimChildrenWithinParent===WZ.USE_OPTIMIZATION;if(u&&l&&o&&!this.anyChildrenVisible(i,a)){i._visible=!1;return}}}},{key:"meetsScreenSpaceErrorEarly",value:function(i,a){var o=i.parent;return!o||o.hasTilesetContent||o.refine!==Qr.ADD?!1:!this.shouldRefine(i,a,!0)}}]),e}(Co);var MQ=h(B()),IQ=h(ge()),RQ=h(L()),LQ=h(N()),kQ=h(_e()),BQ=h(Y()),FQ=h(K()),JE=h(q()),ZE=h(de());var PQ=h(L()),wQ=h(N());var AQ=h(L()),TQ=h(N());var SQ=function(){function t(){(0,AQ.default)(this,t),C(this,"frameNumberMap",new Map)}return(0,TQ.default)(t,[{key:"register",value:function(e,n){var i=this.frameNumberMap.get(e)||new Map,a=i.get(n)||0;i.set(n,a+1),this.frameNumberMap.set(e,i)}},{key:"deregister",value:function(e,n){var i=this.frameNumberMap.get(e);if(i){var a=i.get(n)||1;i.set(n,a-1)}}},{key:"isZero",value:function(e,n){var i,a=((i=this.frameNumberMap.get(e))===null||i===void 0?void 0:i.get(n))||0;return a===0}}]),t}();var KE={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"},OQ=function(){function t(){(0,PQ.default)(this,t),C(this,"_statusMap",void 0),C(this,"pendingTilesRegister",new SQ),this._statusMap={}}return(0,wQ.default)(t,[{key:"add",value:function(e,n,i,a){var o=this;if(!this._statusMap[n]){var s=a.frameNumber,u=a.viewport.id;this._statusMap[n]={request:e,callback:i,key:n,frameState:a,status:KE.REQUESTED},this.pendingTilesRegister.register(u,s),e().then(function(l){o._statusMap[n].status=KE.COMPLETED;var f=o._statusMap[n].frameState,c=f.frameNumber,p=f.viewport.id;o.pendingTilesRegister.deregister(p,c),o._statusMap[n].callback(l,a)}).catch(function(l){o._statusMap[n].status=KE.ERROR;var f=o._statusMap[n].frameState,c=f.frameNumber,p=f.viewport.id;o.pendingTilesRegister.deregister(p,c),i(l)})}}},{key:"update",value:function(e,n){if(this._statusMap[e]){var i=this._statusMap[e].frameState,a=i.frameNumber,o=i.viewport.id;this.pendingTilesRegister.deregister(o,a);var s=n.frameNumber,u=n.viewport.id;this.pendingTilesRegister.register(u,s),this._statusMap[e].frameState=n}}},{key:"find",value:function(e){return this._statusMap[e]}},{key:"hasPendingTiles",value:function(e,n){return!this.pendingTilesRegister.isZero(e,n)}}]),t}();function EQ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function E0(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?EQ(Object(e),!0).forEach(function(n){(0,MQ.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):EQ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function uMe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=lMe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function lMe(t,r){if(t){if(typeof t=="string")return CQ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return CQ(t,r)}}function CQ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function fMe(t){var r=cMe();return function(){var n=(0,JE.default)(t),i;if(r){var a=(0,JE.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,FQ.default)(this,i)}}function cMe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var DQ=function(t){(0,BQ.default)(e,t);var r=fMe(e);function e(n){var i;return(0,RQ.default)(this,e),i=r.call(this,n),C((0,kQ.default)(i),"_tileManager",void 0),i._tileManager=new OQ,i}return(0,LQ.default)(e,[{key:"traversalFinished",value:function(i){return!this._tileManager.hasPendingTiles(i.viewport.id,this._frameNumber||0)}},{key:"shouldRefine",value:function(i,a){return i._lodJudge=rQ(i,a),i._lodJudge==="DIG"}},{key:"updateChildTiles",value:function(i,a){var o=this,s=i.header.children||[],u=i.children,l=i.tileset,f=uMe(s),c;try{var p=function(){var v=c.value,m="".concat(v.id,"-").concat(a.viewport.id),g=u&&u.find(function(b){return b.id===m});if(g)g&&o.updateTile(g,a);else{var y=function(){return o._loadTile(v.id,l)},_=o._tileManager.find(m);_?o._tileManager.update(m,a):(l.tileset.nodePages&&(y=function(){return l.tileset.nodePagesTile.formTileFromNodePages(v.id)}),o._tileManager.add(y,m,function(b){return o._onTileLoad(b,i,m)},a))}};for(f.s();!(c=f.n()).done;)p()}catch(d){f.e(d)}finally{f.f()}return!1}},{key:"_loadTile",value:function(){var n=(0,IQ.default)(ZE.default.mark(function a(o,s){var u,l,f;return ZE.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=s.loader,l=s.getTileUrl("".concat(s.url,"/nodes/").concat(o)),f=E0(E0({},s.loadOptions),{},{i3s:E0(E0({},s.loadOptions.i3s),{},{isTileHeader:!0})}),p.next=5,qt(l,u,f);case 5:return p.abrupt("return",p.sent);case 6:case"end":return p.stop()}},a)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"_onTileLoad",value:function(i,a,o){var s=new Jh(a.tileset,i,a,o);a.children.push(s);var u=this._tileManager.find(s.id).frameState;this.updateTile(s,u),this._frameNumber===u.frameNumber&&(this.traversalFinished(u)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(s,u)}}]),e}(Co);function Da(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=pMe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function pMe(t,r){if(t){if(typeof t=="string")return NQ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return NQ(t,r)}}function NQ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function jQ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function uf(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?jQ(Object(e),!0).forEach(function(n){(0,$Q.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):jQ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var hMe={description:"",ellipsoid:st.WGS84,modelMatrix:new ce,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(){},onTraversalComplete:function(r){return r},contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},C0="Tiles In Tileset(s)",QE="Tiles In Memory",UQ="Tiles In View",GQ="Tiles To Render",zQ="Tiles Loaded",eC="Tiles Loading",VQ="Tiles Unloaded",HQ="Failed Tile Loads",WQ="Points/Vertices",tC="Tile Memory Use",nC=function(){function t(r,e){(0,XQ.default)(this,t),C(this,"options",void 0),C(this,"loadOptions",void 0),C(this,"type",void 0),C(this,"tileset",void 0),C(this,"loader",void 0),C(this,"url",void 0),C(this,"basePath",void 0),C(this,"modelMatrix",void 0),C(this,"ellipsoid",void 0),C(this,"lodMetricType",void 0),C(this,"lodMetricValue",void 0),C(this,"refine",void 0),C(this,"root",void 0),C(this,"roots",void 0),C(this,"asset",void 0),C(this,"description",void 0),C(this,"properties",void 0),C(this,"extras",void 0),C(this,"attributions",void 0),C(this,"credits",void 0),C(this,"stats",void 0),C(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),C(this,"traverseCounter",void 0),C(this,"geometricError",void 0),C(this,"selectedTiles",void 0),C(this,"updatePromise",null),C(this,"tilesetInitializationPromise",void 0),C(this,"cartographicCenter",void 0),C(this,"cartesianCenter",void 0),C(this,"zoom",void 0),C(this,"boundingVolume",void 0),C(this,"gpuMemoryUsageInBytes",void 0),C(this,"dynamicScreenSpaceErrorComputedDensity",void 0),C(this,"_traverser",void 0),C(this,"_cache",void 0),C(this,"_requestScheduler",void 0),C(this,"_frameNumber",void 0),C(this,"_queryParamsString",void 0),C(this,"_queryParams",void 0),C(this,"_extensionsUsed",void 0),C(this,"_tiles",void 0),C(this,"_pendingCount",void 0),C(this,"lastUpdatedVieports",void 0),C(this,"_requestedTiles",void 0),C(this,"_emptyTiles",void 0),C(this,"frameStateData",void 0),C(this,"maximumMemoryUsage",void 0),Fe(r),this.options=uf(uf({},hMe),e),this.tileset=r,this.loader=r.loader,this.type=r.type,this.url=r.url,this.basePath=r.basePath||Ha.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=r.lodMetricType,this.lodMetricValue=r.lodMetricValue,this.refine=r.root.refine,this.loadOptions=this.options.loadOptions||{},this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.traverseCounter=0,this.geometricError=0,this._traverser=this._initializeTraverser(),this._cache=new kZ,this._requestScheduler=new lc({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this._frameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this.frameStateData={},this.lastUpdatedVieports=null,this._queryParams={},this._queryParamsString="",this.maximumMemoryUsage=this.options.maximumMemoryUsage||32,this.gpuMemoryUsageInBytes=0,this.stats=new Un({id:this.url}),this._initializeStats(),this._extensionsUsed=void 0,this.dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description||"",this.tilesetInitializationPromise=this._initializeTileSet(r)}return(0,qQ.default)(t,[{key:"destroy",value:function(){this._destroy()}},{key:"isLoaded",value:function(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}},{key:"tiles",get:function(){return Object.values(this._tiles)}},{key:"frameNumber",get:function(){return this._frameNumber}},{key:"queryParams",get:function(){return this._queryParamsString||(this._queryParamsString=dMe(this._queryParams)),this._queryParamsString}},{key:"setProps",value:function(e){this.options=uf(uf({},this.options),e)}},{key:"setOptions",value:function(e){this.options=uf(uf({},this.options),e)}},{key:"getTileUrl",value:function(e){var n=e.startsWith("data:");return n?e:"".concat(e).concat(this.queryParams)}},{key:"hasExtension",value:function(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)}},{key:"update",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(function(){!n&&e.lastUpdatedVieports?n=e.lastUpdatedVieports:e.lastUpdatedVieports=n,n&&e.doUpdate(n)})}},{key:"selectTiles",value:function(){var r=(0,M0.default)(Js.default.mark(function n(){var i=this,a,o=arguments;return Js.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return a=o.length>0&&o[0]!==void 0?o[0]:null,u.next=3,this.tilesetInitializationPromise;case 3:return a&&(this.lastUpdatedVieports=a),this.updatePromise||(this.updatePromise=new Promise(function(l){setTimeout(function(){i.lastUpdatedVieports&&i.doUpdate(i.lastUpdatedVieports),l(i._frameNumber),i.updatePromise=null},i.options.debounceTime)})),u.abrupt("return",this.updatePromise);case 6:case"end":return u.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"doUpdate",value:function(e){if(!("loadTiles"in this.options&&!this.options.loadTiles)&&!(this.traverseCounter>0)){var n=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;var i=[],a=Da(n),o;try{for(a.s();!(o=a.n()).done;){var s=o.value,u=s.id;this._needTraverse(u)?i.push(u):this.traverseCounter--}}catch(v){a.e(v)}finally{a.f()}var l=Da(n),f;try{for(l.s();!(f=l.n()).done;){var c=f.value,p=c.id;if(this.roots[p]||(this.roots[p]=this._initializeTileHeaders(this.tileset,null)),!!i.includes(p)){var d=jZ(c,this._frameNumber);this._traverser.traverse(this.roots[p],d,this.options)}}}catch(v){l.e(v)}finally{l.f()}}}},{key:"_needTraverse",value:function(e){var n=e;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[e]),n===e}},{key:"_onTraversalEnd",value:function(e){var n=e.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});var i=this.frameStateData[n],a=Object.values(this._traverser.selectedTiles),o=UZ(a,e,this.options.maximumTilesSelected),s=(0,rC.default)(o,2),u=s[0],l=s[1];i.selectedTiles=u;var f=Da(l),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;p.unselect()}}catch(d){f.e(d)}finally{f.f()}i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}},{key:"_updateTiles",value:function(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(var e in this.frameStateData){var n=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);var i=Da(this.selectedTiles),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;this._tiles[o.id]=o}}catch(s){i.e(s)}finally{i.f()}this._loadTiles(),this._unloadTiles(),this._updateStats()}},{key:"_tilesChanged",value:function(e,n){if(e.length!==n.length)return!0;var i=new Set(e.map(function(s){return s.id})),a=new Set(n.map(function(s){return s.id})),o=e.filter(function(s){return!a.has(s.id)}).length>0;return o=o||n.filter(function(s){return!i.has(s.id)}).length>0,o}},{key:"_loadTiles",value:function(){var e=Da(this._requestedTiles),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.contentUnloaded&&this._loadTile(i)}}catch(a){e.e(a)}finally{e.f()}}},{key:"_unloadTiles",value:function(){this._cache.unloadTiles(this,function(e,n){return e._unloadTile(n)})}},{key:"_updateStats",value:function(){var e=0,n=0,i=Da(this.selectedTiles),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.contentAvailable&&o.content&&(e++,o.content.pointCount?n+=o.content.pointCount:n+=o.content.vertexCount)}}catch(s){i.e(s)}finally{i.f()}this.stats.get(UQ).count=this.selectedTiles.length,this.stats.get(GQ).count=e,this.stats.get(WQ).count=n}},{key:"_initializeTileSet",value:function(){var r=(0,M0.default)(Js.default.mark(function n(i){return Js.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.type!==Tr.I3S){o.next=5;break}return this.calculateViewPropsI3S(),o.next=4,i.root;case 4:i.root=o.sent;case 5:this.root=this._initializeTileHeaders(i,null),this.type===Tr.TILES3D&&(this._initializeTiles3DTileset(i),this.calculateViewPropsTiles3D()),this.type===Tr.I3S&&this._initializeI3STileset();case 8:case"end":return o.stop()}},n,this)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"calculateViewPropsI3S",value:function(){var e,n=this.tileset.fullExtent;if(n){var i=n.xmin,a=n.xmax,o=n.ymin,s=n.ymax,u=n.zmin,l=n.zmax;this.cartographicCenter=new V(i+(a-i)/2,o+(s-o)/2,u+(l-u)/2),this.cartesianCenter=st.WGS84.cartographicToCartesian(this.cartographicCenter,new V),this.zoom=zE(n,this.cartographicCenter,this.cartesianCenter);return}var f=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(f){var c=(0,rC.default)(f,4),p=c[0],d=c[1],v=c[2],m=c[3];this.cartographicCenter=new V(p+(v-p)/2,d+(m-d)/2,0),this.cartesianCenter=st.WGS84.cartographicToCartesian(this.cartographicCenter,new V),this.zoom=HZ(f,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new V,this.zoom=1}},{key:"calculateViewPropsTiles3D",value:function(){var e=this.root;Fe(e);var n=e.boundingVolume.center;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new V,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?this.cartographicCenter=st.WGS84.cartesianToCartographic(n,new V):this.cartographicCenter=new V(0,0,-st.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=VZ(e.boundingVolume,this.cartographicCenter)}},{key:"_initializeStats",value:function(){this.stats.get(C0),this.stats.get(eC),this.stats.get(QE),this.stats.get(UQ),this.stats.get(GQ),this.stats.get(zQ),this.stats.get(VQ),this.stats.get(HQ),this.stats.get(WQ),this.stats.get(tC,"memory")}},{key:"_initializeTileHeaders",value:function(e,n){var i=new Jh(this,e.root,n);if(n&&(n.children.push(i),i.depth=n.depth+1),this.type===Tr.TILES3D){var a=[];for(a.push(i);a.length>0;){var o=a.pop();this.stats.get(C0).incrementCount();var s=o.header.children||[],u=Da(s),l;try{for(u.s();!(l=u.n()).done;){var f=l.value,c=new Jh(this,f,o);o.children.push(c),c.depth=o.depth+1,a.push(c)}}catch(p){u.e(p)}finally{u.f()}}}return i}},{key:"_initializeTraverser",value:function(){var e,n=this.type;switch(n){case Tr.TILES3D:e=xQ;break;case Tr.I3S:e=DQ;break;default:e=Co}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}},{key:"_destroyTileHeaders",value:function(e){this._destroySubtree(e)}},{key:"_loadTile",value:function(){var r=(0,M0.default)(Js.default.mark(function n(i){var a;return Js.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,this._onStartTileLoading(),s.next=4,i.loadContent();case 4:a=s.sent,s.next=10;break;case 7:s.prev=7,s.t0=s.catch(0),this._onTileLoadError(i,s.t0);case 10:return s.prev=10,this._onEndTileLoading(),this._onTileLoad(i,a),s.finish(10);case 14:case"end":return s.stop()}},n,this,[[0,7,10,14]])}));function e(n){return r.apply(this,arguments)}return e}()},{key:"_onTileLoadError",value:function(e,n){this.stats.get(HQ).incrementCount();var i=n.message||n.toString(),a=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(i)),this.options.onTileError(e,i,a)}},{key:"_onTileLoad",value:function(e,n){if(n){if(this.type===Tr.I3S){var i,a,o=((i=this.tileset)===null||i===void 0||(a=i.nodePagesTile)===null||a===void 0?void 0:a.nodesInNodePages)||0;this.stats.get(C0).reset(),this.stats.get(C0).addCount(o)}e&&e.content&&BZ(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}},{key:"updateContentTypes",value:function(e){if(this.type===Tr.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break;default:}else if(this.type===Tr.TILES3D){var n,i=((n=e.content)===null||n===void 0?void 0:n.gltf)||{},a=i.extensionsRemoved,o=a===void 0?[]:a;o.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),o.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),o.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}},{key:"_onStartTileLoading",value:function(){this._pendingCount++,this.stats.get(eC).incrementCount()}},{key:"_onEndTileLoading",value:function(){this._pendingCount--,this.stats.get(eC).decrementCount()}},{key:"_addTileToCache",value:function(e){this._cache.add(this,e,function(n){return n._updateCacheStats(e)})}},{key:"_updateCacheStats",value:function(e){this.stats.get(zQ).incrementCount(),this.stats.get(QE).incrementCount(),this.gpuMemoryUsageInBytes+=e.content.byteLength||0,this.stats.get(tC).count=this.gpuMemoryUsageInBytes}},{key:"_unloadTile",value:function(e){this.gpuMemoryUsageInBytes-=e.content&&e.content.byteLength||0,this.stats.get(QE).decrementCount(),this.stats.get(VQ).incrementCount(),this.stats.get(tC).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}},{key:"_destroy",value:function(){var e=[];for(this.root&&e.push(this.root);e.length>0;){var n=e.pop(),i=Da(n.children),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;e.push(o)}}catch(s){i.e(s)}finally{i.f()}this._destroyTile(n)}this.root=null}},{key:"_destroySubtree",value:function(e){var n=e,i=[];for(i.push(n);i.length>0;){e=i.pop();var a=Da(e.children),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;i.push(s)}}catch(u){a.e(u)}finally{a.f()}e!==n&&this._destroyTile(e)}n.children=[]}},{key:"_destroyTile",value:function(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}},{key:"_initializeTiles3DTileset",value:function(e){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed,this.extras=e.extras}},{key:"_initializeI3STileset",value:function(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}]),t}();function dMe(t){for(var r=[],e=0,n=Object.keys(t);e<n.length;e++){var i=n[e];r.push("".concat(i,"=").concat(t[i]))}switch(r.length){case 0:return"";case 1:return"?".concat(r[0]);default:return"?".concat(r.join("&"))}}var G0=h(ge()),nu=h(de());var I0="3.3.3";var wee=h(ge()),SC=h(de());var Zs={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"},uht=Object.keys(Zs);function iC(t,r,e){Fe(t instanceof ArrayBuffer);var n=new TextDecoder("utf8"),i=new Uint8Array(t,r,e),a=n.decode(i);return a}function YQ(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=new DataView(t);return"".concat(String.fromCharCode(e.getUint8(r+0))).concat(String.fromCharCode(e.getUint8(r+1))).concat(String.fromCharCode(e.getUint8(r+2))).concat(String.fromCharCode(e.getUint8(r+3)))}var vee=h(B()),k0=h(ge()),eu=h(de());var KQ=h(L()),JQ=h(N()),Na=h(B());var zi,aC=(zi={},(0,Na.default)(zi,5130,Float64Array),(0,Na.default)(zi,5126,Float32Array),(0,Na.default)(zi,5123,Uint16Array),(0,Na.default)(zi,5125,Uint32Array),(0,Na.default)(zi,5121,Uint8Array),(0,Na.default)(zi,5120,Int8Array),(0,Na.default)(zi,5122,Int16Array),(0,Na.default)(zi,5124,Int32Array),zi),vMe={DOUBLE:5130,FLOAT:5126,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,UNSIGNED_BYTE:5121,BYTE:5120,SHORT:5122,INT:5124},oC="Failed to convert GL type",Mo=function(){function t(){(0,KQ.default)(this,t)}return(0,JQ.default)(t,null,[{key:"fromTypedArray",value:function(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(var n in aC){var i=aC[n];if(i===e)return n}throw new Error(oC)}},{key:"fromName",value:function(e){var n=vMe[e];if(!n)throw new Error(oC);return n}},{key:"getArrayType",value:function(e){switch(e){case 33635:case 32819:case 32820:return Uint16Array;default:var n=aC[e];if(!n)throw new Error(oC);return n}}},{key:"getByteSize",value:function(e){var n=t.getArrayType(e);return n.BYTES_PER_ELEMENT}},{key:"validate",value:function(e){return Boolean(t.getArrayType(e))}},{key:"createTypedArray",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;a===void 0&&(a=(n.byteLength-i)/t.getByteSize(e));var o=t.getArrayType(e);return new o(n,i,a)}}]),t}();function ZQ(t,r){if(!t)throw new Error("math.gl assertion failed. ".concat(r))}function sC(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],e=t>>11&31,n=t>>5&63,i=t&31;return r[0]=e<<3,r[1]=n<<2,r[2]=i<<3,r}var ght=1/256;var yht=new Xn,_ht=new V,bht=new Xn,xht=new Xn,Aht=new Uint8Array(1);function QQ(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return He(t,0,r)/r*2-1}function eee(t){return t<0?-1:1}function tee(t,r,e,n){if(ZQ(n),t<0||t>e||r<0||r>e)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(e));if(n.x=QQ(t,e),n.y=QQ(r,e),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){var i=n.x;n.x=(1-Math.abs(n.y))*eee(i),n.y=(1-Math.abs(i))*eee(n.y)}return n.normalize()}function uC(t,r,e){return tee(t,r,255,e)}var ree=h(L()),nee=h(N());var lf=function(){function t(r,e){(0,ree.default)(this,t),C(this,"json",void 0),C(this,"buffer",void 0),C(this,"featuresLength",0),C(this,"_cachedTypedArrays",{}),this.json=r,this.buffer=e}return(0,nee.default)(t,[{key:"getExtension",value:function(e){return this.json.extensions&&this.json.extensions[e]}},{key:"hasProperty",value:function(e){return Boolean(this.json[e])}},{key:"getGlobalProperty",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5125,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=this.json[e];return a&&Number.isFinite(a.byteOffset)?this._getTypedArrayFromBinary(e,n,i,1,a.byteOffset):a}},{key:"getPropertyArray",value:function(e,n,i){var a=this.json[e];return a&&Number.isFinite(a.byteOffset)?("componentType"in a&&(n=Mo.fromName(a.componentType)),this._getTypedArrayFromBinary(e,n,i,this.featuresLength,a.byteOffset)):this._getTypedArrayFromArray(e,n,a)}},{key:"getProperty",value:function(e,n,i,a,o){var s=this.json[e];if(!s)return s;var u=this.getPropertyArray(e,n,i);if(i===1)return u[a];for(var l=0;l<i;++l)o[l]=u[i*a+l];return o}},{key:"_getTypedArrayFromBinary",value:function(e,n,i,a,o){var s=this._cachedTypedArrays,u=s[e];return u||(u=Mo.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+o,a*i),s[e]=u),u}},{key:"_getTypedArrayFromArray",value:function(e,n,i){var a=this._cachedTypedArrays,o=a[e];return o||(o=Mo.createTypedArray(n,i),a[e]=o),o}}]),t}();var see=h(dr()),uee=h(L()),lee=h(N());var mMe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gMe={SCALAR:function(r,e){return r[e]},VEC2:function(r,e){return[r[2*e+0],r[2*e+1]]},VEC3:function(r,e){return[r[3*e+0],r[3*e+1],r[3*e+2]]},VEC4:function(r,e){return[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]]},MAT2:function(r,e){return[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]]},MAT3:function(r,e){return[r[9*e+0],r[9*e+1],r[9*e+2],r[9*e+3],r[9*e+4],r[9*e+5],r[9*e+6],r[9*e+7],r[9*e+8]]},MAT4:function(r,e){return[r[16*e+0],r[16*e+1],r[16*e+2],r[16*e+3],r[16*e+4],r[16*e+5],r[16*e+6],r[16*e+7],r[16*e+8],r[16*e+9],r[16*e+10],r[16*e+11],r[16*e+12],r[16*e+13],r[16*e+14],r[16*e+15]]}},yMe={SCALAR:function(r,e,n){e[n]=r},VEC2:function(r,e,n){e[2*n+0]=r[0],e[2*n+1]=r[1]},VEC3:function(r,e,n){e[3*n+0]=r[0],e[3*n+1]=r[1],e[3*n+2]=r[2]},VEC4:function(r,e,n){e[4*n+0]=r[0],e[4*n+1]=r[1],e[4*n+2]=r[2],e[4*n+3]=r[3]},MAT2:function(r,e,n){e[4*n+0]=r[0],e[4*n+1]=r[1],e[4*n+2]=r[2],e[4*n+3]=r[3]},MAT3:function(r,e,n){e[9*n+0]=r[0],e[9*n+1]=r[1],e[9*n+2]=r[2],e[9*n+3]=r[3],e[9*n+4]=r[4],e[9*n+5]=r[5],e[9*n+6]=r[6],e[9*n+7]=r[7],e[9*n+8]=r[8],e[9*n+9]=r[9]},MAT4:function(r,e,n){e[16*n+0]=r[0],e[16*n+1]=r[1],e[16*n+2]=r[2],e[16*n+3]=r[3],e[16*n+4]=r[4],e[16*n+5]=r[5],e[16*n+6]=r[6],e[16*n+7]=r[7],e[16*n+8]=r[8],e[16*n+9]=r[9],e[16*n+10]=r[10],e[16*n+11]=r[11],e[16*n+12]=r[12],e[16*n+13]=r[13],e[16*n+14]=r[14],e[16*n+15]=r[15]}};function iee(t,r,e,n){var i=t.componentType;Fe(t.componentType);var a=typeof i=="string"?Mo.fromName(i):i,o=mMe[t.type],s=gMe[t.type],u=yMe[t.type];e+=t.byteOffset;var l=Mo.createTypedArray(a,r,e,o*n);return{values:l,type:a,size:o,unpacker:s,packer:u}}var Vi=function(r){return r!==void 0};function aee(t,r,e){if(!r)return null;var n=t.getExtension("3DTILES_batch_table_hierarchy"),i=r.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),r.extensions=r.extensions||{},r.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?_Me(n,e):null}function _Me(t,r){var e,n,i,a=t.instancesLength,o=t.classes,s=t.classIds,u=t.parentCounts,l=t.parentIds,f=a;Vi(s.byteOffset)&&(s.componentType=defaultValue(s.componentType,5123),s.type=AttributeType.SCALAR,i=getBinaryAccessor(s),s=i.createArrayBufferView(r.buffer,r.byteOffset+s.byteOffset,a));var c;if(Vi(u))for(Vi(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,5123),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),u=i.createArrayBufferView(r.buffer,r.byteOffset+u.byteOffset,a)),c=new Uint16Array(a),f=0,e=0;e<a;++e)c[e]=f,f+=u[e];Vi(l)&&Vi(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,5123),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),l=i.createArrayBufferView(r.buffer,r.byteOffset+l.byteOffset,f));var p=o.length;for(e=0;e<p;++e){var d=o[e].length,v=o[e].instances,m=getBinaryProperties(d,v,r);o[e].instances=combine(m,v)}var g=new Array(p).fill(0),y=new Uint16Array(a);for(e=0;e<a;++e)n=s[e],y[e]=g[n],++g[n];var _={classes:o,classIds:s,classIndexes:y,parentCounts:u,parentIndexes:c,parentIds:l};return AMe(_),_}function ff(t,r,e){if(t){var n=t.parentCounts,i=t.parentIds;return i?e(t,r):n>0?bMe(t,r,e):xMe(t,r,e)}}function bMe(t,r,e){var n=t.classIds,i=t.parentCounts,a=t.parentIds,o=t.parentIndexes,s=n.length,u=scratchVisited;u.length=Math.max(u.length,s);var l=++marker,f=scratchStack;for(f.length=0,f.push(r);f.length>0;)if(r=f.pop(),u[r]!==l){u[r]=l;var c=e(t,r);if(Vi(c))return c;for(var p=i[r],d=o[r],v=0;v<p;++v){var m=a[d+v];m!==r&&f.push(m)}}return null}function xMe(t,r,e){for(var n=!0;n;){var i=e(t,r);if(Vi(i))return i;var a=t.parentIds[r];n=a!==r,r=a}throw new Error("traverseHierarchySingleParent")}function AMe(t){for(var r=[],e=t.classIds,n=e.length,i=0;i<n;++i)oee(t,i,stack)}function oee(t,r,e){var n=t.parentCounts,i=t.parentIds,a=t.parentIndexes,o=t.classIds,s=o.length;if(Vi(i)){assert(r<s,"Parent index ".concat(r," exceeds the total number of instances: ").concat(s)),assert(e.indexOf(r)===-1,"Circular dependency detected in the batch table hierarchy."),e.push(r);for(var u=Vi(n)?n[r]:1,l=Vi(n)?a[r]:r,f=0;f<u;++f){var c=i[l+f];c!==r&&oee(t,c,e)}e.pop(r)}}function en(t){return t!=null}var R0=function(r,e){return r},TMe={HIERARCHY:!0,extensions:!0,extras:!0},L0=function(){function t(r,e,n){(0,uee.default)(this,t);var i,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};C(this,"json",void 0),C(this,"binary",void 0),C(this,"featureCount",void 0),C(this,"_extensions",void 0),C(this,"_properties",void 0),C(this,"_binaryProperties",void 0),C(this,"_hierarchy",void 0),Fe(n>=0),this.json=r||{},this.binary=e,this.featureCount=n,this._extensions=((i=this.json)===null||i===void 0?void 0:i.extensions)||{},this._properties={};for(var o in this.json)TMe[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),a["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=aee(this,this.json,this.binary))}return(0,lee.default)(t,[{key:"getExtension",value:function(e){return this.json&&this.json.extensions&&this.json.extensions[e]}},{key:"memorySizeInBytes",value:function(){return 0}},{key:"isClass",value:function(e,n){if(this._checkBatchId(e),Fe(typeof n=="string",n),this._hierarchy){var i=ff(this._hierarchy,e,function(a,o){var s=a.classIds[o],u=a.classes[s];return u.name===n});return en(i)}return!1}},{key:"isExactClass",value:function(e,n){return Fe(typeof n=="string",n),this.getExactClassName(e)===n}},{key:"getExactClassName",value:function(e){if(this._checkBatchId(e),this._hierarchy){var n=this._hierarchy.classIds[e],i=this._hierarchy.classes[n];return i.name}}},{key:"hasProperty",value:function(e,n){return this._checkBatchId(e),Fe(typeof n=="string",n),en(this._properties[n])||this._hasPropertyInHierarchy(e,n)}},{key:"getPropertyNames",value:function(e,n){var i;this._checkBatchId(e),n=en(n)?n:[],n.length=0;var a=Object.keys(this._properties);return(i=n).push.apply(i,(0,see.default)(a)),this._hierarchy&&this._getPropertyNamesInHierarchy(e,n),n}},{key:"getProperty",value:function(e,n){if(this._checkBatchId(e),Fe(typeof n=="string",n),this._binaryProperties){var i=this._binaryProperties[n];if(en(i))return this._getBinaryProperty(i,e)}var a=this._properties[n];if(en(a))return R0(a[e],!0);if(this._hierarchy){var o=this._getHierarchyProperty(e,n);if(en(o))return o}}},{key:"setProperty",value:function(e,n,i){var a=this.featureCount;if(this._checkBatchId(e),Fe(typeof n=="string",n),this._binaryProperties){var o=this._binaryProperties[n];if(o){this._setBinaryProperty(o,e,i);return}}if(!(this._hierarchy&&this._setHierarchyProperty(this,e,n,i))){var s=this._properties[n];en(s)||(this._properties[n]=new Array(a),s=this._properties[n]),s[e]=R0(i,!0)}}},{key:"_checkBatchId",value:function(e){var n=e>=0&&e<this.featureCount;if(!n)throw new Error("batchId not in range [0, featureCount - 1].")}},{key:"_getBinaryProperty",value:function(e,n){return e.unpack(e.typedArray,n)}},{key:"_setBinaryProperty",value:function(e,n,i){e.pack(i,e.typedArray,n)}},{key:"_initializeBinaryProperties",value:function(){var e=null;for(var n in this._properties){var i=this._properties[n],a=this._initializeBinaryProperty(n,i);a&&(e=e||{},e[n]=a)}return e}},{key:"_initializeBinaryProperty",value:function(e,n){if("byteOffset"in n){var i=n;Fe(this.binary,"Property ".concat(e," requires a batch table binary.")),Fe(i.type,"Property ".concat(e," requires a type."));var a=iee(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:a.values,componentCount:a.size,unpack:a.unpacker,pack:a.packer}}return null}},{key:"_hasPropertyInHierarchy",value:function(e,n){if(!this._hierarchy)return!1;var i=ff(this._hierarchy,e,function(a,o){var s=a.classIds[o],u=a.classes[s].instances;return en(u[n])});return en(i)}},{key:"_getPropertyNamesInHierarchy",value:function(e,n){ff(this._hierarchy,e,function(i,a){var o=i.classIds[a],s=i.classes[o].instances;for(var u in s)s.hasOwnProperty(u)&&n.indexOf(u)===-1&&n.push(u)})}},{key:"_getHierarchyProperty",value:function(e,n){var i=this;return ff(this._hierarchy,e,function(a,o){var s=a.classIds[o],u=a.classes[s],l=a.classIndexes[o],f=u.instances[n];return en(f)?en(f.typedArray)?i._getBinaryProperty(f,l):R0(f[l],!0):null})}},{key:"_setHierarchyProperty",value:function(e,n,i,a){var o=this,s=ff(this._hierarchy,n,function(u,l){var f=u.classIds[l],c=u.classes[f],p=u.classIndexes[l],d=c.instances[i];return en(d)?(Fe(l===n,'Inherited property "'.concat(i,'" is read-only.')),en(d.typedArray)?o._setBinaryProperty(d,p,a):d[p]=R0(a,!0),!0):!1});return en(s)}}]),t}();var lC=4;function Io(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=new DataView(r);if(t.magic=n.getUint32(e,!0),e+=lC,t.version=n.getUint32(e,!0),e+=lC,t.byteLength=n.getUint32(e,!0),e+=lC,t.version!==1)throw new Error("3D Tile Version ".concat(t.version," not supported"));return e}var cf=4,fee="b3dm tile in legacy format.";function pf(t,r,e){var n=new DataView(r),i;t.header=t.header||{};var a=n.getUint32(e,!0);e+=cf;var o=n.getUint32(e,!0);e+=cf;var s=n.getUint32(e,!0);e+=cf;var u=n.getUint32(e,!0);return e+=cf,s>=570425344?(e-=cf*2,i=a,s=o,u=0,a=0,o=0,console.warn(fee)):u>=570425344&&(e-=cf,i=s,s=a,u=o,a=0,o=0,console.warn(fee)),t.header.featureTableJsonByteLength=a,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=s,t.header.batchTableBinaryByteLength=u,t.header.batchLength=i,e}function hf(t,r,e,n){return e=SMe(t,r,e,n),e=PMe(t,r,e,n),e}function SMe(t,r,e,n){var i=t.header,a=i.featureTableJsonByteLength,o=i.featureTableBinaryByteLength,s=i.batchLength;if(t.featureTableJson={BATCH_LENGTH:s||0},a>0){var u=iC(r,e,a);t.featureTableJson=JSON.parse(u)}return e+=a,t.featureTableBinary=new Uint8Array(r,e,o),e+=o,e}function PMe(t,r,e,n){var i=t.header,a=i.batchTableJsonByteLength,o=i.batchTableBinaryByteLength;if(a>0){var s=iC(r,e,a);t.batchTableJson=JSON.parse(s),e+=a,o>0&&(t.batchTableBinary=new Uint8Array(r,e,o),t.batchTableBinary=new Uint8Array(t.batchTableBinary),e+=o)}return e}function fC(t,r,e){if(!r&&(!t||!t.batchIds||!e))return null;var n=t.batchIds,i=t.isRGB565,a=t.pointCount;if(n&&e){for(var o=new Uint8ClampedArray(a*3),s=0;s<a;s++){var u=n[s],l=e.getProperty(u,"dimensions"),f=l.map(function(v){return v*255});o[s*3]=f[0],o[s*3+1]=f[1],o[s*3+2]=f[2]}return{type:5121,value:o,size:3,normalized:!0}}if(i){for(var c=new Uint8ClampedArray(a*3),p=0;p<a;p++){var d=sC(r[p]);c[p*3]=d[0],c[p*3+1]=d[1],c[p*3+2]=d[2]}return{type:5121,value:c,size:3,normalized:!0}}return r&&r.length===a*3?{type:5121,value:r,size:3,normalized:!0}:{type:5121,value:r,size:4,normalized:!0}}var cee=new V;function pee(t,r){if(!r)return null;if(t.isOctEncoded16P){for(var e=new Float32Array(t.pointsLength*3),n=0;n<t.pointsLength;n++)uC(r[n*2],r[n*2+1],cee),cee.toArray(e,n*3);return{type:5126,size:2,value:e}}return{type:5126,size:2,value:r}}function hee(t,r,e){return t.isQuantized?e["3d-tiles"]&&e["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,wMe(t,r)):{type:5123,value:r,size:3,normalized:!0}:r}function wMe(t,r){for(var e=new V,n=new Float32Array(t.pointCount*3),i=0;i<t.pointCount;i++)e.set(r[i*3],r[i*3+1],r[i*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(n,i*3);return n}function dee(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Qs(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?dee(Object(e),!0).forEach(function(n){(0,vee.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):dee(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function mee(t,r,e,n,i){return cC.apply(this,arguments)}function cC(){return cC=(0,k0.default)(eu.default.mark(function t(r,e,n,i,a){var o,s,u;return eu.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return n=Io(r,e,n),n=pf(r,e,n),n=hf(r,e,n,i),OMe(r),o=EMe(r),s=o.featureTable,u=o.batchTable,f.next=7,LMe(r,s,u,i,a);case 7:return CMe(r,s,i),MMe(r,s,u),IMe(r,s),f.abrupt("return",n);case 11:case"end":return f.stop()}},t)})),cC.apply(this,arguments)}function OMe(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function EMe(t){var r=new lf(t.featureTableJson,t.featureTableBinary),e=r.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(e))throw new Error("POINTS_LENGTH must be defined");r.featuresLength=e,t.featuresLength=e,t.pointsLength=e,t.pointCount=e,t.rtcCenter=r.getGlobalProperty("RTC_CENTER",5126,3);var n=RMe(t,r);return{featureTable:r,batchTable:n}}function CMe(t,r,e){if(!t.attributes.positions){if(r.hasProperty("POSITION"))t.attributes.positions=r.getPropertyArray("POSITION",5126,3);else if(r.hasProperty("POSITION_QUANTIZED")){var n=r.getPropertyArray("POSITION_QUANTIZED",5123,3);if(t.isQuantized=!0,t.quantizedRange=(1<<16)-1,t.quantizedVolumeScale=r.getGlobalProperty("QUANTIZED_VOLUME_SCALE",5126,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=r.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",5126,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=hee(t,n,e)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function MMe(t,r,e){if(!t.attributes.colors){var n=null;r.hasProperty("RGBA")?(n=r.getPropertyArray("RGBA",5121,4),t.isTranslucent=!0):r.hasProperty("RGB")?n=r.getPropertyArray("RGB",5121,3):r.hasProperty("RGB565")&&(n=r.getPropertyArray("RGB565",5123,1),t.isRGB565=!0),t.attributes.colors=fC(t,n,e)}r.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=r.getGlobalProperty("CONSTANT_RGBA",5121,4))}function IMe(t,r){if(!t.attributes.normals){var e=null;r.hasProperty("NORMAL")?e=r.getPropertyArray("NORMAL",5126,3):r.hasProperty("NORMAL_OCT16P")&&(e=r.getPropertyArray("NORMAL_OCT16P",5121,2),t.isOctEncoded16P=!0),t.attributes.normals=pee(t,e)}}function RMe(t,r){var e=null;if(!t.batchIds&&r.hasProperty("BATCH_ID")&&(t.batchIds=r.getPropertyArray("BATCH_ID",5123,1),t.batchIds)){var n=r.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");var i=t.batchTableJson,a=t.batchTableBinary;e=new L0(i,a,n)}return e}function LMe(t,r,e,n,i){return pC.apply(this,arguments)}function pC(){return pC=(0,k0.default)(eu.default.mark(function t(r,e,n,i,a){var o,s,u,l,f,c,p,d;return eu.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(l=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"],l&&(u=l.properties),f=e.getExtension("3DTILES_draco_point_compression"),!f){m.next=15;break}if(s=f.properties,c=f.byteOffset,p=f.byteLength,!(!s||!Number.isFinite(c)||!p)){m.next=9;break}throw new Error("Draco properties, byteOffset, and byteLength must be defined");case 9:o=r.featureTableBinary.slice(c,c+p),r.hasPositions=Number.isFinite(s.POSITION),r.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),r.hasNormals=Number.isFinite(s.NORMAL),r.hasBatchIds=Number.isFinite(s.BATCH_ID),r.isTranslucent=Number.isFinite(s.RGBA);case 15:if(o){m.next=17;break}return m.abrupt("return",!0);case 17:return d={buffer:o,properties:Qs(Qs({},s),u),featureTableProperties:s,batchTableProperties:u,dequantizeInShader:!1},m.next=20,kMe(r,d,i,a);case 20:return m.abrupt("return",m.sent);case 21:case"end":return m.stop()}},t)})),pC.apply(this,arguments)}function kMe(t,r,e,n){return hC.apply(this,arguments)}function hC(){return hC=(0,k0.default)(eu.default.mark(function t(r,e,n,i){var a,o,s,u,l,f,c,p,d,v,m,g,y,_,b;return eu.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return a=i.parse,o=Qs(Qs({},n),{},{draco:Qs(Qs({},n.draco),{},{extraAttributes:e.batchTableProperties||{}})}),delete o["3d-tiles"],A.next=5,a(e.buffer,c0,o);case 5:if(s=A.sent,u=s.attributes.POSITION&&s.attributes.POSITION.value,l=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,f=s.attributes.NORMAL&&s.attributes.NORMAL.value,c=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,p=u&&s.attributes.POSITION.value.quantization,d=f&&s.attributes.NORMAL.value.quantization,p&&(v=s.POSITION.data.quantization,m=v.range,r.quantizedVolumeScale=new V(m,m,m),r.quantizedVolumeOffset=new V(v.minValues),r.quantizedRange=(1<<v.quantizationBits)-1,r.isQuantizedDraco=!0),d&&(r.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0),g={},e.batchTableProperties)for(y=0,_=Object.keys(e.batchTableProperties);y<_.length;y++)b=_[y],s.attributes[b]&&s.attributes[b].value&&(g[b.toLowerCase()]=s.attributes[b].value);r.attributes=Qs({positions:u,colors:fC(r,l,void 0),normals:f,batchIds:c},g);case 17:case"end":return A.stop()}},t)})),hC.apply(this,arguments)}var yee=h(ge()),mC=h(de());var gee=h(ge()),dC=h(de());var B0={URI:0,EMBEDDED:1};function F0(t,r,e,n){t.rotateYtoZ=!0;var i=t.byteOffset+t.byteLength-e;if(i===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=Wo(r,e,i),t.gltfByteOffset=0,t.gltfByteLength=i,e%4===0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}function D0(t,r,e,n){return vC.apply(this,arguments)}function vC(){return vC=(0,gee.default)(dC.default.mark(function t(r,e,n,i){var a,o,s;return dC.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(a=n["3d-tiles"]||{},BMe(r,e,n),!a.loadGLTF){l.next=16;break}if(o=i.parse,s=i.fetch,!r.gltfUrl){l.next=9;break}return l.next=7,s(r.gltfUrl,n);case 7:r.gltfArrayBuffer=l.sent,r.gltfByteOffset=0;case 9:if(!r.gltfArrayBuffer){l.next=16;break}return l.next=12,o(r.gltfArrayBuffer,Ia,n,i);case 12:r.gltf=l.sent,delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;case 16:case"end":return l.stop()}},t)})),vC.apply(this,arguments)}function BMe(t,r,e){switch(r){case B0.URI:var n=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),i=new TextDecoder,a=i.decode(n);t.gltfUrl=a.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case B0.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}function _ee(t,r,e,n,i){return gC.apply(this,arguments)}function gC(){return gC=(0,yee.default)(mC.default.mark(function t(r,e,n,i,a){var o,s;return mC.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n=FMe(r,e,n,i,a),l.next=3,D0(r,B0.EMBEDDED,i,a);case 3:return s=r==null||(o=r.gltf)===null||o===void 0?void 0:o.extensions,s&&s.CESIUM_RTC&&(r.rtcCenter=s.CESIUM_RTC.center),l.abrupt("return",n);case 6:case"end":return l.stop()}},t)})),gC.apply(this,arguments)}function FMe(t,r,e,n,i){e=Io(t,r,e),e=pf(t,r,e),e=hf(t,r,e,n),e=F0(t,r,e,n);var a=new lf(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=a.getGlobalProperty("RTC_CENTER",5126,3),e}var bee=h(ge()),yC=h(de());function xee(t,r,e,n,i){return _C.apply(this,arguments)}function _C(){return _C=(0,bee.default)(yC.default.mark(function t(r,e,n,i,a){return yC.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=DMe(r,e,n,i,a),s.next=3,D0(r,r.gltfFormat,i,a);case 3:return s.abrupt("return",n);case 4:case"end":return s.stop()}},t)})),_C.apply(this,arguments)}function DMe(t,r,e,n,i){if(e=Io(t,r,e),t.version!==1)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));e=pf(t,r,e);var a=new DataView(r);if(t.gltfFormat=a.getUint32(e,!0),e+=4,e=hf(t,r,e,n),e=F0(t,r,e,n),t.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");var o=new lf(t.featureTableJson,t.featureTableBinary),s=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",5126,3);var u=new L0(t.batchTableJson,t.batchTableBinary,s);return NMe(t,o,u,s),e}function NMe(t,r,e,n){for(var i={instances:new Array(n),batchTable:t._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]},a=i.instances,o=new V,s=new V,u=new V,l=new V,f=new lt,c=new Ti,p=new V,d={},v=new ce,m=[],g=[],y=new V,_=new V,b=0;b<n;b++){var x=void 0;if(r.hasProperty("POSITION"))x=r.getProperty("POSITION",5126,3,b,o);else if(r.hasProperty("POSITION_QUANTIZED")){x=r.getProperty("POSITION_QUANTIZED",5123,3,b,o);var A=r.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",5126,3,y);if(!A)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var T=r.getGlobalProperty("QUANTIZED_VOLUME_SCALE",5126,3,_);if(!T)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var O=65535,w=0;w<3;w++)x[w]=x[w]/O*T[w]+A[w]}if(!x)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");o.copy(x),d.translation=o,t.normalUp=r.getProperty("NORMAL_UP",5126,3,b,m),t.normalRight=r.getProperty("NORMAL_RIGHT",5126,3,b,g);var E=!1;if(t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=r.getProperty("NORMAL_UP_OCT32P",5123,2,m),t.octNormalRight=r.getProperty("NORMAL_RIGHT_OCT32P",5123,2,g),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(st.WGS84.eastNorthUpToFixedFrame(o,v),v.getRotationMatrix3(f)):f.identity()}E&&(l.copy(s).cross(u).normalize(),f.setColumn(0,s),f.setColumn(1,u),f.setColumn(2,l)),c.fromMatrix3(f),d.rotation=c,p.set(1,1,1);var S=r.getProperty("SCALE",5126,1,b);Number.isFinite(S)&&p.multiplyByScalar(S);var I=r.getProperty("SCALE_NON_UNIFORM",5126,3,b,m);I&&p.scale(I),d.scale=p;var R=r.getProperty("BATCH_ID",5123,1,b);R===void 0&&(R=b);var z=new ce().fromQuaternion(d.rotation);v.identity(),v.translate(d.translation),v.multiplyRight(z),v.scale(d.scale);var G=v.clone();a[b]={modelMatrix:G,batchId:R}}t.instances=a}var Aee=h(ge()),bC=h(de());function Tee(t,r,e,n,i,a){return xC.apply(this,arguments)}function xC(){return xC=(0,Aee.default)(bC.default.mark(function t(r,e,n,i,a,o){var s,u;return bC.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:n=Io(r,e,n),s=new DataView(e),r.tilesLength=s.getUint32(n,!0),n+=4,r.tiles=[];case 5:if(!(r.tiles.length<r.tilesLength&&r.byteLength-n>12)){f.next=13;break}return u={},r.tiles.push(u),f.next=10,o(e,n,i,a,u);case 10:n=f.sent,f.next=5;break;case 13:return f.abrupt("return",n);case 14:case"end":return f.stop()}},t)})),xC.apply(this,arguments)}var See=h(ge()),AC=h(de());function Pee(t,r,e,n){return TC.apply(this,arguments)}function TC(){return TC=(0,See.default)(AC.default.mark(function t(r,e,n,i){var a;return AC.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r.rotateYtoZ=!0,r.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",a=i.parse,s.next=5,a(e,Ia,n,i);case 5:r.gltf=s.sent;case 6:case"end":return s.stop()}},t)})),TC.apply(this,arguments)}function wC(t){return PC.apply(this,arguments)}function PC(){return PC=(0,wee.default)(SC.default.mark(function t(r){var e,n,i,a,o=arguments;return SC.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:e=o.length>1&&o[1]!==void 0?o[1]:0,n=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,a=o.length>4&&o[4]!==void 0?o[4]:{},a.byteOffset=e,a.type=YQ(r,e),u.t0=a.type,u.next=u.t0===Zs.COMPOSITE?9:u.t0===Zs.BATCHED_3D_MODEL?12:u.t0===Zs.GLTF?15:u.t0===Zs.INSTANCED_3D_MODEL?18:u.t0===Zs.POINT_CLOUD?21:24;break;case 9:return u.next=11,Tee(a,r,e,n,i,wC);case 11:return u.abrupt("return",u.sent);case 12:return u.next=14,_ee(a,r,e,n,i);case 14:return u.abrupt("return",u.sent);case 15:return u.next=17,Pee(a,r,n,i);case 17:return u.abrupt("return",u.sent);case 18:return u.next=20,xee(a,r,e,n,i);case 20:return u.abrupt("return",u.sent);case 21:return u.next=23,mee(a,r,e,n,i);case 23:return u.abrupt("return",u.sent);case 24:throw new Error("3DTileLoader: unknown type ".concat(a.type));case 25:case"end":return u.stop()}},t)})),PC.apply(this,arguments)}var U0=h(ge()),ru=h(de());var MC=h(ge()),Zh=h(de()),jMe=1952609651,UMe=1;function IC(t,r,e){return EC.apply(this,arguments)}function EC(){return EC=(0,MC.default)(Zh.default.mark(function t(r,e,n){var i,a,o,s,u,l,f,c,p;return Zh.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(i=new Uint32Array(r.slice(0,4)),i[0]===jMe){v.next=3;break}throw new Error("Wrong subtree file magic number");case 3:if(a=new Uint32Array(r.slice(4,8)),a[0]===UMe){v.next=6;break}throw new Error("Wrong subtree file verson, must be 1");case 6:if(o=Oee(r.slice(8,16)),s=new Uint8Array(r,24,o),u=new TextDecoder("utf8"),l=u.decode(s),f=JSON.parse(l),c=Oee(r.slice(16,24)),p=new ArrayBuffer(0),c&&(p=r.slice(24+o)),!("bufferView"in f.tileAvailability)){v.next=18;break}return v.next=17,OC(f,"tileAvailability",p,n);case 17:f.tileAvailability.explicitBitstream=v.sent;case 18:if(!("bufferView"in f.contentAvailability)){v.next=22;break}return v.next=21,OC(f,"contentAvailability",p,n);case 21:f.contentAvailability.explicitBitstream=v.sent;case 22:if(!("bufferView"in f.childSubtreeAvailability)){v.next=26;break}return v.next=25,OC(f,"childSubtreeAvailability",p,n);case 25:f.childSubtreeAvailability.explicitBitstream=v.sent;case 26:return v.abrupt("return",f);case 27:case"end":return v.stop()}},t)})),EC.apply(this,arguments)}function GMe(t,r){var e=r.startsWith("http");if(e){var n=new URL(t,r);return decodeURI(n.toString())}var i="http://".concat(r),a=new URL(t,i);return"/".concat(a.host).concat(a.pathname)}function OC(t,r,e,n){return CC.apply(this,arguments)}function CC(){return CC=(0,MC.default)(Zh.default.mark(function t(r,e,n,i){var a,o,s,u,l,f;return Zh.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(a=r[e].bufferView,o=r.bufferViews[a],s=r.buffers[o.buffer],!(!(i!=null&&i.url)||!i.fetch)){p.next=5;break}throw new Error("Url is not provided");case 5:if(i.fetch){p.next=7;break}throw new Error("fetch is not provided");case 7:if(!s.uri){p.next=16;break}return u=GMe(s.uri,i?.url),p.next=11,i.fetch(u);case 11:return l=p.sent,p.next=14,l.arrayBuffer();case 14:return f=p.sent,p.abrupt("return",new Uint8Array(f,o.byteOffset,o.byteLength));case 16:return p.abrupt("return",new Uint8Array(n,o.byteOffset,o.byteLength));case 17:case"end":return p.stop()}},t)})),CC.apply(this,arguments)}function Oee(t){var r=new DataView(t),e=r.getUint32(0,!0),n=r.getUint32(4,!0);return e+Math.pow(2,32)*n}var N0={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:I0,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:IC,options:{}};var Eee=h(ye()),Cee=h(ge()),LC=h(de());var zMe=4,VMe=8,HMe={QUADTREE:zMe,OCTREE:VMe};function BC(t){return kC.apply(this,arguments)}function kC(){return kC=(0,Cee.default)(LC.default.mark(function t(r){var e,n,i,a,o,s,u,l,f,c,p,d,v,m,g,y,_,b,x,A,T,O,w,E,S,I,R,z,G,k,U,j,X,H,Q,ne,le,xe,we,ze,me,$e,Le,Pt;return LC.default.wrap(function(wt){for(;;)switch(wt.prev=wt.next){case 0:if(e=r.options,n=r.parentData,i=n===void 0?{mortonIndex:0,x:0,y:0,z:0}:n,a=r.childIndex,o=a===void 0?0:a,s=r.globalData,u=s===void 0?{level:0,mortonIndex:0,x:0,y:0,z:0}:s,l=r.subtree,f=r.level,c=f===void 0?0:f,p=e.subdivisionScheme,d=e.subtreeLevels,v=e.maximumLevel,m=e.contentUrlTemplate,g=e.subtreesUriTemplate,y=e.basePath,_={children:[],lodMetricValue:0,contentUrl:""},b=HMe[p],x=o&1,A=o>>1&1,T=o>>2&1,O=(Math.pow(b,c)-1)/(b-1),w=tu(i.mortonIndex,o),E=O+w,S=tu(i.x,x),I=tu(i.y,A),R=tu(i.z,T),z=!1,c+1>d&&(z=RC(l.childSubtreeAvailability,w)),G=tu(u.x,S),k=tu(u.y,I),U=tu(u.z,R),j=c+u.level,!z){wt.next=38;break}return X="".concat(y,"/").concat(g),H=j0(X,j,G,k,U),wt.next=25,qt(H,N0);case 25:Q=wt.sent,l=Q,u.mortonIndex=w,u.x=S,u.y=I,u.z=R,u.level=c,w=0,E=0,S=0,I=0,R=0,c=0;case 38:if(ne=RC(l.tileAvailability,E),!(!ne||c>v)){wt.next=41;break}return wt.abrupt("return",_);case 41:le=RC(l.contentAvailability,E),le&&(_.contentUrl=j0(m,j,G,k,U)),xe=c+1,we={mortonIndex:w,x:S,y:I,z:R},ze=0;case 46:if(!(ze<b)){wt.next=54;break}return wt.next=49,BC({subtree:l,options:e,parentData:we,childIndex:ze,level:xe,globalData:u});case 49:me=wt.sent,(me.contentUrl||me.children.length)&&($e=j+1,Le={childTileX:S,childTileY:I,childTileZ:R},Pt=WMe(me,$e,Le,e),_.children.push(Pt));case 51:ze++,wt.next=46;break;case 54:return wt.abrupt("return",_);case 55:case"end":return wt.stop()}},t)})),kC.apply(this,arguments)}function RC(t,r){return"constant"in t?Boolean(t.constant):t.explicitBitstream?qMe(r,t.explicitBitstream):!1}function WMe(t,r,e,n){var i=n.basePath,a=n.refine,o=n.getRefine,s=n.lodMetricType,u=n.getTileType,l=n.rootLodMetricValue,f=n.rootBoundingVolume,c=t.contentUrl&&t.contentUrl.replace("".concat(i,"/"),""),p=l/Math.pow(2,r),d=$Me(r,f,e);return{children:t.children,contentUrl:t.contentUrl,content:{uri:c},id:t.contentUrl,refine:o(a),type:u(t),lodMetricType:s,lodMetricValue:p,geometricError:p,transform:t.transform,boundingVolume:d}}function $Me(t,r,e){if(r.region){var n=e.childTileX,i=e.childTileY,a=e.childTileZ,o=(0,Eee.default)(r.region,6),s=o[0],u=o[1],l=o[2],f=o[3],c=o[4],p=o[5],d=Math.pow(2,t),v=(l-s)/d,m=(f-u)/d,g=(p-c)/d,y=s+v*n,_=s+v*(n+1),b=u+m*i,x=u+m*(i+1),A=c+g*a,T=c+g*(a+1);return{region:[y,b,_,x,A,T]}}return console.warn("Unsupported bounding volume type: ",r),null}function tu(t,r){return parseInt(t.toString(2)+r.toString(2),2)}function j0(t,r,e,n,i){var a=XMe({level:r,x:e,y:n,z:i});return t.replace(/{level}|{x}|{y}|{z}/gi,function(o){return a[o]})}function XMe(t){var r={};for(var e in t)r["{".concat(e,"}")]=t[e];return r}function qMe(t,r){var e=Math.floor(t/8),n=t%8,i=r[e]>>n&1;return i===1}function YMe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=KMe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function KMe(t,r){if(t){if(typeof t=="string")return Mee(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Mee(t,r)}}function Mee(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function UC(t){if(!t.contentUrl)return Fa.EMPTY;var r=t.contentUrl,e=r.split(".").pop();switch(e){case"pnts":return Fa.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Fa.SCENEGRAPH;default:return e}}function GC(t){switch(t){case"REPLACE":case"replace":return Qr.REPLACE;case"ADD":case"add":return Qr.ADD;default:return t}}function FC(t,r){var e=/^[a-z][0-9a-z+.-]*:/i;if(e.test(r)){var n=new URL(t,"".concat(r,"/"));return decodeURI(n.toString())}else if(t.startsWith("/"))return t;return"".concat(r,"/").concat(t)}function Iee(t,r){if(!t)return null;if(t.content){var e=t.content.uri||t.content.url;t.contentUrl=FC(e,r.basePath)}return t.id=t.contentUrl,t.lodMetricType=Ys.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=UC(t),t.refine=GC(t.refine),t}function kee(t,r){return DC.apply(this,arguments)}function DC(){return DC=(0,U0.default)(ru.default.mark(function t(r,e){var n,i,a,o,s,u,l,f,c,p;return ru.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(n=r.basePath,a=Lee(r?.root),!(a&&r.root)){v.next=8;break}return v.next=5,Ree(r.root,r,a,e);case 5:i=v.sent,v.next=9;break;case 8:i=Iee(r.root,r);case 9:o=[],o.push(i);case 11:if(!(o.length>0)){v.next=40;break}s=o.pop()||{},u=s.children||[],l=YMe(u),v.prev=15,l.s();case 17:if((f=l.n()).done){v.next=30;break}if(c=f.value,p=Lee(c),!p){v.next=26;break}return v.next=23,Ree(c,r,p,e);case 23:c=v.sent,v.next=27;break;case 26:Iee(c,{basePath:n});case 27:o.push(c);case 28:v.next=17;break;case 30:v.next=35;break;case 32:v.prev=32,v.t0=v.catch(15),l.e(v.t0);case 35:return v.prev=35,l.f(),v.finish(35);case 38:v.next=11;break;case 40:return v.abrupt("return",i);case 41:case"end":return v.stop()}},t,null,[[15,32,35,38]])})),DC.apply(this,arguments)}function Ree(t,r,e,n){return NC.apply(this,arguments)}function NC(){return NC=(0,U0.default)(ru.default.mark(function t(r,e,n,i){var a,o,s,u,l,f,c,p,d,v,m,g,y,_;return ru.default.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=e.basePath,s=n.subdivisionScheme,u=n.maximumLevel,l=n.subtreeLevels,f=n.subtrees.uri,c=j0(f,0,0,0,0),p=FC(c,o),x.next=6,qt(p,N0,i);case 6:return d=x.sent,v=FC(r.content.uri,o),m=e==null||(a=e.root)===null||a===void 0?void 0:a.refine,g=r.geometricError,y=r.boundingVolume,_={contentUrlTemplate:v,subtreesUriTemplate:f,subdivisionScheme:s,subtreeLevels:l,maximumLevel:u,refine:m,basePath:o,lodMetricType:Ys.GEOMETRIC_ERROR,rootLodMetricValue:g,rootBoundingVolume:y,getTileType:UC,getRefine:GC},x.next=14,JMe(r,d,_);case 14:return x.abrupt("return",x.sent);case 15:case"end":return x.stop()}},t)})),NC.apply(this,arguments)}function JMe(t,r,e){return jC.apply(this,arguments)}function jC(){return jC=(0,U0.default)(ru.default.mark(function t(r,e,n){var i,a,o;return ru.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(r){u.next=2;break}return u.abrupt("return",null);case 2:return r.lodMetricType=Ys.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform,u.next=7,BC({subtree:e,options:n});case 7:return i=u.sent,a=i.children,o=i.contentUrl,o&&(r.contentUrl=o,r.content={uri:o.replace("".concat(n.basePath,"/"),"")}),r.refine=GC(r.refine),r.type=UC(r),r.children=a,r.id=r.contentUrl,u.abrupt("return",r);case 16:case"end":return u.stop()}},t)})),jC.apply(this,arguments)}function Lee(t){var r;return(t==null||(r=t.extensions)===null||r===void 0?void 0:r["3DTILES_implicit_tiling"])||t?.implicitTiling}var z0={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:I0,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:t2e,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function ZMe(t){return Ha.dirname(t.url)}function QMe(t,r,e){return zC.apply(this,arguments)}function zC(){return zC=(0,G0.default)(nu.default.mark(function t(r,e,n){var i,a;return nu.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i={content:{featureIds:null}},a=0,s.next=4,wC(r,a,e,n,i.content);case 4:return s.abrupt("return",i.content);case 5:case"end":return s.stop()}},t)})),zC.apply(this,arguments)}function e2e(t,r,e){return VC.apply(this,arguments)}function VC(){return VC=(0,G0.default)(nu.default.mark(function t(r,e,n){var i,a;return nu.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=JSON.parse(new TextDecoder().decode(r)),a.loader=e.loader||z0,a.url=n.url,a.basePath=ZMe(a),s.next=6,kee(a,e);case 6:return a.root=s.sent,a.type=Tr.TILES3D,a.lodMetricType=Ys.GEOMETRIC_ERROR,a.lodMetricValue=((i=a.root)===null||i===void 0?void 0:i.lodMetricValue)||0,s.abrupt("return",a);case 11:case"end":return s.stop()}},t)})),VC.apply(this,arguments)}function t2e(t,r,e){return HC.apply(this,arguments)}function HC(){return HC=(0,G0.default)(nu.default.mark(function t(r,e,n){var i,a;return nu.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(i=e["3d-tiles"]||{},i.isTileset==="auto"?a=n.url&&n.url.indexOf(".json")!==-1:a=i.isTileset,!a){s.next=8;break}return s.next=5,e2e(r,e,n);case 5:r=s.sent,s.next=11;break;case 8:return s.next=10,QMe(r,e,n);case 10:r=s.sent;case 11:return s.abrupt("return",r);case 12:case"end":return s.stop()}},t)})),HC.apply(this,arguments)}function Bee(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function df(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Bee(Object(e),!0).forEach(function(n){(0,Qh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Bee(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function r2e(t){var r=n2e();return function(){var n=(0,WC.default)(t),i;if(r){var a=(0,WC.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,zee.default)(this,i)}}function n2e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Fee=[0],i2e={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:z0,onTilesetLoad:{type:"function",value:function(r){}},onTileLoad:{type:"function",value:function(r){}},onTileUnload:{type:"function",value:function(r){}},onTileError:{type:"function",value:function(r,e,n){}},_getMeshColor:{type:"function",value:function(r){return[255,255,255]}}},V0=function(t){(0,Gee.default)(e,t);var r=r2e(e);function e(){var n;(0,Nee.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Qh.default)((0,Uee.default)(n),"state",void 0),n}return(0,jee.default)(e,[{key:"initializeState",value:function(){"onTileLoadFail"in this.props&&Z.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}},{key:"isLoaded",get:function(){var i=this.state.tileset3d;return i!==null&&i.isLoaded()}},{key:"shouldUpdateState",value:function(i){var a=i.changeFlags;return a.somethingChanged}},{key:"updateState",value:function(i){var a=i.props,o=i.oldProps,s=i.changeFlags;if(a.data&&a.data!==o.data&&this._loadTileset(a.data),s.viewportChanged){var u=this.state.activeViewports,l=Object.keys(u).length;l&&(this._updateTileset(u),this.state.lastUpdatedViewports=u,this.state.activeViewports={})}if(s.propsChanged){var f=this.state.layerMap;for(var c in f)f[c].needsUpdate=!0}}},{key:"activateViewport",value:function(i){var a=this.state,o=a.activeViewports,s=a.lastUpdatedViewports;this.internalState.viewport=i,o[i.id]=i;var u=s?.[i.id];(!u||!i.equals(u))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}},{key:"getPickingInfo",value:function(i){var a=i.info,o=i.sourceLayer,s=o&&o.props.tile;return a.picked&&(a.object=s),a.sourceTile=s,a}},{key:"filterSubLayer",value:function(i){var a=i.layer,o=i.viewport,s=a.props,u=s.tile,l=o.id;return u.selected&&u.viewportIds.includes(l)}},{key:"_updateAutoHighlight",value:function(i){var a=i.sourceTile,o=this.state.layerMap[a?.id];o&&o.layer&&o.layer.updateAutoHighlight(i)}},{key:"_loadTileset",value:function(){var n=(0,Dee.default)($C.default.mark(function a(o){var s,u,l,f,c,p,d;return $C.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(s=this.props.loadOptions,u=s===void 0?{}:s,l=this.props.loader||this.props.loaders,Array.isArray(l)&&(l=l[0]),f={loadOptions:df({},u)},!l.preload){m.next=10;break}return m.next=7,l.preload(o,u);case 7:c=m.sent,c.headers&&(f.loadOptions.fetch=df(df({},f.loadOptions.fetch),{},{headers:c.headers})),Object.assign(f,c);case 10:return m.next=12,qt(o,l,f.loadOptions);case 12:p=m.sent,d=new nC(p,df({onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError},f)),this.setState({tileset3d:d,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(d);case 17:case"end":return m.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"_onTileLoad",value:function(i){var a=this.state.lastUpdatedViewports;this.props.onTileLoad(i),this._updateTileset(a),this.setNeedsUpdate()}},{key:"_onTileUnload",value:function(i){delete this.state.layerMap[i.id],this.props.onTileUnload(i)}},{key:"_updateTileset",value:function(i){var a=this;if(i){var o=this.state.tileset3d,s=this.context.timeline,u=Object.keys(i).length;!s||!u||!o||o.selectTiles(Object.values(i)).then(function(l){var f=a.state.frameNumber!==l;f&&a.setState({frameNumber:l})})}}},{key:"_getSubLayer",value:function(i,a){if(!i.content)return null;switch(i.type){case Fa.POINTCLOUD:return this._makePointCloudLayer(i,a);case Fa.SCENEGRAPH:return this._make3DModelLayer(i);case Fa.MESH:return this._makeSimpleMeshLayer(i,a);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(i.content.type))}}},{key:"_makePointCloudLayer",value:function(i,a){var o=i.content,s=o.attributes,u=o.pointCount,l=o.constantRGBA,f=o.cartographicOrigin,c=o.modelMatrix,p=s.positions,d=s.normals,v=s.colors;if(!p)return null;var m=a&&a.props.data||{header:{vertexCount:u},attributes:{POSITION:p,NORMAL:d,COLOR_0:v}},g=this.props,y=g.pointSize,_=g.getPointColor,b=this.getSubLayerClass("pointcloud",Rl);return new b({pointSize:y},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(i.id),tile:i,data:m,coordinateSystem:se.METER_OFFSETS,coordinateOrigin:f,modelMatrix:c,getColor:l||_,_offset:0})}},{key:"_make3DModelLayer",value:function(i){var a=i.content,o=a.gltf,s=a.instances,u=a.cartographicOrigin,l=a.modelMatrix,f=this.getSubLayerClass("scenegraph",nf);return new f({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(i.id),tile:i,data:s||Fee,scenegraph:o,coordinateSystem:se.METER_OFFSETS,coordinateOrigin:u,modelMatrix:l,getTransformMatrix:function(p){return p.modelMatrix},getPosition:[0,0,0],_offset:0})}},{key:"_makeSimpleMeshLayer",value:function(i,a){var o=i.content,s=o.attributes,u=o.indices,l=o.modelMatrix,f=o.cartographicOrigin,c=o.coordinateSystem,p=c===void 0?se.METER_OFFSETS:c,d=o.material,v=o.featureIds,m=this.props._getMeshColor,g=a&&a.props.mesh||new Ce({drawMode:4,attributes:a2e(s),indices:u}),y=this.getSubLayerClass("mesh",m0);return new y(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(i.id),tile:i,mesh:g,data:Fee,getColor:m(i),pbrMaterial:d,modelMatrix:l,coordinateOrigin:f,coordinateSystem:p,featureIds:v,_offset:0})}},{key:"renderLayers",value:function(){var i=this,a=this.state,o=a.tileset3d,s=a.layerMap;return o?o.tiles.map(function(u){var l=s[u.id]=s[u.id]||{tile:u},f=l.layer;return u.selected&&(f?l.needsUpdate&&(f=i._getSubLayer(u,f),l.needsUpdate=!1):f=i._getSubLayer(u)),l.layer=f,f}).filter(Boolean):null}}]),e}(St);(0,Qh.default)(V0,"defaultProps",i2e);(0,Qh.default)(V0,"layerName","Tile3DLayer");function a2e(t){var r={};return r.positions=df(df({},t.positions),{},{value:new Float32Array(t.positions.value)}),t.normals&&(r.normals=t.normals),t.texCoords&&(r.texCoords=t.texCoords),t.colors&&(r.colors=t.colors),t.uvRegions&&(r.uvRegions=t.uvRegions),r}var eM=h(dr()),ute=h(ye()),lte=h(L()),fte=h(N()),cte=h(_e()),pte=h(Y()),hte=h(K()),tM=h(q()),nd=h(B());var nte=h(ge()),ite=h(B()),QC=h(de());var Wee=h(ye());var Hee=h(ye());function o2e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=s2e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function s2e(t,r){if(t){if(typeof t=="string")return Vee(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Vee(t,r)}}function Vee(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var u2e=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function XC(t){return t>>1^-(t&1)}function l2e(t){var r=0,e={},n=o2e(u2e),i;try{for(n.s();!(i=n.n()).done;){var a=(0,Hee.default)(i.value,2),o=a[0],s=a[1],u=s===8?t.getFloat64:t.getFloat32;e[o]=u.call(t,r,!0),r+=s}}catch(l){n.e(l)}finally{n.f()}return{header:e,headerEndPosition:r}}function f2e(t,r){var e=r,n=3,i=t.getUint32(e,!0),a=new Uint16Array(i*n);e+=Uint32Array.BYTES_PER_ELEMENT;for(var o=Uint16Array.BYTES_PER_ELEMENT,s=i*o,u=e,l=u+s,f=l+s,c=0,p=0,d=0,v=0;v<i;v++)c+=XC(t.getUint16(u+o*v,!0)),p+=XC(t.getUint16(l+o*v,!0)),d+=XC(t.getUint16(f+o*v,!0)),a[v]=c,a[v+i]=p,a[v+i*2]=d;return e+=s*3,{vertexData:a,vertexDataEndPosition:e}}function ed(t,r,e,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a;if(n===2?a=new Uint16Array(t,r,e):a=new Uint32Array(t,r,e),!i)return a;for(var o=0,s=0;s<a.length;++s){var u=a[s];a[s]=o-u,u===0&&++o}return a}function c2e(t,r,e){var n=e,i=3,a=r.length/i,o=a>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;n%o!==0&&(n+=o-n%o);var s=t.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var u=s*3,l=ed(t.buffer,n,u,o);return n+=u*o,{triangleIndicesEndPosition:n,triangleIndices:l}}function p2e(t,r,e){var n=e,i=3,a=r.length/i,o=a>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,s=t.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var u=ed(t.buffer,n,s,o,!1);n+=s*o;var l=t.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var f=ed(t.buffer,n,l,o,!1);n+=l*o;var c=t.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var p=ed(t.buffer,n,c,o,!1);n+=c*o;var d=t.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var v=ed(t.buffer,n,d,o,!1);return n+=d*o,{edgeIndicesEndPosition:n,westIndices:u,southIndices:f,eastIndices:p,northIndices:v}}function h2e(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function d2e(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function v2e(t,r){var e={};if(t.byteLength<=r)return{extensions:e,extensionsEndPosition:r};for(var n=r;n<t.byteLength;){var i=t.getUint8(n,!0);n+=Uint8Array.BYTES_PER_ELEMENT;var a=t.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var o=new DataView(t.buffer,n,a);switch(i){case 1:{e.vertexNormals=h2e(o);break}case 2:{e.waterMask=d2e(o);break}default:}n+=a}return{extensions:e,extensionsEndPosition:n}}var iu={header:0,vertices:1,triangleIndices:2,edgeIndices:3,extensions:4},m2e={maxDecodingStep:iu.extensions};function qC(t,r){var e=Object.assign({},m2e,r),n=new DataView(t),i=l2e(n),a=i.header,o=i.headerEndPosition;if(e.maxDecodingStep<iu.vertices)return{header:a};var s=f2e(n,o),u=s.vertexData,l=s.vertexDataEndPosition;if(e.maxDecodingStep<iu.triangleIndices)return{header:a,vertexData:u};var f=c2e(n,u,l),c=f.triangleIndices,p=f.triangleIndicesEndPosition;if(e.maxDecodingStep<iu.edgeIndices)return{header:a,vertexData:u,triangleIndices:c};var d=p2e(n,u,p),v=d.westIndices,m=d.southIndices,g=d.eastIndices,y=d.northIndices,_=d.edgeIndicesEndPosition;if(e.maxDecodingStep<iu.extensions)return{header:a,vertexData:u,triangleIndices:c,westIndices:v,northIndices:y,eastIndices:g,southIndices:m};var b=v2e(n,_),x=b.extensions;return{header:a,vertexData:u,triangleIndices:c,westIndices:v,northIndices:y,eastIndices:g,southIndices:m,extensions:x}}var td=h(dr());function H0(t,r,e,n){for(var i=n?y2e(n,t.POSITION.value):g2e(r),a=new t.POSITION.value.constructor(i.length*6),o=new t.TEXCOORD_0.value.constructor(i.length*4),s=new r.constructor(i.length*6),u=0;u<i.length;u++){var l=i[u];_2e({edge:l,edgeIndex:u,attributes:t,skirtHeight:e,newPosition:a,newTexcoord0:o,newTriangles:s})}t.POSITION.value=oc(t.POSITION.value,a),t.TEXCOORD_0.value=oc(t.TEXCOORD_0.value,o);var f=r instanceof Array?r.concat(s):oc(r,s);return{attributes:t,triangles:f}}function g2e(t){for(var r=[],e=0;e<t.length;e+=3)r.push([t[e],t[e+1]]),r.push([t[e+1],t[e+2]]),r.push([t[e+2],t[e]]);r.sort(function(s,u){return Math.min.apply(Math,(0,td.default)(s))-Math.min.apply(Math,(0,td.default)(u))||Math.max.apply(Math,(0,td.default)(s))-Math.max.apply(Math,(0,td.default)(u))});for(var n=[],i=0;i<r.length;){var a,o;r[i][0]===((a=r[i+1])===null||a===void 0?void 0:a[1])&&r[i][1]===((o=r[i+1])===null||o===void 0?void 0:o[0])?i+=2:(n.push(r[i]),i++)}return n}function y2e(t,r){t.westIndices.sort(function(o,s){return r[3*o+1]-r[3*s+1]}),t.eastIndices.sort(function(o,s){return r[3*s+1]-r[3*o+1]}),t.southIndices.sort(function(o,s){return r[3*s]-r[3*o]}),t.northIndices.sort(function(o,s){return r[3*o]-r[3*s]});var e=[];for(var n in t)for(var i=t[n],a=0;a<i.length-1;a++)e.push([i[a],i[a+1]]);return e}function _2e(t){var r=t.edge,e=t.edgeIndex,n=t.attributes,i=t.skirtHeight,a=t.newPosition,o=t.newTexcoord0,s=t.newTriangles,u=n.POSITION.value.length,l=e*2,f=e*2+1;a.set(n.POSITION.value.subarray(r[0]*3,r[0]*3+3),l*3),a[l*3+2]=a[l*3+2]-i,a.set(n.POSITION.value.subarray(r[1]*3,r[1]*3+3),f*3),a[f*3+2]=a[f*3+2]-i,o.set(n.TEXCOORD_0.value.subarray(r[0]*2,r[0]*2+2),l*2),o.set(n.TEXCOORD_0.value.subarray(r[1]*2,r[1]*2+2),f*2);var c=e*2*3;s[c]=r[0],s[c+1]=u/3+f,s[c+2]=r[1],s[c+3]=u/3+f,s[c+4]=r[0],s[c+5]=u/3+l}function b2e(t,r,e){for(var n=r.minHeight,i=r.maxHeight,a=e||[0,0,1,1],o=(0,Wee.default)(a,4),s=o[0],u=o[1],l=o[2],f=o[3],c=l-s,p=f-u,d=i-n,v=t.length/3,m=new Float32Array(v*3),g=new Float32Array(v*2),y=0;y<v;y++){var _=t[y]/32767,b=t[y+v]/32767,x=t[y+v*2]/32767;m[3*y+0]=_*c+s,m[3*y+1]=b*p+u,m[3*y+2]=x*d+n,g[2*y+0]=_,g[2*y+1]=b}return{POSITION:{value:m,size:3},TEXCOORD_0:{value:g,size:2}}}function x2e(t,r){if(!t)return null;var e=r.bounds,n=qC(t,iu.triangleIndices),i=n.header,a=n.vertexData,o=n.triangleIndices,s=n.westIndices,u=n.northIndices,l=n.eastIndices,f=n.southIndices,c=o,p=b2e(a,i,e),d=wa(p);if(r.skirtHeight){var v=H0(p,c,r.skirtHeight,{westIndices:s,northIndices:u,eastIndices:l,southIndices:f}),m=v.attributes,g=v.triangles;p=m,c=g}return{loaderData:{header:{}},header:{vertexCount:c.length,boundingBox:d},mode:4,indices:{value:c,size:1},attributes:p}}function W0(t,r){return x2e(t,r["quantized-mesh"])}var Zee=h(B()),Qee=h(ge()),ete=h(ye()),KC=h(de());var rd=class{constructor(r=257){this.gridSize=r;let e=r-1;if(e&e-1)throw new Error(`Expected grid size to be 2^n+1, got ${r}.`);this.numTriangles=e*e*2-2,this.numParentTriangles=this.numTriangles-e*e,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let n=0;n<this.numTriangles;n++){let i=n+2,a=0,o=0,s=0,u=0,l=0,f=0;for(i&1?s=u=l=e:a=o=f=e;(i>>=1)>1;){let p=a+s>>1,d=o+u>>1;i&1?(s=a,u=o,a=l,o=f):(a=s,o=u,s=l,u=f),l=p,f=d}let c=n*4;this.coords[c+0]=a,this.coords[c+1]=o,this.coords[c+2]=s,this.coords[c+3]=u}}createTile(r){return new YC(r,this)}},YC=class{constructor(r,e){let n=e.gridSize;if(r.length!==n*n)throw new Error(`Expected terrain data of length ${n*n} (${n} x ${n}), got ${r.length}.`);this.terrain=r,this.martini=e,this.errors=new Float32Array(r.length),this.update()}update(){let{numTriangles:r,numParentTriangles:e,coords:n,gridSize:i}=this.martini,{terrain:a,errors:o}=this;for(let s=r-1;s>=0;s--){let u=s*4,l=n[u+0],f=n[u+1],c=n[u+2],p=n[u+3],d=l+c>>1,v=f+p>>1,m=d+v-f,g=v+l-d,y=(a[f*i+l]+a[p*i+c])/2,_=v*i+d,b=Math.abs(y-a[_]);if(o[_]=Math.max(o[_],b),s<e){let x=(f+g>>1)*i+(l+m>>1),A=(p+g>>1)*i+(c+m>>1);o[_]=Math.max(o[_],o[x],o[A])}}}getMesh(r=0){let{gridSize:e,indices:n}=this.martini,{errors:i}=this,a=0,o=0,s=e-1;n.fill(0);function u(d,v,m,g,y,_){let b=d+m>>1,x=v+g>>1;Math.abs(d-y)+Math.abs(v-_)>1&&i[x*e+b]>r?(u(y,_,d,v,b,x),u(m,g,y,_,b,x)):(n[v*e+d]=n[v*e+d]||++a,n[g*e+m]=n[g*e+m]||++a,n[_*e+y]=n[_*e+y]||++a,o++)}u(0,0,s,s,s,0),u(s,s,0,0,0,s);let l=new Uint16Array(a*2),f=new Uint32Array(o*3),c=0;function p(d,v,m,g,y,_){let b=d+m>>1,x=v+g>>1;if(Math.abs(d-y)+Math.abs(v-_)>1&&i[x*e+b]>r)p(y,_,d,v,b,x),p(m,g,y,_,b,x);else{let A=n[v*e+d]-1,T=n[g*e+m]-1,O=n[_*e+y]-1;l[2*A]=d,l[2*A+1]=v,l[2*T]=m,l[2*T+1]=g,l[2*O]=y,l[2*O+1]=_,f[c++]=A,f[c++]=T,f[c++]=O}}return p(0,0,s,s,s,0),p(s,s,0,0,0,s),{vertices:l,triangles:f}}};var $ee=h(L()),Xee=h(N()),qee=function(){function t(r,e){(0,$ee.default)(this,t);var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e;this.data=r,this.width=e,this.height=n,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;var i=e-1,a=n-1,o=this._addPoint(0,0),s=this._addPoint(i,0),u=this._addPoint(0,a),l=this._addPoint(i,a),f=this._addTriangle(l,o,u,-1,-1,-1);this._addTriangle(o,l,s,f,-1,-1),this._flush()}return(0,Xee.default)(t,[{key:"run",value:function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this.getMaxError()>e;)this.refine()}},{key:"refine",value:function(){this._step(),this._flush()}},{key:"getMaxError",value:function(){return this._errors[0]}},{key:"getRMSD",value:function(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}},{key:"heightAt",value:function(e,n){return this.data[this.width*n+e]}},{key:"_flush",value:function(){for(var e=this.coords,n=0;n<this._pendingLen;n++){var i=this._pending[n],a=2*this.triangles[i*3+0],o=2*this.triangles[i*3+1],s=2*this.triangles[i*3+2];this._findCandidate(e[a],e[a+1],e[o],e[o+1],e[s],e[s+1],i)}this._pendingLen=0}},{key:"_findCandidate",value:function(e,n,i,a,o,s,u){for(var l=Math.min(e,i,o),f=Math.min(n,a,s),c=Math.max(e,i,o),p=Math.max(n,a,s),d=au(i,a,o,s,l,f),v=au(o,s,e,n,l,f),m=au(e,n,i,a,l,f),g=a-n,y=e-i,_=s-a,b=i-o,x=n-s,A=o-e,T=au(e,n,i,a,o,s),O=this.heightAt(e,n)/T,w=this.heightAt(i,a)/T,E=this.heightAt(o,s)/T,S=0,I=0,R=0,z=0,G=f;G<=p;G++){var k=0;d<0&&_!==0&&(k=Math.max(k,Math.floor(-d/_))),v<0&&x!==0&&(k=Math.max(k,Math.floor(-v/x))),m<0&&g!==0&&(k=Math.max(k,Math.floor(-m/g)));for(var U=d+_*k,j=v+x*k,X=m+g*k,H=!1,Q=l+k;Q<=c;Q++){if(U>=0&&j>=0&&X>=0){H=!0;var ne=O*U+w*j+E*X,le=Math.abs(ne-this.heightAt(Q,G));z+=le*le,le>S&&(S=le,I=Q,R=G)}else if(H)break;U+=_,j+=x,X+=g}d+=b,v+=A,m+=y}(I===e&&R===n||I===i&&R===a||I===o&&R===s)&&(S=0),this._candidates[2*u]=I,this._candidates[2*u+1]=R,this._rms[u]=z,this._queuePush(u,S,z)}},{key:"_step",value:function(){var e=this._queuePop(),n=e*3+0,i=e*3+1,a=e*3+2,o=this.triangles[n],s=this.triangles[i],u=this.triangles[a],l=this.coords[2*o],f=this.coords[2*o+1],c=this.coords[2*s],p=this.coords[2*s+1],d=this.coords[2*u],v=this.coords[2*u+1],m=this._candidates[2*e],g=this._candidates[2*e+1],y=this._addPoint(m,g);if(au(l,f,c,p,m,g)===0)this._handleCollinear(y,n);else if(au(c,p,d,v,m,g)===0)this._handleCollinear(y,i);else if(au(d,v,l,f,m,g)===0)this._handleCollinear(y,a);else{var _=this._halfedges[n],b=this._halfedges[i],x=this._halfedges[a],A=this._addTriangle(o,s,y,_,-1,-1,n),T=this._addTriangle(s,u,y,b,-1,A+1),O=this._addTriangle(u,o,y,x,A+2,T+1);this._legalize(A),this._legalize(T),this._legalize(O)}}},{key:"_addPoint",value:function(e,n){var i=this.coords.length>>1;return this.coords.push(e,n),i}},{key:"_addTriangle",value:function(e,n,i,a,o,s){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:this.triangles.length,l=u/3;return this.triangles[u+0]=e,this.triangles[u+1]=n,this.triangles[u+2]=i,this._halfedges[u+0]=a,this._halfedges[u+1]=o,this._halfedges[u+2]=s,a>=0&&(this._halfedges[a]=u+0),o>=0&&(this._halfedges[o]=u+1),s>=0&&(this._halfedges[s]=u+2),this._candidates[2*l+0]=0,this._candidates[2*l+1]=0,this._queueIndices[l]=-1,this._rms[l]=0,this._pending[this._pendingLen++]=l,u}},{key:"_legalize",value:function(e){var n=this._halfedges[e];if(!(n<0)){var i=e-e%3,a=n-n%3,o=i+(e+1)%3,s=i+(e+2)%3,u=a+(n+2)%3,l=a+(n+1)%3,f=this.triangles[s],c=this.triangles[e],p=this.triangles[o],d=this.triangles[u],v=this.coords;if(A2e(v[2*f],v[2*f+1],v[2*c],v[2*c+1],v[2*p],v[2*p+1],v[2*d],v[2*d+1])){var m=this._halfedges[o],g=this._halfedges[s],y=this._halfedges[u],_=this._halfedges[l];this._queueRemove(i/3),this._queueRemove(a/3);var b=this._addTriangle(f,d,p,-1,y,m,i),x=this._addTriangle(d,f,c,b,g,_,a);this._legalize(b+1),this._legalize(x+2)}}}},{key:"_handleCollinear",value:function(e,n){var i=n-n%3,a=i+(n+1)%3,o=i+(n+2)%3,s=this.triangles[o],u=this.triangles[n],l=this.triangles[a],f=this._halfedges[a],c=this._halfedges[o],p=this._halfedges[n];if(p<0){var d=this._addTriangle(e,s,u,-1,c,-1,i),v=this._addTriangle(s,e,l,d,-1,f);this._legalize(d+1),this._legalize(v+2);return}var m=p-p%3,g=m+(p+2)%3,y=m+(p+1)%3,_=this.triangles[g],b=this._halfedges[g],x=this._halfedges[y];this._queueRemove(m/3);var A=this._addTriangle(s,u,e,c,-1,-1,i),T=this._addTriangle(u,_,e,x,-1,A+1,m),O=this._addTriangle(_,l,e,b,-1,T+1),w=this._addTriangle(l,s,e,f,A+2,O+1);this._legalize(A),this._legalize(T),this._legalize(O),this._legalize(w)}},{key:"_queuePush",value:function(e,n,i){var a=this._queue.length;this._queueIndices[e]=a,this._queue.push(e),this._errors.push(n),this._rmsSum+=i,this._queueUp(a)}},{key:"_queuePop",value:function(){var e=this._queue.length-1;return this._queueSwap(0,e),this._queueDown(0,e),this._queuePopBack()}},{key:"_queuePopBack",value:function(){var e=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[e],this._queueIndices[e]=-1,e}},{key:"_queueRemove",value:function(e){var n=this._queueIndices[e];if(n<0){var i=this._pending.indexOf(e);if(i!==-1)this._pending[i]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}var a=this._queue.length-1;a!==n&&(this._queueSwap(n,a),this._queueDown(n,a)||this._queueUp(n)),this._queuePopBack()}},{key:"_queueLess",value:function(e,n){return this._errors[e]>this._errors[n]}},{key:"_queueSwap",value:function(e,n){var i=this._queue[e],a=this._queue[n];this._queue[e]=a,this._queue[n]=i,this._queueIndices[i]=n,this._queueIndices[a]=e;var o=this._errors[e];this._errors[e]=this._errors[n],this._errors[n]=o}},{key:"_queueUp",value:function(e){for(var n=e;;){var i=n-1>>1;if(i===n||!this._queueLess(n,i))break;this._queueSwap(i,n),n=i}}},{key:"_queueDown",value:function(e,n){for(var i=e;;){var a=2*i+1;if(a>=n||a<0)break;var o=a+1,s=a;if(o<n&&this._queueLess(o,a)&&(s=o),!this._queueLess(s,i))break;this._queueSwap(i,s),i=s}return i>e}}]),t}();function au(t,r,e,n,i,a){return(e-i)*(r-a)-(n-a)*(t-i)}function A2e(t,r,e,n,i,a,o,s){var u=t-o,l=r-s,f=e-o,c=n-s,p=i-o,d=a-s,v=u*u+l*l,m=f*f+c*c,g=p*p+d*d;return u*(c*g-m*d)-l*(f*g-m*p)+v*(f*d-c*p)<0}function Yee(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function $0(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Yee(Object(e),!0).forEach(function(n){(0,Zee.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Yee(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function X0(t,r,e,n,i){for(var a=n.rScaler,o=n.bScaler,s=n.gScaler,u=n.offset,l=new Float32Array((r+1)*(e+1)),f=0,c=0;c<e;c++)for(var p=0;p<r;p++,f++){var d=f*4,v=t[d+0],m=t[d+1],g=t[d+2];l[f+c]=v*a+m*s+g*o+u}if(i==="martini"){for(var y=(r+1)*r,_=0;_<r;_++,y++)l[y]=l[y-r-1];for(var b=e,x=0;x<e+1;x++,b+=e+1)l[b]=l[b-1]}return l}function T2e(t,r,e,n,i){for(var a=e+1,o=t.length/2,s=new Float32Array(o*3),u=new Float32Array(o*2),l=i||[0,0,e,n],f=(0,ete.default)(l,4),c=f[0],p=f[1],d=f[2],v=f[3],m=(d-c)/e,g=(v-p)/n,y=0;y<o;y++){var _=t[y*2],b=t[y*2+1],x=b*a+_;s[3*y+0]=_*m+c,s[3*y+1]=-b*g+v,s[3*y+2]=r[x],u[2*y+0]=_/e,u[2*y+1]=b/n}return{POSITION:{value:s,size:3},TEXCOORD_0:{value:u,size:2}}}function S2e(t,r){if(t===null)return null;var e=r.meshMaxError,n=r.bounds,i=r.elevationDecoder,a=t.data,o=t.width,s=t.height,u,l;switch(r.tesselator){case"martini":u=X0(a,o,s,i,r.tesselator),l=Kee(e,o,u);break;case"delatin":u=X0(a,o,s,i,r.tesselator),l=Jee(e,o,s,u);break;default:o===s&&!(s&o-1)?(u=X0(a,o,s,i,"martini"),l=Kee(e,o,u)):(u=X0(a,o,s,i,"delatin"),l=Jee(e,o,s,u));break}var f=l,c=f.vertices,p=l,d=p.triangles,v=T2e(c,u,o,s,n),m=wa(v);if(r.skirtHeight){var g=H0(v,d,r.skirtHeight),y=g.attributes,_=g.triangles;v=y,d=_}return{loaderData:{header:{}},header:{vertexCount:d.length,boundingBox:m},mode:4,indices:{value:Uint32Array.from(d),size:1},attributes:v}}function Kee(t,r,e){var n=r+1,i=new rd(n),a=i.createTile(e),o=a.getMesh(t),s=o.vertices,u=o.triangles;return{vertices:s,triangles:u}}function Jee(t,r,e,n){var i=new qee(n,r+1,e+1);i.run(t);var a=i.coords,o=i.triangles,s=a;return{vertices:s,triangles:o}}function ZC(t,r,e){return JC.apply(this,arguments)}function JC(){return JC=(0,Qee.default)(KC.default.mark(function t(r,e,n){var i,a;return KC.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i=$0($0({},e),{},{mimeType:"application/x.image",image:$0($0({},e.image),{},{type:"data"})}),s.next=3,n.parse(r,i);case 3:return a=s.sent,s.abrupt("return",S2e(a,e.terrain));case 5:case"end":return s.stop()}},t)})),JC.apply(this,arguments)}var q0="3.3.3";var Y0={name:"Terrain",id:"terrain",module:"terrain",version:q0,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:null,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:null}}};var tte={name:"Quantized Mesh",id:"quantized-mesh",module:"terrain",version:q0,worker:!0,extensions:["terrain"],mimeTypes:["application/vnd.quantized-mesh"],options:{"quantized-mesh":{bounds:[0,0,1,1],skirtHeight:null}}};function rte(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function K0(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?rte(Object(e),!0).forEach(function(n){(0,ite.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):rte(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var qvt=K0(K0({},Y0),{},{parse:ZC});var Yvt=K0(K0({},tte),{},{parseSync:W0,parse:function(){var t=(0,nte.default)(QC.default.mark(function e(n,i){return QC.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",W0(n,i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}()});function P2e(t){var r=w2e();return function(){var n=(0,tM.default)(t),i;if(r){var a=(0,tM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,hte.default)(this,i)}}function w2e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ate(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ro(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ate(Object(e),!0).forEach(function(n){(0,nd.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ate(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var ote=[1],O2e=Ro(Ro({},Sa.defaultProps),{},{elevationData:To,texture:Ro(Ro({},To),{},{optional:!0}),meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[Y0]});function ste(t){return Array.isArray(t)?t.join(";"):t||""}var J0=function(t){(0,pte.default)(e,t);var r=P2e(e);function e(){var n;(0,lte.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,nd.default)((0,cte.default)(n),"state",void 0),n}return(0,fte.default)(e,[{key:"updateState",value:function(i){var a=i.props,o=i.oldProps,s=a.elevationData!==o.elevationData;if(s){var u=a.elevationData,l=u&&(Array.isArray(u)||u.includes("{x}")&&u.includes("{y}"));this.setState({isTiled:l})}var f=s||a.meshMaxError!==o.meshMaxError||a.elevationDecoder!==o.elevationDecoder||a.bounds!==o.bounds;if(!this.state.isTiled&&f){var c=this.loadTerrain(a);this.setState({terrain:c})}a.workerUrl&&Z.removed("workerUrl","loadOptions.terrain.workerUrl")()}},{key:"loadTerrain",value:function(i){var a,o=i.elevationData,s=i.bounds,u=i.elevationDecoder,l=i.meshMaxError,f=i.signal;if(!o)return null;var c=this.getLoadOptions();c=Ro(Ro({},c),{},{terrain:Ro(Ro({skirtHeight:this.state.isTiled?l*2:0},(a=c)===null||a===void 0?void 0:a.terrain),{},{bounds:s,meshMaxError:l,elevationDecoder:u})});var p=this.props.fetch;return p(o,{propName:"elevationData",layer:this,loadOptions:c,signal:f})}},{key:"getTiledTerrainData",value:function(i){var a=this.props,o=a.elevationData,s=a.fetch,u=a.texture,l=a.elevationDecoder,f=a.meshMaxError,c=this.context.viewport,p=ji(o,i),d=u&&ji(u,i),v=i.signal,m=[0,0],g=[0,0];if(c.isGeospatial){var y=i.bbox;m=c.projectFlat([y.west,y.south]),g=c.projectFlat([y.east,y.north])}else{var _=i.bbox;m=[_.left,_.bottom],g=[_.right,_.top]}var b=[m[0],m[1],g[0],g[1]],x=this.loadTerrain({elevationData:p,bounds:b,elevationDecoder:l,meshMaxError:f,signal:v}),A=d?s(d,{propName:"texture",layer:this,loaders:[],signal:v}).catch(function(T){return null}):Promise.resolve(null);return Promise.all([x,A])}},{key:"renderSubLayers",value:function(i){var a=this.getSubLayerClass("mesh",Oa),o=this.props,s=o.color,u=o.wireframe,l=o.material,f=i.data;if(!f)return null;var c=(0,ute.default)(f,2),p=c[0],d=c[1];return new a(i,{data:ote,mesh:p,texture:d,_instanced:!1,coordinateSystem:se.CARTESIAN,getPosition:function(m){return[0,0,0]},getColor:s,wireframe:u,material:l})}},{key:"onViewportLoad",value:function(i){if(i){var a=this.state.zRange,o=i.map(function(l){return l.content}).filter(Boolean).map(function(l){var f=l[0].header.boundingBox;return f.map(function(c){return c[2]})});if(o.length!==0){var s=Math.min.apply(Math,(0,eM.default)(o.map(function(l){return l[0]}))),u=Math.max.apply(Math,(0,eM.default)(o.map(function(l){return l[1]})));(!a||s<a[0]||u>a[1])&&this.setState({zRange:[s,u]})}}}},{key:"renderLayers",value:function(){var i=this.props,a=i.color,o=i.material,s=i.elevationData,u=i.texture,l=i.wireframe,f=i.meshMaxError,c=i.elevationDecoder,p=i.tileSize,d=i.maxZoom,v=i.minZoom,m=i.extent,g=i.maxRequests,y=i.onTileLoad,_=i.onTileUnload,b=i.onTileError,x=i.maxCacheSize,A=i.maxCacheByteSize,T=i.refinementStrategy;if(this.state.isTiled)return new Sa(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:ste(s),texture:ste(u),meshMaxError:f,elevationDecoder:c}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:p,maxZoom:d,minZoom:v,extent:m,maxRequests:g,onTileLoad:y,onTileUnload:_,onTileError:b,maxCacheSize:x,maxCacheByteSize:A,refinementStrategy:T});var O=this.getSubLayerClass("mesh",Oa);return new O(this.getSubLayerProps({id:"mesh"}),{data:ote,mesh:this.state.terrain,texture:u,_instanced:!1,getPosition:function(E){return[0,0,0]},getColor:a,material:o,wireframe:l})}}]),e}(St);(0,nd.default)(J0,"defaultProps",O2e);(0,nd.default)(J0,"layerName","TerrainLayer");var kie=h(dr()),Bie=h(ge()),Fie=h(L()),Die=h(N()),Lo=h(Oe()),Nie=h(Y()),jie=h(K()),Wi=h(q()),T_=h(B()),VM=h(de());var vte=h(L()),mte=h(N()),gte=h(Y()),yte=h(K()),rM=h(q()),nM=h(B());var E2e=`
  uniform bool brushing_enabled;
  uniform int brushing_target;
  uniform vec2 brushing_mousePos;
  uniform float brushing_radius;

  #ifdef NON_INSTANCED_MODEL
  attribute vec2 brushingTargets;
  #else
  attribute vec2 instanceBrushingTargets;
  #endif

  varying float brushing_isVisible;

  bool brushing_isPointInRange(vec2 position) {
    if (!brushing_enabled) {
      return true;
    }
    vec2 source_commonspace = project_position(position);
    vec2 target_commonspace = project_position(brushing_mousePos);
    float distance = length((target_commonspace - source_commonspace) / project_uCommonUnitsPerMeter.xy);

    return distance <= brushing_radius;
  }

  bool brushing_arePointsInRange(vec2 sourcePos, vec2 targetPos) {
    return brushing_isPointInRange(sourcePos) || brushing_isPointInRange(targetPos);
  }

  void brushing_setVisible(bool visible) {
    brushing_isVisible = float(visible);
  }
`,C2e=`
  uniform bool brushing_enabled;
  varying float brushing_isVisible;
`,M2e={source:0,target:1,custom:2,source_target:3},I2e={"vs:DECKGL_FILTER_GL_POSITION":`
    vec2 brushingTarget;
    vec2 brushingSource;
    if (brushing_target == 3) {
      brushingTarget = geometry.worldPositionAlt.xy;
      brushingSource = geometry.worldPosition.xy;
    } else if (brushing_target == 0) {
      brushingTarget = geometry.worldPosition.xy;
    } else if (brushing_target == 1) {
      brushingTarget = geometry.worldPositionAlt.xy;
    } else {
      #ifdef NON_INSTANCED_MODEL
      brushingTarget = brushingTargets;
      #else
      brushingTarget = instanceBrushingTargets;
      #endif
    }
    bool visible;
    if (brushing_target == 3) {
      visible = brushing_arePointsInRange(brushingSource, brushingTarget);
    } else {
      visible = brushing_isPointInRange(brushingTarget);
    }
    brushing_setVisible(visible);
  `,"fs:DECKGL_FILTER_COLOR":`
    if (brushing_enabled && brushing_isVisible < 0.5) {
      discard;
    }
  `},dte={name:"brushing",dependencies:[Yt],vs:E2e,fs:C2e,inject:I2e,getUniforms:function(r){if(!r||!("viewport"in r))return{};var e=r.brushingEnabled,n=e===void 0?!0:e,i=r.brushingRadius,a=i===void 0?1e4:i,o=r.brushingTarget,s=o===void 0?"source":o,u=r.mousePosition,l=r.viewport;return{brushing_enabled:Boolean(n&&u&&l.containsPixel(u)),brushing_radius:a,brushing_target:M2e[s]||0,brushing_mousePos:u?l.unproject([u.x-l.x,u.y-l.y]):[0,0]}}};function R2e(t){var r=L2e();return function(){var n=(0,rM.default)(t),i;if(r){var a=(0,rM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,yte.default)(this,i)}}function L2e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var k2e={getBrushingTarget:{type:"accessor",value:[0,0]},brushingTarget:"source",brushingEnabled:!0,brushingRadius:1e4},Z0=function(t){(0,gte.default)(e,t);var r=R2e(e);function e(){return(0,vte.default)(this,e),r.apply(this,arguments)}return(0,mte.default)(e,[{key:"getShaders",value:function(){return{modules:[dte]}}},{key:"initializeState",value:function(i,a){var o=this,s=this.getAttributeManager();s&&s.add({brushingTargets:{size:2,accessor:"getBrushingTarget",shaderAttributes:{brushingTargets:{divisor:0},instanceBrushingTargets:{divisor:1}}}}),this.state.onMouseMove=function(){var u;(u=o.getCurrentLayer())===null||u===void 0||u.setNeedsRedraw()},i.deck&&i.deck.eventManager.on({pointermove:this.state.onMouseMove,pointerleave:this.state.onMouseMove})}},{key:"finalizeState",value:function(i,a){i.deck&&i.deck.eventManager.off({pointermove:this.state.onMouseMove,pointerleave:this.state.onMouseMove})}}]),e}(jt);(0,nM.default)(Z0,"defaultProps",k2e);(0,nM.default)(Z0,"extensionName","BrushingExtension");var Bte=h(L()),Fte=h(N()),Dte=h(Y()),Nte=h(K()),aM=h(q()),e_=h(B());var xte=h(B());function _te(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function bte(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?_te(Object(e),!0).forEach(function(n){(0,xte.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):_te(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Ate=`
uniform DATAFILTER_TYPE filter_min;
uniform DATAFILTER_TYPE filter_softMin;
uniform DATAFILTER_TYPE filter_softMax;
uniform DATAFILTER_TYPE filter_max;
uniform bool filter_useSoftMargin;
uniform bool filter_enabled;
uniform bool filter_transformSize;

#ifdef NON_INSTANCED_MODEL
  #define DATAFILTER_ATTRIB filterValues
  #define DATAFILTER_ATTRIB_64LOW filterValues64Low
#else
  #define DATAFILTER_ATTRIB instanceFilterValues
  #define DATAFILTER_ATTRIB_64LOW instanceFilterValues64Low
#endif

attribute DATAFILTER_TYPE DATAFILTER_ATTRIB;
#ifdef DATAFILTER_DOUBLE
  attribute DATAFILTER_TYPE DATAFILTER_ATTRIB_64LOW;

  uniform DATAFILTER_TYPE filter_min64High;
  uniform DATAFILTER_TYPE filter_max64High;
#endif

varying float dataFilter_value;

float dataFilter_reduceValue(float value) {
  return value;
}
float dataFilter_reduceValue(vec2 value) {
  return min(value.x, value.y);
}
float dataFilter_reduceValue(vec3 value) {
  return min(min(value.x, value.y), value.z);
}
float dataFilter_reduceValue(vec4 value) {
  return min(min(value.x, value.y), min(value.z, value.w));
}
void dataFilter_setValue(DATAFILTER_TYPE valueFromMin, DATAFILTER_TYPE valueFromMax) {
  if (filter_enabled) {
    if (filter_useSoftMargin) {
      dataFilter_value = dataFilter_reduceValue(
        smoothstep(filter_min, filter_softMin, valueFromMin) *
        (1.0 - smoothstep(filter_softMax, filter_max, valueFromMax))
      );
    } else {
      dataFilter_value = dataFilter_reduceValue(
        step(filter_min, valueFromMin) * step(valueFromMax, filter_max)
      );
    }
  } else {
    dataFilter_value = 1.0;
  }
}
`,Tte=`
uniform bool filter_transformColor;
varying float dataFilter_value;
`;function Ste(t){if(!t||!("extensions"in t))return{};var r=t.filterRange,e=r===void 0?[-1,1]:r,n=t.filterEnabled,i=n===void 0?!0:n,a=t.filterTransformSize,o=a===void 0?!0:a,s=t.filterTransformColor,u=s===void 0?!0:s,l=t.filterSoftRange||e;return bte(bte({},Number.isFinite(e[0])?{filter_min:e[0],filter_softMin:l[0],filter_softMax:l[1],filter_max:e[1]}:{filter_min:e.map(function(f){return f[0]}),filter_softMin:l.map(function(f){return f[0]}),filter_softMax:l.map(function(f){return f[1]}),filter_max:e.map(function(f){return f[1]})}),{},{filter_enabled:i,filter_useSoftMargin:Boolean(t.filterSoftRange),filter_transformSize:i&&o,filter_transformColor:i&&u})}function B2e(t){if(!t||!("extensions"in t))return{};var r=Ste(t);if(Number.isFinite(r.filter_min)){var e=Math.fround(r.filter_min);r.filter_min-=e,r.filter_softMin-=e,r.filter_min64High=e;var n=Math.fround(r.filter_max);r.filter_max-=n,r.filter_softMax-=n,r.filter_max64High=n}else{var i=r.filter_min.map(Math.fround);r.filter_min=r.filter_min.map(function(o,s){return o-i[s]}),r.filter_softMin=r.filter_softMin.map(function(o,s){return o-i[s]}),r.filter_min64High=i;var a=r.filter_max.map(Math.fround);r.filter_max=r.filter_max.map(function(o,s){return o-a[s]}),r.filter_softMax=r.filter_softMax.map(function(o,s){return o-a[s]}),r.filter_max64High=a}return r}var Pte={"vs:#main-start":`
    #ifdef DATAFILTER_DOUBLE
      dataFilter_setValue(
        DATAFILTER_ATTRIB - filter_min64High + DATAFILTER_ATTRIB_64LOW,
        DATAFILTER_ATTRIB - filter_max64High + DATAFILTER_ATTRIB_64LOW
      );
    #else
      dataFilter_setValue(DATAFILTER_ATTRIB, DATAFILTER_ATTRIB);
    #endif
  `,"vs:#main-end":`
    if (dataFilter_value == 0.0) {
      gl_Position = vec4(0.);
    }
  `,"vs:DECKGL_FILTER_SIZE":`
    if (filter_transformSize) {
      size = size * dataFilter_value;
    }
  `,"fs:DECKGL_FILTER_COLOR":`
    if (dataFilter_value == 0.0) discard;
    if (filter_transformColor) {
      color.a *= dataFilter_value;
    }
  `},wte={name:"data-filter",vs:Ate,fs:Tte,inject:Pte,getUniforms:Ste},Ote={name:"data-filter-fp64",vs:Ate,fs:Tte,inject:Pte,getUniforms:B2e};var iM=h(B());function Ete(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function F2e(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Ete(Object(e),!0).forEach(function(n){(0,iM.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Ete(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var D2e=`#define SHADER_NAME data-filter-vertex-shader

#ifdef FLOAT_TARGET
  attribute float filterIndices;
  attribute float filterPrevIndices;
#else
  attribute vec2 filterIndices;
  attribute vec2 filterPrevIndices;
#endif

varying vec4 vColor;
const float component = 1.0 / 255.0;

void main() {
  #ifdef FLOAT_TARGET
    dataFilter_value *= float(filterIndices != filterPrevIndices);
    gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
    vColor = vec4(0.0, 0.0, 0.0, 1.0);
  #else
    // Float texture is not supported: pack result into 4 channels x 256 px x 64px
    dataFilter_value *= float(filterIndices.x != filterPrevIndices.x);
    float col = filterIndices.x;
    float row = filterIndices.y * 4.0;
    float channel = floor(row);
    row = fract(row);
    vColor = component * vec4(bvec4(channel == 0.0, channel == 1.0, channel == 2.0, channel == 3.0));
    gl_Position = vec4(col * 2.0 - 1.0, row * 2.0 - 1.0, 0.0, 1.0);
  #endif
  gl_PointSize = 1.0;
}
`,N2e=`#define SHADER_NAME data-filter-fragment-shader
precision highp float;

varying vec4 vColor;

void main() {
  if (dataFilter_value < 0.5) {
    discard;
  }
  gl_FragColor = vColor;
}
`;function Cte(t){return Boolean(t.getExtension("EXT_float_blend")&&(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")))}function Mte(t,r){return r?new Me(t,{width:1,height:1,attachments:(0,iM.default)({},36064,new Se(t,{format:fe(t)?34836:6408,type:5126,mipmaps:!1}))}):new Me(t,{width:256,height:64,depth:!1})}function Ite(t,r,e){return r.defines.NON_INSTANCED_MODEL=1,e&&(r.defines.FLOAT_TARGET=1),new Ee(t,F2e({id:"data-filter-aggregation-model",vertexCount:1,isInstanced:!1,drawMode:0,vs:D2e,fs:N2e},r))}var Rte={blend:!0,blendFunc:[1,1,1,1],blendEquation:[32774,32774],depthTest:!1};function Lte(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Q0(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Lte(Object(e),!0).forEach(function(n){(0,e_.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Lte(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function U2e(t){var r=G2e();return function(){var n=(0,aM.default)(t),i;if(r){var a=(0,aM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Nte.default)(this,i)}}function G2e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var z2e={getFilterValue:{type:"accessor",value:0},onFilteredItemsChange:{type:"function",value:null,optional:!0},filterEnabled:!0,filterRange:[-1,1],filterSoftRange:null,filterTransformSize:!0,filterTransformColor:!0},kte={1:"float",2:"vec2",3:"vec3",4:"vec4"},t_=function(t){(0,Dte.default)(e,t);var r=U2e(e);function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.filterSize,a=i===void 0?1:i,o=n.fp64,s=o===void 0?!1:o,u=n.countItems,l=u===void 0?!1:u;if((0,Bte.default)(this,e),!kte[a])throw new Error("filterSize out of range");return r.call(this,{filterSize:a,fp64:s,countItems:l})}return(0,Fte.default)(e,[{key:"getShaders",value:function(i){var a=i.opts,o=a.filterSize,s=a.fp64;return{modules:[s?Ote:wte],defines:{DATAFILTER_TYPE:kte[o],DATAFILTER_DOUBLE:Boolean(s)}}}},{key:"initializeState",value:function(i,a){var o=this.getAttributeManager();o&&o.add({filterValues:{size:a.opts.filterSize,type:a.opts.fp64?5130:5126,accessor:"getFilterValue",shaderAttributes:{filterValues:{divisor:0},instanceFilterValues:{divisor:1}}}});var s=this.context.gl;if(o&&a.opts.countItems){var u=Cte(s);o.add({filterIndices:{size:u?1:2,vertexOffset:1,type:5121,normalized:!0,accessor:function(p,d){var v=d.index,m=p&&p.__source?p.__source.index:v;return u?(m+1)%255:[(m+1)%255,Math.floor(m/255)%255]},shaderAttributes:{filterPrevIndices:{vertexOffset:0},filterIndices:{vertexOffset:1}}}});var l=Mte(s,u),f=Ite(s,a.getShaders.call(this,a),u);this.setState({filterFBO:l,filterModel:f})}}},{key:"updateState",value:function(i){var a=i.props,o=i.oldProps;if(this.state.filterModel){var s=this.getAttributeManager(),u=s.attributes.filterValues.needsUpdate()||a.filterEnabled!==o.filterEnabled||a.filterRange!==o.filterRange||a.filterSoftRange!==o.filterSoftRange;u&&this.setState({filterNeedsUpdate:u})}}},{key:"draw",value:function(i,a){var o=this.state,s=o.filterFBO,u=o.filterModel,l=o.filterNeedsUpdate,f=this.props.onFilteredItemsChange;if(l&&f&&u){var c=this.getAttributeManager(),p=c.attributes,d=p.filterValues,v=p.filterIndices;u.setVertexCount(this.getNumInstances());var m=this.context.gl;yn(m,{framebuffer:s,color:[0,0,0,0]}),u.updateModuleSettings(i.moduleParameters).setAttributes(Q0(Q0({},d.getShaderAttributes()),v&&v.getShaderAttributes())).draw({framebuffer:s,parameters:Q0(Q0({},Rte),{},{viewport:[0,0,s.width,s.height]})});for(var g=Wn(s),y=0,_=0;_<g.length;_++)y+=g[_];f({id:this.id,count:y}),this.state.filterNeedsUpdate=!1}}},{key:"finalizeState",value:function(){var i=this.state,a=i.filterFBO,o=i.filterModel;a&&(a.color.delete(),a.delete(),o.delete())}}]),e}(jt);(0,e_.default)(t_,"defaultProps",z2e);(0,e_.default)(t_,"extensionName","DataFilterExtension");var Ute=h(L()),Gte=h(N()),zte=h(Y()),Vte=h(K()),oM=h(q()),Hte=h(B());var jte=`
const vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);

uniform vec2 project_uViewProjectionMatrixFP64[16];
void mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {

#if defined(NVIDIA_FP64_WORKAROUND)
  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);
#else
  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);
#endif
  out_val[1] = sum_fp64(PI_FP64,
    log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));
  return;
}

void project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {
  vec2 pos_fp64[2];
  mercatorProject_fp64(position_fp64, pos_fp64);
  out_val[0] = mul_fp64(pos_fp64[0], WORLD_SCALE_FP64);
  out_val[1] = mul_fp64(pos_fp64[1], WORLD_SCALE_FP64);

  return;
}

void project_position_fp64(vec2 position, vec2 position64xyLow, out vec2 out_val[2]) {
  vec4 position64xy = vec4(
    position.x, position64xyLow.x,
    position.y, position64xyLow.y);

  project_position_fp64(position64xy, out_val);
}

vec4 project_common_position_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {
  vec2 vertex_pos_clipspace[4];
  mat4_vec4_mul_fp64(project_uViewProjectionMatrixFP64, vertex_pos_modelspace,
    vertex_pos_clipspace);
  return vec4(
    vertex_pos_clipspace[0].x,
    vertex_pos_clipspace[1].x,
    vertex_pos_clipspace[2].x,
    vertex_pos_clipspace[3].x
    );
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64xyLow, vec3 offset, out vec4 commonPosition
) {
  vec2 offset64[4];
  vec4_fp64(vec4(offset, 0.0), offset64);

  float z = project_size(position.z);
  vec2 projectedPosition64xy[2];
  project_position_fp64(position.xy, position64xyLow.xy, projectedPosition64xy);

  vec2 commonPosition64[4];
  commonPosition64[0] = sum_fp64(offset64[0], projectedPosition64xy[0]);
  commonPosition64[1] = sum_fp64(offset64[1], projectedPosition64xy[1]);
  commonPosition64[2] = sum_fp64(offset64[2], vec2(z, 0.0));
  commonPosition64[3] = vec2(1.0, 0.0);

  commonPosition = vec4(projectedPosition64xy[0].x, projectedPosition64xy[1].x, z, 1.0);

  return project_common_position_to_clipspace_fp64(commonPosition64);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64xyLow, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(
    position, position64xyLow, offset, commonPosition
  );
}
`;var V2e=ju.fp64ify,H2e=ju.fp64ifyMatrix4,r_={name:"project64",dependencies:[Yt,ju],vs:jte,getUniforms:$2e},W2e=Hr(X2e);function $2e(t){if(t&&"viewport"in t){var r=t.viewport,e=r.viewProjectionMatrix,n=r.scale;return W2e({viewProjectionMatrix:e,scale:n})}return{}}function X2e(t){var r=t.viewProjectionMatrix,e=t.scale,n=H2e(r),i=V2e(e);return{project_uViewProjectionMatrixFP64:n,project64_uViewProjectionMatrix:n,project64_uScale:i}}function q2e(t){var r=Y2e();return function(){var n=(0,oM.default)(t),i;if(r){var a=(0,oM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Vte.default)(this,i)}}function Y2e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sM=function(t){(0,zte.default)(e,t);var r=q2e(e);function e(){return(0,Ute.default)(this,e),r.apply(this,arguments)}return(0,Gte.default)(e,[{key:"getShaders",value:function(){var i=this.props.coordinateSystem;if(i!==se.LNGLAT&&i!==se.DEFAULT)throw new Error("fp64: coordinateSystem must be LNGLAT");return{modules:[r_]}}}]),e}(jt);(0,Hte.default)(sM,"extensionName","Fp64Extension");var Xte=h(L()),qte=h(N()),Yte=h(Y()),Kte=h(K()),uM=h(q()),lM=h(B());var Wte={inject:{"vs:#decl":`
attribute vec2 instanceDashArrays;
attribute float instanceDashOffsets;
varying vec2 vDashArray;
varying float vDashOffset;
`,"vs:#main-end":`
vDashArray = instanceDashArrays;
vDashOffset = instanceDashOffsets / width.x;
`,"fs:#decl":`
uniform float dashAlignMode;
uniform float capType;
uniform bool dashGapPickable;
varying vec2 vDashArray;
varying float vDashOffset;

float round(float x) {
  return floor(x + 0.5);
}
`,"fs:#main-start":`
  float solidLength = vDashArray.x;
  float gapLength = vDashArray.y;
  float unitLength = solidLength + gapLength;

  float offset;

  if (unitLength > 0.0) {
    if (dashAlignMode == 0.0) {
      offset = vDashOffset;
    } else {
      unitLength = vPathLength / round(vPathLength / unitLength);
      offset = solidLength / 2.0;
    }

    float unitOffset = mod(clamp(vPathPosition.y, 0.0, vPathLength) + offset, unitLength);

    if (gapLength > 0.0 && unitOffset > solidLength) {
      if (capType <= 0.5) {
        if (!(dashGapPickable && picking_uActive)) {
          discard;
        }
      } else {
        float distToEnd = length(vec2(
          min(unitOffset - solidLength, unitLength - unitOffset),
          vPathPosition.x
        ));
        if (distToEnd > 1.0) {
          if (!(dashGapPickable && picking_uActive)) {
            discard;
          }
        }
      }
    }
  }
`}},$te={inject:{"vs:#decl":`
attribute float instanceOffsets;
`,"vs:DECKGL_FILTER_SIZE":`
  float offsetWidth = abs(instanceOffsets * 2.0) + 1.0;
  size *= offsetWidth;
`,"vCornerOffset = offsetVec;":`
  float offsetWidth = abs(instanceOffsets * 2.0) + 1.0;
  vec2 offsetCenter = -instanceOffsets * (isCap ? perp : miterVec * miterSize) * 2.0;
  vCornerOffset = vCornerOffset * offsetWidth - offsetCenter;
`,"fs:#main-start":`
  float isInside;
  isInside = step(-1.0, vPathPosition.x) * step(vPathPosition.x, 1.0);
  if (isInside == 0.0) {
    discard;
  }
`}};function K2e(t){var r=J2e();return function(){var n=(0,uM.default)(t),i;if(r){var a=(0,uM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Kte.default)(this,i)}}function J2e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Z2e={getDashArray:{type:"accessor",value:[0,0]},getOffset:{type:"accessor",value:0},dashJustified:!1,dashGapPickable:!1},n_=function(t){(0,Yte.default)(e,t);var r=K2e(e);function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.dash,a=i===void 0?!1:i,o=n.offset,s=o===void 0?!1:o,u=n.highPrecisionDash,l=u===void 0?!1:u;return(0,Xte.default)(this,e),r.call(this,{dash:a||l,offset:s,highPrecisionDash:l})}return(0,qte.default)(e,[{key:"isEnabled",value:function(i){return"pathTesselator"in i.state}},{key:"getShaders",value:function(i){if(!i.isEnabled(this))return null;var a={};return i.opts.dash&&(a=da(a,Wte)),i.opts.offset&&(a=da(a,$te)),a}},{key:"initializeState",value:function(i,a){var o=this.getAttributeManager();!o||!a.isEnabled(this)||(a.opts.dash&&o.addInstanced({instanceDashArrays:{size:2,accessor:"getDashArray"}}),a.opts.highPrecisionDash&&o.addInstanced({instanceDashOffsets:{size:1,accessor:"getPath",transform:a.getDashOffsets.bind(this)}}),a.opts.offset&&o.addInstanced({instanceOffsets:{size:1,accessor:"getOffset"}}))}},{key:"updateState",value:function(i,a){if(a.isEnabled(this)){var o={};a.opts.dash&&(o.dashAlignMode=this.props.dashJustified?1:0,o.dashGapPickable=Boolean(this.props.dashGapPickable)),this.state.model.setUniforms(o)}}},{key:"getDashOffsets",value:function(i){for(var a=[0],o=this.props.positionFormat==="XY"?2:3,s=Array.isArray(i[0]),u=s?i.length:i.length/o,l,f,c=0;c<u-1;c++)l=s?i[c]:i.slice(c*o,c*o+o),l=this.projectPosition(l),c>0&&(a[c]=a[c-1]+wF(f,l)),f=l;return a}}]),e}(jt);(0,lM.default)(n_,"defaultProps",Z2e);(0,lM.default)(n_,"extensionName","PathStyleExtension");var Zte=h(L()),Qte=h(N()),ere=h(Y()),tre=h(K()),fM=h(q()),i_=h(B());var Q2e=`
#ifdef NON_INSTANCED_MODEL
  #define FILL_PATTERN_FRAME_ATTRIB fillPatternFrames
  #define FILL_PATTERN_SCALE_ATTRIB fillPatternScales
  #define FILL_PATTERN_OFFSET_ATTRIB fillPatternOffsets
#else
  #define FILL_PATTERN_FRAME_ATTRIB instanceFillPatternFrames
  #define FILL_PATTERN_SCALE_ATTRIB instanceFillPatternScales
  #define FILL_PATTERN_OFFSET_ATTRIB instanceFillPatternOffsets
#endif

attribute vec4 FILL_PATTERN_FRAME_ATTRIB;
attribute float FILL_PATTERN_SCALE_ATTRIB;
attribute vec2 FILL_PATTERN_OFFSET_ATTRIB;

uniform bool fill_patternEnabled;
uniform vec2 fill_patternTextureSize;

varying vec2 fill_uv;
varying vec4 fill_patternBounds;
varying vec4 fill_patternPlacement;
`,eIe=`
uniform bool fill_patternEnabled;
uniform bool fill_patternMask;
uniform sampler2D fill_patternTexture;
uniform vec2 fill_uvCoordinateOrigin;
uniform vec2 fill_uvCoordinateOrigin64Low;

varying vec4 fill_patternBounds;
varying vec4 fill_patternPlacement;
varying vec2 fill_uv;

const float FILL_UV_SCALE = 512.0 / 40000000.0;
`,tIe={"vs:DECKGL_FILTER_GL_POSITION":`
    fill_uv = geometry.position.xy;
  `,"vs:DECKGL_FILTER_COLOR":`
    if (fill_patternEnabled) {
      fill_patternBounds = FILL_PATTERN_FRAME_ATTRIB / vec4(fill_patternTextureSize, fill_patternTextureSize);
      fill_patternPlacement.xy = FILL_PATTERN_OFFSET_ATTRIB;
      fill_patternPlacement.zw = FILL_PATTERN_SCALE_ATTRIB * FILL_PATTERN_FRAME_ATTRIB.zw;
    }
  `,"fs:DECKGL_FILTER_COLOR":`
    if (fill_patternEnabled) {
      vec2 scale = FILL_UV_SCALE * fill_patternPlacement.zw;
      vec2 patternUV = mod(mod(fill_uvCoordinateOrigin, scale) + fill_uvCoordinateOrigin64Low + fill_uv, scale) / scale;
      patternUV = mod(fill_patternPlacement.xy + patternUV, 1.0);

      vec2 texCoords = fill_patternBounds.xy + fill_patternBounds.zw * patternUV;

      vec4 patternColor = texture2D(fill_patternTexture, texCoords);
      color.a *= patternColor.a;
      if (!fill_patternMask) {
        color.rgb = patternColor.rgb;
      }
    }
  `};function rIe(t,r){if(!t)return{};if("fillPatternTexture"in t){var e=t.fillPatternTexture;return{fill_patternTexture:e,fill_patternTextureSize:[e.width,e.height]}}if("viewport"in t){var n=t.fillPatternMask,i=n===void 0?!0:n,a=t.fillPatternEnabled,o=a===void 0?!0:a,s=r,u=s.project_uCommonOrigin,l=[Jn(u[0]),Jn(u[1])];return{fill_uvCoordinateOrigin:u.slice(0,2),fill_uvCoordinateOrigin64Low:l,fill_patternMask:i,fill_patternEnabled:o}}return{}}var Jte={name:"fill-pattern",vs:Q2e,fs:eIe,inject:tIe,dependencies:[Yt],getUniforms:rIe};function nIe(t){var r=iIe();return function(){var n=(0,fM.default)(t),i;if(r){var a=(0,fM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,tre.default)(this,i)}}function iIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var aIe={fillPatternEnabled:!0,fillPatternAtlas:{type:"image",value:null,async:!0,parameters:(0,i_.default)({},10241,9729)},fillPatternMapping:{type:"object",value:{},async:!0},fillPatternMask:!0,getFillPattern:{type:"accessor",value:function(r){return r.pattern}},getFillPatternScale:{type:"accessor",value:1},getFillPatternOffset:{type:"accessor",value:[0,0]}},a_=function(t){(0,ere.default)(e,t);var r=nIe(e);function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.pattern,a=i===void 0?!1:i;return(0,Zte.default)(this,e),r.call(this,{pattern:a})}return(0,Qte.default)(e,[{key:"isEnabled",value:function(i){return i.getAttributeManager()!==null&&!("pathTesselator"in i.state)}},{key:"getShaders",value:function(i){return i.isEnabled(this)?{modules:[i.opts.pattern&&Jte].filter(Boolean)}:null}},{key:"initializeState",value:function(i,a){if(a.isEnabled(this)){var o=this.getAttributeManager();a.opts.pattern&&o.add({fillPatternFrames:{size:4,accessor:"getFillPattern",transform:a.getPatternFrame.bind(this),shaderAttributes:{fillPatternFrames:{divisor:0},instanceFillPatternFrames:{divisor:1}}},fillPatternScales:{size:1,accessor:"getFillPatternScale",defaultValue:1,shaderAttributes:{fillPatternScales:{divisor:0},instanceFillPatternScales:{divisor:1}}},fillPatternOffsets:{size:2,accessor:"getFillPatternOffset",shaderAttributes:{fillPatternOffsets:{divisor:0},instanceFillPatternOffsets:{divisor:1}}}}),this.setState({emptyTexture:new Se(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}}},{key:"updateState",value:function(i,a){var o=i.props,s=i.oldProps;a.isEnabled(this)&&o.fillPatternMapping&&o.fillPatternMapping!==s.fillPatternMapping&&this.getAttributeManager().invalidate("getFillPattern")}},{key:"draw",value:function(i,a){if(a.isEnabled(this)){var o=this.props.fillPatternAtlas;this.setModuleParameters({fillPatternTexture:o||this.state.emptyTexture})}}},{key:"finalizeState",value:function(){var i=this.state,a=i.patternTexture,o=i.emptyTexture;a?.delete(),o?.delete()}},{key:"getPatternFrame",value:function(i){var a=this.getCurrentLayer().props.fillPatternMapping,o=a&&a[i];return o?[o.x,o.y,o.width,o.height]:[0,0,0,0]}}]),e}(jt);(0,i_.default)(a_,"defaultProps",aIe);(0,i_.default)(a_,"extensionName","FillStyleExtension");var rre=h(L()),nre=h(N()),ire=h(Y()),are=h(K()),cM=h(q()),pM=h(B());function oIe(t){var r=sIe();return function(){var n=(0,cM.default)(t),i;if(r){var a=(0,cM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,are.default)(this,i)}}function sIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var uIe={clipBounds:[0,0,1,1],clipByInstance:void 0},ore=`
uniform vec4 clip_bounds;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,lIe={name:"clip-vs",vs:ore},fIe={"vs:#decl":`
varying float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
varying float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},cIe={name:"clip-fs",fs:ore},pIe={"vs:#decl":`
varying vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
varying vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`},vf=function(t){(0,ire.default)(e,t);var r=oIe(e);function e(){return(0,rre.default)(this,e),r.apply(this,arguments)}return(0,nre.default)(e,[{key:"getShaders",value:function(){var i="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(i=Boolean(this.props.clipByInstance)),this.state.clipByInstance=i,i?{modules:[lIe],inject:fIe}:{modules:[cIe],inject:pIe}}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props.clipBounds;if(this.state.clipByInstance)a.clip_bounds=o;else{var s=this.projectPosition([o[0],o[1],0]),u=this.projectPosition([o[2],o[3],0]);a.clip_bounds=[Math.min(s[0],u[0]),Math.min(s[1],u[1]),Math.max(s[0],u[0]),Math.max(s[1],u[1])]}}}]),e}(jt);(0,pM.default)(vf,"defaultProps",uIe);(0,pM.default)(vf,"extensionName","ClipExtension");var Lre=h(L()),kre=h(N()),Bre=h(Y()),Fre=h(K()),mM=h(q()),gM=h(B());var hIe=`
#ifdef NON_INSTANCED_MODEL
attribute float collisionPriorities;
#else
attribute float instanceCollisionPriorities;
#endif

uniform sampler2D collision_texture;
uniform bool collision_sort;
uniform bool collision_enabled;

vec2 collision_getCoords(vec4 position) {
  vec4 collision_clipspace = project_common_position_to_clipspace(position);
  return (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;
}

float collision_match(vec2 tex, vec3 pickingColor) {
  vec4 collision_pickingColor = texture2D(collision_texture, tex);
  float delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));
  float e = 0.001;
  return step(delta, e);
}

float collision_isVisible(vec2 texCoords, vec3 pickingColor) {
  if (!collision_enabled) {
    return 1.0;
  }

  // Visibility test, sample area of 5x5 pixels in order to fade in/out.
  // Due to the locality, the lookups will be cached
  // This reduces the flicker present when objects are shown/hidden
  const int N = 2;
  float accumulator = 0.0;
  vec2 step = vec2(1.0 / project_uViewportSize);

  const float floatN = float(N);
  vec2 delta = -floatN * step;
  for(int i = -N; i <= N; i++) {
    delta.x = -step.x * floatN;
    for(int j = -N; j <= N; j++) {
      accumulator += collision_match(texCoords + delta, pickingColor);
      delta.x += step.x;
    }
    delta.y += step.y;
  }

  float W = 2.0 * floatN + 1.0;
  return pow(accumulator / (W * W), 2.2);
}
`,dIe={"vs:#decl":`
  float collision_fade = 1.0;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  if (collision_sort) {
    #ifdef NON_INSTANCED_MODEL
    float collisionPriority = collisionPriorities;
    #else
    float collisionPriority = instanceCollisionPriorities;
    #endif
    position.z = -0.001 * collisionPriority * position.w; // Support range -1000 -> 1000
  }

  if (collision_enabled) {
    vec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));
    vec2 collision_texCoords = collision_getCoords(collision_common_position);
    collision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);
    if (collision_fade < 0.0001) {
      // Position outside clip space bounds to discard
      position = vec4(0.0, 0.0, 2.0, 1.0);
    }
  }
  `,"vs:DECKGL_FILTER_COLOR":`
  color.a *= collision_fade;
  `},vIe=function(r,e){if(!r||!("dummyCollisionMap"in r))return{};var n=r.collisionFBO,i=r.drawToCollisionMap,a=r.dummyCollisionMap;return{collision_sort:Boolean(i),collision_texture:!i&&n?n:a}},sre={name:"collision",dependencies:[Yt],vs:hIe,inject:dIe,getUniforms:vIe};var Mre=h(L()),Ire=h(N()),Pr=h(B());var fre=h(B()),cre=h(L()),pre=h(N()),hre=h(Y()),dre=h(K()),hM=h(q());function ure(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function lre(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ure(Object(e),!0).forEach(function(n){(0,fre.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ure(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function mIe(t){var r=gIe();return function(){var n=(0,hM.default)(t),i;if(r){var a=(0,hM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,dre.default)(this,i)}}function gIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vre=function(t){(0,hre.default)(e,t);var r=mIe(e);function e(){return(0,cre.default)(this,e),r.apply(this,arguments)}return(0,pre.default)(e,[{key:"renderCollisionMap",value:function(i,a){var o=this,s=this.gl,u=1;return Ie(s,{scissorTest:!0,scissor:[u,u,i.width-2*u,i.height-2*u],clearColor:[0,0,0,0],blend:!1,depthTest:!0,depthRange:[0,1]},function(){return o.render(lre(lre({},a),{},{target:i,pass:"collision"}))})}},{key:"getModuleParameters",value:function(){return{drawToCollisionMap:!0,pickingActive:1,pickingAttribute:!1,lightSources:{}}}}]),e}(Vr);var Ore=h(L()),Ere=h(N()),ui=h(B());var yre=h(L()),_re=h(N()),dM=h(_e()),bre=h(Oe()),xre=h(Y()),Are=h(K()),o_=h(q()),ja=h(B());function mre(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function gre(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?mre(Object(e),!0).forEach(function(n){(0,ja.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):mre(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function yIe(t){var r=_Ie();return function(){var n=(0,o_.default)(t),i;if(r){var a=(0,o_.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Are.default)(this,i)}}function _Ie(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Tre=function(t){(0,xre.default)(e,t);var r=yIe(e);function e(n,i){var a,o;(0,yre.default)(this,e),o=r.call(this,n,i),(0,ja.default)((0,dM.default)(o),"maskMap",void 0),(0,ja.default)((0,dM.default)(o),"fbo",void 0);var s=i.mapSize,u=s===void 0?2048:s;return o.maskMap=new Se(n,{width:u,height:u,parameters:(a={},(0,ja.default)(a,10241,9729),(0,ja.default)(a,10240,9729),(0,ja.default)(a,10242,33071),(0,ja.default)(a,10243,33071),a)}),o.fbo=new Me(n,{id:"maskmap",width:u,height:u,attachments:(0,ja.default)({},36064,o.maskMap)}),o}return(0,_re.default)(e,[{key:"render",value:function(i){var a=this,o=this.gl,s=[!1,!1,!1,!1];return s[i.channel]=!0,Ie(o,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:s,depthTest:!1},function(){return(0,bre.default)((0,o_.default)(e.prototype),"render",a).call(a,gre(gre({},i),{},{target:a.fbo,pass:"mask"}))})}},{key:"shouldDrawLayer",value:function(i){return i.props.operation.includes("mask")}},{key:"delete",value:function(){this.fbo.delete(),this.maskMap.delete()}}]),e}(Vr);var Pre=h(ye());function bIe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=xIe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function xIe(t,r){if(t){if(typeof t=="string")return Sre(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Sre(t,r)}}function Sre(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function mf(t,r){var e=[1/0,1/0,-1/0,-1/0],n=bIe(t),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.getBounds();if(o){var s=a.projectPosition(o[0],{viewport:r,autoOffset:!1}),u=a.projectPosition(o[1],{viewport:r,autoOffset:!1});e[0]=Math.min(e[0],s[0]),e[1]=Math.min(e[1],s[1]),e[2]=Math.max(e[2],u[0]),e[3]=Math.max(e[3],u[1])}}}catch(l){n.e(l)}finally{n.f()}return Number.isFinite(e[0])?e:null}var AIe=2048;function gf(t){var r=t.bounds,e=t.viewport,n=t.border,i=n===void 0?0:n,a=e.isGeospatial;if(r[2]<=r[0]||r[3]<=r[1])return null;var o=e.unprojectPosition([(r[0]+r[2])/2,(r[1]+r[3])/2,0]),s=t.width,u=t.height,l=t.zoom;if(l===void 0){s=s-i*2,u=u-i*2;var f=Math.min(s/(r[2]-r[0]),u/(r[3]-r[1]));l=Math.min(Math.log2(f),20)}else if(!s||!u){var c=Math.pow(2,l);s=Math.round(Math.abs(r[2]-r[0])*c),u=Math.round(Math.abs(r[3]-r[1])*c);var p=AIe-i*2;if(s>p||u>p){var d=p/Math.max(s,u);s=Math.round(s*d),u=Math.round(u*d),l+=Math.log2(d)}}return a?new $r({id:e.id,x:i,y:i,width:s,height:u,longitude:o[0],latitude:o[1],zoom:l,orthographic:!0}):new wl({id:e.id,x:i,y:i,width:s,height:u,target:o,zoom:l,flipY:!1})}function TIe(t,r){var e;if(r&&r.length===2){var n=(0,Pre.default)(r,2),i=n[0],a=n[1],o=t.getBounds({z:i}),s=t.getBounds({z:a});e=[Math.min(o[0],s[0]),Math.min(o[1],s[1]),Math.max(o[2],s[2]),Math.max(o[3],s[3])]}else e=t.getBounds();var u=t.projectPosition(e.slice(0,2)),l=t.projectPosition(e.slice(2,4));return[u[0],u[1],l[0],l[1]]}function yf(t,r,e){if(!t)return[0,0,1,1];var n=TIe(r,e),i=SIe(n);return t[2]-t[0]<=i[2]-i[0]&&t[3]-t[1]<=i[3]-i[1]?t:[Math.max(t[0],i[0]),Math.max(t[1],i[1]),Math.min(t[2],i[2]),Math.min(t[3],i[3])]}function SIe(t){var r=t[2]-t[0],e=t[3]-t[1],n=(t[0]+t[2])/2,i=(t[1]+t[3])/2;return[n-r,i-e,n+r,i+e]}function PIe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=wIe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function wIe(t,r){if(t){if(typeof t=="string")return wre(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return wre(t,r)}}function wre(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var s_=function(){function t(){(0,Ore.default)(this,t),(0,ui.default)(this,"id","mask-effect"),(0,ui.default)(this,"props",null),(0,ui.default)(this,"useInPicking",!0),(0,ui.default)(this,"order",0),(0,ui.default)(this,"dummyMaskMap",void 0),(0,ui.default)(this,"channels",[]),(0,ui.default)(this,"masks",null),(0,ui.default)(this,"maskPass",void 0),(0,ui.default)(this,"maskMap",void 0),(0,ui.default)(this,"lastViewport",void 0)}return(0,Ere.default)(t,[{key:"preRender",value:function(e,n){var i=n.layers,a=n.layerFilter,o=n.viewports,s=n.onViewportActive,u=n.views,l=n.isPicking,f=!1;if(this.dummyMaskMap||(this.dummyMaskMap=new Se(e,{width:1,height:1})),l)return{didRender:f};var c=i.filter(function(y){return y.props.visible&&y.props.operation.includes("mask")});if(c.length===0)return this.masks=null,this.channels.length=0,{didRender:f};this.masks={},this.maskPass||(this.maskPass=new Tre(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);var p=this._sortMaskChannels(c),d=o[0],v=!this.lastViewport||!this.lastViewport.equals(d);if(d.resolution!==void 0)return Z.warn("MaskExtension is not supported in GlobeView")(),{didRender:f};for(var m in p){var g=this._renderChannel(p[m],{layerFilter:a,onViewportActive:s,views:u,viewport:d,viewportChanged:v});f||(f=g)}return{didRender:f}}},{key:"_renderChannel",value:function(e,n){var i=n.layerFilter,a=n.onViewportActive,o=n.views,s=n.viewport,u=n.viewportChanged,l=!1,f=this.channels[e.index];if(!f)return l;var c=e===f||e.layers.length!==f.layers.length||e.layers.some(function(g,y){return g!==f.layers[y]||g.props.transitions})||e.layerBounds.some(function(g,y){return g!==f.layerBounds[y]});if(e.bounds=f.bounds,e.maskBounds=f.maskBounds,this.channels[e.index]=e,c||u){this.lastViewport=s;var p=mf(e.layers,s);if(e.bounds=p&&yf(p,s),c||!tt(e.bounds,f.bounds)){var d=this.maskPass,v=this.maskMap,m=p&&gf({bounds:e.bounds,viewport:s,width:v.width,height:v.height,border:1});e.maskBounds=m?m.getBounds():[0,0,1,1],d.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:i,viewports:m?[m]:[],onViewportActive:a,views:o,moduleParameters:{devicePixelRatio:1}}),l=!0}}return this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem},l}},{key:"_sortMaskChannels",value:function(e){var n=this,i={},a=0,o=PIe(e),s;try{var u=function(){var m=s.value,g=m.root.id,y=i[g];if(!y){if(++a>4)return Z.warn("Too many mask layers. The max supported is 4")(),"continue";y={id:g,index:n.channels.findIndex(function(_){return _?.id===g}),layers:[],layerBounds:[],coordinateOrigin:m.root.props.coordinateOrigin,coordinateSystem:m.root.props.coordinateSystem},i[g]=y}y.layers.push(m),y.layerBounds.push(m.getBounds())};for(o.s();!(s=o.n()).done;)var l=u()}catch(v){o.e(v)}finally{o.f()}for(var f=0;f<4;f++){var c=this.channels[f];(!c||!(c.id in i))&&(this.channels[f]=null)}for(var p in i){var d=i[p];d.index<0&&(d.index=this.channels.findIndex(function(v){return!v}),this.channels[d.index]=d)}return i}},{key:"getModuleParameters",value:function(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}},{key:"cleanup",value:function(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}]),t}();function OIe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=EIe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function EIe(t,r){if(t){if(typeof t=="string")return Cre(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Cre(t,r)}}function Cre(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var vM=2,Rre=function(){function t(){(0,Mre.default)(this,t),(0,Pr.default)(this,"id","collision-filter-effect"),(0,Pr.default)(this,"props",null),(0,Pr.default)(this,"useInPicking",!0),(0,Pr.default)(this,"order",1),(0,Pr.default)(this,"channels",{}),(0,Pr.default)(this,"collisionFilterPass",void 0),(0,Pr.default)(this,"collisionFBOs",{}),(0,Pr.default)(this,"dummyCollisionMap",void 0),(0,Pr.default)(this,"lastViewport",void 0)}return(0,Ire.default)(t,[{key:"preRender",value:function(e,n){var i,a=n.effects,o=n.layers,s=n.layerFilter,u=n.viewports,l=n.onViewportActive,f=n.views,c=n.isPicking,p=n.preRenderStats,d=p===void 0?{}:p;if(this.dummyCollisionMap||(this.dummyCollisionMap=new Se(e,{width:1,height:1})),!c){var v=o.filter(function(O){var w=O.props,E=w.visible,S=w.collisionEnabled;return E&&S});if(v.length===0){this.channels={};return}this.collisionFilterPass||(this.collisionFilterPass=new vre(e,{id:"default-collision-filter"}));var m=a?.filter(function(O){return O.constructor===s_}),g=(i=d["mask-effect"])===null||i===void 0?void 0:i.didRender,y=this._groupByCollisionGroup(e,v),_=u[0],b=!this.lastViewport||!this.lastViewport.equals(_)||g;for(var x in y){var A=this.collisionFBOs[x],T=y[x];A.resize({width:e.canvas.width/vM,height:e.canvas.height/vM}),this._render(T,{effects:m,layerFilter:s,onViewportActive:l,views:f,viewport:_,viewportChanged:b})}}}},{key:"_render",value:function(e,n){var i=n.effects,a=n.layerFilter,o=n.onViewportActive,s=n.views,u=n.viewport,l=n.viewportChanged,f=e.collisionGroup,c=this.channels[f];if(c){var p=l||e===c||!It(c.layers,e.layers,1)||e.layerBounds.some(function(v,m){return!tt(v,c.layerBounds[m])})||e.allLayersLoaded!==c.allLayersLoaded||e.layers.some(function(v){return v.props.transitions});if(this.channels[f]=e,p){this.lastViewport=u;var d=this.collisionFBOs[f];this.collisionFilterPass.renderCollisionMap(d,{pass:"collision-filter",isPicking:!0,layers:e.layers,effects:i,layerFilter:a,viewports:u?[u]:[],onViewportActive:o,views:s,moduleParameters:{dummyCollisionMap:this.dummyCollisionMap,devicePixelRatio:vr(d.gl)/vM}})}}}},{key:"_groupByCollisionGroup",value:function(e,n){var i={},a=OIe(n),o;try{for(a.s();!(o=a.n()).done;){var s=o.value,u=s.props.collisionGroup,l=i[u];l||(l={collisionGroup:u,layers:[],layerBounds:[],allLayersLoaded:!0},i[u]=l),l.layers.push(s),l.layerBounds.push(s.getBounds()),s.isLoaded||(l.allLayersLoaded=!1)}}catch(g){a.e(g)}finally{a.f()}for(var f=0,c=Object.keys(i);f<c.length;f++){var p=c[f];this.collisionFBOs[p]||this.createFBO(e,p),this.channels[p]||(this.channels[p]=i[p])}for(var d=0,v=Object.keys(this.collisionFBOs);d<v.length;d++){var m=v[d];i[m]||this.destroyFBO(m)}return i}},{key:"getModuleParameters",value:function(e){var n=e.props.collisionGroup,i=this.collisionFBOs,a=this.dummyCollisionMap;return{collisionFBO:i[n],dummyCollisionMap:a}}},{key:"cleanup",value:function(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(var e=0,n=Object.keys(this.collisionFBOs);e<n.length;e++){var i=n[e];this.destroyFBO(i)}this.collisionFBOs={},this.lastViewport=void 0}},{key:"createFBO",value:function(e,n){var i,a,o=e.canvas,s=o.width,u=o.height,l=new Se(e,{width:s,height:u,parameters:(i={},(0,Pr.default)(i,10241,9728),(0,Pr.default)(i,10240,9728),(0,Pr.default)(i,10242,33071),(0,Pr.default)(i,10243,33071),i)}),f=new Rr(e,{format:33189,width:s,height:u});this.collisionFBOs[n]=new Me(e,{id:"Collision-".concat(n),width:s,height:u,attachments:(a={},(0,Pr.default)(a,36064,l),(0,Pr.default)(a,36096,f),a)})}},{key:"destroyFBO",value:function(e){for(var n=this.collisionFBOs[e],i=0,a=Object.values(n.attachments);i<a.length;i++){var o=a[i];o.delete()}n.delete(),delete this.collisionFBOs[e]}}]),t}();function CIe(t){var r=MIe();return function(){var n=(0,mM.default)(t),i;if(r){var a=(0,mM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Fre.default)(this,i)}}function MIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var IIe={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}},u_=function(t){(0,Bre.default)(e,t);var r=CIe(e);function e(){return(0,Lre.default)(this,e),r.apply(this,arguments)}return(0,kre.default)(e,[{key:"getShaders",value:function(){return{modules:[sre]}}},{key:"draw",value:function(i){var a=i.uniforms,o=i.context,s=i.moduleParameters,u=this.props.collisionEnabled,l=s.collisionFBO,f=s.drawToCollisionMap,c=u&&Boolean(l);a.collision_enabled=c,f&&(this.props=this.clone(this.props.collisionTestProps).props)}},{key:"initializeState",value:function(i,a){var o;if(this.getAttributeManager()!==null){(o=this.context.deck)===null||o===void 0||o._addDefaultEffect(new Rre);var s=this.getAttributeManager();s.add({collisionPriorities:{size:1,accessor:"getCollisionPriority",shaderAttributes:{collisionPriorities:{divisor:0},instanceCollisionPriorities:{divisor:1}}}})}}},{key:"getNeedsPickingBuffer",value:function(){return this.props.collisionEnabled}}]),e}(jt);(0,gM.default)(u_,"defaultProps",IIe);(0,gM.default)(u_,"extensionName","CollisionFilterExtension");var Nre=h(L()),jre=h(N()),Ure=h(Y()),Gre=h(K()),yM=h(q()),_M=h(B());var RIe=`
uniform vec4 mask_bounds;
uniform bool mask_maskByInstance;
vec2 mask_getCoords(vec4 position) {
  return (position.xy - mask_bounds.xy) / (mask_bounds.zw - mask_bounds.xy);
}
`,LIe=`
uniform sampler2D mask_texture;
uniform int mask_channel;
uniform bool mask_enabled;
uniform bool mask_inverted;
bool mask_isInBounds(vec2 texCoords) {
  if (!mask_enabled) {
    return true;
  }
  vec4 maskColor = texture2D(mask_texture, texCoords);
  float maskValue = 1.0;
  if (mask_channel == 0) {
    maskValue = maskColor.r;
  } else if (mask_channel == 1) {
    maskValue = maskColor.g;
  } else if (mask_channel == 2) {
    maskValue = maskColor.b;
  } else if (mask_channel == 3) {
    maskValue = maskColor.a;
  }

  if (mask_inverted) {
    return maskValue >= 0.5;
  } else {
    return maskValue < 0.5;
  }
}
`,kIe={"vs:#decl":`
varying vec2 mask_texCoords;
`,"vs:#main-end":`
   vec4 mask_common_position;
   if (mask_maskByInstance) {
     mask_common_position = project_position(vec4(geometry.worldPosition, 1.0));
   } else {
     mask_common_position = geometry.position;
   }
   mask_texCoords = mask_getCoords(mask_common_position);
`,"fs:#decl":`
varying vec2 mask_texCoords;
`,"fs:#main-start":`
  if (mask_enabled) {
    bool mask = mask_isInBounds(mask_texCoords);

    // Debug: show extent of render target
    // gl_FragColor = vec4(mask_texCoords, 0.0, 1.0);
    gl_FragColor = texture2D(mask_texture, mask_texCoords);

    if (!mask) discard;
  }
`},BIe=function(r){return r&&"maskMap"in r?{mask_texture:r.maskMap}:{}},Dre={name:"mask",dependencies:[Yt],vs:RIe,fs:LIe,inject:kIe,getUniforms:BIe};function FIe(t){var r=DIe();return function(){var n=(0,yM.default)(t),i;if(r){var a=(0,yM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Gre.default)(this,i)}}function DIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var NIe={maskId:"",maskByInstance:void 0,maskInverted:!1},l_=function(t){(0,Ure.default)(e,t);var r=FIe(e);function e(){return(0,Nre.default)(this,e),r.apply(this,arguments)}return(0,jre.default)(e,[{key:"initializeState",value:function(){var i;(i=this.context.deck)===null||i===void 0||i._addDefaultEffect(new s_)}},{key:"getShaders",value:function(){var i="instancePositions"in this.getAttributeManager().attributes;return this.props.maskByInstance!==void 0&&(i=Boolean(this.props.maskByInstance)),this.state.maskByInstance=i,{modules:[Dre]}}},{key:"draw",value:function(i){var a=i.uniforms,o=i.context,s=i.moduleParameters;a.mask_maskByInstance=this.state.maskByInstance;var u=this.props,l=u.maskId,f=u.maskInverted,c=s.maskChannels,p=o.viewport;if(c&&c[l]){var d=c[l],v=d.index,m=d.bounds,g=d.coordinateOrigin,y=c[l].coordinateSystem;a.mask_enabled=!0,a.mask_channel=v,a.mask_inverted=f,y===se.DEFAULT&&(y=p.isGeospatial?se.LNGLAT:se.CARTESIAN);var _={modelMatrix:null,fromCoordinateOrigin:g,fromCoordinateSystem:y},b=this.projectPosition([m[0],m[1],0],_),x=this.projectPosition([m[2],m[3],0],_);a.mask_bounds=[b[0],b[1],x[0],x[1]]}else l&&Z.warn("Could not find a mask layer with id: ".concat(l))(),a.mask_enabled=!1}}]),e}(jt);(0,_M.default)(l_,"defaultProps",NIe);(0,_M.default)(l_,"extensionName","MaskExtension");var xne=h(L()),Ane=h(N()),Tne=h(Y()),Sne=h(K()),TM=h(q()),SM=h(B());var gne=h(ye()),yne=h(L()),_ne=h(N()),Rn=h(B());var Hi={NONE:0,WRITE_HEIGHT_MAP:1,USE_HEIGHT_MAP:2,USE_COVER:3,USE_COVER_ONLY:4,SKIP:5},zre=Object.keys(Hi).map(function(t){return"const float TERRAIN_MODE_".concat(t," = ").concat(Hi[t],".0;")}).join(`
`),f_={name:"terrain",dependencies:[Yt],inject:{"vs:#decl":`
uniform float terrain_mode;
uniform sampler2D terrain_map;
uniform vec4 terrain_bounds;
varying vec3 commonPos;
`.concat(zre,`
    `),"vs:#main-start":`
if (terrain_mode == TERRAIN_MODE_SKIP) {
  gl_Position = vec4(0.0);
  return;
}
`,"vs:DECKGL_FILTER_GL_POSITION":`
commonPos = geometry.position.xyz;
if (terrain_mode == TERRAIN_MODE_WRITE_HEIGHT_MAP) {
  vec2 texCoords = (commonPos.xy - terrain_bounds.xy) / terrain_bounds.zw;
  position = vec4(texCoords * 2.0 - 1.0, 0.0, 1.0);
  commonPos.z += project_uCommonOrigin.z;
}
if (terrain_mode == TERRAIN_MODE_USE_HEIGHT_MAP) {
  vec3 anchor = geometry.worldPosition;
  anchor.z = 0.0;
  vec3 anchorCommon = project_position(anchor);
  vec2 texCoords = (anchorCommon.xy - terrain_bounds.xy) / terrain_bounds.zw;
  if (texCoords.x >= 0.0 && texCoords.y >= 0.0 && texCoords.x <= 1.0 && texCoords.y <= 1.0) {
    float terrainZ = texture2D(terrain_map, texCoords).r;
    geometry.position.z += terrainZ;
    position = project_common_position_to_clipspace(geometry.position);
  }
}
    `,"fs:#decl":`
uniform float terrain_mode;
uniform sampler2D terrain_map;
uniform vec4 terrain_bounds;
varying vec3 commonPos;
`.concat(zre,`
    `),"fs:#main-start":`
if (terrain_mode == TERRAIN_MODE_WRITE_HEIGHT_MAP) {
  gl_FragColor = vec4(commonPos.z, 0.0, 0.0, 1.0);
  return;
}
    `,"fs:DECKGL_FILTER_COLOR":`
if ((terrain_mode == TERRAIN_MODE_USE_COVER) || (terrain_mode == TERRAIN_MODE_USE_COVER_ONLY)) {
  vec2 texCoords = (commonPos.xy - terrain_bounds.xy) / terrain_bounds.zw;
  vec4 pixel = texture2D(terrain_map, texCoords);
  if (terrain_mode == TERRAIN_MODE_USE_COVER_ONLY) {
    color = pixel;
  } else {
    // pixel is premultiplied
    color = pixel + color * (1.0 - pixel.a);
  }
  return;
}
    `},getUniforms:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;if("dummyHeightMap"in r){var n=r.drawToTerrainHeightMap,i=r.heightMap,a=r.heightMapBounds,o=r.dummyHeightMap,s=r.terrainCover,u=r.useTerrainHeightMap,l=r.terrainSkipRender,f=e.project_uCommonOrigin,c=l?Hi.SKIP:Hi.NONE,p=o,d=null;if(n)c=Hi.WRITE_HEIGHT_MAP,d=a;else if(u&&i)c=Hi.USE_HEIGHT_MAP,p=i,d=a;else if(s){var v=r.pickingActive;p=v?s.getPickingFramebuffer():s.getRenderFramebuffer(),v&&(c=Hi.SKIP),p?(c=c===Hi.SKIP?Hi.USE_COVER_ONLY:Hi.USE_COVER,d=s.bounds):p=o}return{terrain_mode:c,terrain_map:p,terrain_bounds:d?[d[0]-f[0],d[1]-f[1],d[2]-d[0],d[3]-d[1]]:[0,0,0,0]}}return null}};var $re=h(L()),Xre=h(N()),li=h(B());var ou=h(B());function Vre(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Hre(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Vre(Object(e),!0).forEach(function(n){(0,ou.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Vre(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function id(t,r){var e;return new Me(t,{id:r.id,attachments:(0,ou.default)({},36064,new Se(t,Hre(Hre({},r.float&&{format:fe(t)?34836:6408,type:5126}),{},{mipmaps:!1,parameters:(e={},(0,ou.default)(e,10241,9729),(0,ou.default)(e,10240,9729),(0,ou.default)(e,10242,33071),(0,ou.default)(e,10243,33071),e)})))})}function jIe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=UIe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function UIe(t,r){if(t){if(typeof t=="string")return Wre(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Wre(t,r)}}function Wre(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var qre=function(){function t(r){(0,$re.default)(this,t),(0,li.default)(this,"isDirty",!0),(0,li.default)(this,"targetLayer",void 0),(0,li.default)(this,"renderViewport",null),(0,li.default)(this,"bounds",null),(0,li.default)(this,"fbo",void 0),(0,li.default)(this,"pickingFbo",void 0),(0,li.default)(this,"layers",[]),(0,li.default)(this,"tile",void 0),(0,li.default)(this,"targetBounds",null),(0,li.default)(this,"targetBoundsCommon",null),this.targetLayer=r,this.tile=Yre(r)}return(0,Xre.default)(t,[{key:"id",get:function(){return this.targetLayer.id}},{key:"isActive",get:function(){return Boolean(this.targetLayer.getCurrentLayer())}},{key:"shouldUpdate",value:function(e){var n=e.targetLayer,i=e.viewport,a=e.layers,o=e.layerNeedsRedraw;n&&(this.targetLayer=n);var s=i?this._updateViewport(i):!1,u=a?this._updateLayers(a):!1;if(o){var l=jIe(this.layers),f;try{for(l.s();!(f=l.n()).done;){var c=f.value;if(o[c]){u=!0;break}}}catch(p){l.e(p)}finally{l.f()}}return u||s}},{key:"_updateLayers",value:function(e){var n=!1;if(e=this.tile?GIe(this.tile,e):e,e.length!==this.layers.length)n=!0;else for(var i=0;i<e.length;i++){var a=e[i].id;if(a!==this.layers[i]){n=!0;break}}return n&&(this.layers=e.map(function(o){return o.id})),n}},{key:"_updateViewport",value:function(e){var n=this.targetLayer,i=!1;if(this.tile&&"boundingBox"in this.tile){if(!this.targetBounds){i=!0,this.targetBounds=this.tile.boundingBox;var a=e.projectPosition(this.targetBounds[0]),o=e.projectPosition(this.targetBounds[1]);this.targetBoundsCommon=[a[0],a[1],o[0],o[1]]}}else this.targetBounds!==n.getBounds()&&(i=!0,this.targetBounds=n.getBounds(),this.targetBoundsCommon=mf([n],e));if(!this.targetBoundsCommon)return!1;var s=Math.ceil(e.zoom+.5);if(this.tile)this.bounds=this.targetBoundsCommon;else{var u,l=(u=this.renderViewport)===null||u===void 0?void 0:u.zoom;i=i||s!==l;var f=yf(this.targetBoundsCommon,e),c=this.bounds;i=i||!c||f.some(function(p,d){return p!==c[d]}),this.bounds=f}return i&&(this.renderViewport=gf({bounds:this.bounds,zoom:s,viewport:e})),i}},{key:"getRenderFramebuffer",value:function(){return!this.renderViewport||this.layers.length===0?null:(this.fbo||(this.fbo=id(this.targetLayer.context.gl,{id:this.id})),this.fbo)}},{key:"getPickingFramebuffer",value:function(){return!this.renderViewport||this.layers.length===0&&!this.targetLayer.props.pickable?null:(this.pickingFbo||(this.pickingFbo=id(this.targetLayer.context.gl,{id:"".concat(this.id,"-picking")})),this.pickingFbo)}},{key:"filterLayers",value:function(e){var n=this;return e.filter(function(i){var a=i.id;return n.layers.includes(a)})}},{key:"delete",value:function(){var e=this.fbo,n=this.pickingFbo;e&&(e.texture.delete(),e.delete()),n&&(n.texture.delete(),n.delete())}}]),t}();function GIe(t,r){return r.filter(function(e){var n=Yre(e);return n?zIe(t.boundingBox,n.boundingBox):!0})}function Yre(t){for(;t;){var r=t.props.tile;if(r)return r;t=t.parent}return null}function zIe(t,r){return t&&r?t[0][0]<r[1][0]&&r[0][0]<t[1][0]&&t[0][1]<r[1][1]&&r[0][1]<t[1][1]:!1}var Jre=h(B()),Zre=h(L()),Qre=h(N()),ene=h(Y()),tne=h(K()),bM=h(q());function Kre(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function c_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Kre(Object(e),!0).forEach(function(n){(0,Jre.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Kre(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function VIe(t){var r=HIe();return function(){var n=(0,bM.default)(t),i;if(r){var a=(0,bM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,tne.default)(this,i)}}function HIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rne=function(t){(0,ene.default)(e,t);var r=VIe(e);function e(){return(0,Zre.default)(this,e),r.apply(this,arguments)}return(0,Qre.default)(e,[{key:"getRenderableLayers",value:function(i,a){for(var o=a.layers,s=[],u=this._getDrawLayerParams(i,a,!0),l=0;l<o.length;l++){var f=o[l];!f.isComposite&&u[l].shouldDrawLayer&&s.push(f)}return s}},{key:"renderHeightMap",value:function(i,a){var o=this,s=i.getRenderFramebuffer(),u=i.renderViewport;!s||!u||(s.resize(u),Ie(this.gl,{clearColor:[0,0,0,0],blend:!0,blendFunc:[1,1],blendEquation:32776,depthTest:!1},function(){return o.render(c_(c_({},a),{},{target:s,pass:"terrain-height-map",layers:a.layers,viewports:[u],effects:[]}))}))}},{key:"renderTerrainCover",value:function(i,a){var o=this,s=i.getRenderFramebuffer(),u=i.renderViewport;if(!(!s||!u)){var l=i.filterLayers(a.layers);s.resize(u),Ie(this.gl,{depthTest:!1},function(){return o.render(c_(c_({},a),{},{target:s,pass:"terrain-cover-".concat(i.id),layers:l,effects:[],viewports:[u]}))})}}}]),e}(Vr);var ane=h(L()),one=h(N()),sne=h(_e()),une=h(Oe()),lne=h(Y()),fne=h(K()),p_=h(q()),xM=h(B());function nne(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ine(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?nne(Object(e),!0).forEach(function(n){(0,xM.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):nne(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function WIe(t){var r=$Ie();return function(){var n=(0,p_.default)(t),i;if(r){var a=(0,p_.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,fne.default)(this,i)}}function $Ie(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cne=function(t){(0,lne.default)(e,t);var r=WIe(e);function e(){var n;(0,ane.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,xM.default)((0,sne.default)(n),"drawParameters",{}),n}return(0,one.default)(e,[{key:"getRenderableLayers",value:function(i,a){var o=a.layers,s=[];this.drawParameters={},this._resetColorEncoder(a.pickZ);for(var u=this._getDrawLayerParams(i,a),l=0;l<o.length;l++){var f=o[l];!f.isComposite&&u[l].shouldDrawLayer&&(s.push(f),this.drawParameters[f.id]=u[l].layerParameters)}return s}},{key:"renderTerrainCover",value:function(i,a){var o=this,s=i.getPickingFramebuffer(),u=i.renderViewport;if(!(!s||!u)){var l=i.filterLayers(a.layers),f=i.targetLayer;f.props.pickable&&l.unshift(f),s.resize(u),Ie(this.gl,{depthTest:!1},function(){return o.render(ine(ine({},a),{},{pickingFBO:s,pass:"terrain-cover-picking-".concat(i.id),layers:l,effects:[],viewports:[u],cullRect:void 0,deviceRect:u,pickZ:!1}))})}}},{key:"getLayerParameters",value:function(i,a,o){if(this.drawParameters[i.id])return this.drawParameters[i.id];var s=(0,une.default)((0,p_.default)(e.prototype),"getLayerParameters",this).call(this,i,a,o);return s.blend=!0,s}}]),e}(oo);var hne=h(L()),dne=h(N()),Ua=h(B());var pne=2048,AM=function(){function t(r){(0,hne.default)(this,t),(0,Ua.default)(this,"renderViewport",null),(0,Ua.default)(this,"bounds",null),(0,Ua.default)(this,"fbo",void 0),(0,Ua.default)(this,"gl",void 0),(0,Ua.default)(this,"layers",[]),(0,Ua.default)(this,"layersBounds",[]),(0,Ua.default)(this,"layersBoundsCommon",null),(0,Ua.default)(this,"lastViewport",null),this.gl=r}return(0,dne.default)(t,[{key:"getRenderFramebuffer",value:function(){return this.renderViewport?(this.fbo||(this.fbo=id(this.gl,{id:"height-map",float:!0})),this.fbo):null}},{key:"shouldUpdate",value:function(e){var n=this,i=e.layers,a=e.viewport,o=i.length!==this.layers.length||i.some(function(p,d){return p!==n.layers[d]||p.props.transitions||p.getBounds()!==n.layersBounds[d]});o&&(this.layers=i,this.layersBounds=i.map(function(p){return p.getBounds()}),this.layersBoundsCommon=mf(i,a));var s=!this.lastViewport||!a.equals(this.lastViewport);if(!this.layersBoundsCommon)this.renderViewport=null;else if(o||s){var u=yf(this.layersBoundsCommon,a);if(u[2]<=u[0]||u[3]<=u[1])return this.renderViewport=null,!1;this.bounds=u,this.lastViewport=a;var l=a.scale,f=(u[2]-u[0])*l,c=(u[3]-u[1])*l;return this.renderViewport=f>0||c>0?gf({bounds:[a.center[0]-1,a.center[1]-1,a.center[0]+1,a.center[1]+1],zoom:a.zoom,width:Math.min(f,pne),height:Math.min(c,pne),viewport:a}):null,!0}return!1}},{key:"delete",value:function(){this.fbo&&(this.fbo.color.delete(),this.fbo.delete())}}],[{key:"isSupported",value:function(e){return Me.isSupported(e,{colorBufferFloat:!0})}}]),t}();function vne(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function h_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?vne(Object(e),!0).forEach(function(n){(0,Rn.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):vne(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function _f(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=XIe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function XIe(t,r){if(t){if(typeof t=="string")return mne(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return mne(t,r)}}function mne(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var bne=function(){function t(){(0,yne.default)(this,t),(0,Rn.default)(this,"id","terrain-effect"),(0,Rn.default)(this,"props",null),(0,Rn.default)(this,"useInPicking",!0),(0,Rn.default)(this,"isPicking",!1),(0,Rn.default)(this,"isDrapingEnabled",!1),(0,Rn.default)(this,"dummyHeightMap",void 0),(0,Rn.default)(this,"heightMap",void 0),(0,Rn.default)(this,"terrainPass",void 0),(0,Rn.default)(this,"terrainPickingPass",void 0),(0,Rn.default)(this,"terrainCovers",new Map)}return(0,_ne.default)(t,[{key:"initialize",value:function(e){this.dummyHeightMap=new Se(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])}),this.terrainPass=new rne(e,{id:"terrain"}),this.terrainPickingPass=new cne(e,{id:"terrain-picking"}),AM.isSupported(e)?this.heightMap=new AM(e):Z.warn("Terrain offset mode is not supported by this browser")(),_n.getDefaultProgramManager(e).addDefaultModule(f_)}},{key:"preRender",value:function(e,n){if(!this.dummyHeightMap){this.initialize(e);var i=_f(n.layers),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.props.operation.includes("terrain")&&o.setChangeFlags({extensionsChanged:!0})}}catch(m){i.e(m)}finally{i.f()}}if(n.pickZ){this.isDrapingEnabled=!1;return}var s=n.viewports,u=n.isPicking,l=u===void 0?!1:u;this.isPicking=l,this.isDrapingEnabled=!0;var f=s[0],c=(l?this.terrainPickingPass:this.terrainPass).getRenderableLayers(f,n),p=c.filter(function(m){return m.props.operation.includes("terrain")});if(p.length!==0){if(!l){var d=c.filter(function(m){return m.state.terrainDrawMode==="offset"});d.length>0&&this._updateHeightMap(p,f,n)}var v=c.filter(function(m){return m.state.terrainDrawMode==="drape"});this._updateTerrainCovers(p,v,f,n)}}},{key:"getModuleParameters",value:function(e){var n,i,a=e.state.terrainDrawMode;return{heightMap:(n=this.heightMap)===null||n===void 0?void 0:n.getRenderFramebuffer(),heightMapBounds:(i=this.heightMap)===null||i===void 0?void 0:i.bounds,dummyHeightMap:this.dummyHeightMap,terrainCover:this.isDrapingEnabled?this.terrainCovers.get(e.id):null,useTerrainHeightMap:a==="offset",terrainSkipRender:a==="drape"||!e.props.operation.includes("draw")}}},{key:"cleanup",value:function(){this.dummyHeightMap&&(this.dummyHeightMap.delete(),this.dummyHeightMap=void 0),this.heightMap&&(this.heightMap.delete(),this.heightMap=void 0);var e=_f(this.terrainCovers.values()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.terrainCovers.clear()}},{key:"_updateHeightMap",value:function(e,n,i){if(this.heightMap){var a=this.heightMap.shouldUpdate({layers:e,viewport:n});a&&this.terrainPass.renderHeightMap(this.heightMap,h_(h_({},i),{},{layers:e,moduleParameters:{heightMapBounds:this.heightMap.bounds,dummyHeightMap:this.dummyHeightMap,devicePixelRatio:1,drawToTerrainHeightMap:!0}}))}}},{key:"_updateTerrainCovers",value:function(e,n,i,a){var o={},s=_f(n),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;l.state.terrainCoverNeedsRedraw&&(o[l.id]=!0,l.state.terrainCoverNeedsRedraw=!1)}}catch(g){s.e(g)}finally{s.f()}var f=_f(this.terrainCovers.values()),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;p.isDirty=p.isDirty||p.shouldUpdate({layerNeedsRedraw:o})}}catch(g){f.e(g)}finally{f.f()}var d=_f(e),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;this._updateTerrainCover(m,n,i,a)}}catch(g){d.e(g)}finally{d.f()}this.isPicking||this._pruneTerrainCovers()}},{key:"_updateTerrainCover",value:function(e,n,i,a){var o=this.isPicking?this.terrainPickingPass:this.terrainPass,s=this.terrainCovers.get(e.id);s||(s=new qre(e),this.terrainCovers.set(e.id,s));try{var u=s.shouldUpdate({targetLayer:e,viewport:i,layers:n});(this.isPicking||s.isDirty||u)&&(o.renderTerrainCover(s,h_(h_({},a),{},{layers:n,moduleParameters:{dummyHeightMap:this.dummyHeightMap,terrainSkipRender:!1,devicePixelRatio:1}})),s.isDirty=!1)}catch(l){e.raiseError(l,"Error rendering terrain cover ".concat(s.id))}}},{key:"_pruneTerrainCovers",value:function(){var e=[],n=_f(this.terrainCovers),i;try{for(n.s();!(i=n.n()).done;){var a=(0,gne.default)(i.value,2),o=a[0],s=a[1];s.isActive||e.push(o)}}catch(c){n.e(c)}finally{n.f()}for(var u=0,l=e;u<l.length;u++){var f=l[u];this.terrainCovers.delete(f)}}}]),t}();function qIe(t){var r=YIe();return function(){var n=(0,TM.default)(t),i;if(r){var a=(0,TM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Sne.default)(this,i)}}function YIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var KIe={terrainDrawMode:void 0},d_=function(t){(0,Tne.default)(e,t);var r=qIe(e);function e(){return(0,xne.default)(this,e),r.apply(this,arguments)}return(0,Ane.default)(e,[{key:"getShaders",value:function(){return{modules:[f_]}}},{key:"initializeState",value:function(){var i;(i=this.context.deck)===null||i===void 0||i._addDefaultEffect(new bne)}},{key:"updateState",value:function(i){var a=i.props,o=i.oldProps;if(!(this.state.terrainDrawMode&&a.terrainDrawMode===o.terrainDrawMode&&a.extruded===o.extruded)){var s=a.terrainDrawMode;if(!s){var u,l=this.props.extruded,f=(u=this.getAttributeManager())===null||u===void 0?void 0:u.attributes,c=f&&"instancePositions"in f;s=l||c?"offset":"drape"}this.setState({terrainDrawMode:s})}}},{key:"onNeedsRedraw",value:function(){var i=this.state;i.terrainDrawMode==="drape"&&(i.terrainCoverNeedsRedraw=!0)}}]),e}(jt);(0,SM.default)(d_,"defaultProps",KIe);(0,SM.default)(d_,"extensionName","TerrainExtension");var yie=h(ge()),_ie=h(B()),DM=h(de());var vie=h(ye());var One=h(B());function OM(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=JIe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function JIe(t,r){if(t){if(typeof t=="string")return Pne(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Pne(t,r)}}function Pne(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function wne(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function su(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?wne(Object(e),!0).forEach(function(n){(0,One.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):wne(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function EM(t,r,e){var n=ZIe(t),i=Object.keys(n).filter(function(a){return n[a]!==Array});return QIe(t,su({propArrayTypes:n},r),{numericPropKeys:e&&e.numericPropKeys||i,PositionDataType:e?e.PositionDataType:Float32Array})}function ZIe(t){var r={},e=OM(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(i.properties)for(var a in i.properties){var o=i.properties[a];r[a]=aRe(o,r[a])}}}catch(s){e.e(s)}finally{e.f()}return r}function QIe(t,r,e){for(var n=r.pointPositionsCount,i=r.pointFeaturesCount,a=r.linePositionsCount,o=r.linePathsCount,s=r.lineFeaturesCount,u=r.polygonPositionsCount,l=r.polygonObjectsCount,f=r.polygonRingsCount,c=r.polygonFeaturesCount,p=r.propArrayTypes,d=r.coordLength,v=e.numericPropKeys,m=v===void 0?[]:v,g=e.PositionDataType,y=g===void 0?Float32Array:g,_=t[0]&&("id"in t[0]),b=t.length>65535?Uint32Array:Uint16Array,x={type:"Point",positions:new y(n*d),globalFeatureIds:new b(n),featureIds:i>65535?new Uint32Array(n):new Uint16Array(n),numericProps:{},properties:[],fields:[]},A={type:"LineString",pathIndices:a>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new y(a*d),globalFeatureIds:new b(a),featureIds:s>65535?new Uint32Array(a):new Uint16Array(a),numericProps:{},properties:[],fields:[]},T={type:"Polygon",polygonIndices:u>65535?new Uint32Array(l+1):new Uint16Array(l+1),primitivePolygonIndices:u>65535?new Uint32Array(f+1):new Uint16Array(f+1),positions:new y(u*d),triangles:[],globalFeatureIds:new b(u),featureIds:c>65535?new Uint32Array(u):new Uint16Array(u),numericProps:{},properties:[],fields:[]},O=0,w=[x,A,T];O<w.length;O++){var E=w[O],S=OM(m),I;try{for(S.s();!(I=S.n()).done;){var R=I.value,z=p[R];E.numericProps[R]=new z(E.positions.length/d)}}catch(Q){S.e(Q)}finally{S.f()}}A.pathIndices[o]=a,T.polygonIndices[l]=u,T.primitivePolygonIndices[f]=u;var G={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0},k=OM(t),U;try{for(k.s();!(U=k.n()).done;){var j=U.value,X=j.geometry,H=j.properties||{};switch(X.type){case"Point":eRe(X,x,G,d,H),x.properties.push(wM(H,m)),_&&x.fields.push({id:j.id}),G.pointFeature++;break;case"LineString":tRe(X,A,G,d,H),A.properties.push(wM(H,m)),_&&A.fields.push({id:j.id}),G.lineFeature++;break;case"Polygon":rRe(X,T,G,d,H),T.properties.push(wM(H,m)),_&&T.fields.push({id:j.id}),G.polygonFeature++;break;default:throw new Error("Invalid geometry type")}G.feature++}}catch(Q){k.e(Q)}finally{k.f()}return iRe(x,A,T,d)}function eRe(t,r,e,n,i){r.positions.set(t.data,e.pointPosition*n);var a=t.data.length/n;CM(r,i,e.pointPosition,a),r.globalFeatureIds.fill(e.feature,e.pointPosition,e.pointPosition+a),r.featureIds.fill(e.pointFeature,e.pointPosition,e.pointPosition+a),e.pointPosition+=a}function tRe(t,r,e,n,i){r.positions.set(t.data,e.linePosition*n);var a=t.data.length/n;CM(r,i,e.linePosition,a),r.globalFeatureIds.fill(e.feature,e.linePosition,e.linePosition+a),r.featureIds.fill(e.lineFeature,e.linePosition,e.linePosition+a);for(var o=0,s=t.indices.length;o<s;++o){var u=t.indices[o],l=o===s-1?t.data.length:t.indices[o+1];r.pathIndices[e.linePath++]=e.linePosition,e.linePosition+=(l-u)/n}}function rRe(t,r,e,n,i){r.positions.set(t.data,e.polygonPosition*n);var a=t.data.length/n;CM(r,i,e.polygonPosition,a),r.globalFeatureIds.fill(e.feature,e.polygonPosition,e.polygonPosition+a),r.featureIds.fill(e.polygonFeature,e.polygonPosition,e.polygonPosition+a);for(var o=0,s=t.indices.length;o<s;++o){var u=e.polygonPosition;r.polygonIndices[e.polygonObject++]=u;for(var l=t.areas[o],f=t.indices[o],c=t.indices[o+1],p=0,d=f.length;p<d;++p){var v=f[p],m=p===d-1?c===void 0?t.data.length:c[0]:f[p+1];r.primitivePolygonIndices[e.polygonRing++]=e.polygonPosition,e.polygonPosition+=(m-v)/n}var g=e.polygonPosition;nRe(r,l,f,{startPosition:u,endPosition:g,coordLength:n})}}function nRe(t,r,e,n){for(var i=n.startPosition,a=n.endPosition,o=n.coordLength,s=i*o,u=a*o,l=t.positions.subarray(s,u),f=e[0],c=e.slice(1).map(function(m){return(m-f)/o}),p=uP(l,c,o,r),d=0,v=p.length;d<v;++d)t.triangles.push(i+p[d])}function PM(t,r){var e={};for(var n in t)e[n]={value:t[n],size:r};return e}function iRe(t,r,e,n){return{points:su(su({},t),{},{positions:{value:t.positions,size:n},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:PM(t.numericProps,1)}),lines:su(su({},r),{},{positions:{value:r.positions,size:n},pathIndices:{value:r.pathIndices,size:1},globalFeatureIds:{value:r.globalFeatureIds,size:1},featureIds:{value:r.featureIds,size:1},numericProps:PM(r.numericProps,1)}),polygons:su(su({},e),{},{positions:{value:e.positions,size:n},polygonIndices:{value:e.polygonIndices,size:1},primitivePolygonIndices:{value:e.primitivePolygonIndices,size:1},triangles:{value:new Uint32Array(e.triangles),size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:PM(e.numericProps,1)})}}function CM(t,r,e,n){for(var i in t.numericProps)if(i in r){var a=r[i];t.numericProps[i].fill(a,e,e+n)}}function wM(t,r){var e={};for(var n in t)r.includes(n)||(e[n]=t[n]);return e}function aRe(t,r){return r===Array||!Number.isFinite(t)?Array:r===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}var Mne=h(B());function Ene(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function oRe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Ene(Object(e),!0).forEach(function(n){(0,Mne.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Ene(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Ine(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=sRe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function sRe(t,r){if(t){if(typeof t=="string")return Cne(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Cne(t,r)}}function Cne(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function g_(t,r){var e=r?.globalFeatureId;return e!==void 0?uRe(t,e):lRe(t,r?.type)}function uRe(t,r){var e=Lne(t),n=Ine(e),i;try{for(n.s();!(i=n.n()).done;){for(var a=i.value,o=0,s=a.featureIds.value[0],u=0;u<a.featureIds.value.length;u++){var l=a.featureIds.value[u];if(l!==s){if(r===a.globalFeatureIds.value[o])return v_(a,o,u);o=u,s=l}}if(r===a.globalFeatureIds.value[o])return v_(a,o,a.featureIds.value.length)}}catch(f){n.e(f)}finally{n.f()}throw new Error("featureId:".concat(r," not found"))}function lRe(t,r){var e=Lne(t,r);return fRe(e)}function Rne(t,r,e){switch(t.type){case"Point":return dRe(t,r,e);case"LineString":return hRe(t,r,e);case"Polygon":return kne(t,r,e);default:var n=t;throw new Error("Unsupported geometry type: ".concat(n?.type))}}function Lne(t,r){var e=Boolean(t.points||t.lines||t.polygons);if(!e)return t.type=r||vRe(t),[t];var n=[];return t.points&&(t.points.type="Point",n.push(t.points)),t.lines&&(t.lines.type="LineString",n.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",n.push(t.polygons)),n}function fRe(t){var r=[],e=Ine(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(i.featureIds.value.length!==0){for(var a=0,o=i.featureIds.value[0],s=0;s<i.featureIds.value.length;s++){var u=i.featureIds.value[s];u!==o&&(r.push(v_(i,a,s)),a=s,o=u)}r.push(v_(i,a,i.featureIds.value.length))}}}catch(l){e.e(l)}finally{e.f()}return r}function v_(t,r,e){var n=Rne(t,r,e),i=pRe(t,r,e),a=cRe(t,r,e);return oRe({type:"Feature",geometry:n,properties:i},a)}function cRe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;return t.fields&&t.fields[t.featureIds.value[r]]}function pRe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,n=Object.assign({},t.properties[t.featureIds.value[r]]);for(var i in t.numericProps)n[i]=t.numericProps[i].value[r];return n}function kne(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1/0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=t.positions,i=t.polygonIndices.value.filter(function(y){return y>=r&&y<=e}),a=t.primitivePolygonIndices.value.filter(function(y){return y>=r&&y<=e}),o=i.length>2;if(!o){for(var s=[],u=0;u<a.length-1;u++){var l=a[u],f=a[u+1],c=m_(n,l,f);s.push(c)}return{type:"Polygon",coordinates:s}}for(var p=[],d=0;d<i.length-1;d++){var v=i[d],m=i[d+1],g=kne(t,v,m).coordinates;p.push(g)}return{type:"MultiPolygon",coordinates:p}}function hRe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1/0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=t.positions,i=t.pathIndices.value.filter(function(f){return f>=r&&f<=e}),a=i.length>2;if(!a){var o=m_(n,i[0],i[1]);return{type:"LineString",coordinates:o}}for(var s=[],u=0;u<i.length-1;u++){var l=m_(n,i[u],i[u+1]);s.push(l)}return{type:"MultiLineString",coordinates:s}}function dRe(t,r,e){var n=t.positions,i=m_(n,r,e),a=i.length>1;return a?{type:"MultiPoint",coordinates:i}:{type:"Point",coordinates:i[0]}}function m_(t,r,e){r=r||0,e=e||t.value.length/t.size;for(var n=[],i=r;i<e;i++){for(var a=Array(),o=i*t.size;o<(i+1)*t.size;o++)a.push(Number(t.value[o]));n.push(a)}return n}function vRe(t){return t.pathIndices?"LineString":t.polygonIndices?"Polygon":"Point"}var FM=h(Gne());var Kne=h(L());var Xne=h(L()),qne=h(N());var Hne=h(L()),Wne=h(N());function zne(t){var r=t.length;if(r<=1)return[t];for(var e=[],n,i,a=0;a<r;a++){var o=LRe(t[a]);o!==0&&(i===void 0&&(i=o<0),i===o<0?(n&&e.push(n),n=[t[a]]):n&&n.push(t[a]))}return n&&e.push(n),e}function LRe(t){for(var r=0,e=0,n=t.length-1,i,a;e<t.length;n=e++)i=t[e],a=t[n],r+=(a[0]-i[0])*(i[1]+a[1]);return r}function Vne(t,r,e){r&&e&&(t===1?r.id=e.readVarint():t===2?kRe(e,r):t===3?r.type=e.readVarint():t===4&&(r._geometry=e.pos))}function kRe(t,r){for(var e=t.readVarint()+t.pos;t.pos<e;){var n=r._keys[t.readVarint()],i=r._values[t.readVarint()];r.properties[n]=i}}var $ne=function(){function t(r,e,n,i,a){(0,Hne.default)(this,t),C(this,"properties",void 0),C(this,"extent",void 0),C(this,"type",void 0),C(this,"id",void 0),C(this,"_pbf",void 0),C(this,"_geometry",void 0),C(this,"_keys",void 0),C(this,"_values",void 0),this.properties={},this.extent=n,this.type=0,this.id=null,this._pbf=r,this._geometry=-1,this._keys=i,this._values=a,r.readFields(Vne,this,e)}return(0,Wne.default)(t,[{key:"loadGeometry",value:function(){var e=this._pbf;e.pos=this._geometry;for(var n=e.readVarint()+e.pos,i=1,a=0,o=0,s=0,u=[],l;e.pos<n;){if(a<=0){var f=e.readVarint();i=f&7,a=f>>3}if(a--,i===1||i===2)o+=e.readSVarint(),s+=e.readSVarint(),i===1&&(l&&u.push(l),l=[]),l&&l.push([o,s]);else if(i===7)l&&l.push(l[0].slice());else throw new Error("unknown command ".concat(i))}return l&&u.push(l),u}},{key:"bbox",value:function(){var e=this._pbf;e.pos=this._geometry;for(var n=e.readVarint()+e.pos,i=1,a=0,o=0,s=0,u=1/0,l=-1/0,f=1/0,c=-1/0;e.pos<n;){if(a<=0){var p=e.readVarint();i=p&7,a=p>>3}if(a--,i===1||i===2)o+=e.readSVarint(),s+=e.readSVarint(),o<u&&(u=o),o>l&&(l=o),s<f&&(f=s),s>c&&(c=s);else if(i!==7)throw new Error("unknown command ".concat(i))}return[u,f,l,c]}},{key:"_toGeoJSON",value:function(e){var n=this.loadGeometry(),i=t.types[this.type],a,o;switch(this.type){case 1:var s=[];for(a=0;a<n.length;a++)s[a]=n[a][0];n=s,e(n,this);break;case 2:for(a=0;a<n.length;a++)e(n[a],this);break;case 3:for(n=zne(n),a=0;a<n.length;a++)for(o=0;o<n[a].length;o++)e(n[a][o],this);break}n.length===1?n=n[0]:i="Multi".concat(i);var u={type:"Feature",geometry:{type:i,coordinates:n},properties:this.properties};return this.id!==null&&(u.id=this.id),u}},{key:"toGeoJSON",value:function(e){if(typeof e=="function")return this._toGeoJSON(e);var n=e.x,i=e.y,a=e.z,o=this.extent*Math.pow(2,a),s=this.extent*n,u=this.extent*i;function l(f){for(var c=0;c<f.length;c++){var p=f[c];p[0]=(p[0]+s)*360/o-180;var d=180-(p[1]+u)*360/o;p[1]=360/Math.PI*Math.atan(Math.exp(d*Math.PI/180))-90}}return this._toGeoJSON(l)}}],[{key:"types",get:function(){return["Unknown","Point","LineString","Polygon"]}}]),t}();var Yne=function(){function t(r,e){(0,Xne.default)(this,t),C(this,"version",void 0),C(this,"name",void 0),C(this,"extent",void 0),C(this,"length",void 0),C(this,"_pbf",void 0),C(this,"_keys",void 0),C(this,"_values",void 0),C(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(BRe,this,e),this.length=this._features.length}return(0,qne.default)(t,[{key:"feature",value:function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var n=this._pbf.readVarint()+this._pbf.pos;return new $ne(this._pbf,n,this.extent,this._keys,this._values)}}]),t}();function BRe(t,r,e){r&&e&&(t===15?r.version=e.readVarint():t===1?r.name=e.readString():t===5?r.extent=e.readVarint():t===2?r._features.push(e.pos):t===3?r._keys.push(e.readString()):t===4&&r._values.push(FRe(e)))}function FRe(t){for(var r=null,e=t.readVarint()+t.pos;t.pos<e;){var n=t.readVarint()>>3;r=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null}return r}var Jne=function t(r,e){(0,Kne.default)(this,t),C(this,"layers",void 0),this.layers=r.readFields(DRe,{},e)};function DRe(t,r,e){if(t===3&&e){var n=new Yne(e,e.readVarint()+e.pos);n.length&&r&&(r[n.name]=n)}}var pie=h(L());var lie=h(L()),fie=h(N());var aie=h(B()),oie=h(L()),sie=h(N());function Zne(t){var r=t.indices.length,e="Polygon";if(r<=1)return{type:e,data:t.data,areas:[[ma(t.data)]],indices:[t.indices]};for(var n=[],i=[],a=[],o=[],s,u=0,l,f=0,c;f<r;f++){c=t.indices[f]-u,l=t.indices[f+1]-u||t.data.length;var p=t.data.slice(c,l),d=ma(p);if(d===0){var v=t.data.slice(0,c),m=t.data.slice(l);t.data=v.concat(m),u+=l-c;continue}s===void 0&&(s=d<0),s===d<0?(o.length&&(n.push(a),i.push(o)),o=[c],a=[d]):(a.push(d),o.push(c))}return a&&n.push(a),o.length&&i.push(o),{type:e,areas:n,indices:i,data:t.data}}function Qne(t,r,e,n){for(var i=0,a=t.length;i<a;i+=2){t[i]=(t[i]+r)*360/n-180;var o=180-(t[i+1]+e)*360/n;t[i+1]=360/Math.PI*Math.atan(Math.exp(o*Math.PI/180))-90}}function eie(t,r,e){r&&e&&(t===1?r.id=e.readVarint():t===2?NRe(e,r):t===3?r.type=e.readVarint():t===4&&(r._geometry=e.pos))}function NRe(t,r){for(var e=t.readVarint()+t.pos;t.pos<e;){var n=r._keys[t.readVarint()],i=r._values[t.readVarint()];r.properties[n]=i}}function jRe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=URe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function URe(t,r){if(t){if(typeof t=="string")return tie(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return tie(t,r)}}function tie(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function rie(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function nie(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?rie(Object(e),!0).forEach(function(n){(0,aie.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):rie(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var iie,uu,RM,b_,LM,kM,ad;var uie=function(){function t(r,e,n,i,a,o){(0,oie.default)(this,t),C(this,"properties",void 0),C(this,"extent",void 0),C(this,"type",void 0),C(this,"id",void 0),C(this,"_pbf",void 0),C(this,"_geometry",void 0),C(this,"_keys",void 0),C(this,"_values",void 0),C(this,"_geometryInfo",void 0),this.properties={},this.extent=n,this.type=0,this.id=null,this._pbf=r,this._geometry=-1,this._keys=i,this._values=a,this._geometryInfo=o,r.readFields(eie,this,e)}return(0,sie.default)(t,[{key:"loadGeometry",value:function(){var e=this._pbf;e.pos=this._geometry,iie=e.readVarint()+e.pos,uu=1,b_=0,LM=0,kM=0,ad=0;for(var n=[],i=[];e.pos<iie;)if(b_<=0&&(RM=e.readVarint(),uu=RM&7,b_=RM>>3),b_--,uu===1||uu===2)LM+=e.readSVarint(),kM+=e.readSVarint(),uu===1&&n.push(ad),i.push(LM,kM),ad+=2;else if(uu===7){if(ad>0){var a=n[n.length-1];i.push(i[a],i[a+1]),ad+=2}}else throw new Error("unknown command ".concat(uu));return{data:i,indices:n}}},{key:"_toBinaryCoordinates",value:function(e){var n=this.loadGeometry(),i;e(n.data,this);var a=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=n.indices.length,i=nie({type:"Point"},n);break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=n.indices.length,this._geometryInfo.linePositionsCount+=n.data.length/a,i=nie({type:"LineString"},n);break;case 3:i=Zne(n),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;var o=jRe(i.indices),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;this._geometryInfo.polygonRingsCount+=u.length}}catch(f){o.e(f)}finally{o.f()}this._geometryInfo.polygonPositionsCount+=i.data.length/a;break;default:throw new Error("Invalid geometry type: ".concat(this.type))}var l={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(l.id=this.id),l}},{key:"toBinaryCoordinates",value:function(e){if(typeof e=="function")return this._toBinaryCoordinates(e);var n=e.x,i=e.y,a=e.z,o=this.extent*Math.pow(2,a),s=this.extent*n,u=this.extent*i;return this._toBinaryCoordinates(function(l){return Qne(l,s,u,o)})}}]),t}();var cie=function(){function t(r,e){(0,lie.default)(this,t),C(this,"version",void 0),C(this,"name",void 0),C(this,"extent",void 0),C(this,"length",void 0),C(this,"_pbf",void 0),C(this,"_keys",void 0),C(this,"_values",void 0),C(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(GRe,this,e),this.length=this._features.length}return(0,fie.default)(t,[{key:"feature",value:function(e,n){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var i=this._pbf.readVarint()+this._pbf.pos;return new uie(this._pbf,i,this.extent,this._keys,this._values,n)}}]),t}();function GRe(t,r,e){r&&e&&(t===15?r.version=e.readVarint():t===1?r.name=e.readString():t===5?r.extent=e.readVarint():t===2?r._features.push(e.pos):t===3?r._keys.push(e.readString()):t===4&&r._values.push(zRe(e)))}function zRe(t){for(var r=null,e=t.readVarint()+t.pos;t.pos<e;){var n=t.readVarint()>>3;r=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null}return r}var hie=function t(r,e){(0,pie.default)(this,t),C(this,"layers",void 0),this.layers=r.readFields(VRe,{},e)};function VRe(t,r,e){if(t===3&&e){var n=new cie(e,e.readVarint()+e.pos);n.length&&r&&(r[n.name]=n)}}function x_(t,r){var e,n,i=WRe(r),a=(r==null||(e=r.gis)===null||e===void 0?void 0:e.format)||(r==null||(n=r.mvt)===null||n===void 0?void 0:n.shape);switch(a){case"columnar-table":return{shape:"columnar-table",data:BM(t,i)};case"geojson-row-table":{var o={shape:"geojson-row-table",data:die(t,i)};return o}case"geojson":return die(t,i);case"binary-geometry":return BM(t,i);case"binary":return BM(t,i);default:throw new Error(a)}}function BM(t,r){var e=HRe(t,r),n=(0,vie.default)(e,2),i=n[0],a=n[1],o=EM(i,a);return o.byteLength=t.byteLength,o}function HRe(t,r){var e=[],n={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[e,n];var i=new hie(new FM.default(t)),a=r&&Array.isArray(r.layers)?r.layers:Object.keys(i.layers);return a.forEach(function(o){var s=i.layers[o];if(s)for(var u=0;u<s.length;u++){var l=s.feature(u,n),f=XRe(l,r,o);e.push(f)}}),[e,n]}function die(t,r){if(t.byteLength<=0)return[];var e=[],n=new Jne(new FM.default(t)),i=Array.isArray(r.layers)?r.layers:Object.keys(n.layers);return i.forEach(function(a){var o=n.layers[a];if(o)for(var s=0;s<o.length;s++){var u=o.feature(s),l=$Re(u,r,a);e.push(l)}}),e}function WRe(t){var r;if(!(t!=null&&t.mvt))throw new Error("mvt options required");var e=((r=t.mvt)===null||r===void 0?void 0:r.coordinates)==="wgs84",n=t.mvt.tileIndex,i=n&&Number.isFinite(n.x)&&Number.isFinite(n.y)&&Number.isFinite(n.z);if(e&&!i)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.mvt}function $Re(t,r,e){var n=t.toGeoJSON(r.coordinates==="wgs84"?r.tileIndex:qRe);return r.layerProperty&&(n.properties[r.layerProperty]=e),n}function XRe(t,r,e){var n=t.toBinaryCoordinates(r.coordinates==="wgs84"?r.tileIndex:YRe);return r.layerProperty&&n.properties&&(n.properties[r.layerProperty]=e),n}function qRe(t,r){for(var e=r.extent,n=0;n<t.length;n++){var i=t[n];i[0]/=e,i[1]/=e}}function YRe(t,r){for(var e=r.extent,n=0,i=t.length;n<i;++n)t[n]/=e}function mie(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function gie(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?mie(Object(e),!0).forEach(function(n){(0,_ie.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):mie(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var KRe="3.3.3",JRe={mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}},A_={name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:KRe,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:JRe},ZRe=gie(gie({},A_),{},{parse:function(){var t=(0,yie.default)(DM.default.mark(function e(n,i){return DM.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",x_(n,i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}(),parseSync:x_,binary:!0});var Aie=h(B()),NM=h(ye());function bie(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function xie(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?bie(Object(e),!0).forEach(function(n){(0,Aie.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):bie(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var QRe={Point:Tie,MultiPoint:eLe,LineString:Sie,MultiLineString:tLe,Polygon:Pie,MultiPolygon:rLe};function Tie(t,r,e){var n=(0,NM.default)(t,2),i=n[0],a=n[1],o=(0,NM.default)(r,2),s=o[0],u=o[1],l=nr(s[0],u[0],i),f=nr(s[1],u[1],a);return e.unprojectFlat([l,f])}function jM(t,r,e){return t.map(function(n){return Tie(n,r,e)})}function eLe(t,r,e){return jM(t,r,e)}function Sie(t,r,e){return jM(t,r,e)}function tLe(t,r,e){return t.map(function(n){return Sie(n,r,e)})}function Pie(t,r,e){return t.map(function(n){return jM(n,r,e)})}function rLe(t,r,e){return t.map(function(n){return Pie(n,r,e)})}function wie(t,r,e){var n=e.projectFlat([r.west,r.north]),i=e.projectFlat([r.east,r.south]),a=[n,i];return xie(xie({},t),{},{coordinates:QRe[t.type](t.coordinates,a,e)})}function nLe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=iLe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function iLe(t,r){if(t){if(typeof t=="string")return Oie(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Oie(t,r)}}function Oie(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var aLe=["points","lines","polygons"];function UM(t,r,e,n){var i=nLe(aLe),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=t[o]&&oLe(t[o],r,e,n);if(s>=0)return s}}catch(u){i.e(u)}finally{i.f()}return-1}function oLe(t,r,e,n){var i=t.featureIds.value;if(!i.length)return-1;var a=0,o=i[i.length-1]+1;if(n){var s=sLe(t,n);if(s)a=s[0],o=s[1]+1;else return-1}var u=-1;if(r in t.numericProps){var l=t.numericProps[r].value.findIndex(function(f,c){return f===e&&i[c]>=a&&i[c]<o});return l>=0?t.globalFeatureIds.value[l]:-1}else r?u=Eie(t.properties,function(f){return f[r]===e},a,o):t.fields&&(u=Eie(t.fields,function(f){return f.id===e},a,o));return u>=0?uLe(t,u):-1}function sLe(t,r){if(!t.__layers){for(var e={},n=t.properties,i=0;i<n.length;i++){var a=n[i],o=a.layerName;o&&(e[o]?e[o][1]=i:e[o]=[i,i])}t.__layers=e}return t.__layers[r]}function uLe(t,r){if(!t.__ids){for(var e=[],n=t.featureIds.value,i=t.globalFeatureIds.value,a=0;a<n.length;a++)e[n[a]]=i[a];t.__ids=e}return t.__ids[r]}function Eie(t,r,e,n){for(var i=e;i<n;i++)if(r(t[i],i))return i;return-1}function lLe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=fLe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function fLe(t,r){if(t){if(typeof t=="string")return Cie(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Cie(t,r)}}function Cie(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function cLe(t){var r=pLe();return function(){var n=(0,Wi.default)(t),i;if(r){var a=(0,Wi.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,jie.default)(this,i)}}function pLe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Mie(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ko(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Mie(Object(e),!0).forEach(function(n){(0,T_.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Mie(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var GM=512,hLe=ko(ko({},ya.defaultProps),{},{data:To,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[A_],binary:!0}),S_=function(t){(0,Nie.default)(e,t);var r=cLe(e);function e(){return(0,Fie.default)(this,e),r.apply(this,arguments)}return(0,Die.default)(e,[{key:"initializeState",value:function(){(0,Lo.default)((0,Wi.default)(e.prototype),"initializeState",this).call(this);var i=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:i,data:null,tileJSON:null})}},{key:"isLoaded",get:function(){return this.state&&this.state.data&&this.state.tileset&&(0,Lo.default)((0,Wi.default)(e.prototype),"isLoaded",this)}},{key:"updateState",value:function(i){var a,o=i.props,s=i.oldProps,u=i.context,l=i.changeFlags;l.dataChanged&&this._updateTileData(),(a=this.state)!==null&&a!==void 0&&a.data&&((0,Lo.default)((0,Wi.default)(e.prototype),"updateState",this).call(this,{props:o,oldProps:s,context:u,changeFlags:l}),this._setWGS84PropertyForTiles());var f=o.highlightColor;f!==s.highlightColor&&Array.isArray(f)&&this.setState({highlightColor:f})}},{key:"_updateTileData",value:function(){var n=(0,Bie.default)(VM.default.mark(function a(){var o,s,u,l,f;return VM.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(o=this.props.data,s=null,!(typeof o=="string"&&!Dw(o))){p.next=18;break}return u=this.props,l=u.onDataLoad,f=u.fetch,this.setState({data:null,tileJSON:null}),p.prev=5,p.next=8,f(o,{propName:"data",layer:this,loaders:[]});case 8:s=p.sent,p.next=15;break;case 11:p.prev=11,p.t0=p.catch(5),this.raiseError(p.t0,"loading TileJSON"),o=null;case 15:l&&l(s,{propName:"data",layer:this}),p.next=19;break;case 18:o.tilejson&&(s=o);case 19:s&&(o=s.tiles),this.setState({data:o,tileJSON:s});case 21:case"end":return p.stop()}},a,this,[[5,11]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"_getTilesetOptions",value:function(){var i=(0,Lo.default)((0,Wi.default)(e.prototype),"_getTilesetOptions",this).call(this),a=this.state.tileJSON,o=this.props,s=o.minZoom,u=o.maxZoom;return a&&(Number.isFinite(a.minzoom)&&a.minzoom>s&&(i.minZoom=a.minzoom),Number.isFinite(a.maxzoom)&&(!Number.isFinite(u)||a.maxzoom<u)&&(i.maxZoom=a.maxzoom)),i}},{key:"renderLayers",value:function(){var i;return(i=this.state)!==null&&i!==void 0&&i.data?(0,Lo.default)((0,Wi.default)(e.prototype),"renderLayers",this).call(this):null}},{key:"getTileData",value:function(i){var a,o=this.state,s=o.data,u=o.binary,l=i.index,f=i.signal,c=ji(s,i);if(!c)return Promise.reject("Invalid URL");var p=this.getLoadOptions(),d=this.props.fetch;return p=ko(ko({},p),{},{mimeType:"application/x-protobuf",mvt:ko(ko({},(a=p)===null||a===void 0?void 0:a.mvt),{},{coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:l}),gis:u?{format:"binary"}:{}}),d(c,{propName:"data",layer:this,loadOptions:p,signal:f})}},{key:"renderSubLayers",value:function(i){var a=i.tile.index,o=a.x,s=a.y,u=a.z,l=Math.pow(2,u),f=GM/l,c=-f,p=GM*o/l,d=GM*(1-s/l),v=new ce().scale([f,c,1]);i.autoHighlight=!1,this.context.viewport.resolution||(i.modelMatrix=v,i.coordinateOrigin=[p,d,0],i.coordinateSystem=se.CARTESIAN,i.extensions=[].concat((0,kie.default)(i.extensions||[]),[new vf]));var m=(0,Lo.default)((0,Wi.default)(e.prototype),"renderSubLayers",this).call(this,i);return this.state.binary&&!(m instanceof ya)&&Z.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),m}},{key:"_updateAutoHighlight",value:function(i){var a=this.props.uniqueIdProperty,o=this.state,s=o.hoveredFeatureId,u=o.hoveredFeatureLayerName,l=i.object,f,c;l&&(f=zM(l,a),c=Iie(l));var p=this.props.highlightColor;typeof p=="function"&&(p=p(i)),(s!==f||u!==c)&&this.setState({highlightColor:p,hoveredFeatureId:f,hoveredFeatureLayerName:c})}},{key:"getPickingInfo",value:function(i){var a=(0,Lo.default)((0,Wi.default)(e.prototype),"getPickingInfo",this).call(this,i),o=Boolean(this.context.viewport.resolution);if(this.state.binary&&a.index!==-1){var s=i.sourceLayer.props.data;a.object=g_(s,{globalFeatureId:a.index})}return a.object&&!o&&(a.object=Lie(a.object,a.tile.bbox,this.context.viewport)),a}},{key:"getSubLayerPropsByTile",value:function(i){return{highlightedObjectIndex:this.getHighlightedObjectIndex(i),highlightColor:this.state.highlightColor}}},{key:"getHighlightedObjectIndex",value:function(i){var a=this.state,o=a.hoveredFeatureId,s=a.hoveredFeatureLayerName,u=a.binary,l=this.props,f=l.uniqueIdProperty,c=l.highlightedFeatureId,p=i.content,d=Rie(c),v=Rie(o)||d;if(!v)return-1;var m=d?c:o;return Array.isArray(p)?p.findIndex(function(g){var y=zM(g,f)===m,_=d||Iie(g)===s;return y&&_}):p&&u?UM(p,f,m,d?"":s):-1}},{key:"_pickObjects",value:function(i){var a=this.context,o=a.deck,s=a.viewport,u=s.width,l=s.height,f=s.x,c=s.y,p=[this.id];return o.pickObjects({x:f,y:c,width:u,height:l,layerIds:p,maxObjects:i})}},{key:"getRenderedFeatures",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,a=this._pickObjects(i),o=new Set,s=[],u=lLe(a),l;try{for(u.s();!(l=u.n()).done;){var f=l.value,c=zM(f.object,this.props.uniqueIdProperty);c===void 0?s.push(f.object):o.has(c)||(o.add(c),s.push(f.object))}}catch(p){u.e(p)}finally{u.f()}return s}},{key:"_setWGS84PropertyForTiles",value:function(){var i=this,a="dataInWGS84",o=this.state.tileset;o.selectedTiles.forEach(function(s){s.hasOwnProperty(a)||Object.defineProperty(s,a,{get:function(){if(!s.content)return null;if(i.state.binary&&Array.isArray(s.content)&&!s.content.length)return[];var l=s.bbox;if(s._contentWGS84===void 0&&Nw(l)){var f=i.state.binary?g_(s.content):s.content;s._contentWGS84=f.map(function(c){return Lie(c,l,i.context.viewport)})}return s._contentWGS84}})})}}]),e}(Sa);(0,T_.default)(S_,"layerName","MVTLayer");(0,T_.default)(S_,"defaultProps",hLe);function zM(t,r){if(t.properties&&r)return t.properties[r];if("id"in t)return t.id}function Iie(t){var r;return((r=t.properties)===null||r===void 0?void 0:r.layerName)||null}function Rie(t){return t!=null&&t!==""}function Lie(t,r,e){var n=ko(ko({},t),{},{geometry:{type:t.geometry.type}});return Object.defineProperty(n.geometry,"coordinates",{get:function(){var a=wie(t.geometry,r,e);return a.coordinates}}),n}var Hie=h(L()),Wie=h(N()),$ie=h(Y()),Xie=h(K()),HM=h(q()),WM=h(B());var Gie=h(ye()),Uie="0123456789bcdefghjkmnpqrstuvwxyz",zie={};for(od=0;od<Uie.length;od++)zie[Uie.charAt(od)]=od;var od,dLe=-90,vLe=90,mLe=-180,gLe=180;function yLe(t){for(var r=!0,e=vLe,n=dLe,i=gLe,a=mLe,o,s=0,u=0,l=t.length;u<l;u++){var f=t[u].toLowerCase();s=zie[f];for(var c=4;c>=0;c--){var p=s>>c&1;r?(o=(i+a)/2,p===1?a=o:i=o):(o=(e+n)/2,p===1?n=o:e=o),r=!r}}return[n,a,e,i]}function Vie(t){var r=yLe(t),e=(0,Gie.default)(r,4),n=e[0],i=e[1],a=e[2],o=e[3];return[o,a,o,n,i,n,i,a,o,a]}function _Le(t){var r=bLe();return function(){var n=(0,HM.default)(t),i;if(r){var a=(0,HM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Xie.default)(this,i)}}function bLe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xLe={getGeohash:{type:"accessor",value:function(r){return r.geohash}}},P_=function(t){(0,$ie.default)(e,t);var r=_Le(e);function e(){return(0,Hie.default)(this,e),r.apply(this,arguments)}return(0,Wie.default)(e,[{key:"indexToBounds",value:function(){var i=this.props,a=i.data,o=i.getGeohash;return{data:a,_normalize:!1,positionFormat:"XY",getPolygon:function(u,l){return Vie(o(u,l))}}}}]),e}(Cn);(0,WM.default)(P_,"layerName","GeohashLayer");(0,WM.default)(P_,"defaultProps",xLe);var $M={};tn($M,{Buffer:()=>be,ConeGeometry:()=>sm,CubeGeometry:()=>ro,CylinderGeometry:()=>lm,FEATURES:()=>Ae,Framebuffer:()=>Me,Geometry:()=>Ce,IcoSphereGeometry:()=>cm,Model:()=>Ee,PlaneGeometry:()=>hm,Program:()=>Ka,ProgramManager:()=>_n,Renderbuffer:()=>Rr,SphereGeometry:()=>vm,Texture2D:()=>Se,Texture3D:()=>Lu,TextureCube:()=>Zo,Timeline:()=>no,Transform:()=>kr,TransformFeedback:()=>Ja,TruncatedConeGeometry:()=>to,cloneTextureFrom:()=>Bu,copyToTexture:()=>ku,cssToDeviceRatio:()=>vr,getParameters:()=>bi,hasFeatures:()=>lr,instrumentGLContext:()=>ea,isWebGL2:()=>fe,readPixelsToBuffer:()=>ta,setParameters:()=>Gt,withParameters:()=>Ie});var XM={};tn(XM,{fetchFile:()=>Su,load:()=>qt,parse:()=>Yo,registerLoaders:()=>mc});var sae=h(L()),uae=h(N()),lae=h(_e()),O_=h(Oe()),fae=h(Y()),cae=h(K()),Tf=h(q()),JM=h(B());function qM(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function qie(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function YM(t,r,e){return r&&qie(t.prototype,r),e&&qie(t,e),t}var dt=h(rae());var E0t=typeof window<"u"?window:global;var lu=typeof document<"u"?document:{};function SLe(){}function PLe(t){t&&console.error(t.error)}var iae={container:dt.default.object,gl:dt.default.object,mapboxApiAccessToken:dt.default.string,mapboxApiUrl:dt.default.string,attributionControl:dt.default.bool,preserveDrawingBuffer:dt.default.bool,reuseMaps:dt.default.bool,transformRequest:dt.default.func,mapOptions:dt.default.object,mapStyle:dt.default.oneOfType([dt.default.string,dt.default.object]),visible:dt.default.bool,asyncRender:dt.default.bool,onLoad:dt.default.func,onError:dt.default.func,width:dt.default.number,height:dt.default.number,viewState:dt.default.object,longitude:dt.default.number,latitude:dt.default.number,zoom:dt.default.number,bearing:dt.default.number,pitch:dt.default.number,altitude:dt.default.number},w_={container:lu.body,mapboxApiAccessToken:wLe(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",visible:!0,asyncRender:!1,onLoad:SLe,onError:PLe,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function wLe(){var t=null;if(typeof window<"u"&&window.location){var r=window.location.search.match(/access_token=([^&\/]*)/);t=r&&r[1]}return!t&&typeof process<"u"&&(t=t||process.env.MapboxAccessToken||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN),t||"no-token"}function nae(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";t.debug&&dt.default.checkPropTypes(iae,t,"prop",r)}var Af=function(){function t(r){var e=this;if(qM(this,t),C(this,"mapboxgl",void 0),C(this,"props",w_),C(this,"_map",null),C(this,"width",0),C(this,"height",0),C(this,"_fireLoadEvent",function(){e.props.onLoad({type:"load",target:e._map})}),!r.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=r.mapboxgl,t.initialized||(t.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(r)}return YM(t,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(e){return this._update(this.props,e),this}},{key:"resize",value:function(){return this._map.resize(),this}},{key:"redraw",value:function(){var e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(e){this._map=t.savedMap;var n=this._map.getContainer(),i=e.container;for(i.classList.add("mapboxgl-map");n.childNodes.length>0;)i.appendChild(n.childNodes[0]);this._map._container=i,t.savedMap=null,e.mapStyle&&this._map.setStyle(e.mapStyle,{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(e){if(e.reuseMaps&&t.savedMap)this._reuse(e);else{if(e.gl){var n=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=n,e.gl}}var i={container:e.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:e.mapStyle,interactive:!1,trackResize:!1,attributionControl:e.attributionControl,preserveDrawingBuffer:e.preserveDrawingBuffer};e.transformRequest&&(i.transformRequest=e.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},i,e.mapOptions)),this._map.once("load",e.onLoad),this._map.on("error",e.onError)}return this}},{key:"_destroy",value:function(){this._map&&(t.savedMap?this._map.remove():(t.savedMap=this._map,this._map.off("load",this.props.onLoad),this._map.off("error",this.props.onError),this._map.off("styledata",this._fireLoadEvent)),this._map=null)}},{key:"_initialize",value:function(e){var n=this;e=Object.assign({},w_,e),nae(e,"Mapbox"),this.mapboxgl.accessToken=e.mapboxApiAccessToken||w_.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=e.mapboxApiUrl,this._create(e);var i=e,a=i.container;Object.defineProperty(a,"offsetWidth",{get:function(){return n.width}}),Object.defineProperty(a,"clientWidth",{get:function(){return n.width}}),Object.defineProperty(a,"offsetHeight",{get:function(){return n.height}}),Object.defineProperty(a,"clientHeight",{get:function(){return n.height}});var o=this._map.getCanvas();o&&(o.style.outline="none"),this._updateMapViewport({},e),this._updateMapSize({},e),this.props=e}},{key:"_update",value:function(e,n){if(this._map){n=Object.assign({},this.props,n),nae(n,"Mapbox");var i=this._updateMapViewport(e,n),a=this._updateMapSize(e,n);!n.asyncRender&&(i||a)&&this.redraw(),this.props=n}}},{key:"_updateMapSize",value:function(e,n){var i=e.width!==n.width||e.height!==n.height;return i&&(this.width=n.width,this.height=n.height,this.resize()),i}},{key:"_updateMapViewport",value:function(e,n){var i=this._getViewState(e),a=this._getViewState(n),o=a.latitude!==i.latitude||a.longitude!==i.longitude||a.zoom!==i.zoom||a.pitch!==i.pitch||a.bearing!==i.bearing||a.altitude!==i.altitude;return o&&(this._map.jumpTo(this._viewStateToMapboxProps(a)),a.altitude!==i.altitude&&(this._map.transform.altitude=a.altitude)),o}},{key:"_getViewState",value:function(e){var n=e.viewState||e,i=n.longitude,a=n.latitude,o=n.zoom,s=n.pitch,u=s===void 0?0:s,l=n.bearing,f=l===void 0?0:l,c=n.altitude,p=c===void 0?1.5:c;return{longitude:i,latitude:a,zoom:o,pitch:u,bearing:f,altitude:p}}},{key:"_checkStyleSheet",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof lu>"u"))try{var n=lu.createElement("div");n.className="mapboxgl-map",n.style.display="none",lu.body.append(n);var i=window.getComputedStyle(n).position!=="static";if(!i){var a=lu.createElement("link");a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(e,"/mapbox-gl.css")),lu.head.append(a)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(e){return{center:[e.longitude,e.latitude],zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}}}]),t}();C(Af,"initialized",!1);C(Af,"propTypes",iae);C(Af,"defaultProps",w_);C(Af,"savedMap",null);function aae(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function KM(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?aae(Object(e),!0).forEach(function(n){(0,JM.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):aae(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function OLe(t){var r=ELe();return function(){var n=(0,Tf.default)(t),i;if(r){var a=(0,Tf.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cae.default)(this,i)}}function ELe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var oae={position:"absolute",left:0,top:0,width:"100%",height:"100%"};function CLe(t){var r=t.container,e=r===void 0?document.body:r;if(typeof e=="string"&&(e=document.getElementById(e)),!e)throw Error("Deck: container not found");var n=window.getComputedStyle(e);n.position==="static"&&(e.style.position="relative");var i=document.createElement("div");e.appendChild(i),Object.assign(i.style,oae);var a=document.createElement("canvas");return e.appendChild(a),Object.assign(a.style,oae),{container:e,mapCanvas:i,deckCanvas:a}}var pae=function(t){(0,fae.default)(e,t);var r=OLe(e);function e(n){var i;if((0,sae.default)(this,e),typeof document>"u")throw Error("Deck can only be used in the browser");var a=CLe(n),o=a.mapCanvas,s=a.deckCanvas,u=n.viewState||n.initialViewState,l=Number.isFinite(u&&u.latitude),f=n.map,c=f===void 0?globalThis.mapboxgl||globalThis.maplibregl:f;return i=r.call(this,KM({canvas:s},n)),(0,JM.default)((0,lae.default)(i),"_map",void 0),c&&c.Map?i._map=l&&new Af(KM(KM({},n),{},{viewState:u,container:o,mapboxgl:c})):i._map=c,i}return(0,uae.default)(e,[{key:"getMapboxMap",value:function(){return this._map&&this._map.getMap()}},{key:"finalize",value:function(){this._map&&this._map.finalize(),(0,O_.default)((0,Tf.default)(e.prototype),"finalize",this).call(this)}},{key:"setProps",value:function(i){"mapStyle"in i&&this._map&&this._map._map.setStyle(i.mapStyle),(0,O_.default)((0,Tf.default)(e.prototype),"setProps",this).call(this,i)}},{key:"_drawLayers",value:function(i,a){if(this._map){var o=this.getViewports()[0];this._map.setProps({width:o.width,height:o.height,viewState:o})}(0,O_.default)((0,Tf.default)(e.prototype),"_drawLayers",this).call(this,i,a)}}]),e}(un);globalThis.luma=globalThis.luma||{};globalThis.loaders=globalThis.loaders||{};Object.assign(globalThis.luma,$M);Object.assign(globalThis.loaders,XM);var Toe=h(L()),Soe=h(N()),Poe=h(_e()),j_=h(Oe()),woe=h(Y()),Ooe=h(K()),If=h(q()),pu=h(B());var I_=h(B()),Oae=h(L()),Eae=h(N());var fu=h(B());var vt={SUM:1,MEAN:2,MIN:3,MAX:4};function hae(t,r){return t+r}function MLe(t,r){return r>t?r:t}function ILe(t,r){return r<t?r:t}function RLe(t,r){if(Number.isFinite(r))return t.length?r:null;var e=t.map(r).filter(Number.isFinite);return e.length?e.reduce(hae,0)/e.length:null}function LLe(t,r){if(Number.isFinite(r))return t.length?t.length*r:null;var e=t.map(r).filter(Number.isFinite);return e.length?e.reduce(hae,0):null}function kLe(t,r){if(Number.isFinite(r))return t.length?r:null;var e=t.map(r).filter(Number.isFinite);return e.length?e.reduce(MLe,-1/0):null}function BLe(t,r){if(Number.isFinite(r))return t.length?r:null;var e=t.map(r).filter(Number.isFinite);return e.length?e.reduce(ILe,1/0):null}function Sf(t,r,e){var n=vt[t]||vt.SUM;switch(r=FLe(r,e),n){case vt.MIN:return function(i){return BLe(i,r)};case vt.SUM:return function(i){return LLe(i,r)};case vt.MEAN:return function(i){return RLe(i,r)};case vt.MAX:return function(i){return kLe(i,r)};default:return null}}function FLe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Number.isFinite(t)?t:function(e){return r.index=e.index,t(e.source,r)}}function dae(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function(e){return r.indices=e.map(function(n){return n.index}),t(e.map(function(n){return n.source}),r)}}var Pf,E_,vae={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},Bo=3402823466e29,ZM=[32775,32774],QM=[32776,32774],mae=[32776,32775],e2=(Pf={},(0,fu.default)(Pf,vt.SUM,32774),(0,fu.default)(Pf,vt.MEAN,32774),(0,fu.default)(Pf,vt.MIN,ZM),(0,fu.default)(Pf,vt.MAX,QM),Pf);var gae={size:1,operation:vt.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},yae=4;var H0t={format:34836,type:5126,border:0,mipmaps:!1,parameters:(E_={},(0,fu.default)(E_,10240,9728),(0,fu.default)(E_,10241,9728),E_),dataFormat:6408,width:1,height:1};var _ae=`#define SHADER_NAME gpu-aggregation-to-grid-vs

attribute vec3 positions;
attribute vec3 positions64Low;
attribute vec3 weights;
uniform vec2 cellSize;
uniform vec2 gridSize;
uniform bool projectPoints;
uniform vec2 translation;
uniform vec3 scaling;

varying vec3 vWeights;

vec2 project_to_pixel(vec4 pos) {
  vec4 result;
  pos.xy = pos.xy/pos.w;
  result = pos + vec4(translation, 0., 0.);
  result.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;
  return result.xy;
}

void main(void) {

  vWeights = weights;

  vec4 windowPos = vec4(positions, 1.);
  if (projectPoints) {
    windowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));
  }

  vec2 pos = project_to_pixel(windowPos);

  vec2 pixelXY64[2];
  pixelXY64[0] = vec2(pos.x, 0.);
  pixelXY64[1] = vec2(pos.y, 0.);
  vec2 gridXY64[2];
  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));
  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));
  float x = floor(gridXY64[0].x);
  float y = floor(gridXY64[1].x);
  pos = vec2(x, y);
  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);
  vec2 offset = 1.0 / gridSize;
  pos = pos + offset;

  gl_Position = vec4(pos, 0.0, 1.0);
  gl_PointSize = 1.0;
}
`;var bae=`#define SHADER_NAME gpu-aggregation-to-grid-fs

precision highp float;

varying vec3 vWeights;

void main(void) {
  gl_FragColor = vec4(vWeights, 1.0);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var xae=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-vs-64

in vec2 position;
uniform ivec2 gridSize;
out vec2 vTextureCoord;

void main(void) {
  vec2 pos = vec2(-1.0, -1.0);
  vec2 offset = 1.0 / vec2(gridSize);
  pos = pos + offset;

  gl_Position = vec4(pos, 0.0, 1.0);

  int yIndex = gl_InstanceID / gridSize[0];
  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);

  vec2 yIndexFP64 = vec2(float(yIndex), 0.);
  vec2 xIndexFP64 = vec2(float(xIndex), 0.);
  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);
  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);

  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);
  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);

  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);
  gl_PointSize = 1.0;
}
`;var Aae=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-fs

precision highp float;

in vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform bool combineMaxMin;
out vec4 fragColor;
void main(void) {
  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
  if (textureColor.a == 0.) {
    discard;
  }
  fragColor.rgb = textureColor.rgb;
  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;
}
`;var Tae=`#define SHADER_NAME gpu-aggregation-transform-mean-vs
attribute vec4 aggregationValues;
varying vec4 meanValues;

void main()
{
  bool isCellValid = bool(aggregationValues.w > 0.);
  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);
  meanValues.w = aggregationValues.w;
  gl_PointSize = 1.0;
}
`;var M_=h(B());var C_,DLe=(C_={},(0,M_.default)(C_,10240,9728),(0,M_.default)(C_,10241,9728),C_);function wf(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.width,n=e===void 0?1:e,i=r.height,a=i===void 0?1:i,o=r.data,s=o===void 0?null:o,u=r.unpackFlipY,l=u===void 0?!0:u,f=r.parameters,c=f===void 0?DLe:f,p=new Se(t,{data:s,format:fe(t)?34836:6408,type:5126,border:0,mipmaps:!1,parameters:c,dataFormat:6408,width:n,height:a,unpackFlipY:l});return p}function sd(t,r){var e=r.id,n=r.width,i=n===void 0?1:n,a=r.height,o=a===void 0?1:a,s=r.texture,u=new Me(t,{id:e,width:i,height:o,attachments:(0,M_.default)({},36064,s)});return u}function NLe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=jLe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function jLe(t,r){if(t){if(typeof t=="string")return Sae(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Sae(t,r)}}function Sae(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Pae(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function wr(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Pae(Object(e),!0).forEach(function(n){(0,I_.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Pae(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var ULe=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],wae={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},GLe=[Ae.WEBGL2,Ae.COLOR_ATTACHMENT_RGBA32F,Ae.BLEND_EQUATION_MINMAX,Ae.FLOAT_BLEND,Ae.TEXTURE_FLOAT],Or=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,Oae.default)(this,t),this.id=e.id||"gpu-grid-aggregator",this.gl=r,this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=fe(r)&&lr(this.gl,Ae.BLEND_EQUATION_MINMAX,Ae.COLOR_ATTACHMENT_RGBA32F,Ae.TEXTURE_FLOAT),this._hasGPUSupport&&this._setupModels()}return(0,Eae.default)(t,[{key:"delete",value:function(){var e=this.gridAggregationModel,n=this.allAggregationModel,i=this.meanTransform,a=this.state,o=a.textures,s=a.framebuffers,u=a.maxMinFramebuffers,l=a.minFramebuffers,f=a.maxFramebuffers,c=a.meanTextures,p=a.resources;e?.delete(),n?.delete(),i?.delete(),VLe([s,o,u,l,f,c,p])}},{key:"run",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.setState({results:{}});var n=this._normalizeAggregationParams(e);return this._hasGPUSupport||Z.log(1,"GPUGridAggregator: not supported")(),this._runAggregation(n)}},{key:"getData",value:function(e){var n={},i=this.state.results;i[e].aggregationData||(i[e].aggregationData=i[e].aggregationBuffer.getData()),n.aggregationData=i[e].aggregationData;for(var a in wae){var o=wae[a];(i[e][a]||i[e][o])&&(i[e][a]=i[e][a]||i[e][o].getData(),n[a]=i[e][a])}return n}},{key:"updateShaders",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.setState({shaderOptions:e,modelDirty:!0})}},{key:"_normalizeAggregationParams",value:function(e){var n=wr(wr({},vae),e),i=n.weights;return i&&(n.weights=zLe(i)),n}},{key:"setState",value:function(e){Object.assign(this.state,e)}},{key:"_getAggregateData",value:function(e){var n={},i=this.state,a=i.textures,o=i.framebuffers,s=i.maxMinFramebuffers,u=i.minFramebuffers,l=i.maxFramebuffers,f=i.resources,c=e.weights;for(var p in c){n[p]={};var d=c[p],v=d.needMin,m=d.needMax,g=d.combineMaxMin;n[p].aggregationTexture=a[p],n[p].aggregationBuffer=ta(o[p],{target:c[p].aggregationBuffer,sourceType:5126}),v&&m&&g?(n[p].maxMinBuffer=ta(s[p],{target:c[p].maxMinBuffer,sourceType:5126}),n[p].maxMinTexture=f["".concat(p,"-maxMinTexture")]):(v&&(n[p].minBuffer=ta(u[p],{target:c[p].minBuffer,sourceType:5126}),n[p].minTexture=f["".concat(p,"-minTexture")]),m&&(n[p].maxBuffer=ta(l[p],{target:c[p].maxBuffer,sourceType:5126}),n[p].maxTexture=f["".concat(p,"-maxTexture")]))}return this._trackGPUResultBuffers(n,c),n}},{key:"_renderAggregateData",value:function(e){var n=e.cellSize,i=e.projectPoints,a=e.attributes,o=e.moduleSettings,s=e.numCol,u=e.numRow,l=e.weights,f=e.translation,c=e.scaling,p=this.state,d=p.maxMinFramebuffers,v=p.minFramebuffers,m=p.maxFramebuffers,g=[s,u],y={blend:!0,depthTest:!1,blendFunc:[1,1]},_={cellSize:n,gridSize:g,projectPoints:i,translation:f,scaling:c};for(var b in l){var x=l[b],A=x.needMin,T=x.needMax,O=A&&T&&l[b].combineMaxMin;this._renderToWeightsTexture({id:b,parameters:y,moduleSettings:o,uniforms:_,gridSize:g,attributes:a,weights:l}),O?this._renderToMaxMinTexture({id:b,parameters:wr(wr({},y),{},{blendEquation:mae}),gridSize:g,minOrMaxFb:d[b],clearParams:{clearColor:[0,0,0,Bo]},combineMaxMin:O}):(A&&this._renderToMaxMinTexture({id:b,parameters:wr(wr({},y),{},{blendEquation:ZM}),gridSize:g,minOrMaxFb:v[b],clearParams:{clearColor:[Bo,Bo,Bo,0]},combineMaxMin:O}),T&&this._renderToMaxMinTexture({id:b,parameters:wr(wr({},y),{},{blendEquation:QM}),gridSize:g,minOrMaxFb:m[b],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:O}))}}},{key:"_renderToMaxMinTexture",value:function(e){var n=e.id,i=e.parameters,a=e.gridSize,o=e.minOrMaxFb,s=e.combineMaxMin,u=e.clearParams,l=u===void 0?{}:u,f=this.state.framebuffers,c=this.gl,p=this.allAggregationModel;Ie(c,wr(wr({},l),{},{framebuffer:o,viewport:[0,0,a[0],a[1]]}),function(){c.clear(16384),p.draw({parameters:i,uniforms:{uSampler:f[n].texture,gridSize:a,combineMaxMin:s}})})}},{key:"_renderToWeightsTexture",value:function(e){var n=e.id,i=e.parameters,a=e.moduleSettings,o=e.uniforms,s=e.gridSize,u=e.weights,l=this.state,f=l.framebuffers,c=l.equations,p=l.weightAttributes,d=this.gl,v=this.gridAggregationModel,m=u[n].operation,g=m===vt.MIN?[Bo,Bo,Bo,0]:[0,0,0,0];if(Ie(d,{framebuffer:f[n],viewport:[0,0,s[0],s[1]],clearColor:g},function(){d.clear(16384);var A={weights:p[n]};v.draw({parameters:wr(wr({},i),{},{blendEquation:c[n]}),moduleSettings:a,uniforms:o,attributes:A})}),m===vt.MEAN){var y=this.state,_=y.meanTextures,b=y.textures,x={_sourceTextures:{aggregationValues:_[n]},_targetTexture:b[n],elementCount:b[n].width*b[n].height};this.meanTransform?this.meanTransform.update(x):this.meanTransform=$Le(d,x),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),f[n].attach((0,I_.default)({},36064,b[n]))}}},{key:"_runAggregation",value:function(e){this._updateModels(e),this._setupFramebuffers(e),this._renderAggregateData(e);var n=this._getAggregateData(e);return this.setState({results:n}),n}},{key:"_setupFramebuffers",value:function(e){var n=this.state,i=n.textures,a=n.framebuffers,o=n.maxMinFramebuffers,s=n.minFramebuffers,u=n.maxFramebuffers,l=n.meanTextures,f=n.equations,c=e.weights,p=e.numCol,d=e.numRow,v={width:p,height:d};for(var m in c){var g=c[m],y=g.needMin,_=g.needMax,b=g.combineMaxMin,x=g.operation;i[m]=c[m].aggregationTexture||i[m]||wf(this.gl,{id:"".concat(m,"-texture"),width:p,height:d}),i[m].resize(v);var A=i[m];x===vt.MEAN&&(l[m]=l[m]||wf(this.gl,{id:"".concat(m,"-mean-texture"),width:p,height:d}),l[m].resize(v),A=l[m]),a[m]?a[m].attach((0,I_.default)({},36064,A)):a[m]=sd(this.gl,{id:"".concat(m,"-fb"),width:p,height:d,texture:A}),a[m].resize(v),f[m]=e2[x]||e2.SUM,(y||_)&&(y&&_&&b?o[m]||(A=c[m].maxMinTexture||this._getMinMaxTexture("".concat(m,"-maxMinTexture")),o[m]=sd(this.gl,{id:"".concat(m,"-maxMinFb"),texture:A})):(y&&(s[m]||(A=c[m].minTexture||this._getMinMaxTexture("".concat(m,"-minTexture")),s[m]=sd(this.gl,{id:"".concat(m,"-minFb"),texture:A}))),_&&(u[m]||(A=c[m].maxTexture||this._getMinMaxTexture("".concat(m,"-maxTexture")),u[m]=sd(this.gl,{id:"".concat(m,"-maxFb"),texture:A})))))}}},{key:"_getMinMaxTexture",value:function(e){var n=this.state.resources;return n[e]||(n[e]=wf(this.gl,{id:"resourceName"})),n[e]}},{key:"_setupModels",value:function(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.numCol,a=i===void 0?0:i,o=n.numRow,s=o===void 0?0:o,u=this.gl,l=this.state.shaderOptions;if((e=this.gridAggregationModel)===null||e===void 0||e.delete(),this.gridAggregationModel=HLe(u,l),!this.allAggregationModel){var f=a*s;this.allAggregationModel=WLe(u,f)}}},{key:"_setupWeightAttributes",value:function(e){var n=this.state.weightAttributes,i=e.weights;for(var a in i)n[a]=e.attributes[a]}},{key:"_trackGPUResultBuffers",value:function(e,n){var i=this.state.resources;for(var a in e)if(e[a]){var o=NLe(ULe),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;if(e[a][u]&&n[a][u]!==e[a][u]){var l="gpu-result-".concat(a,"-").concat(u);i[l]&&i[l].delete(),i[l]=e[a][u]}}}catch(f){o.e(f)}finally{o.f()}}}},{key:"_updateModels",value:function(e){var n=e.vertexCount,i=e.attributes,a=e.numCol,o=e.numRow,s=this.state.modelDirty;s&&(this._setupModels(e),this.setState({modelDirty:!1})),this._setupWeightAttributes(e),this.gridAggregationModel.setVertexCount(n),this.gridAggregationModel.setAttributes(i),this.allAggregationModel.setInstanceCount(a*o)}}],[{key:"getAggregationData",value:function(e){var n=e.aggregationData,i=e.maxData,a=e.minData,o=e.maxMinData,s=e.pixelIndex,u=s*yae,l={};return n&&(l.cellCount=n[u+3],l.cellWeight=n[u]),o?(l.maxCellWieght=o[0],l.minCellWeight=o[3]):(i&&(l.maxCellWieght=i[0],l.totalCount=i[3]),a&&(l.minCellWeight=a[0],l.totalCount=i[3])),l}},{key:"getCellData",value:function(e){for(var n=e.countsData,i=e.size,a=i===void 0?1:i,o=n.length/4,s=new Float32Array(o*a),u=new Uint32Array(o),l=0;l<o;l++){for(var f=0;f<a;f++)s[l*a+f]=n[l*4+f];u[l]=n[l*4+3]}return{cellCounts:u,cellWeights:s}}},{key:"isSupported",value:function(e){return lr(e,GLe)}}]),t}();function zLe(t){var r={};for(var e in t)r[e]=wr(wr({},gae),t[e]);return r}function VLe(t){t=Array.isArray(t)?t:[t],t.forEach(function(r){for(var e in r)r[e].delete()})}function HLe(t,r){var e=da({vs:_ae,fs:bae,modules:[ns,Ze]},r);return new Ee(t,wr({id:"Gird-Aggregation-Model",vertexCount:1,drawMode:0},e))}function WLe(t,r){return new Ee(t,{id:"All-Aggregation-Model",vs:xae,fs:Aae,modules:[ns],vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:r,attributes:{position:[0,0]}})}function $Le(t,r){return new kr(t,wr({vs:Tae,_targetTextureVarying:"meanValues"},r))}var Rae=h(L()),Lae=h(N()),kae=h(_e()),Bae=h(Oe()),Fae=h(Y()),Dae=h(K()),R_=h(q()),ud=h(B());var Ln=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function Fo(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float32Array,n;if(Number.isFinite(t[0]))n=new e(t);else{n=new e(t.length*4);for(var i=0,a=0;a<t.length;a++){var o=t[a];n[i++]=o[0],n[i++]=o[1],n[i++]=o[2],n[i++]=Number.isFinite(o[3])?o[3]:255}}if(r)for(var s=0;s<n.length;s++)n[s]/=255;return n}var Cae=`#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6

attribute vec3 positions;
attribute vec3 instancePositions;
attribute vec4 instanceCounts;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform vec3 cellScale;
uniform vec4 minColor;
uniform vec4 maxColor;
uniform vec4 colorRange[RANGE_COUNT];
uniform vec2 colorDomain;
uniform bool shouldUseMinMax;
uniform sampler2D maxTexture;

varying vec4 vColor;
varying float vSampleCount;

vec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {
  vec4 outColor = vec4(0., 0., 0., 0.);
  if (value >= domain.x && value <= domain.y) {
    float domainRange = domain.y - domain.x;
    if (domainRange <= 0.) {
      outColor = colorRange[0];
    } else {
      float rangeCount = float(RANGE_COUNT);
      float rangeStep = domainRange / rangeCount;
      float idx = floor((value - domain.x) / rangeStep);
      idx = clamp(idx, 0., rangeCount - 1.);
      int intIdx = int(idx);
      outColor = colorRange[intIdx];
    }
  }
  outColor = outColor / 255.;
  return outColor;
}

void main(void) {
  vSampleCount = instanceCounts.a;

  float weight = instanceCounts.r;
  float maxWeight = texture2D(maxTexture, vec2(0.5)).r;

  float step = weight / maxWeight;
  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;

  vec2 domain = colorDomain;
  float domainMaxValid = float(colorDomain.y != 0.);
  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);
  vec4 rangeColor = quantizeScale(domain, colorRange, weight);

  float rangeMinMax = float(shouldUseMinMax);
  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);
  vColor = vec4(color.rgb, color.a * opacity);
  picking_setPickingColor(instancePickingColors);

  gl_Position = vec4(instancePositions + positions * cellScale, 1.);
}
`;var Mae=`#define SHADER_NAME screen-grid-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying float vSampleCount;

void main(void) {
  if (vSampleCount <= 0.0) {
    discard;
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function Iae(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function t2(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Iae(Object(e),!0).forEach(function(n){(0,ud.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Iae(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function XLe(t){var r=qLe();return function(){var n=(0,R_.default)(t),i;if(r){var a=(0,R_.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Dae.default)(this,i)}}function qLe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var YLe=[0,0,0,0],KLe=[0,255,0,255],JLe=["minColor","maxColor","colorRange","colorDomain"],ZLe={cellSizePixels:{value:100,min:1},cellMarginPixels:{value:2,min:0,max:5},colorDomain:null,colorRange:Ln},Of=function(t){(0,Fae.default)(e,t);var r=XLe(e);function e(){var n;(0,Rae.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,ud.default)((0,kae.default)(n),"state",void 0),n}return(0,Lae.default)(e,[{key:"getShaders",value:function(){return{vs:Cae,fs:Mae,modules:[it]}}},{key:"initializeState",value:function(){var i=this.context.gl,a=this.getAttributeManager();a.addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,noAlloc:!0}}),this.setState({model:this._getModel(i)})}},{key:"shouldUpdateState",value:function(i){var a=i.changeFlags;return a.somethingChanged}},{key:"updateState",value:function(i){(0,Bae.default)((0,R_.default)(e.prototype),"updateState",this).call(this,i);var a=i.oldProps,o=i.props,s=i.changeFlags,u=this.getAttributeManager();o.numInstances!==a.numInstances?u.invalidateAll():a.cellSizePixels!==o.cellSizePixels&&u.invalidate("instancePositions"),this._updateUniforms(a,o,s)}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.parameters,u=o.maxTexture,l=this.props.minColor||YLe,f=this.props.maxColor||KLe,c=this.props.colorDomain||[1,0],p=this.state.model;p.setUniforms(a).setUniforms({minColor:l,maxColor:f,maxTexture:u,colorDomain:c}).draw({parameters:t2({depthTest:!1,depthMask:!1},s)})}},{key:"calculateInstancePositions",value:function(i,a){for(var o=a.numInstances,s=this.context.viewport,u=s.width,l=s.height,f=this.props.cellSizePixels,c=Math.ceil(u/f),p=i.value,d=i.size,v=0;v<o;v++){var m=v%c,g=Math.floor(v/c);p[v*d+0]=m*f/u*2-1,p[v*d+1]=1-g*f/l*2,p[v*d+2]=0}}},{key:"_getModel",value:function(i){return new Ee(i,t2(t2({},this.getShaders()),{},{id:this.props.id,geometry:new Ce({drawMode:6,attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}}),isInstanced:!0}))}},{key:"_shouldUseMinMax",value:function(){var i=this.props,a=i.minColor,o=i.maxColor,s=i.colorDomain,u=i.colorRange;return a||o?(Z.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!(s||u)}},{key:"_updateUniforms",value:function(i,a,o){var s=this.state.model;if(JLe.some(function(g){return i[g]!==a[g]})&&s.setUniforms({shouldUseMinMax:this._shouldUseMinMax()}),i.colorRange!==a.colorRange&&s.setUniforms({colorRange:Fo(a.colorRange)}),i.cellMarginPixels!==a.cellMarginPixels||i.cellSizePixels!==a.cellSizePixels||o.viewportChanged){var u=this.context.viewport,l=u.width,f=u.height,c=this.props,p=c.cellSizePixels,d=c.cellMarginPixels,v=p>d?d:0,m=new Float32Array([(p-v)/l*2,-(p-v)/f*2,1]);s.setUniforms({cellScale:m})}}}],[{key:"isSupported",value:function(i){return lr(i,[Ae.TEXTURE_FLOAT])}}]),e}(Ve);(0,ud.default)(Of,"layerName","ScreenGridCellLayer");(0,ud.default)(Of,"defaultProps",ZLe);var moe=h(L()),goe=h(N()),yoe=h(_e()),N_=h(Oe()),_oe=h(Y()),boe=h(K()),Mf=h(q()),a2=h(B());var Gae=h(L()),zae=h(N()),Vae=h(_e()),r2=h(Oe()),Hae=h(Y()),Wae=h(K()),ld=h(q()),n2=h(B());function Nae(t,r){var e={};for(var n in t)r.includes(n)||(e[n]=t[n]);return e}function jae(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=QLe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function QLe(t,r){if(t){if(typeof t=="string")return Uae(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Uae(t,r)}}function Uae(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function eke(t){var r=tke();return function(){var n=(0,ld.default)(t),i;if(r){var a=(0,ld.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Wae.default)(this,i)}}function tke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fi=function(t){(0,Hae.default)(e,t);var r=eke(e);function e(){var n;(0,Gae.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,n2.default)((0,Vae.default)(n),"state",void 0),n}return(0,zae.default)(e,[{key:"initializeAggregationLayer",value:function(i){(0,r2.default)((0,ld.default)(e.prototype),"initializeState",this).call(this,this.context),this.setState({ignoreProps:Nae(this.constructor._propTypes,i.data.props),dimensions:i})}},{key:"updateState",value:function(i){(0,r2.default)((0,ld.default)(e.prototype),"updateState",this).call(this,i);var a=i.changeFlags;if(a.extensionsChanged){var o=this.getShaders({});o&&o.defines&&(o.defines.NON_INSTANCED_MODEL=1),this.updateShaders(o)}this._updateAttributes()}},{key:"updateAttributes",value:function(i){this.setState({changedAttributes:i})}},{key:"getAttributes",value:function(){return this.getAttributeManager().getShaderAttributes()}},{key:"getModuleSettings",value:function(){var i=this.context,a=i.viewport,o=i.mousePosition,s=i.gl,u=Object.assign(Object.create(this.props),{viewport:a,mousePosition:o,pickingActive:0,devicePixelRatio:vr(s)});return u}},{key:"updateShaders",value:function(i){}},{key:"isAggregationDirty",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.props,s=i.oldProps,u=i.changeFlags,l=a.compareAll,f=l===void 0?!1:l,c=a.dimension,p=this.state.ignoreProps,d=c.props,v=c.accessors,m=v===void 0?[]:v,g=u.updateTriggersChanged;if(u.dataChanged)return!0;if(g){if(g.all)return!0;var y=jae(m),_;try{for(y.s();!(_=y.n()).done;){var b=_.value;if(g[b])return!0}}catch(O){y.e(O)}finally{y.f()}}if(f)return u.extensionsChanged?!0:bl({oldProps:s,newProps:o,ignoreProps:p,propTypes:this.constructor._propTypes});var x=jae(d),A;try{for(x.s();!(A=x.n()).done;){var T=A.value;if(o[T]!==s[T])return!0}}catch(O){x.e(O)}finally{x.f()}return!1}},{key:"isAttributeChanged",value:function(i){var a=this.state.changedAttributes;return i?a&&a[i]!==void 0:!rke(a)}},{key:"_getAttributeManager",value:function(){return new co(this.context.gl,{id:this.props.id,stats:this.context.stats})}}]),e}(St);(0,n2.default)(fi,"layerName","AggregationLayer");function rke(t){var r=!0;for(var e in t){r=!1;break}return r}var k_=h(ye()),ioe=h(L()),aoe=h(N()),Do=h(B());function nke(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=ike(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function ike(t,r){if(t){if(typeof t=="string")return $ae(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return $ae(t,r)}}function $ae(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function L_(t,r,e){var n=e;return n.domain=function(){return t},n.range=function(){return r},n}function Xae(t,r){var e=function(i){return pke(t,r,i)};return L_(t,r,e)}function ake(t,r){var e=function(i){return hke(t,r,i)};return L_(t,r,e)}function oke(t,r){for(var e=t.sort(qae),n=0,i=Math.max(1,r.length),a=new Array(i-1);++n<i;)a[n-1]=ske(e,n/i);var o=function(u){return lke(a,r,u)};return o.thresholds=function(){return a},L_(t,r,o)}function qae(t,r){return t-r}function ske(t,r){var e=t.length;if(r<=0||e<2)return t[0];if(r>=1)return t[e-1];var n=(e-1)*r,i=Math.floor(n),a=t[i],o=t[i+1];return a+(o-a)*(n-i)}function uke(t,r){for(var e=0,n=t.length;e<n;){var i=e+n>>>1;qae(t[i],r)>0?n=i:e=i+1}return e}function lke(t,r,e){return r[uke(t,e)]}function fke(t,r,e,n){var i="".concat(n),a=r.get(i);return a===void 0&&(a=t.push(n),r.set(i,a)),e[(a-1)%e.length]}function cke(t,r){var e=new Map,n=[],i=nke(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s="".concat(o);e.has(s)||e.set(s,n.push(o))}}catch(l){i.e(l)}finally{i.f()}var u=function(f){return fke(n,e,r,f)};return L_(t,r,u)}function pke(t,r,e){var n=t[1]-t[0];if(n<=0)return Z.warn("quantizeScale: invalid domain, returning range[0]")(),r[0];var i=n/r.length,a=Math.floor((e-t[0])/i),o=Math.max(Math.min(a,r.length-1),0);return r[o]}function hke(t,r,e){return(e-t[0])/(t[1]-t[0])*(r[1]-r[0])+r[0]}function Yae(t){return t!=null}function dke(t){var r=[];return t.forEach(function(e){!r.includes(e)&&Yae(e)&&r.push(e)}),r}function Kae(t,r){var e=typeof r=="function"?t.map(r):t;return e.filter(Yae)}function Jae(t,r){return Kae(t,r)}function Zae(t,r){return dke(Kae(t,r))}function Qae(t,r,e){return Math.max(r,Math.min(e,t))}function eoe(t){switch(t){case"quantize":return Xae;case"linear":return ake;case"quantile":return oke;case"ordinal":return cke;default:return Xae}}function toe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=vke(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function vke(t,r){if(t){if(typeof t=="string")return roe(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return roe(t,r)}}function roe(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var ooe=function(r){return r.length},mke=3402823466e29,soe=function(r){return r.points},uoe=function(r){return r.index},noe=function(r,e){return r<e?-1:r>e?1:r>=e?0:NaN},gke={getValue:ooe,getPoints:soe,getIndex:uoe,filterData:null},Ef=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gke;(0,ioe.default)(this,t),(0,Do.default)(this,"maxCount",void 0),(0,Do.default)(this,"maxValue",void 0),(0,Do.default)(this,"minValue",void 0),(0,Do.default)(this,"totalCount",void 0),(0,Do.default)(this,"aggregatedBins",void 0),(0,Do.default)(this,"sortedBins",void 0),(0,Do.default)(this,"binMap",void 0),this.aggregatedBins=this.getAggregatedBins(r,e),this._updateMinMaxValues(),this.binMap=this.getBinMap()}return(0,aoe.default)(t,[{key:"getAggregatedBins",value:function(e,n){for(var i=n.getValue,a=i===void 0?ooe:i,o=n.getPoints,s=o===void 0?soe:o,u=n.getIndex,l=u===void 0?uoe:u,f=n.filterData,c=typeof f=="function",p=e.length,d=[],v=0,m=0;m<p;m++){var g=e[m],y=s(g),_=l(g),b=c?y.filter(f):y;g.filteredPoints=c?b:null;var x=b.length?a(b):null;x!=null&&(d[v]={i:Number.isFinite(_)?_:m,value:x,counts:b.length},v++)}return d}},{key:"_percentileToIndex",value:function(e){var n=this.sortedBins.length;if(n<2)return[0,0];var i=e.map(function(f){return Qae(f,0,100)}),a=(0,k_.default)(i,2),o=a[0],s=a[1],u=Math.ceil(o/100*(n-1)),l=Math.floor(s/100*(n-1));return[u,l]}},{key:"getBinMap",value:function(){var e={},n=toe(this.aggregatedBins),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;e[a.i]=a}}catch(o){n.e(o)}finally{n.f()}return e}},{key:"_updateMinMaxValues",value:function(){var e=0,n=0,i=mke,a=0,o=toe(this.aggregatedBins),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;e=e>u.counts?e:u.counts,n=n>u.value?n:u.value,i=i<u.value?i:u.value,a+=u.counts}}catch(l){o.e(l)}finally{o.f()}this.maxCount=e,this.maxValue=n,this.minValue=i,this.totalCount=a}},{key:"getValueRange",value:function(e){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort(function(o,s){return noe(o.value,s.value)})),!this.sortedBins.length)return[];var n=0,i=this.sortedBins.length-1;if(Array.isArray(e)){var a=this._percentileToIndex(e);n=a[0],i=a[1]}return[this.sortedBins[n].value,this.sortedBins[i].value]}},{key:"getValueDomainByScale",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=(0,k_.default)(n,2),a=i[0],o=a===void 0?0:a,s=i[1],u=s===void 0?100:s;if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort(function(f,c){return noe(f.value,c.value)})),!this.sortedBins.length)return[];var l=this._percentileToIndex([o,u]);return this._getScaleDomain(e,l)}},{key:"_getScaleDomain",value:function(e,n){var i=(0,k_.default)(n,2),a=i[0],o=i[1],s=this.sortedBins;switch(e){case"quantize":case"linear":return[s[a].value,s[o].value];case"quantile":return Jae(s.slice(a,o+1),function(u){return u.value});case"ordinal":return Zae(s,function(u){return u.value});default:return[s[a].value,s[o].value]}}}]),t}();var hoe=h(B()),doe=h(ye());var foe=6378e3;function B_(t){return Number.isFinite(t)?t:0}function F_(t,r){for(var e=t.positions.value,n=1/0,i=-1/0,a=1/0,o=-1/0,s,u,l=0;l<r;l++)u=e[l*3],s=e[l*3+1],n=s<n?s:n,i=s>i?s:i,a=u<a?u:a,o=u>o?u:o;var f={xMin:B_(a),xMax:B_(o),yMin:B_(n),yMax:B_(i)};return f}function yke(t,r,e,n){var i=n.width,a=n.height,o=e===se.CARTESIAN?[-i/2,-a/2]:[-180,-90];Z.assert(e===se.CARTESIAN||e===se.LNGLAT||e===se.DEFAULT);var s=t.xMin,u=t.yMin;return[-1*(loe(s-o[0],r.xOffset)+o[0]),-1*(loe(u-o[1],r.yOffset)+o[1])]}function loe(t,r){var e=t<0?-1:1,n=e<0?Math.abs(t)+r:Math.abs(t);return n=Math.floor(n/r)*r,n*e}function i2(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e)return{xOffset:r,yOffset:r};var n=t.yMin,i=t.yMax,a=(n+i)/2;return _ke(r,a)}function D_(t,r,e,n){var i=i2(t,r,n!==se.CARTESIAN),a=yke(t,i,n,e),o=t.xMin,s=t.yMin,u=t.xMax,l=t.yMax,f=u-o+i.xOffset,c=l-s+i.yOffset,p=Math.ceil(f/i.xOffset),d=Math.ceil(c/i.yOffset);return{gridOffset:i,translation:a,width:f,height:c,numCol:p,numRow:d}}function _ke(t,r){var e=bke(t),n=xke(r,t);return{yOffset:e,xOffset:n}}function bke(t){return t/foe*(180/Math.PI)}function xke(t,r){return r/foe*(180/Math.PI)/Math.cos(t*Math.PI/180)}function coe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ake(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?coe(Object(e),!0).forEach(function(n){(0,hoe.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):coe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Tke(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Ske(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Ske(t,r){if(t){if(typeof t=="string")return poe(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return poe(t,r)}}function poe(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Cf(t,r){var e=Pke(t,r),n=wke(e);return{gridHash:e.gridHash,gridOffset:e.gridOffset,data:n}}function Pke(t,r){var e=t.data,n=e===void 0?[]:e,i=t.cellSize,a=r.attributes,o=r.viewport,s=r.projectPoints,u=r.numInstances,l=a.positions.value,f=a.positions.getAccessor(),c=f.size,p=r.boundingBox||Oke(a.positions,u),d=r.posOffset||[180,90],v=r.gridOffset||i2(p,i);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var m=o.width,g=o.height,y=Math.ceil(m/v.xOffset),_=Math.ceil(g/v.yOffset),b={},x=Nt(n),A=x.iterable,T=x.objectInfo,O=new Array(3),w=Tke(A),E;try{for(w.s();!(E=w.n()).done;){var S=E.value;T.index++,O[0]=l[T.index*c],O[1]=l[T.index*c+1],O[2]=c>=3?l[T.index*c+2]:0;var I=s?o.project(O):O,R=(0,doe.default)(I,2),z=R[0],G=R[1];if(Number.isFinite(z)&&Number.isFinite(G)){var k=Math.floor((G+d[1])/v.yOffset),U=Math.floor((z+d[0])/v.xOffset);if(!s||U>=0&&U<y&&k>=0&&k<_){var j="".concat(k,"-").concat(U);b[j]=b[j]||{count:0,points:[],lonIdx:U,latIdx:k},b[j].count+=1,b[j].points.push({source:S,index:T.index})}}}}catch(X){w.e(X)}finally{w.f()}return{gridHash:b,gridOffset:v,offsets:[d[0]*-1,d[1]*-1]}}function wke(t){var r=t.gridHash,e=t.gridOffset,n=t.offsets,i=new Array(Object.keys(r).length),a=0;for(var o in r){var s=o.split("-"),u=parseInt(s[0],10),l=parseInt(s[1],10),f=a++;i[f]=Ake({index:f,position:[n[0]+e.xOffset*l,n[1]+e.yOffset*u]},r[o])}return i}function Oke(t,r){for(var e=t.value,n=t.getAccessor(),i=n.size,a=1/0,o=-1/0,s=1/0,u=-1/0,l,f,c=0;c<r;c++)f=e[c*i],l=e[c*i+1],Number.isFinite(f)&&Number.isFinite(l)&&(a=l<a?l:a,o=l>o?l:o,s=f<s?f:s,u=f>u?f:u);return{xMin:s,xMax:u,yMin:a,yMax:o}}function Eke(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Cke(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Cke(t,r){if(t){if(typeof t=="string")return voe(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return voe(t,r)}}function voe(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Mke(t){var r=Ike();return function(){var n=(0,Mf.default)(t),i;if(r){var a=(0,Mf.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,boe.default)(this,i)}}function Ike(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cu=function(t){(0,_oe.default)(e,t);var r=Mke(e);function e(){var n;(0,moe.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,a2.default)((0,yoe.default)(n),"state",void 0),n}return(0,goe.default)(e,[{key:"initializeAggregationLayer",value:function(i){var a=i.dimensions,o=this.context.gl;(0,N_.default)((0,Mf.default)(e.prototype),"initializeAggregationLayer",this).call(this,a),this.setState({layerData:{},gpuGridAggregator:new Or(o,{id:"".concat(this.id,"-gpu-aggregator")}),cpuGridAggregator:Cf})}},{key:"updateState",value:function(i){(0,N_.default)((0,Mf.default)(e.prototype),"updateState",this).call(this,i),this.updateAggregationState(i);var a=this.state,o=a.aggregationDataDirty,s=a.aggregationWeightsDirty,u=a.gpuAggregation;if(!(this.getNumInstances()<=0)){var l=!1;(o||u&&s)&&(this._updateAggregation(i),l=!0),!u&&(o||s)&&(this._updateWeightBins(),this._uploadAggregationResults(),l=!0),this.setState({aggregationDirty:l})}}},{key:"finalizeState",value:function(i){var a,o=this.state.weights.count;o&&o.aggregationBuffer&&o.aggregationBuffer.delete(),(a=this.state.gpuGridAggregator)===null||a===void 0||a.delete(),(0,N_.default)((0,Mf.default)(e.prototype),"finalizeState",this).call(this,i)}},{key:"updateShaders",value:function(i){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(i)}},{key:"updateAggregationState",value:function(i){Z.assert(!1)}},{key:"allocateResources",value:function(i,a){if(this.state.numRow!==i||this.state.numCol!==a){var o=a*i*4*4,s=this.context.gl,u=this.state.weights;for(var l in u){var f=u[l];f.aggregationBuffer&&f.aggregationBuffer.delete(),f.aggregationBuffer=new be(s,{byteLength:o,accessor:{size:4,type:5126,divisor:1}})}}}},{key:"updateResults",value:function(i){var a=i.aggregationData,o=i.maxMinData,s=i.maxData,u=i.minData,l=this.state.weights.count;l&&(l.aggregationData=a,l.maxMinData=o,l.maxData=s,l.minData=u)}},{key:"_updateAggregation",value:function(i){var a=this.state,o=a.cpuGridAggregator,s=a.gpuGridAggregator,u=a.gridOffset,l=a.posOffset,f=a.translation,c=f===void 0?[0,0]:f,p=a.scaling,d=p===void 0?[0,0,0]:p,v=a.boundingBox,m=a.projectPoints,g=a.gpuAggregation,y=a.numCol,_=a.numRow,b=i.props,x=this.context.viewport,A=this.getAttributes(),T=this.getNumInstances();if(g){var w=this.state.weights;s.run({weights:w,cellSize:[u.xOffset,u.yOffset],numCol:y,numRow:_,translation:c,scaling:d,vertexCount:T,projectPoints:m,attributes:A,moduleSettings:this.getModuleSettings()})}else{var O=o(b,{gridOffset:u,projectPoints:m,attributes:A,viewport:x,posOffset:l,boundingBox:v});this.setState({layerData:O})}}},{key:"_updateWeightBins",value:function(){var i=this.state.getValue,a=new Ef(this.state.layerData.data||[],{getValue:i});this.setState({sortedBins:a})}},{key:"_uploadAggregationResults",value:function(){var i=this.state,a=i.numCol,o=i.numRow,s=this.state.layerData.data,u=this.state.sortedBins,l=u.aggregatedBins,f=u.minValue,c=u.maxValue,p=u.totalCount,d=4,v=a*o*d,m=new Float32Array(v).fill(0),g=Eke(l),y;try{for(g.s();!(y=g.n()).done;){var _=y.value,b=s[_.i],x=b.lonIdx,A=b.latIdx,T=_.value,O=_.counts,w=(x+A*a)*d;m[w]=T,m[w+d-1]=O}}catch(R){g.e(R)}finally{g.f()}var E=new Float32Array([c,0,0,f]),S=new Float32Array([c,0,0,p]),I=new Float32Array([f,0,0,p]);this.updateResults({aggregationData:m,maxMinData:E,maxData:S,minData:I})}}]),e}(fi);(0,a2.default)(cu,"layerName","GridAggregationLayer");function Rke(t){var r=Lke();return function(){var n=(0,If.default)(t),i;if(r){var a=(0,If.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Ooe.default)(this,i)}}function Lke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function xoe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function o2(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?xoe(Object(e),!0).forEach(function(n){(0,pu.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):xoe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var kke=o2(o2({},Of.defaultProps),{},{getPosition:{type:"accessor",value:function(r){return r.position}},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"}),Aoe="positions",Bke={data:{props:["cellSizePixels"]},weights:{props:["aggregation"],accessors:["getWeight"]}},U_=function(t){(0,woe.default)(e,t);var r=Rke(e);function e(){var n;(0,Toe.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,pu.default)((0,Poe.default)(n),"state",void 0),n}return(0,Soe.default)(e,[{key:"initializeState",value:function(){var i,a=this.context.gl;if(!Of.isSupported(a)){this.setState({supported:!1}),Z.error("ScreenGridLayer: ".concat(this.id," is not supported on this browser"))();return}(0,j_.default)((0,If.default)(e.prototype),"initializeAggregationLayer",this).call(this,{dimensions:Bke,getCellSize:function(l){return l.cellSizePixels}});var o={count:{size:1,operation:vt.SUM,needMax:!0,maxTexture:wf(a,{id:"".concat(this.id,"-max-texture")})}};this.setState({supported:!0,projectPoints:!0,weights:o,subLayerData:{attributes:{}},maxTexture:o.count.maxTexture,positionAttributeName:"positions",posOffset:[0,0],translation:[1,-1]});var s=this.getAttributeManager();s.add((i={},(0,pu.default)(i,Aoe,{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()}),(0,pu.default)(i,"count",{size:3,accessor:"getWeight"}),i))}},{key:"shouldUpdateState",value:function(i){var a=i.changeFlags;return this.state.supported&&a.somethingChanged}},{key:"updateState",value:function(i){(0,j_.default)((0,If.default)(e.prototype),"updateState",this).call(this,i)}},{key:"renderLayers",value:function(){if(!this.state.supported)return[];var i=this.state,a=i.maxTexture,o=i.numRow,s=i.numCol,u=i.weights,l=this.props.updateTriggers,f=u.count.aggregationBuffer,c=this.getSubLayerClass("cells",Of);return new c(this.props,this.getSubLayerProps({id:"cell-layer",updateTriggers:l}),{data:{attributes:{instanceCounts:f}},maxTexture:a,numInstances:o*s})}},{key:"finalizeState",value:function(i){(0,j_.default)((0,If.default)(e.prototype),"finalizeState",this).call(this,i);var a=this.state,o=a.aggregationBuffer,s=a.maxBuffer,u=a.maxTexture;o?.delete(),s?.delete(),u?.delete()}},{key:"getPickingInfo",value:function(i){var a=i.info,o=a.index;if(o>=0){var s=this.state,u=s.gpuGridAggregator,l=s.gpuAggregation,f=s.weights,c=l?u.getData("count"):f.count;a.object=Or.getAggregationData(o2({pixelIndex:o},c))}return a}},{key:"updateResults",value:function(i){var a=i.aggregationData,o=i.maxData,s=this.state.weights.count;s.aggregationData=a,s.aggregationBuffer.setData({data:a}),s.maxData=o,s.maxTexture.setImageData({data:o})}},{key:"updateAggregationState",value:function(i){var a=i.props.cellSizePixels,o=i.oldProps.cellSizePixels!==a,s=i.changeFlags.viewportChanged,u=i.props.gpuAggregation;this.state.gpuAggregation!==i.props.gpuAggregation&&u&&!Or.isSupported(this.context.gl)&&(Z.warn("GPU Grid Aggregation not supported, falling back to CPU")(),u=!1);var l=u!==this.state.gpuAggregation;this.setState({gpuAggregation:u});var f=this.isAttributeChanged(Aoe),c=this.state.dimensions,p=c.data,d=c.weights,v=f||l||s||this.isAggregationDirty(i,{compareAll:u,dimension:p}),m=this.isAggregationDirty(i,{dimension:d});this.setState({aggregationDataDirty:v,aggregationWeightsDirty:m});var g=this.context.viewport;if(s||o){var y=g.width,_=g.height,b=Math.ceil(y/a),x=Math.ceil(_/a);this.allocateResources(x,b),this.setState({scaling:[y/2,-_/2,1],gridOffset:{xOffset:a,yOffset:a},width:y,height:_,numCol:b,numRow:x})}m&&this._updateAccessors(i),(v||m)&&this._resetResults()}},{key:"_updateAccessors",value:function(i){var a=i.props,o=a.getWeight,s=a.aggregation,u=a.data,l=this.state.weights.count;l&&(l.getWeight=o,l.operation=vt[s]),this.setState({getValue:Sf(s,o,{data:u})})}},{key:"_resetResults",value:function(){var i=this.state.weights.count;i&&(i.aggregationData=null)}}]),e}(cu);(0,pu.default)(U_,"layerName","ScreenGridLayer");(0,pu.default)(U_,"defaultProps",kke);var Boe=h(L()),Foe=h(N()),Doe=h(Oe()),Noe=h(Y()),joe=h(K()),G_=h(q()),l2=h(B());var s2=h(Je()),u2=h(B()),Roe=h(L()),Loe=h(N());function Eoe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ci(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Eoe(Object(e),!0).forEach(function(n){(0,u2.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Eoe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Coe(){}var Moe=["getBins","getDomain","getScaleFunc"],Ioe=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],Fke=function(r){return r.cellSize},Rf=function(){function t(r){(0,Roe.default)(this,t),this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=r.getCellSize||Fke,this._getAggregator=r.getAggregator,this._addDimension(r.dimensions||Ioe)}return(0,Loe.default)(t,[{key:"updateState",value:function(e,n){var i=e.oldProps,a=e.props,o=e.changeFlags;this.updateGetValueFuncs(i,a,o);var s=this.needsReProjectPoints(i,a,o),u=!1;if(o.dataChanged||s)this.getAggregatedData(a,n),u=!0;else{var l=this.getDimensionChanges(i,a,o)||[];l.forEach(function(f){return typeof f=="function"&&f()}),u=!0}return this.setState({aggregationDirty:u}),this.state}},{key:"setState",value:function(e){this.state=ci(ci({},this.state),e)}},{key:"setDimensionState",value:function(e,n){this.setState({dimensions:ci(ci({},this.state.dimensions),{},(0,u2.default)({},e,ci(ci({},this.state.dimensions[e]),n)))})}},{key:"normalizeResult",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.hexagons?ci({data:e.hexagons},e):e.layerData?ci({data:e.layerData},e):e}},{key:"getAggregatedData",value:function(e,n){var i=this._getAggregator(e),a=i(e,n);this.setState({layerData:this.normalizeResult(a)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}},{key:"updateGetValueFuncs",value:function(e,n,i){for(var a in this.dimensionUpdaters){var o=this.dimensionUpdaters[a].getBins.triggers,s=o.value,u=o.weight,l=o.aggregation,f=n[s.prop],c=this.needUpdateDimensionStep(this.dimensionUpdaters[a].getBins,e,n,i);c&&(f?f=dae(f,{data:n.data}):f=Sf(n[l.prop],n[u.prop],{data:n.data})),f&&this.setDimensionState(a,{getValue:f})}}},{key:"needsReProjectPoints",value:function(e,n,i){return this._getCellSize(e)!==this._getCellSize(n)||this._getAggregator(e)!==this._getAggregator(n)||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition)}},{key:"addDimension",value:function(e){this._addDimension(e)}},{key:"_addDimension",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];n.forEach(function(i){var a=i.key;e.dimensionUpdaters[a]=e.getDimensionUpdaters(i),e.state.dimensions[a]={getValue:null,domain:null,sortedBins:null,scaleFunc:Coe}})}},{key:"getDimensionUpdaters",value:function(e){var n=e.key,i=e.accessor,a=e.pickingInfo,o=e.getBins,s=e.getDomain,u=e.getScaleFunc,l=e.nullValue;return{key:n,accessor:i,pickingInfo:a,getBins:ci({updater:this.getDimensionSortedBins},o),getDomain:ci({updater:this.getDimensionValueDomain},s),getScaleFunc:ci({updater:this.getDimensionScale},u),attributeAccessor:this.getSubLayerDimensionAttribute(n,l)}}},{key:"needUpdateDimensionStep",value:function(e,n,i,a){return Object.values(e.triggers).some(function(o){return o.updateTrigger?a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged[o.updateTrigger]):n[o.prop]!==i[o.prop]})}},{key:"getDimensionChanges",value:function(e,n,i){var a=this,o=[],s=function(f){var c=Moe.find(function(p){return a.needUpdateDimensionStep(a.dimensionUpdaters[f][p],e,n,i)});c&&o.push(a.dimensionUpdaters[f][c].updater.bind(a,n,a.dimensionUpdaters[f]))};for(var u in this.dimensionUpdaters)s(u);return o.length?o:null}},{key:"getUpdateTriggers",value:function(e){var n=this,i=e.updateTriggers||{},a={},o=function(l){var f=n.dimensionUpdaters[l].accessor;a[f]={},Moe.forEach(function(c){Object.values(n.dimensionUpdaters[l][c].triggers).forEach(function(p){var d=p.prop,v=p.updateTrigger;if(v){var m=i[v];(0,s2.default)(m)==="object"&&!Array.isArray(m)?Object.assign(a[f],m):m!==void 0&&(a[f][d]=m)}else a[f][d]=e[d]})})};for(var s in this.dimensionUpdaters)o(s);return a}},{key:"getSortedBins",value:function(e){for(var n in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[n])}},{key:"getDimensionSortedBins",value:function(e,n){var i=n.key,a=this.state.dimensions[i].getValue,o=new Ef(this.state.layerData.data||[],{getValue:a,filterData:e._filterData});this.setDimensionState(i,{sortedBins:o}),this.getDimensionValueDomain(e,n)}},{key:"getDimensionValueDomain",value:function(e,n){var i=n.getDomain,a=n.key,o=i.triggers,s=o.lowerPercentile,u=o.upperPercentile,l=o.scaleType,f=this.state.dimensions[a].sortedBins.getValueDomainByScale(e[l.prop],[e[s.prop],e[u.prop]]);this.setDimensionState(a,{valueDomain:f}),this.getDimensionScale(e,n)}},{key:"getDimensionScale",value:function(e,n){var i=n.key,a=n.getScaleFunc,o=n.getDomain,s=a.triggers,u=s.domain,l=s.range,f=o.triggers.scaleType,c=a.onSet,p=e[l.prop],d=e[u.prop]||this.state.dimensions[i].valueDomain,v=eoe(f&&e[f.prop]),m=v(d,p);(0,s2.default)(c)==="object"&&typeof e[c.props]=="function"&&e[c.props](m.domain()),this.setDimensionState(i,{scaleFunc:m})}},{key:"getSubLayerDimensionAttribute",value:function(e,n){var i=this;return function(a){var o=i.state.dimensions[e],s=o.sortedBins,u=o.scaleFunc,l=s.binMap[a.index];if(l&&l.counts===0)return n;var f=l&&l.value,c=u.domain(),p=f>=c[0]&&f<=c[c.length-1];return p?u(f):n}}},{key:"getSubLayerAccessors",value:function(e){var n={};for(var i in this.dimensionUpdaters){var a=this.dimensionUpdaters[i].accessor;n[a]=this.getSubLayerDimensionAttribute(e,i)}return n}},{key:"getPickingInfo",value:function(e){var n=e.info,i=n.picked&&n.index>-1,a=null;if(i){var o=this.state.layerData.data[n.index],s={};for(var u in this.dimensionUpdaters){var l=this.dimensionUpdaters[u].pickingInfo,f=this.state.dimensions[u].sortedBins,c=f.binMap[o.index]&&f.binMap[o.index].value;s[l]=c}a=Object.assign(s,o,{points:o.filteredPoints||o.points})}return n.picked=Boolean(a),n.object=a,n}},{key:"getAccessor",value:function(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:Coe}}],[{key:"defaultDimensions",value:function(){return Ioe}}]),t}();function Dke(t){var r=Nke();return function(){var n=(0,G_.default)(t),i;if(r){var a=(0,G_.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,joe.default)(this,i)}}function Nke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function koe(){}var jke={colorDomain:null,colorRange:Ln,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:koe,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:koe,gridAggregator:Cf,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(r){return r.position}},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}},hu=function(t){(0,Noe.default)(e,t);var r=Dke(e);function e(){return(0,Boe.default)(this,e),r.apply(this,arguments)}return(0,Foe.default)(e,[{key:"initializeState",value:function(){var i=new Rf({getAggregator:function(s){return s.gridAggregator},getCellSize:function(s){return s.cellSize}});this.state={cpuAggregator:i,aggregatorState:i.state};var a=this.getAttributeManager();a.add({positions:{size:3,type:5130,accessor:"getPosition"}})}},{key:"updateState",value:function(i){(0,Doe.default)((0,G_.default)(e.prototype),"updateState",this).call(this,i),this.setState({aggregatorState:this.state.cpuAggregator.updateState(i,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances()})})}},{key:"getPickingInfo",value:function(i){var a=i.info;return this.state.cpuAggregator.getPickingInfo({info:a})}},{key:"_onGetSublayerColor",value:function(i){return this.state.cpuAggregator.getAccessor("fillColor")(i)}},{key:"_onGetSublayerElevation",value:function(i){return this.state.cpuAggregator.getAccessor("elevation")(i)}},{key:"_getSublayerUpdateTriggers",value:function(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}},{key:"renderLayers",value:function(){var i=this.props,a=i.elevationScale,o=i.extruded,s=i.cellSize,u=i.coverage,l=i.material,f=i.transitions,c=this.state.cpuAggregator,p=this.getSubLayerClass("grid-cell",Fl),d=this._getSublayerUpdateTriggers();return new p({cellSize:s,coverage:u,material:l,elevationScale:a,extruded:o,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:f&&{getFillColor:f.getColorValue||f.getColorWeight,getElevation:f.getElevationValue||f.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:d}),{data:c.state.layerData.data})}}]),e}(fi);(0,l2.default)(hu,"layerName","CPUGridLayer");(0,l2.default)(hu,"defaultProps",jke);var Woe=h(L()),$oe=h(N()),Xoe=h(_e()),qoe=h(Oe()),Yoe=h(Y()),Koe=h(K()),z_=h(q()),fd=h(B());var Lf=Math.PI/3,Uke=[0,Lf,2*Lf,3*Lf,4*Lf,5*Lf];function Gke(t){return t[0]}function zke(t){return t[1]}function f2(){var t=0,r=0,e=1,n=1,i=Gke,a=zke,o,s,u;function l(c){var p={},d=[],v,m=c.length;for(v=0;v<m;++v)if(!(isNaN(y=+i.call(null,g=c[v],v,c))||isNaN(_=+a.call(null,g,v,c)))){var g,y,_,b=Math.round(_=_/u),x=Math.round(y=y/s-(b&1)/2),A=_-b;if(Math.abs(A)*3>1){var T=y-x,O=x+(y<x?-1:1)/2,w=b+(_<b?-1:1),E=y-O,S=_-w;T*T+A*A>E*E+S*S&&(x=O+(b&1?1:-1)/2,b=w)}var I=x+"-"+b,R=p[I];R?R.push(g):(d.push(R=p[I]=[g]),R.x=(x+(b&1)/2)*s,R.y=b*u)}return d}function f(c){var p=0,d=0;return Uke.map(function(v){var m=Math.sin(v)*c,g=-Math.cos(v)*c,y=m-p,_=g-d;return p=m,d=g,[y,_]})}return l.hexagon=function(c){return"m"+f(c==null?o:+c).join("l")+"z"},l.centers=function(){for(var c=[],p=Math.round(r/u),d=Math.round(t/s),v=p*u;v<n+o;v+=u,++p)for(var m=d*s+(p&1)*s/2;m<e+s/2;m+=s)c.push([m,v]);return c},l.mesh=function(){var c=f(o).slice(0,4).join("l");return l.centers().map(function(p){return"M"+p+"m"+c}).join("")},l.x=function(c){return arguments.length?(i=c,l):i},l.y=function(c){return arguments.length?(a=c,l):a},l.radius=function(c){return arguments.length?(o=+c,s=o*2*Math.sin(Lf),u=o*1.5,l):o},l.size=function(c){return arguments.length?(t=r=0,e=+c[0],n=+c[1],l):[e-t,n-r]},l.extent=function(c){return arguments.length?(t=+c[0][0],r=+c[0][1],e=+c[1][0],n=+c[1][1],l):[[t,r],[e,n]]},l.radius(1)}function Vke(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Hke(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Hke(t,r){if(t){if(typeof t=="string")return Uoe(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Uoe(t,r)}}function Uoe(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Goe(t,r){var e=t.data,n=t.radius,i=r.viewport,a=r.attributes,o=e.length?Wke(e,r):null,s=$ke(n,i,o),u=[],l=Nt(e),f=l.iterable,c=l.objectInfo,p=a.positions.value,d=a.positions.getAccessor(),v=d.size,m=Vke(f),g;try{for(m.s();!(g=m.n()).done;){var y=g.value;c.index++;var _=c.index*v,b=[p[_],p[_+1]],x=Number.isFinite(b[0])&&Number.isFinite(b[1]);x?u.push({screenCoord:i.projectFlat(b),source:y,index:c.index}):Z.warn("HexagonLayer: invalid position")()}}catch(O){m.e(O)}finally{m.f()}var A=f2().radius(s).x(function(O){return O.screenCoord[0]}).y(function(O){return O.screenCoord[1]}),T=A(u);return{hexagons:T.map(function(O,w){return{position:i.unprojectFlat([O.x,O.y]),points:O,index:w}}),radiusCommon:s}}function Wke(t,r){var e=r.attributes,n=e.positions.value,i=e.positions.getAccessor(),a=i.size,o=1/0,s=1/0,u=-1/0,l=-1/0,f;for(f=0;f<a*t.length;f+=a){var c=n[f],p=n[f+1],d=Number.isFinite(c)&&Number.isFinite(p);d&&(o=Math.min(c,o),u=Math.max(c,u),s=Math.min(p,s),l=Math.max(p,l))}return[o,s,u,l].every(Number.isFinite)?[(o+u)/2,(s+l)/2]:null}function $ke(t,r,e){var n=r.getDistanceScales(e),i=n.unitsPerMeter;return t*i[0]}function zoe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Voe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?zoe(Object(e),!0).forEach(function(n){(0,fd.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):zoe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Xke(t){var r=qke();return function(){var n=(0,z_.default)(t),i;if(r){var a=(0,z_.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Koe.default)(this,i)}}function qke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Hoe(){}var Yke={colorDomain:null,colorRange:Ln,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:Hoe,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:Hoe,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:Goe,getPosition:{type:"accessor",value:function(r){return r.position}},material:!0,_filterData:{type:"function",value:null,optional:!0}},V_=function(t){(0,Yoe.default)(e,t);var r=Xke(e);function e(){var n;(0,Woe.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,fd.default)((0,Xoe.default)(n),"state",void 0),n}return(0,$oe.default)(e,[{key:"initializeState",value:function(){var i=new Rf({getAggregator:function(s){return s.hexagonAggregator},getCellSize:function(s){return s.radius}});this.state={cpuAggregator:i,aggregatorState:i.state,vertices:null};var a=this.getAttributeManager();a.add({positions:{size:3,type:5130,accessor:"getPosition"}})}},{key:"updateState",value:function(i){if((0,qoe.default)((0,z_.default)(e.prototype),"updateState",this).call(this,i),i.changeFlags.propsOrDataChanged){var a=this.state.cpuAggregator.updateState(i,{viewport:this.context.viewport,attributes:this.getAttributes()});if(this.state.aggregatorState.layerData!==a.layerData){var o=a.layerData||{},s=o.hexagonVertices;this.setState({vertices:s&&this.convertLatLngToMeterOffset(s)})}this.setState({aggregatorState:a})}}},{key:"convertLatLngToMeterOffset",value:function(i){var a=this.context.viewport;if(Array.isArray(i)&&i.length===6){var o=i[0],s=i[3],u=[(o[0]+s[0])/2,(o[1]+s[1])/2],l=a.projectFlat(u),f=a.getDistanceScales(u),c=f.metersPerUnit,p=i.map(function(d){var v=a.projectFlat(d);return[(v[0]-l[0])*c[0],(v[1]-l[1])*c[1]]});return p}return Z.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}},{key:"getPickingInfo",value:function(i){var a=i.info;return this.state.cpuAggregator.getPickingInfo({info:a})}},{key:"_onGetSublayerColor",value:function(i){return this.state.cpuAggregator.getAccessor("fillColor")(i)}},{key:"_onGetSublayerElevation",value:function(i){return this.state.cpuAggregator.getAccessor("elevation")(i)}},{key:"_getSublayerUpdateTriggers",value:function(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}},{key:"renderLayers",value:function(){var i=this.props,a=i.elevationScale,o=i.extruded,s=i.coverage,u=i.material,l=i.transitions,f=this.state,c=f.aggregatorState,p=f.vertices,d=this.getSubLayerClass("hexagon-cell",Li),v=this._getSublayerUpdateTriggers(),m=p?{vertices:p,radius:1}:{radius:c.layerData.radiusCommon||1,radiusUnits:"common",angle:90};return new d(Voe(Voe({},m),{},{diskResolution:6,elevationScale:a,extruded:o,coverage:s,material:u,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:l&&{getFillColor:l.getColorValue||l.getColorWeight,getElevation:l.getElevationValue||l.getElevationWeight}}),this.getSubLayerProps({id:"hexagon-cell",updateTriggers:v}),{data:c.layerData.data})}}]),e}(fi);(0,fd.default)(V_,"layerName","HexagonLayer");(0,fd.default)(V_,"defaultProps",Yke);var Ise=h(L()),Rse=h(N()),p2=h(Oe()),Lse=h(Y()),kse=h(K()),pd=h(q()),hd=h(B());var Sse=h(B());var oe=h(B()),ae,ie=.5,pe=1/6,W={N:[0,ie],E:[ie,0],S:[0,-ie],W:[-ie,0],NE:[ie,ie],NW:[-ie,ie],SE:[ie,-ie],SW:[-ie,-ie]},kf=[W.W,W.SW,W.S],Bf=[W.S,W.SE,W.E],Ff=[W.E,W.NE,W.N],Df=[W.NW,W.W,W.N],Nf=[[-ie,pe],[-ie,-pe],[-pe,-ie],[pe,-ie]],jf=[[-pe,-ie],[pe,-ie],[ie,-pe],[ie,pe]],Uf=[[ie,-pe],[ie,pe],[pe,ie],[-pe,ie]],Gf=[[-ie,pe],[-ie,-pe],[pe,ie],[-pe,ie]],Joe=[W.W,W.SW,W.SE,W.E],Zoe=[W.S,W.SE,W.NE,W.N],Qoe=[W.NW,W.W,W.E,W.NE],ese=[W.NW,W.SW,W.S,W.N],tse=[[-ie,pe],[-ie,-pe],[ie,-pe],[ie,pe]],rse=[[-pe,-ie],[pe,-ie],[pe,ie],[-pe,ie]],Kke=[W.NW,W.SW,W.SE,W.NE],nse=[W.NW,W.SW,W.SE,W.E,W.N],ise=[W.W,W.SW,W.SE,W.NE,W.N],ase=[W.NW,W.W,W.S,W.SE,W.NE],ose=[W.NW,W.SW,W.S,W.E,W.NE],sse=[W.NW,W.W,[ie,-pe],[ie,pe],W.N],use=[[-pe,-ie],[pe,-ie],W.E,W.NE,W.N],lse=[[-ie,pe],[-ie,-pe],W.S,W.SE,W.E],fse=[W.W,W.SW,W.S,[pe,ie],[-pe,ie]],cse=[W.NW,W.W,[-pe,-ie],[pe,-ie],W.N],pse=[[-ie,pe],[-ie,-pe],W.E,W.NE,W.N],hse=[W.S,W.SE,W.E,[pe,ie],[-pe,ie]],dse=[W.W,W.SW,W.S,[ie,-pe],[ie,pe]],vse=[W.W,W.SW,W.SE,W.E,[pe,ie],[-pe,ie]],mse=[[-ie,pe],[-ie,-pe],W.S,W.SE,W.NE,W.N],gse=[W.NW,W.W,[-pe,-ie],[pe,-ie],W.E,W.NE],yse=[W.NW,W.SW,W.S,[ie,-pe],[ie,pe],W.N],zf=[W.W,W.SW,W.S,W.E,W.NE,W.N],Vf=[W.NW,W.W,W.S,W.SE,W.E,W.N],H_=[[-ie,pe],[-ie,-pe],[-pe,-ie],[pe,-ie],W.E,W.NE,W.N],W_=[W.W,W.SW,W.S,[ie,-pe],[ie,pe],[pe,ie],[-pe,ie]],$_=[W.NW,W.W,[-pe,-ie],[pe,-ie],[ie,-pe],[ie,pe],W.N],X_=[[-ie,pe],[-ie,-pe],W.S,W.SE,W.E,[pe,ie],[-pe,ie]],_se=[[-ie,pe],[-ie,-pe],[-pe,-ie],[pe,-ie],[ie,-pe],[ie,pe],[pe,ie],[-pe,ie]],bse={0:[],1:[[W.W,W.S]],2:[[W.S,W.E]],3:[[W.W,W.E]],4:[[W.N,W.E]],5:{0:[[W.W,W.S],[W.N,W.E]],1:[[W.W,W.N],[W.S,W.E]]},6:[[W.N,W.S]],7:[[W.W,W.N]],8:[[W.W,W.N]],9:[[W.N,W.S]],10:{0:[[W.W,W.N],[W.S,W.E]],1:[[W.W,W.S],[W.N,W.E]]},11:[[W.N,W.E]],12:[[W.W,W.E]],13:[[W.S,W.E]],14:[[W.W,W.S]],15:[]};function ue(t){return parseInt(t,4)}var xse=(ae={},(0,oe.default)(ae,ue("0000"),[]),(0,oe.default)(ae,ue("2222"),[]),(0,oe.default)(ae,ue("2221"),[kf]),(0,oe.default)(ae,ue("2212"),[Bf]),(0,oe.default)(ae,ue("2122"),[Ff]),(0,oe.default)(ae,ue("1222"),[Df]),(0,oe.default)(ae,ue("0001"),[kf]),(0,oe.default)(ae,ue("0010"),[Bf]),(0,oe.default)(ae,ue("0100"),[Ff]),(0,oe.default)(ae,ue("1000"),[Df]),(0,oe.default)(ae,ue("2220"),[Nf]),(0,oe.default)(ae,ue("2202"),[jf]),(0,oe.default)(ae,ue("2022"),[Uf]),(0,oe.default)(ae,ue("0222"),[Gf]),(0,oe.default)(ae,ue("0002"),[Nf]),(0,oe.default)(ae,ue("0020"),[jf]),(0,oe.default)(ae,ue("0200"),[Uf]),(0,oe.default)(ae,ue("2000"),[Gf]),(0,oe.default)(ae,ue("0011"),[Joe]),(0,oe.default)(ae,ue("0110"),[Zoe]),(0,oe.default)(ae,ue("1100"),[Qoe]),(0,oe.default)(ae,ue("1001"),[ese]),(0,oe.default)(ae,ue("2211"),[Joe]),(0,oe.default)(ae,ue("2112"),[Zoe]),(0,oe.default)(ae,ue("1122"),[Qoe]),(0,oe.default)(ae,ue("1221"),[ese]),(0,oe.default)(ae,ue("2200"),[tse]),(0,oe.default)(ae,ue("2002"),[rse]),(0,oe.default)(ae,ue("0022"),[tse]),(0,oe.default)(ae,ue("0220"),[rse]),(0,oe.default)(ae,ue("1111"),[Kke]),(0,oe.default)(ae,ue("1211"),[nse]),(0,oe.default)(ae,ue("2111"),[ise]),(0,oe.default)(ae,ue("1112"),[ase]),(0,oe.default)(ae,ue("1121"),[ose]),(0,oe.default)(ae,ue("1011"),[nse]),(0,oe.default)(ae,ue("0111"),[ise]),(0,oe.default)(ae,ue("1110"),[ase]),(0,oe.default)(ae,ue("1101"),[ose]),(0,oe.default)(ae,ue("1200"),[sse]),(0,oe.default)(ae,ue("0120"),[use]),(0,oe.default)(ae,ue("0012"),[lse]),(0,oe.default)(ae,ue("2001"),[fse]),(0,oe.default)(ae,ue("1022"),[sse]),(0,oe.default)(ae,ue("2102"),[use]),(0,oe.default)(ae,ue("2210"),[lse]),(0,oe.default)(ae,ue("0221"),[fse]),(0,oe.default)(ae,ue("1002"),[cse]),(0,oe.default)(ae,ue("2100"),[pse]),(0,oe.default)(ae,ue("0210"),[hse]),(0,oe.default)(ae,ue("0021"),[dse]),(0,oe.default)(ae,ue("1220"),[cse]),(0,oe.default)(ae,ue("0122"),[pse]),(0,oe.default)(ae,ue("2012"),[hse]),(0,oe.default)(ae,ue("2201"),[dse]),(0,oe.default)(ae,ue("0211"),[vse]),(0,oe.default)(ae,ue("2110"),[mse]),(0,oe.default)(ae,ue("1102"),[gse]),(0,oe.default)(ae,ue("1021"),[yse]),(0,oe.default)(ae,ue("2011"),[vse]),(0,oe.default)(ae,ue("0112"),[mse]),(0,oe.default)(ae,ue("1120"),[gse]),(0,oe.default)(ae,ue("1201"),[yse]),(0,oe.default)(ae,ue("2101"),[zf]),(0,oe.default)(ae,ue("0121"),[zf]),(0,oe.default)(ae,ue("1012"),[Vf]),(0,oe.default)(ae,ue("1210"),[Vf]),(0,oe.default)(ae,ue("0101"),{0:[kf,Ff],1:[zf],2:[zf]}),(0,oe.default)(ae,ue("1010"),{0:[Df,Bf],1:[Vf],2:[Vf]}),(0,oe.default)(ae,ue("2121"),{0:[zf],1:[zf],2:[kf,Ff]}),(0,oe.default)(ae,ue("1212"),{0:[Vf],1:[Vf],2:[Df,Bf]}),(0,oe.default)(ae,ue("2120"),{0:[H_],1:[H_],2:[Nf,Ff]}),(0,oe.default)(ae,ue("2021"),{0:[W_],1:[W_],2:[kf,Uf]}),(0,oe.default)(ae,ue("1202"),{0:[$_],1:[$_],2:[Df,jf]}),(0,oe.default)(ae,ue("0212"),{0:[X_],1:[X_],2:[Bf,Gf]}),(0,oe.default)(ae,ue("0102"),{0:[Nf,Ff],1:[H_],2:[H_]}),(0,oe.default)(ae,ue("0201"),{0:[kf,Uf],1:[W_],2:[W_]}),(0,oe.default)(ae,ue("1020"),{0:[Df,jf],1:[$_],2:[$_]}),(0,oe.default)(ae,ue("2010"),{0:[Bf,Gf],1:[X_],2:[X_]}),(0,oe.default)(ae,ue("2020"),{0:[Gf,jf],1:[_se],2:[Nf,Uf]}),(0,oe.default)(ae,ue("0202"),{0:[Uf,Nf],1:[_se],2:[Gf,jf]}),ae);function Ase(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Tse(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Ase(Object(e),!0).forEach(function(n){(0,Sse.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Ase(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var du={ISO_LINES:1,ISO_BANDS:2},Jke={zIndex:0,zOffset:.005};function cd(t,r){return Array.isArray(r)?t<r[0]?0:t<r[1]?1:2:t>=r?1:0}function Pse(t){var r=t.cellWeights,e=t.x,n=t.y,i=t.width,a=t.height,o=t.threshold;t.thresholdValue&&(Z.deprecated("thresholdValue","threshold")(),o=t.thresholdValue);var s=e<0,u=e>=i-1,l=n<0,f=n>=a-1,c=s||u||l||f,p={},d={};s||f?d.top=0:(p.top=r[(n+1)*i+e],d.top=cd(p.top,o)),u||f?d.topRight=0:(p.topRight=r[(n+1)*i+e+1],d.topRight=cd(p.topRight,o)),u||l?d.right=0:(p.right=r[n*i+e+1],d.right=cd(p.right,o)),s||l?d.current=0:(p.current=r[n*i+e],d.current=cd(p.current,o));var v=d.top,m=d.topRight,g=d.right,y=d.current,_=-1;Number.isFinite(o)&&(_=v<<3|m<<2|g<<1|y),Array.isArray(o)&&(_=v<<6|m<<4|g<<2|y);var b=0;return c||(b=cd((p.top+p.topRight+p.right+p.current)/4,o)),{code:_,meanCode:b}}function c2(t){var r=t.gridOrigin,e=t.cellSize,n=t.x,i=t.y,a=t.code,o=t.meanCode,s=t.type,u=s===void 0?du.ISO_LINES:s,l=Tse(Tse({},Jke),t.thresholdData),f=u===du.ISO_BANDS?xse[a]:bse[a];Array.isArray(f)||(f=f[o]);var c=l.zIndex*l.zOffset,p=(n+1)*e[0],d=(i+1)*e[1],v=r[0]+p,m=r[1]+d;if(u===du.ISO_BANDS){var g=[];return f.forEach(function(_){var b=[];_.forEach(function(x){var A=v+x[0]*e[0],T=m+x[1]*e[1];b.push([A,T,c])}),g.push(b)}),g}var y=[];return f.forEach(function(_){_.forEach(function(b){var x=v+b[0]*e[0],A=m+b[1]*e[1];y.push([x,A,c])})}),y}function wse(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Zke(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Zke(t,r){if(t){if(typeof t=="string")return Ose(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Ose(t,r)}}function Ose(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Ese(t){var r=t.thresholdData,e=t.cellWeights,n=t.gridSize,i=t.gridOrigin,a=t.cellSize,o=[],s=[],u=n[0],l=n[1],f=0,c=0,p=wse(r),d;try{for(p.s();!(d=p.n()).done;)for(var v=d.value,m=v.contour,g=m.threshold,y=-1;y<u;y++)for(var _=-1;_<l;_++){var b=Pse({cellWeights:e,threshold:g,x:y,y:_,width:u,height:l}),x=b.code,A=b.meanCode,T={type:du.ISO_BANDS,gridOrigin:i,cellSize:a,x:y,y:_,width:u,height:l,code:x,meanCode:A,thresholdData:v};if(Array.isArray(g)){T.type=du.ISO_BANDS;var O=c2(T),w=wse(O),E;try{for(w.s();!(E=w.n()).done;){var S=E.value;s[c++]={vertices:S,contour:m}}}catch(z){w.e(z)}finally{w.f()}}else{T.type=du.ISO_LINES;for(var I=c2(T),R=0;R<I.length;R+=2)o[f++]={start:I[R],end:I[R+1],contour:m}}}}catch(z){p.e(z)}finally{p.f()}return{contourSegments:o,contourPolygons:s}}function Qke(t){var r=eBe();return function(){var n=(0,pd.default)(t),i;if(r){var a=(0,pd.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,kse.default)(this,i)}}function eBe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Cse=[255,255,255,255],tBe=1,rBe=1,nBe={cellSize:{type:"number",min:1,max:1e3,value:1e3},getPosition:{type:"accessor",value:function(r){return r.position}},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:rBe}],optional:!0,compare:3},zOffset:.005},Mse="positions",iBe={data:{props:["cellSize"]},weights:{props:["aggregation"],accessors:["getWeight"]}},q_=function(t){(0,Lse.default)(e,t);var r=Qke(e);function e(){return(0,Ise.default)(this,e),r.apply(this,arguments)}return(0,Rse.default)(e,[{key:"initializeState",value:function(){var i;(0,p2.default)((0,pd.default)(e.prototype),"initializeAggregationLayer",this).call(this,{dimensions:iBe}),this.setState({contourData:{},projectPoints:!1,weights:{count:{size:1,operation:vt.SUM}}});var a=this.getAttributeManager();a.add((i={},(0,hd.default)(i,Mse,{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()}),(0,hd.default)(i,"count",{size:3,accessor:"getWeight"}),i))}},{key:"updateState",value:function(i){(0,p2.default)((0,pd.default)(e.prototype),"updateState",this).call(this,i);var a=!1,o=i.oldProps,s=i.props,u=this.state.aggregationDirty;(o.contours!==s.contours||o.zOffset!==s.zOffset)&&(a=!0,this._updateThresholdData(i.props)),this.getNumInstances()>0&&(u||a)&&this._generateContours()}},{key:"renderLayers",value:function(){var i=this.state.contourData,a=i.contourSegments,o=i.contourPolygons,s=this.getSubLayerClass("lines",Il),u=this.getSubLayerClass("bands",Bi),l=a&&a.length>0&&new s(this.getSubLayerProps({id:"lines"}),{data:this.state.contourData.contourSegments,getSourcePosition:function(p){return p.start},getTargetPosition:function(p){return p.end},getColor:function(p){return p.contour.color||Cse},getWidth:function(p){return p.contour.strokeWidth||tBe}}),f=o&&o.length>0&&new u(this.getSubLayerProps({id:"bands"}),{data:this.state.contourData.contourPolygons,getPolygon:function(p){return p.vertices},getFillColor:function(p){return p.contour.color||Cse}});return[l,f]}},{key:"updateAggregationState",value:function(i){var a=i.props,o=i.oldProps,s=a.cellSize,u=a.coordinateSystem,l=this.context.viewport,f=o.cellSize!==s,c=a.gpuAggregation;this.state.gpuAggregation!==a.gpuAggregation&&c&&!Or.isSupported(this.context.gl)&&(Z.warn("GPU Grid Aggregation not supported, falling back to CPU")(),c=!1);var p=c!==this.state.gpuAggregation;this.setState({gpuAggregation:c});var d=this.state.dimensions,v=this.isAttributeChanged(Mse),m=d.data,g=d.weights,y=this.state.boundingBox;if(v&&(y=F_(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:y})),v||f){var _=D_(y,s,l,u),b=_.gridOffset,x=_.translation,A=_.width,T=_.height,O=_.numCol,w=_.numRow;this.allocateResources(w,O),this.setState({gridOffset:b,boundingBox:y,translation:x,posOffset:x.slice(),gridOrigin:[-1*x[0],-1*x[1]],width:A,height:T,numCol:O,numRow:w})}var E=v||p||this.isAggregationDirty(i,{dimension:m,compareAll:c}),S=this.isAggregationDirty(i,{dimension:g});S&&this._updateAccessors(i),(E||S)&&this._resetResults(),this.setState({aggregationDataDirty:E,aggregationWeightsDirty:S})}},{key:"_updateAccessors",value:function(i){var a=i.props,o=a.getWeight,s=a.aggregation,u=a.data,l=this.state.weights.count;l&&(l.getWeight=o,l.operation=vt[s]),this.setState({getValue:Sf(s,o,{data:u})})}},{key:"_resetResults",value:function(){var i=this.state.weights.count;i&&(i.aggregationData=null)}},{key:"_generateContours",value:function(){var i=this.state,a=i.numCol,o=i.numRow,s=i.gridOrigin,u=i.gridOffset,l=i.thresholdData,f=this.state.weights.count,c=f.aggregationData;c||(c=f.aggregationBuffer.getData(),f.aggregationData=c);var p=Or.getCellData({countsData:c}),d=p.cellWeights,v=Ese({thresholdData:l,cellWeights:d,gridSize:[a,o],gridOrigin:s,cellSize:[u.xOffset,u.yOffset]});this.setState({contourData:v})}},{key:"_updateThresholdData",value:function(i){for(var a=i.contours,o=i.zOffset,s=a.length,u=new Array(s),l=0;l<s;l++){var f=a[l];u[l]={contour:f,zIndex:f.zIndex||l,zOffset:o}}this.setState({thresholdData:u})}}]),e}(cu);(0,hd.default)(q_,"layerName","ContourLayer");(0,hd.default)(q_,"defaultProps",nBe);var Zse=h(L()),Qse=h(N()),eue=h(_e()),tue=h(Y()),rue=h(K()),m2=h(q()),dd=h(B());var Xse=h(L()),qse=h(N()),Z_=h(Oe()),Yse=h(Y()),Kse=h(K()),Hf=h(q()),vu=h(B());var jse=h(L()),Use=h(N()),Gse=h(Oe()),zse=h(Y()),Vse=h(K()),Y_=h(q()),K_=h(B());var Bse=`#version 300 es
#define SHADER_NAME gpu-grid-cell-layer-vertex-shader
#define RANGE_COUNT 6

in vec3 positions;
in vec3 normals;

in vec4 colors;
in vec4 elevations;
in vec3 instancePickingColors;
uniform vec2 offset;
uniform bool extruded;
uniform float cellSize;
uniform float coverage;
uniform float opacity;
uniform float elevationScale;

uniform ivec2 gridSize;
uniform vec2 gridOrigin;
uniform vec2 gridOriginLow;
uniform vec2 gridOffset;
uniform vec2 gridOffsetLow;
uniform vec4 colorRange[RANGE_COUNT];
uniform vec2 elevationRange;
uniform vec2 colorDomain;
uniform bool colorDomainValid;
uniform vec2 elevationDomain;
uniform bool elevationDomainValid;

layout(std140) uniform;
uniform ColorData
{
  vec4 maxMinCount;
} colorData;
uniform ElevationData
{
  vec4 maxMinCount;
} elevationData;

#define EPSILON 0.00001
out vec4 vColor;

vec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {
  vec4 outColor = vec4(0., 0., 0., 0.);
  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {
    float domainRange = domain.y - domain.x;
    if (domainRange <= 0.) {
      outColor = colorRange[0];
    } else {
      float rangeCount = float(RANGE_COUNT);
      float rangeStep = domainRange / rangeCount;
      float idx = floor((value - domain.x) / rangeStep);
      idx = clamp(idx, 0., rangeCount - 1.);
      int intIdx = int(idx);
      outColor = colorRange[intIdx];
    }
  }
  return outColor;
}

float linearScale(vec2 domain, vec2 range, float value) {
  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {
    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;
  }
  return -1.;
}

void main(void) {
  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);
  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);

  float elevation = 0.0;

  if (extruded) {
    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);
    elevation = linearScale(elvDomain, elevationRange, elevations.r);
    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;
  }
  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);
  float dotRadius = cellSize / 2. * coverage * shouldRender;

  int yIndex = (gl_InstanceID / gridSize[0]);
  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);

  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));
  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));
  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));
  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));

  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);
  vec3 centroidPosition64Low = vec3(instancePositionXFP64[1], instancePositionYFP64[1], 0.0);
  geometry.worldPosition = centroidPosition;
  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);
  picking_setPickingColor(instancePickingColors);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);

  vec3 normals_commonspace = project_normal(normals);

   if (extruded) {
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, normals_commonspace);
    vColor = vec4(lightColor, color.a * opacity) / 255.;
  } else {
    vColor = vec4(color.rgb, color.a * opacity) / 255.;
  }
}
`;var Fse=`#version 300 es
#define SHADER_NAME gpu-grid-cell-layer-fragment-shader

precision highp float;

in vec4 vColor;

out vec4 fragColor;

void main(void) {
  fragColor = vColor;
  fragColor = picking_filterColor(fragColor);
}
`;function Dse(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Nse(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Dse(Object(e),!0).forEach(function(n){(0,K_.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Dse(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function aBe(t){var r=oBe();return function(){var n=(0,Y_.default)(t),i;if(r){var a=(0,Y_.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Vse.default)(this,i)}}function oBe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var h2=0,d2=1,sBe={colorDomain:null,colorRange:Ln,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",value:[1,1]},gridOrigin:{type:"array",value:[0,0]},gridOffset:{type:"array",value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,material:!0},J_=function(t){(0,zse.default)(e,t);var r=aBe(e);function e(){return(0,jse.default)(this,e),r.apply(this,arguments)}return(0,Use.default)(e,[{key:"getShaders",value:function(){return(0,Gse.default)((0,Y_.default)(e.prototype),"getShaders",this).call(this,{vs:Bse,fs:Fse,modules:[Ze,on,it,ns]})}},{key:"initializeState",value:function(i){var a=i.gl,o=this.getAttributeManager();o.addInstanced({colors:{size:4,noAlloc:!0},elevations:{size:4,noAlloc:!0}});var s=this._getModel(a);this._setupUniformBuffer(s),this.setState({model:s})}},{key:"_getModel",value:function(i){return new Ee(i,Nse(Nse({},this.getShaders()),{},{id:this.props.id,geometry:new ro,isInstanced:!0}))}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.cellSize,u=o.offset,l=o.extruded,f=o.elevationScale,c=o.coverage,p=o.gridSize,d=o.gridOrigin,v=o.gridOffset,m=o.elevationRange,g=o.colorMaxMinBuffer,y=o.elevationMaxMinBuffer,_=[Jn(d[0]),Jn(d[1])],b=[Jn(v[0]),Jn(v[1])],x=this.getDomainUniforms(),A=Fo(this.props.colorRange);this.bindUniformBuffers(g,y),this.state.model.setUniforms(a).setUniforms(x).setUniforms({cellSize:s,offset:u,extruded:l,elevationScale:f,coverage:c,gridSize:p,gridOrigin:d,gridOriginLow:_,gridOffset:v,gridOffsetLow:b,colorRange:A,elevationRange:m}).draw(),this.unbindUniformBuffers(g,y)}},{key:"bindUniformBuffers",value:function(i,a){i.bind({target:35345,index:h2}),a.bind({target:35345,index:d2})}},{key:"unbindUniformBuffers",value:function(i,a){i.unbind({target:35345,index:h2}),a.unbind({target:35345,index:d2})}},{key:"getDomainUniforms",value:function(){var i=this.props,a=i.colorDomain,o=i.elevationDomain,s={};return a!==null?(s.colorDomainValid=!0,s.colorDomain=a):s.colorDomainValid=!1,o!==null?(s.elevationDomainValid=!0,s.elevationDomain=o):s.elevationDomainValid=!1,s}},{key:"_setupUniformBuffer",value:function(i){var a=this.context.gl,o=i.program.handle,s=a.getUniformBlockIndex(o,"ColorData"),u=a.getUniformBlockIndex(o,"ElevationData");a.uniformBlockBinding(o,s,h2),a.uniformBlockBinding(o,u,d2)}}]),e}(Ve);(0,K_.default)(J_,"layerName","GPUGridCellLayer");(0,K_.default)(J_,"defaultProps",sBe);function Hse(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Wse(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Hse(Object(e),!0).forEach(function(n){(0,vu.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Hse(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function uBe(t){var r=lBe();return function(){var n=(0,Hf.default)(t),i;if(r){var a=(0,Hf.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Kse.default)(this,i)}}function lBe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fBe={colorDomain:null,colorRange:Ln,getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:1,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(r){return r.position}},extruded:!1,material:!0},cBe={data:{props:["cellSize","colorAggregation","elevationAggregation"]}},$se="positions",mu=function(t){(0,Yse.default)(e,t);var r=uBe(e);function e(){return(0,Xse.default)(this,e),r.apply(this,arguments)}return(0,qse.default)(e,[{key:"initializeState",value:function(i){var a,o=i.gl,s=Or.isSupported(o);s||Z.error("GPUGridLayer is not supported on this browser, use GridLayer instead")(),(0,Z_.default)((0,Hf.default)(e.prototype),"initializeAggregationLayer",this).call(this,{dimensions:cBe}),this.setState({gpuAggregation:!0,projectPoints:!1,isSupported:s,weights:{color:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:new be(o,{byteLength:4*4,accessor:{size:4,type:5126,divisor:1}})},elevation:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:new be(o,{byteLength:4*4,accessor:{size:4,type:5126,divisor:1}})}},positionAttributeName:"positions"});var u=this.getAttributeManager();u.add((a={},(0,vu.default)(a,$se,{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()}),(0,vu.default)(a,"color",{size:3,accessor:"getColorWeight"}),(0,vu.default)(a,"elevation",{size:3,accessor:"getElevationWeight"}),a))}},{key:"updateState",value:function(i){if(this.state.isSupported!==!1){(0,Z_.default)((0,Hf.default)(e.prototype),"updateState",this).call(this,i);var a=this.state.aggregationDirty;a&&this.setState({gridHash:null})}}},{key:"getHashKeyForIndex",value:function(i){var a=this.state,o=a.numRow,s=a.numCol,u=a.boundingBox,l=a.gridOffset,f=[s,o],c=[u.xMin,u.yMin],p=[l.xOffset,l.yOffset],d=Math.floor(i/f[0]),v=i-d*f[0],m=Math.floor((d*p[1]+c[1]+90+p[1]/2)/p[1]),g=Math.floor((v*p[0]+c[0]+180+p[0]/2)/p[0]);return"".concat(m,"-").concat(g)}},{key:"getPositionForIndex",value:function(i){var a=this.state,o=a.numRow,s=a.numCol,u=a.boundingBox,l=a.gridOffset,f=[s,o],c=[u.xMin,u.yMin],p=[l.xOffset,l.yOffset],d=Math.floor(i/f[0]),v=i-d*f[0],m=d*p[1]+c[1],g=v*p[0]+c[0];return[g,m]}},{key:"getPickingInfo",value:function(i){var a=i.info,o=i.mode,s=a.index,u=null;if(s>=0){var l=this.state.gpuGridAggregator,f=this.getPositionForIndex(s),c=Or.getAggregationData(Wse({pixelIndex:s},l.getData("color"))),p=Or.getAggregationData(Wse({pixelIndex:s},l.getData("elevation")));if(u={colorValue:c.cellWeight,elevationValue:p.cellWeight,count:c.cellCount||p.cellCount,position:f,totalCount:c.totalCount||p.totalCount},o!=="hover"){var d=this.props,v=this.state.gridHash;if(!v){var m=this.state,g=m.gridOffset,y=m.translation,_=m.boundingBox,b=this.context.viewport,x=this.getAttributes(),A=Cf(d,{gridOffset:g,attributes:x,viewport:b,translation:y,boundingBox:_});v=A.gridHash,this.setState({gridHash:v})}var T=this.getHashKeyForIndex(s),O=v[T];Object.assign(u,O)}}return a.picked=Boolean(u),a.object=u,a}},{key:"renderLayers",value:function(){if(!this.state.isSupported)return null;var i=this.props,a=i.elevationScale,o=i.extruded,s=i.cellSize,u=i.coverage,l=i.material,f=i.elevationRange,c=i.colorDomain,p=i.elevationDomain,d=this.state,v=d.weights,m=d.numRow,g=d.numCol,y=d.gridOrigin,_=d.gridOffset,b=v.color,x=v.elevation,A=Fo(this.props.colorRange),T=this.getSubLayerClass("gpu-grid-cell",J_);return new T({gridSize:[g,m],gridOrigin:y,gridOffset:[_.xOffset,_.yOffset],colorRange:A,elevationRange:f,colorDomain:c,elevationDomain:p,cellSize:s,coverage:u,material:l,elevationScale:a,extruded:o},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:{attributes:{colors:b.aggregationBuffer,elevations:x.aggregationBuffer}},colorMaxMinBuffer:b.maxMinBuffer,elevationMaxMinBuffer:x.maxMinBuffer,numInstances:g*m})}},{key:"finalizeState",value:function(i){var a=this.state.weights,o=a.color,s=a.elevation;[o,s].forEach(function(u){var l=u.aggregationBuffer,f=u.maxMinBuffer;f.delete(),l?.delete()}),(0,Z_.default)((0,Hf.default)(e.prototype),"finalizeState",this).call(this,i)}},{key:"updateAggregationState",value:function(i){var a=i.props,o=i.oldProps,s=a.cellSize,u=a.coordinateSystem,l=this.context.viewport,f=o.cellSize!==s,c=this.state.dimensions,p=this.isAttributeChanged($se),d=p||this.isAttributeChanged(),v=this.state.boundingBox;if(p&&(v=F_(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:v})),p||f){var m=D_(v,s,l,u),g=m.gridOffset,y=m.translation,_=m.width,b=m.height,x=m.numCol,A=m.numRow;this.allocateResources(A,x),this.setState({gridOffset:g,translation:y,gridOrigin:[-1*y[0],-1*y[1]],width:_,height:b,numCol:x,numRow:A})}var T=d||this.isAggregationDirty(i,{dimension:c.data,compareAll:!0});T&&this._updateAccessors(i),this.setState({aggregationDataDirty:T})}},{key:"_updateAccessors",value:function(i){var a=i.props,o=a.colorAggregation,s=a.elevationAggregation,u=this.state.weights,l=u.color,f=u.elevation;l.operation=vt[o],f.operation=vt[s]}}]),e}(cu);(0,vu.default)(mu,"layerName","GPUGridLayer");(0,vu.default)(mu,"defaultProps",fBe);function pBe(t){var r=hBe();return function(){var n=(0,m2.default)(t),i;if(r){var a=(0,m2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rue.default)(this,i)}}function hBe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Jse(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function v2(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Jse(Object(e),!0).forEach(function(n){(0,dd.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Jse(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var dBe=v2(v2(v2({},mu.defaultProps),hu.defaultProps),{},{gpuAggregation:!1}),Q_=function(t){(0,tue.default)(e,t);var r=pBe(e);function e(){var n;(0,Zse.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,dd.default)((0,eue.default)(n),"state",void 0),n}return(0,Qse.default)(e,[{key:"initializeState",value:function(){this.state={useGPUAggregation:!0}}},{key:"updateState",value:function(i){var a=i.props;this.setState({useGPUAggregation:this.canUseGPUAggregation(a)})}},{key:"renderLayers",value:function(){var i=this.props,a=i.data,o=i.updateTriggers,s=this.state.useGPUAggregation?"GPU":"CPU",u=this.state.useGPUAggregation?this.getSubLayerClass("GPU",mu):this.getSubLayerClass("CPU",hu);return new u(this.props,this.getSubLayerProps({id:s,updateTriggers:o}),{data:a})}},{key:"canUseGPUAggregation",value:function(i){var a=i.gpuAggregation,o=i.lowerPercentile,s=i.upperPercentile,u=i.getColorValue,l=i.getElevationValue,f=i.colorScaleType;return!(!a||!Or.isSupported(this.context.gl)||o!==0||s!==100||u!==null||l!==null||f==="quantile"||f==="ordinal")}}]),e}(St);(0,dd.default)(Q_,"layerName","GridLayer");(0,dd.default)(Q_,"defaultProps",dBe);var T2=h(ye()),Tue=h(L()),Sue=h(N()),Pue=h(_e()),vd=h(Oe()),wue=h(Y()),Oue=h(K()),gu=h(q()),pi=h(B());var g2=h(ye());function vBe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=mBe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function mBe(t,r){if(t){if(typeof t=="string")return nue(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return nue(t,r)}}function nue(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function aue(t){var r=t.map(function(s){return s[0]}),e=t.map(function(s){return s[1]}),n=Math.min.apply(null,r),i=Math.max.apply(null,r),a=Math.min.apply(null,e),o=Math.max.apply(null,e);return[n,a,i,o]}function oue(t,r){return r[0]>=t[0]&&r[2]<=t[2]&&r[1]>=t[1]&&r[3]<=t[3]}var iue=new Float32Array(12);function y2(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,e=0,n=vBe(t),i;try{for(n.s();!(i=n.n()).done;)for(var a=i.value,o=0;o<r;o++)iue[e++]=a[o]||0}catch(s){n.e(s)}finally{n.f()}return iue}function sue(t,r,e){var n=(0,g2.default)(t,4),i=n[0],a=n[1],o=n[2],s=n[3],u=o-i,l=s-a,f=u,c=l;u/l<r/e?f=r/e*l:c=e/r*u,f<r&&(f=r,c=e);var p=(o+i)/2,d=(s+a)/2;return[p-f/2,d-c/2,p+f/2,d+c/2]}function uue(t,r){var e=(0,g2.default)(r,4),n=e[0],i=e[1],a=e[2],o=e[3];return[(t[0]-n)/(a-n),(t[1]-i)/(o-i)]}function lue(t){var r=t.gl,e=t.floatTargetSupport;return e?{format:fe(r)?34836:6408,type:5126}:{format:6408,type:5121}}var hue=h(L()),due=h(N()),vue=h(Y()),mue=h(K()),_2=h(q()),b2=h(B());var fue=`#define SHADER_NAME heatp-map-layer-vertex-shader

uniform sampler2D maxTexture;
uniform float intensity;
uniform vec2 colorDomain;
uniform float threshold;
uniform float aggregationMode;

attribute vec3 positions;
attribute vec2 texCoords;

varying vec2 vTexCoords;
varying float vIntensityMin;
varying float vIntensityMax;

void main(void) {
  gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
  vTexCoords = texCoords;
  vec4 maxTexture = texture2D(maxTexture, vec2(0.5));
  float maxValue = aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
  float minValue = maxValue * threshold;
  if (colorDomain[1] > 0.) {
    maxValue = colorDomain[1];
    minValue = colorDomain[0];
  }
  vIntensityMax = intensity / maxValue;
  vIntensityMin = intensity / minValue;
}
`;var cue=`#define SHADER_NAME triangle-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D texture;
uniform sampler2D colorTexture;
uniform float aggregationMode;

varying vec2 vTexCoords;
varying float vIntensityMin;
varying float vIntensityMax;

vec4 getLinearColor(float value) {
  float factor = clamp(value * vIntensityMax, 0., 1.);
  vec4 color = texture2D(colorTexture, vec2(factor, 0.5));
  color.a *= min(value * vIntensityMin, 1.0);
  return color;
}

void main(void) {
  vec4 weights = texture2D(texture, vTexCoords);
  float weight = weights.r;

  if (aggregationMode > 0.5) {
    weight /= max(1.0, weights.a);
  }
  if (weight <= 0.) {
     discard;
  }

  vec4 linearColor = getLinearColor(weight);
  linearColor.a *= opacity;
  gl_FragColor =linearColor;
}
`;function pue(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function eb(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?pue(Object(e),!0).forEach(function(n){(0,b2.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):pue(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function gBe(t){var r=yBe();return function(){var n=(0,_2.default)(t),i;if(r){var a=(0,_2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,mue.default)(this,i)}}function yBe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var x2=function(t){(0,vue.default)(e,t);var r=gBe(e);function e(){return(0,hue.default)(this,e),r.apply(this,arguments)}return(0,due.default)(e,[{key:"getShaders",value:function(){return{vs:fue,fs:cue,modules:[Ze]}}},{key:"initializeState",value:function(i){var a=i.gl,o=this.getAttributeManager();o.add({positions:{size:3,noAlloc:!0},texCoords:{size:2,noAlloc:!0}}),this.setState({model:this._getModel(a)})}},{key:"_getModel",value:function(i){var a=this.props.vertexCount;return new Ee(i,eb(eb({},this.getShaders()),{},{id:this.props.id,geometry:new Ce({drawMode:6,vertexCount:a})}))}},{key:"draw",value:function(i){var a=i.uniforms,o=this.state.model,s=this.props,u=s.texture,l=s.maxTexture,f=s.colorTexture,c=s.intensity,p=s.threshold,d=s.aggregationMode,v=s.colorDomain;o.setUniforms(eb(eb({},a),{},{texture:u,maxTexture:l,colorTexture:f,intensity:c,threshold:p,aggregationMode:d,colorDomain:v})).draw()}}]),e}(Ve);(0,b2.default)(x2,"layerName","TriangleLayer");var gue=`attribute vec3 positions;
attribute vec3 positions64Low;
attribute float weights;
varying vec4 weightsTexture;
uniform float radiusPixels;
uniform float textureWidth;
uniform vec4 commonBounds;
uniform float weightsScale;
void main()
{
  weightsTexture = vec4(weights * weightsScale, 0., 0., 1.);

  float radiusTexels  = project_pixel_size(radiusPixels) * textureWidth / (commonBounds.z - commonBounds.x);
  gl_PointSize = radiusTexels * 2.;

  vec3 commonPosition = project_position(positions, positions64Low);
  gl_Position.xy = (commonPosition.xy - commonBounds.xy) / (commonBounds.zw - commonBounds.xy) ;
  gl_Position.xy = (gl_Position.xy * 2.) - (1.);
}
`;var yue=`varying vec4 weightsTexture;
float gaussianKDE(float u){
  return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
  float dist = length(gl_PointCoord - vec2(0.5, 0.5));
  if (dist > 0.5) {
    discard;
  }
  gl_FragColor = weightsTexture * gaussianKDE(2. * dist);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var _ue=`attribute vec4 inTexture;
varying vec4 outTexture;

void main()
{
outTexture = inTexture;
gl_Position = vec4(0, 0, 0, 1.);
gl_PointSize = 1.0;
}
`;var bue=`varying vec4 outTexture;
void main() {
  gl_FragColor = outTexture;
  gl_FragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`;var Wf;function xue(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function $f(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?xue(Object(e),!0).forEach(function(n){(0,pi.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):xue(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function _Be(t){var r=bBe();return function(){var n=(0,gu.default)(t),i;if(r){var a=(0,gu.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Oue.default)(this,i)}}function bBe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xBe=2,A2={mipmaps:!1,parameters:(Wf={},(0,pi.default)(Wf,10240,9729),(0,pi.default)(Wf,10241,9729),(0,pi.default)(Wf,10242,33071),(0,pi.default)(Wf,10243,33071),Wf),dataFormat:6408},Aue=[0,0],ABe={SUM:0,MEAN:1},TBe={getPosition:{type:"accessor",value:function(r){return r.position}},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Ln,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},SBe=[Ae.BLEND_EQUATION_MINMAX,Ae.TEXTURE_FLOAT],PBe=[Ae.COLOR_ATTACHMENT_RGBA32F,Ae.FLOAT_BLEND],wBe={data:{props:["radiusPixels"]}},tb=function(t){(0,wue.default)(e,t);var r=_Be(e);function e(){var n;(0,Tue.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,pi.default)((0,Pue.default)(n),"state",void 0),n}return(0,Sue.default)(e,[{key:"initializeState",value:function(){var i=this.context.gl;if(!lr(i,SBe)){this.setState({supported:!1}),Z.error("HeatmapLayer: ".concat(this.id," is not supported on this browser"))();return}(0,vd.default)((0,gu.default)(e.prototype),"initializeAggregationLayer",this).call(this,wBe),this.setState({supported:!0,colorDomain:Aue}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}},{key:"shouldUpdateState",value:function(i){var a=i.changeFlags;return a.somethingChanged}},{key:"updateState",value:function(i){this.state.supported&&((0,vd.default)((0,gu.default)(e.prototype),"updateState",this).call(this,i),this._updateHeatmapState(i))}},{key:"_updateHeatmapState",value:function(i){var a=i.props,o=i.oldProps,s=this._getChangeFlags(i);(s.dataChanged||s.viewportChanged)&&(s.boundsChanged=this._updateBounds(s.dataChanged),this._updateTextureRenderingBounds()),s.dataChanged||s.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):s.viewportZoomChanged&&this._debouncedUpdateWeightmap(),a.colorRange!==o.colorRange&&this._updateColorTexture(i),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:i.context.viewport.zoom})}},{key:"renderLayers",value:function(){if(!this.state.supported)return[];var i=this.state,a=i.weightsTexture,o=i.triPositionBuffer,s=i.triTexCoordBuffer,u=i.maxWeightsTexture,l=i.colorTexture,f=i.colorDomain,c=this.props,p=c.updateTriggers,d=c.intensity,v=c.threshold,m=c.aggregation,g=this.getSubLayerClass("triangle",x2);return new g(this.getSubLayerProps({id:"triangle-layer",updateTriggers:p}),{coordinateSystem:se.DEFAULT,data:{attributes:{positions:o,texCoords:s}},vertexCount:4,maxTexture:u,colorTexture:l,aggregationMode:ABe[m]||0,texture:a,intensity:d,threshold:v,colorDomain:f})}},{key:"finalizeState",value:function(i){(0,vd.default)((0,gu.default)(e.prototype),"finalizeState",this).call(this,i);var a=this.state,o=a.weightsTransform,s=a.weightsTexture,u=a.maxWeightTransform,l=a.maxWeightsTexture,f=a.triPositionBuffer,c=a.triTexCoordBuffer,p=a.colorTexture,d=a.updateTimer;o?.delete(),s?.delete(),u?.delete(),l?.delete(),f?.delete(),c?.delete(),p?.delete(),d&&clearTimeout(d)}},{key:"_getAttributeManager",value:function(){return new co(this.context.gl,{id:this.props.id,stats:this.context.stats})}},{key:"_getChangeFlags",value:function(i){var a={},o=this.state.dimensions;a.dataChanged=this.isAttributeChanged()||this.isAggregationDirty(i,{compareAll:!0,dimension:o.data}),a.viewportChanged=i.changeFlags.viewportChanged;var s=this.state.zoom;return(!i.context.viewport||i.context.viewport.zoom!==s)&&(a.viewportZoomChanged=!0),a}},{key:"_createTextures",value:function(){var i=this.context.gl,a=this.state,o=a.textureSize,s=a.format,u=a.type;this.setState({weightsTexture:new Se(i,$f({width:o,height:o,format:s,type:u},A2)),maxWeightsTexture:new Se(i,$f({format:s,type:u},A2))})}},{key:"_setupAttributes",value:function(){var i=this.getAttributeManager();i.add({positions:{size:3,type:5130,accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}},{key:"_setupTextureParams",value:function(){var i=this.context.gl,a=this.props.weightsTextureSize,o=Math.min(a,bi(i,3379)),s=lr(i,PBe),u=lue({gl:i,floatTargetSupport:s}),l=u.format,f=u.type,c=s?1:1/255;this.setState({textureSize:o,format:l,type:f,weightsScale:c}),s||Z.warn("HeatmapLayer: ".concat(this.id," rendering to float texture not supported, fallingback to low precession format"))()}},{key:"getShaders",value:function(i){return(0,vd.default)((0,gu.default)(e.prototype),"getShaders",this).call(this,i==="max-weights-transform"?{vs:_ue,_fs:bue}:{vs:gue,_fs:yue})}},{key:"_createWeightsTransform",value:function(){var i,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=this.context.gl,s=this.state.weightsTransform,u=this.state.weightsTexture;(i=s)===null||i===void 0||i.delete(),s=new kr(o,$f({id:"".concat(this.id,"-weights-transform"),elementCount:1,_targetTexture:u,_targetTextureVarying:"weightsTexture"},a)),this.setState({weightsTransform:s})}},{key:"_setupResources",value:function(){var i=this.context.gl;this._createTextures();var a=this.state,o=a.textureSize,s=a.weightsTexture,u=a.maxWeightsTexture,l=this.getShaders("weights-transform");this._createWeightsTransform(l);var f=this.getShaders("max-weights-transform"),c=new kr(i,$f($f({id:"".concat(this.id,"-max-weights-transform"),_sourceTextures:{inTexture:s},_targetTexture:u,_targetTextureVarying:"outTexture"},f),{},{elementCount:o*o}));this.setState({weightsTexture:s,maxWeightsTexture:u,maxWeightTransform:c,zoom:null,triPositionBuffer:new be(i,{byteLength:48,accessor:{size:3}}),triTexCoordBuffer:new be(i,{byteLength:48,accessor:{size:2}})})}},{key:"updateShaders",value:function(i){this._createWeightsTransform(i)}},{key:"_updateMaxWeightValue",value:function(){var i=this.state.maxWeightTransform;i.run({parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32776}})}},{key:"_updateBounds",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=this.context.viewport,o=[a.unproject([0,0]),a.unproject([a.width,0]),a.unproject([a.width,a.height]),a.unproject([0,a.height])].map(function(d){return d.map(Math.fround)}),s=aue(o),u={visibleWorldBounds:s,viewportCorners:o},l=!1;if(i||!this.state.worldBounds||!oue(this.state.worldBounds,s)){var f=this._worldToCommonBounds(s),c=this._commonToWorldBounds(f);this.props.coordinateSystem===se.LNGLAT&&(c[1]=Math.max(c[1],-85.051129),c[3]=Math.min(c[3],85.051129),c[0]=Math.max(c[0],-360),c[2]=Math.min(c[2],360));var p=this._worldToCommonBounds(c);u.worldBounds=c,u.normalizedCommonBounds=p,l=!0}return this.setState(u),l}},{key:"_updateTextureRenderingBounds",value:function(){var i=this.state,a=i.triPositionBuffer,o=i.triTexCoordBuffer,s=i.normalizedCommonBounds,u=i.viewportCorners,l=this.context.viewport;a.subData(y2(u,3));var f=u.map(function(c){return uue(l.projectPosition(c),s)});o.subData(y2(f,2))}},{key:"_updateColorTexture",value:function(i){var a=i.props.colorRange,o=this.state.colorTexture,s=Fo(a,!1,Uint8Array);o?o.setImageData({data:s,width:a.length}):o=new Se(this.context.gl,$f({data:s,width:a.length,height:1},A2)),this.setState({colorTexture:o})}},{key:"_updateWeightmap",value:function(){var i=this,a,o=this.props,s=o.radiusPixels,u=o.colorDomain,l=o.aggregation,f=this.state,c=f.weightsTransform,p=f.worldBounds,d=f.textureSize,v=f.weightsTexture,m=f.weightsScale;this.state.isWeightMapDirty=!1;var g=this._worldToCommonBounds(p,{useLayerCoordinateSystem:!0});if(u&&l==="SUM"){var y=this.context.viewport,_=y.distanceScales.metersPerUnit[2]*(g[2]-g[0])/d;this.state.colorDomain=u.map(function(x){return x*_*m})}else this.state.colorDomain=u||Aue;var b={radiusPixels:s,commonBounds:g,textureWidth:d,weightsScale:m};c.update({elementCount:this.getNumInstances()}),Ie(this.context.gl,{clearColor:[0,0,0,0]},function(){c.run({uniforms:b,parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32774},clearRenderTarget:!0,attributes:i.getAttributes(),moduleSettings:i.getModuleSettings()})}),this._updateMaxWeightValue(),v.setParameters((a={},(0,pi.default)(a,10240,9729),(0,pi.default)(a,10241,9729),a))}},{key:"_debouncedUpdateWeightmap",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=this.state.updateTimer,o=this.props.debounceTimeout;i?(a=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(a),a=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),o)),this.setState({updateTimer:a})}},{key:"_worldToCommonBounds",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a.useLayerCoordinateSystem,s=o===void 0?!1:o,u=(0,T2.default)(i,4),l=u[0],f=u[1],c=u[2],p=u[3],d=this.context.viewport,v=this.state.textureSize,m=this.props.coordinateSystem,g=s&&(m===se.LNGLAT_OFFSETS||m===se.METER_OFFSETS),y=g?d.projectPosition(this.props.coordinateOrigin):[0,0],_=v*xBe/d.scale,b,x;return s&&!g?(b=this.projectPosition([l,f,0]),x=this.projectPosition([c,p,0])):(b=d.projectPosition([l,f,0]),x=d.projectPosition([c,p,0])),sue([b[0]-y[0],b[1]-y[1],x[0]-y[0],x[1]-y[1]],_,_)}},{key:"_commonToWorldBounds",value:function(i){var a=(0,T2.default)(i,4),o=a[0],s=a[1],u=a[2],l=a[3],f=this.context.viewport,c=f.unprojectPosition([o,s]),p=f.unprojectPosition([u,l]);return c.slice(0,2).concat(p.slice(0,2))}}]),e}(fi);(0,pi.default)(tb,"layerName","HeatmapLayer");(0,pi.default)(tb,"defaultProps",TBe);var Bue=h(ny()),Fue=h(L()),Due=h(N()),Xf=h(B());var Mue=h(B());function Eue(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Cue(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Eue(Object(e),!0).forEach(function(n){(0,Mue.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Eue(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var S2=85.05113;function w2(t,r,e,n){if(e){if(e.userData._googleMap===t)return e;rb(e)}var i={click:null,rightclick:null,dblclick:null,mousemove:null,mouseout:null},a=new un(Cue(Cue({},n),{},{useDevicePixels:n.interleaved?!0:n.useDevicePixels,style:n.interleaved?null:{pointerEvents:"none"},parent:OBe(r,n.style),initialViewState:{longitude:0,latitude:0,zoom:1},controller:!1})),o=function(l){i[l]=t.addListener(l,function(f){return CBe(a,l,f)})};for(var s in i)o(s);return a.userData._googleMap=t,a.userData._eventListeners=i,a}function OBe(t,r){var e=document.createElement("div");if(e.style.position="absolute",Object.assign(e.style,r),"getPanes"in t){var n;(n=t.getPanes())===null||n===void 0||n.overlayLayer.appendChild(e)}else{var i;(i=t.getMap())===null||i===void 0||i.getDiv().appendChild(e)}return e}function rb(t){var r=t.userData._eventListeners;for(var e in r)r[e]&&r[e].remove();t.finalize()}function Iue(t,r){var e=Rue(t),n=e.width,i=e.height,a=r.getProjection(),o=t.getBounds();if(!o)return{width:n,height:i,left:0,top:0};var s=o.getNorthEast(),u=o.getSouthWest(),l=a.fromLatLngToDivPixel(s),f=a.fromLatLngToDivPixel(u),c=P2(a,n/2,i/2),p=new google.maps.LatLng(0,c[0]),d=a.fromLatLngToContainerPixel(p),v=a.fromLatLngToDivPixel(p);if(!l||!f||!v||!d)return{width:n,height:i,left:0,top:0};var m=Math.round(v.x-d.x),g=v.y-d.y,y=P2(a,n/2,0),_=P2(a,n/2,i),b=c[1],x=c[0];if(Math.abs(b)>S2){b=b>0?S2:-S2;var A=new google.maps.LatLng(b,x),T=a.fromLatLngToContainerPixel(A);g+=T.y-i/2}g=Math.round(g);var O=new Xn(y).sub(_),w=180*O.verticalAngle()/Math.PI;w<0&&(w+=360);var E=t.getHeading()||0,S=t.getZoom()-1,I;if(w===0)I=i?(f.y-l.y)/i:1;else if(w===E){var R=new Xn([l.x,l.y]).sub([f.x,f.y]).len(),z=new Xn([n,-i]).len();I=z?R/z:1}return S+=Math.log2(I||1),{width:n,height:i,left:m,top:g,zoom:S,bearing:w,pitch:t.getTilt(),latitude:b,longitude:x}}function O2(t,r){var e=Rue(t),n=e.width,i=e.height,a=r.getCameraParams(),o=a.center,s=a.heading,u=a.tilt,l=a.zoom,f=25,c=i?n/i:1,p=.75,d=3e14,v=new ce().perspective({fovy:f*Math.PI/180,aspect:c,near:p,far:d}),m=.5*v[5];return{width:n,height:i,viewState:{altitude:m,bearing:s,latitude:o.lat(),longitude:o.lng(),pitch:u,projectionMatrix:v,repeat:!0,zoom:l-1}}}function Rue(t){var r=t.getDiv().firstChild;return{width:r.offsetWidth,height:r.offsetHeight}}function P2(t,r,e){var n=new google.maps.Point(r,e),i=t.fromContainerPixelToLatLng(n);return[i.lng(),i.lat()]}function EBe(t,r){if(t.pixel)return t.pixel;var e=r.getViewports()[0].project([t.latLng.lng(),t.latLng.lat()]);return{x:e[0],y:e[1]}}function CBe(t,r,e){if(t.isInitialized){var n={type:r,offsetCenter:EBe(e,t),srcEvent:e};switch(r){case"click":case"rightclick":n.type="click",n.tapCount=1,t._onPointerDown(n),t._onEvent(n);break;case"dblclick":n.type="click",n.tapCount=2,t._onEvent(n);break;case"mousemove":n.type="pointermove",t._onPointerMove(n);break;case"mouseout":n.type="pointerleave",t._onPointerMove(n);break;default:return}}}var MBe=["width","height","left","top"];function Lue(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function yu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Lue(Object(e),!0).forEach(function(n){(0,Xf.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Lue(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var IBe=function(){return!1},RBe={depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],blendEquation:32774};function kue(){}var LBe={interleaved:!0},Nue=function(){function t(r){(0,Fue.default)(this,t),(0,Xf.default)(this,"props",{}),(0,Xf.default)(this,"_map",null),(0,Xf.default)(this,"_deck",null),(0,Xf.default)(this,"_overlay",null),this.setProps(yu(yu({},LBe),r))}return(0,Due.default)(t,[{key:"setMap",value:function(e){var n=this;if(e!==this._map){if(this._map){var i;(i=this._overlay)===null||i===void 0||i.setMap(null),this._map=null}if(e){this._map=e;var a=google.maps.RenderingType.UNINITIALIZED,o=e.getRenderingType();o!==a?this._createOverlay(e):e.addListener("renderingtype_changed",function(){n._createOverlay(e)})}}}},{key:"setProps",value:function(e){if(Object.assign(this.props,e),this._deck){if(e.style){var n=this._deck.canvas.parentElement.style;Object.assign(n,e.style),e.style=null}this._deck.setProps(e)}}},{key:"pickObject",value:function(e){return this._deck&&this._deck.pickObject(e)}},{key:"pickMultipleObjects",value:function(e){return this._deck&&this._deck.pickMultipleObjects(e)}},{key:"pickObjects",value:function(e){return this._deck&&this._deck.pickObjects(e)}},{key:"finalize",value:function(){this.setMap(null),this._deck&&(rb(this._deck),this._deck=null)}},{key:"_createOverlay",value:function(e){var n=this.props.interleaved,i=google.maps.RenderingType,a=i.VECTOR,o=i.UNINITIALIZED,s=e.getRenderingType();if(s!==o){var u=s===a&&google.maps.WebGLOverlayView,l=u?google.maps.WebGLOverlayView:google.maps.OverlayView,f=new l;f instanceof google.maps.WebGLOverlayView?(n?(f.onAdd=kue,f.onContextRestored=this._onContextRestored.bind(this),f.onDraw=this._onDrawVectorInterleaved.bind(this)):(f.onAdd=this._onAdd.bind(this),f.onContextRestored=kue,f.onDraw=this._onDrawVectorOverlay.bind(this)),f.onContextLost=this._onContextLost.bind(this)):(f.onAdd=this._onAdd.bind(this),f.draw=this._onDrawRaster.bind(this)),f.onRemove=this._onRemove.bind(this),this._overlay=f,this._overlay.setMap(e)}}},{key:"_onAdd",value:function(){this._deck=w2(this._map,this._overlay,this._deck,this.props)}},{key:"_onContextRestored",value:function(e){var n=this,i=e.gl;if(!(!this._map||!this._overlay)){var a=function(){n._overlay&&n._overlay.requestRedraw()},o=w2(this._map,this._overlay,this._deck,yu({gl:i,_customRender:a},this.props));this._deck=o;var s=o.animationLoop;s._renderFrame=function(){var u=i.getParameter(34964);Ie(i,{},function(){s.onRender()}),i.bindBuffer(34962,u)}}}},{key:"_onContextLost",value:function(){this._deck&&(rb(this._deck),this._deck=null)}},{key:"_onRemove",value:function(){var e;(e=this._deck)===null||e===void 0||e.setProps({layerFilter:IBe})}},{key:"_onDrawRaster",value:function(){if(!(!this._deck||!this._map)){var e=this._deck,n=Iue(this._map,this._overlay),i=n.width,a=n.height,o=n.left,s=n.top,u=(0,Bue.default)(n,MBe),l=e.canvas.parentElement.style;l.left="".concat(o,"px"),l.top="".concat(s,"px");var f=1e4;e.setProps({width:i,height:a,viewState:yu({altitude:f,repeat:!0},u)}),e.redraw()}}},{key:"_onDrawVectorInterleaved",value:function(e){var n=e.gl,i=e.transformer;if(!(!this._deck||!this._map)){var a=this._deck;if(a.setProps(yu(yu({},O2(this._map,i)),{},{width:null,height:null})),a.isInitialized){var o=bi(n,36006);a.setProps({_framebuffer:o}),a.needsRedraw({clearRedrawFlags:!0}),Gt(n,{viewport:[0,0,n.canvas.width,n.canvas.height],scissor:[0,0,n.canvas.width,n.canvas.height],stencilFunc:[519,0,255,519,0,255]}),Ie(n,RBe,function(){a._drawLayers("google-vector",{clearCanvas:!1})})}}}},{key:"_onDrawVectorOverlay",value:function(e){var n=e.transformer;if(!(!this._deck||!this._map)){var i=this._deck;i.setProps(yu({},O2(this._map,n))),i.redraw()}}}]),t}();var Xue=h(L()),que=h(N()),bu=h(B());var Gue=h(B());function jue(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function _u(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?jue(Object(e),!0).forEach(function(n){(0,Gue.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):jue(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var E2=512,kBe=Math.PI/180;function nb(t){var r=t.map,e=t.gl,n=t.deck;if(r.__deck)return r.__deck;var i=n?.props._customRender,a=n?.props.onLoad,o=C2(_u(_u({},n?.props),{},{_customRender:function(){r.triggerRepaint(),i?.("")}})),s;return(!n||n.props.gl===e)&&(Object.assign(o,{gl:e,width:null,height:null,touchAction:"unset",viewState:qf(r)}),n!=null&&n.isInitialized?Uue(n,r):o.onLoad=function(){a?.(),Uue(s,r)}),n?(s=n,n.setProps(o),n.userData.isExternal=!0):(s=new un(o),r.on("remove",function(){s.finalize(),r.__deck=null})),s.userData.mapboxLayers=new Set,r.__deck=s,r.on("render",function(){s.isInitialized&&FBe(s,r)}),s}function Uue(t,r){var e=function n(){t.isInitialized?DBe(t,r):r.off("move",n)};r.on("move",e)}function C2(t){var r="useDevicePixels"in t?t.useDevicePixels:!0,e=_u(_u({},t),{},{useDevicePixels:r,parameters:_u({depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774},t.parameters),views:t.views||[new As({id:"mapbox"})]});return e}function zue(t,r){t.userData.mapboxLayers.add(r),M2(t)}function Vue(t,r){t.userData.mapboxLayers.delete(r),M2(t)}function Hue(t,r){M2(t)}function Wue(t,r,e){var n=t.userData,i=n.currentViewport,a=!1;i||(i=$ue(t,r,!0),t.userData.currentViewport=i,a=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:function(s){var u=s.layer;return e.id===u.id},clearStack:a,clearCanvas:!1})}function qf(t){var r,e=t.getCenter(),n=e.lng,i=e.lat,a={longitude:(n+540)%360-180,latitude:i,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return(r=t.getTerrain)!==null&&r!==void 0&&r.call(t)&&BBe(t,a),a}function BBe(t,r){if(t.getFreeCameraOptions){var e=t.getFreeCameraOptions(),n=e.position;if(!n||n.z===void 0)return;var i=t.transform.height,a=r.longitude,o=r.latitude,s=r.pitch,u=n.x*E2,l=(1-n.y)*E2,f=n.z*E2,c=At([a,o]),p=u-c[0],d=l-c[1],v=Math.sqrt(p*p+d*d),m=s*kBe,g=1.5*i,y=m<.001?g*Math.cos(m)/f:g*Math.sin(m)/v;r.zoom=Math.log2(y);var _=g*Math.cos(m)/y,b=f-_;r.position=[0,0,b/hs(o)]}else typeof t.transform.elevation=="number"&&(r.position=[0,0,t.transform.elevation])}function $ue(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new $r(_u(_u({id:"mapbox",x:0,y:0,width:t.width,height:t.height},qf(r)),{},{nearZMultiplier:e?.02:.1}))}function FBe(t,r){var e=t.userData,n=e.mapboxLayers,i=e.isExternal;if(i){var a=Array.from(n,function(c){return c.id}),o=Br(t.props.layers,Boolean),s=o.some(function(c){return c&&!a.includes(c.id)}),u=t.getViewports(),l=u.findIndex(function(c){return c.id==="mapbox"}),f=u.length>1||l<0;(s||f)&&(l>=0&&(u=u.slice(),u[l]=$ue(t,r,!1)),t._drawLayers("mapbox-repaint",{viewports:u,layerFilter:function(p){return(!t.props.layerFilter||t.props.layerFilter(p))&&(p.viewport.id!=="mapbox"||!a.includes(p.layer.id))},clearCanvas:!1}))}t.userData.currentViewport=null}function DBe(t,r){t.setProps({viewState:qf(r)}),t.needsRedraw({clearRedrawFlags:!0})}function M2(t){if(!t.userData.isExternal){var r=[];t.userData.mapboxLayers.forEach(function(e){var n=e.props.type,i=new n(e.props);r.push(i)}),t.setProps({layers:r})}}var ib=function(){function t(r){if((0,Xue.default)(this,t),(0,bu.default)(this,"id",void 0),(0,bu.default)(this,"type",void 0),(0,bu.default)(this,"renderingMode",void 0),(0,bu.default)(this,"map",void 0),(0,bu.default)(this,"deck",void 0),(0,bu.default)(this,"props",void 0),!r.id)throw new Error("Layer must have an unique id");this.id=r.id,this.type="custom",this.renderingMode=r.renderingMode||"3d",this.map=null,this.deck=null,this.props=r}return(0,que.default)(t,[{key:"onAdd",value:function(e,n){this.map=e,this.deck=nb({map:e,gl:n,deck:this.props.deck}),zue(this.deck,this)}},{key:"onRemove",value:function(){this.deck&&Vue(this.deck,this)}},{key:"setProps",value:function(e){Object.assign(this.props,e,{id:this.id}),this.deck&&Hue(this.deck,this)}},{key:"render",value:function(){Wue(this.deck,this.map,this)}}]),t}();var Jue=h(ny()),Zue=h(L()),Que=h(N()),kn=h(B());function ab(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=NBe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function NBe(t,r){if(t){if(typeof t=="string")return Yue(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Yue(t,r)}}function Yue(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var I2="__UNDEFINED__";function md(t,r,e,n){if(!(!t||!r||!t.style||!t.style._loaded)){var i=Br(n,Boolean);if(e!==n){var a=Br(e,Boolean),o=new Set(a.map(function(G){return G.id})),s=ab(i),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;o.delete(l.id)}}catch(G){s.e(G)}finally{s.f()}var f=ab(o),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;t.getLayer(p)&&t.removeLayer(p)}}catch(G){f.e(G)}finally{f.f()}}var d=ab(i),v;try{for(d.s();!(v=d.n()).done;){var m=v.value,g=t.getLayer(m.id);g?g.implementation.setProps(m.props):t.addLayer(new ib({id:m.id,deck:r}),m.props.beforeId)}}catch(G){d.e(G)}finally{d.f()}var y=t.style._order,_={},b=ab(i),x;try{for(b.s();!(x=b.n()).done;){var A=x.value,T=A.props.beforeId;(!T||!y.includes(T))&&(T=I2),_[T]=_[T]||[],_[T].push(A.id)}}catch(G){b.e(G)}finally{b.f()}for(var O in _)for(var w=_[O],E=O===I2?y.length:y.indexOf(O),S=O===I2?void 0:O,I=w.length-1;I>=0;I--){var R=w[I],z=y.indexOf(R);z!==E-1&&(t.moveLayer(R,S),z>E&&E++),E--,S=R}}}var jBe=["interleaved"];function Kue(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Yf(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Kue(Object(e),!0).forEach(function(n){(0,kn.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Kue(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var ele=function(){function t(r){var e=this;(0,Zue.default)(this,t),(0,kn.default)(this,"_props",void 0),(0,kn.default)(this,"_deck",void 0),(0,kn.default)(this,"_map",void 0),(0,kn.default)(this,"_container",void 0),(0,kn.default)(this,"_interleaved",void 0),(0,kn.default)(this,"_lastMouseDownPoint",void 0),(0,kn.default)(this,"_handleStyleChange",function(){md(e._map,e._deck,e._props.layers,e._props.layers)}),(0,kn.default)(this,"_updateContainerSize",function(){if(e._map&&e._container){var o=e._map.getContainer(),s=o.clientWidth,u=o.clientHeight;Object.assign(e._container.style,{width:"".concat(s,"px"),height:"".concat(u,"px")})}}),(0,kn.default)(this,"_updateViewState",function(){var o=e._deck;o&&(o.setProps({viewState:qf(e._map)}),o.isInitialized&&o.redraw())}),(0,kn.default)(this,"_handleMouseEvent",function(o){var s=e._deck;if(!(!s||!s.isInitialized)){var u={type:o.type,offsetCenter:o.point,srcEvent:o},l=e._lastMouseDownPoint;switch(!o.point&&l&&(u.deltaX=o.originalEvent.clientX-l.clientX,u.deltaY=o.originalEvent.clientY-l.clientY,u.offsetCenter={x:l.x+u.deltaX,y:l.y+u.deltaY}),u.type){case"mousedown":s._onPointerDown(u),e._lastMouseDownPoint=Yf(Yf({},o.point),{},{clientX:o.originalEvent.clientX,clientY:o.originalEvent.clientY});break;case"dragstart":u.type="panstart",s._onEvent(u);break;case"drag":u.type="panmove",s._onEvent(u);break;case"dragend":u.type="panend",s._onEvent(u);break;case"click":u.tapCount=1,s._onEvent(u);break;case"dblclick":u.type="click",u.tapCount=2,s._onEvent(u);break;case"mousemove":u.type="pointermove",s._onPointerMove(u);break;case"mouseout":u.type="pointerleave",s._onPointerMove(u);break;default:return}}});var n=r.interleaved,i=n===void 0?!1:n,a=(0,Jue.default)(r,jBe);this._interleaved=i,this._props=a}return(0,Que.default)(t,[{key:"setProps",value:function(e){this._interleaved&&e.layers&&md(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?C2(this._props):this._props)}},{key:"onAdd",value:function(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}},{key:"_onAddOverlaid",value:function(e){var n=document.createElement("div");return Object.assign(n.style,{position:"absolute",left:0,top:0,pointerEvents:"none"}),this._container=n,this._deck=new un(Yf(Yf({},this._props),{},{parent:n,viewState:qf(e)})),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),n}},{key:"_onAddInterleaved",value:function(e){return this._deck=nb({map:e,gl:e.painter.context.gl,deck:new un(Yf(Yf({},this._props),{},{gl:e.painter.context.gl}))}),e.on("styledata",this._handleStyleChange),md(e,this._deck,[],this._props.layers),document.createElement("div")}},{key:"onRemove",value:function(){var e,n=this._map;n&&(this._interleaved?this._onRemoveInterleaved(n):this._onRemoveOverlaid(n)),(e=this._deck)===null||e===void 0||e.finalize(),this._deck=void 0,this._map=void 0,this._container=void 0}},{key:"_onRemoveOverlaid",value:function(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent)}},{key:"_onRemoveInterleaved",value:function(e){e.off("styledata",this._handleStyleChange),md(e,this._deck,this._props.layers,[])}},{key:"getDefaultPosition",value:function(){return"top-left"}},{key:"pickObject",value:function(e){return rt(this._deck),this._deck.pickObject(e)}},{key:"pickMultipleObjects",value:function(e){return rt(this._deck),this._deck.pickMultipleObjects(e)}},{key:"pickObjects",value:function(e){return rt(this._deck),this._deck.pickObjects(e)}},{key:"finalize",value:function(){this._map&&this._map.removeControl(this)}}]),t}();var gd=h(Fy());Pa._checkH3Lib=function(){var t='include the <script src="https://unpkg.com/h3-js@^3.0.0"><\/script> tag before the deck.gl script tag. https://deck.gl/docs/api-reference/geo-layers/h3-hexagon-layer';if(gd){if(!gd.polyfill&&gd.polygonToCells)throw new Error("Incompatible h3-js version. ".concat(t))}else throw new Error("To use H3 functionality, ".concat(t))};return Ele(UBe);})();
      return __exports__;
      });
